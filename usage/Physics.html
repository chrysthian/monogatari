<!DOCTYPE html>
<meta charset="UTF-8">
<html>

<head>
  <title>Physics Usage - Monogatari</title>
  <link href="css/style.css" rel="stylesheet">
  <script src="../../monogatari.js"></script>
</head>

<body>

</body>
<script>
  var m = Monogatari;

  m.init("#000", 800, 600);

  m.physicsManager.createWorld(new m.THREE.Vector2(0, 10), true, null, m.world);

  var rbOpts = {
    density: 1,
    friction: 0,
    bounciness: 1
  };

  // zombieShape
  var zombieShape = new m.Box2D.b2CircleShape();
  zombieShape.set_m_radius(0.4);

  // zombie1
  var zombie = new m.GameObject('zombie1');

  var rb1 = new m.RigidBody(m.RigidBody.TYPE.DYNAMIC, zombieShape, rbOpts);
  rb1.setPosition(32, 128);

  var sprite = new m.Sprite('../assets/zombies.png', 64, 64, 1, 3);

  zombie.addComponent(sprite);
  zombie.addComponent(rb1);

  // Only zombie 1 displays messages, to avoid flood of information
  zombie.update = function () {
    var message = this.messages.pop();
    sprite.nextFrame();
    if (message) {
      console.log(message);
    }
  };

  m.world.children.push(zombie);

  // zombie2
  var zombie2 = new m.GameObject('zombie2');
  var rb2 = new m.RigidBody(m.RigidBody.TYPE.DYNAMIC, zombieShape, rbOpts);

  rb2.setPosition(0, 0);

  zombie2.addComponent(new m.Sprite('../assets/zombies.png', 64, 64, 1, 3));
  zombie2.addComponent(rb2);

  m.world.children.push(zombie2);

  //zombie3
  var zombie3 = new m.GameObject('zombie3');
  var rb3 = new m.RigidBody(m.RigidBody.TYPE.DYNAMIC, zombieShape, rbOpts);

  rb3.setPosition(96, 64);

  zombie3.addComponent(new m.Sprite('../assets/zombies.png', 64, 64, 1, 3));
  zombie3.addComponent(rb3);

  m.world.children.push(zombie3);

  //zombie4
  var zombie4 = new m.GameObject('zombie4');
  var rb4 = new m.RigidBody(m.RigidBody.TYPE.DYNAMIC, zombieShape, rbOpts);

  rb4.setPosition(64, 32);

  zombie4.addComponent(new m.Sprite('../assets/zombies.png', 64, 64, 1, 3));
  zombie4.addComponent(rb4);

  m.world.children.push(zombie4);

  // ground
  var groundShape = new m.Box2D.b2PolygonShape();
  groundShape.SetAsBox(100, 0.01);

  var ground = new m.GameObject('ground');
  var groundBody = new m.RigidBody(m.RigidBody.TYPE.STATIC, groundShape, rbOpts);

  groundBody.setPosition(0, 600);

  ground.addComponent(groundBody);

  m.world.children.push(ground);

  // wall shape
  var wallShape = new m.Box2D.b2PolygonShape();
  wallShape.SetAsBox(0.01, 100);

  // left wall
  var lWall = new m.GameObject('lWall');
  var lWallBody = new m.RigidBody(m.RigidBody.TYPE.STATIC, wallShape, rbOpts);

  lWallBody.setPosition(0, 0);

  lWall.addComponent(lWallBody);

  m.world.children.push(lWall);

  // right wall
  var rWall = new m.GameObject('rWall');
  var rWallBody = new m.RigidBody(m.RigidBody.TYPE.STATIC, wallShape, rbOpts);

  rWallBody.setPosition(800, 0);

  rWall.addComponent(rWallBody);

  m.world.children.push(rWall);
  m.run();
</script>

</html>