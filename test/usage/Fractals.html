<!DOCTYPE html>
<meta charset="UTF-8">
<html>

<head>
  <title>Fractals - Monogatari</title>
  <link href="css/style.css" rel="stylesheet">
  <script src="../../dist/monogatari.min.js"></script>
</head>

<body>
  <script>
    var m = Monogatari;

    m.init("#000");

    m.Random.init();

    var tree = new m.GameObject('tree');
    tree.position.set(m.sceneManager.canvasWidth / 2, m.sceneManager.canvasHeight / 2, 0);

    var Branch = function (begin, end) {
      this.begin = begin ? begin : new m.THREE.Vector3(0, 0, 0);
      this.end = end ? end : new m.THREE.Vector3(0, 0, 0);
      this.done = false;

      this.grow = function (side) {
        var dir = this.end.clone().sub(this.begin);
        var axis = new m.THREE.Vector3(0, 0, 1);
        var angle = side ? Math.random() : -Math.random();

        dir.applyAxisAngle(axis, angle);

        dir.multiplyScalar(0.9);

        return new Branch(this.end, dir.add(this.end));
      };

    };

    var branches = [];
    branches[0] = new Branch(
      new m.THREE.Vector3(m.sceneManager.canvasWidth / 2, m.sceneManager.canvasHeight - 100, 0),
      new m.THREE.Vector3(m.sceneManager.canvasWidth / 2, m.sceneManager.canvasHeight - 200, 0)
    );

    tree.update = function () {
      for (var i = 0, len = 100; i < len; i++) {
        if (!branches[i].done) {
          branches.push(branches[i].grow(0));
          branches.push(branches[i].grow(1));
          branches[i].done = true;
        }

        branches[i].end.x += m.Random.integer(-1, 1);
        branches[i].end.y += m.Random.integer(-1, 1);
      }
    };

    var draw = function () {
      this.setColor("#FFFFFF");

      for (var i = 0, len = branches.length; i < len; i++) {
        this.line(
          branches[i].begin.x,
          branches[i].begin.y,
          branches[i].end.x,
          branches[i].end.y
        );
      }
    };

    var canvas = new m.Canvas(m.sceneManager.canvasWidth, m.sceneManager.canvasHeight, draw);

    tree.addComponent(canvas);

    m.world.children.push(tree);

    m.run();
  </script>
</body>

</html>