/**
 * Simple JavaScript Inheritance. MIT Licensed.
 * Copyright (C) John Resig http://ejohn.org/
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, 
 * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

/**
 * Chance.js 0.5.4 (Modified)
 * Copyright (C) 2013 Victor Quinn  http://chancejs.com
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"),
 * to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, 
 * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, 
 * DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE 
 * OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

/*!
* @license PreloadJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2013 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/

/*!
* @license SoundJS
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2011-2013 gskinner.com, inc.
*
* Distributed under the terms of the MIT license.
* http://www.opensource.org/licenses/mit-license.html
*
* This notice shall be included in all copies or substantial portions of the Software.
*/

/**
 * Copyright 2013 Small Batch, Inc.
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy of
 * the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */

/**
 * The MIT License
 *
 * Copyright (C) 2010-2014 three.js authors http://github.com/mrdoob/three.js
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

/**
 * @author alteredq / http://alteredqualia.com/
 * @author mr.doob / http://mrdoob.com/
 * 
 * Copyright (C) 2010-2014 three.js authors http://github.com/mrdoob/three.js
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */

/**
 * https://github.com/HBehrens/box2d.js
 * 
 * Copyright (c) 2006-2013 Erin Catto http://www.gphysics.com
 * 
 * This software is provided 'as-is', without any express or implied
 * warranty. In no event will the authors be held liable for any damages
 * arising from the use of this software.
 * 
 * Permission is granted to anyone to use this software for any purpose,
 * including commercial applications, and to alter it and redistribute it
 * freely, subject to the following restrictions:
 * 
 *   1. The origin of this software must not be misrepresented; you must not
 *   claim that you wrote the original software. If you use this software
 *   in a product, an acknowledgment in the product documentation would be
 *   appreciated but is not required.
 * 
 *   2. Altered source versions must be plainly marked as such, and must not be
 *   misrepresented as being the original software.
 * 
 *   3. This notice may not be removed or altered from any source
 *   distribution.
 */

function extend(e,t){for(var n in t)e[n]=t[n]}function isInstanceOf(e,t){for(;typeof e=="object";){if(e.constructor===t)return!0;e=e._super}return!1}(function(){var e=!1,t=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;window.Class=function(){},Class.extend=function(n){function r(){!e&&this.init&&this.init.apply(this,arguments)}var i=this.prototype;e=!0;var s=new this;e=!1;for(var o in n)s[o]="function"==typeof n[o]&&"function"==typeof i[o]&&t.test(n[o])?function(e,t){return function(){var n=this._super;this._super=i[e];var r=t.apply(this,arguments);return this._super=n,r}}(o,n[o]):n[o];return r.prototype=s,r.prototype.constructor=r,r.extend=arguments.callee,r}})(),define("lib/Class",function(){}),function(){function e(e,t){e||(e={});if(!t)return e;for(var n in t)"undefined"==typeof e[n]&&(e[n]=t[n]);return e}function t(e,t){if(e)throw new RangeError(t)}var n=function(e){void 0!==e&&("function"==typeof e?this.random=e:this.seed=e),"undefined"==typeof this.random&&(this.mt=this.mersenne_twister(e),this.random=function(){return this.mt.random(this.seed)})};n.prototype.bool=function(n){return n=e(n,{likelihood:50}),t(0>n.likelihood||100<n.likelihood,"Chance: Likelihood accepts values from 0 to 100."),100*this.random()<n.likelihood},n.prototype.character=function(n){n=e(n);var r;return t(n.alpha&&n.symbols,"Chance: Cannot specify both alpha and symbols."),r="lower"===n.casing?"abcdefghijklmnopqrstuvwxyz":"upper"===n.casing?"ABCDEFGHIJKLMNOPQRSTUVWXYZ":"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",n=n.pool?n.pool:n.alpha?r:n.symbols?"!@#$%^&*()[]":r+"0123456789!@#$%^&*()[]",n.charAt(this.natural({max:n.length-1}))},n.prototype.floating=function(n){n=e(n,{fixed:4});var r=Math.pow(10,n.fixed);t(n.fixed&&n.precision,"Chance: Cannot specify both fixed and precision.");var i=9007199254740992/r,s=-i;return t(n.min&&n.fixed&&n.min<s,"Chance: Min specified is out of range with fixed. Min should be, at least, "+s),t(n.max&&n.fixed&&n.max>i,"Chance: Max specified is out of range with fixed. Max should be, at most, "+i),n=e(n,{min:s,max:i}),n=(this.integer({min:n.min*r,max:n.max*r})/r).toFixed(n.fixed),parseFloat(n)},n.prototype.integer=function(t){var n,r;t=e(t,{min:-9007199254740992,max:9007199254740992}),r=Math.max(Math.abs(t.min),Math.abs(t.max));do n=this.natural({max:r}),n=this.bool()?n:-1*n;while(n<t.min||n>t.max);return n},n.prototype.natural=function(n){return n=e(n,{min:0,max:9007199254740992}),t(n.min>n.max,"Chance: Min cannot be greater than Max."),Math.floor(this.random()*(n.max-n.min+1)+n.min)},n.prototype.normal=function(t){t=e(t,{mean:0,dev:1});var n,r,i=t.mean;t=t.dev;do r=2*this.random()-1,n=2*this.random()-1,n=r*r+n*n;while(1<=n);return r*=Math.sqrt(-2*Math.log(n)/n),t*r+i},n.prototype.string=function(t){t=e(t);var n=t.length||this.natural({min:5,max:20}),r="";t=t.pool;for(var i=0;i<n;i++)r+=this.character({pool:t});return r},n.prototype.capitalize=function(e){return e.charAt(0).toUpperCase()+e.substr(1)},n.prototype.mixin=function(e){for(var t in e)n.prototype[t]=e[t];return this},n.prototype.pick=function(e,t){return t&&1!==t?this.shuffle(e).slice(0,t):e[this.natural({max:e.length-1})]},n.prototype.shuffle=function(e){e=e.slice(0);for(var t=[],n=0,r=Number(e.length),i=0;i<r;i++)n=this.natural({max:e.length-1}),t[i]=e[n],e.splice(n,1);return t},n.prototype.ampm=function(){return this.bool()?"am":"pm"},n.prototype.date=function(t){var n=this.month({raw:!0});t=e(t,{year:parseInt(this.year(),10),month:n.numeric-1,day:this.natural({min:1,max:n.days}),hour:this.hour(),minute:this.minute(),second:this.second(),millisecond:this.millisecond(),american:!0,string:!1});var r=new Date(t.year,t.month,t.day,t.hour,t.minute,t.second,t.millisecond),n=t.american?r.getMonth()+1+"/"+r.getDate()+"/"+r.getFullYear():r.getDate()+"/"+(r.getMonth()+1)+"/"+r.getFullYear();return t.string?n:r},n.prototype.hammertime=function(e){return this.date(e).getTime()},n.prototype.hour=function(t){return t=e(t),this.natural({min:1,max:t.twentyfour?24:12})},n.prototype.millisecond=function(){return this.natural({max:999})},n.prototype.minute=n.prototype.second=function(){return this.natural({max:59})},n.prototype.month=function(t){t=e(t);var n=this.pick(this.months());return t.raw?n:n.name},n.prototype.months=function(){return[{name:"January",short_name:"Jan",numeric:"01",days:31},{name:"February",short_name:"Feb",numeric:"02",days:28},{name:"March",short_name:"Mar",numeric:"03",days:31},{name:"April",short_name:"Apr",numeric:"04",days:30},{name:"May",short_name:"May",numeric:"05",days:31},{name:"June",short_name:"Jun",numeric:"06",days:30},{name:"July",short_name:"Jul",numeric:"07",days:31},{name:"August",short_name:"Aug",numeric:"08",days:31},{name:"September",short_name:"Sep",numeric:"09",days:30},{name:"October",short_name:"Oct",numeric:"10",days:31},{name:"November",short_name:"Nov",numeric:"11",days:30},{name:"December",short_name:"Dec",numeric:"12",days:31}]},n.prototype.second=function(){return this.natural({max:59})},n.prototype.timestamp=function(){return this.natural({min:1,max:parseInt((new Date).getTime()/1e3,10)})},n.prototype.year=function(t){return t=e(t,{min:(new Date).getFullYear()}),t.max="undefined"!=typeof t.max?t.max:t.min+100,this.natural(t).toString()},n.prototype.d4=function(){return this.natural({min:1,max:4})},n.prototype.d6=function(){return this.natural({min:1,max:6})},n.prototype.d8=function(){return this.natural({min:1,max:8})},n.prototype.d10=function(){return this.natural({min:1,max:10})},n.prototype.d12=function(){return this.natural({min:1,max:12})},n.prototype.d20=function(){return this.natural({min:1,max:20})},n.prototype.d30=function(){return this.natural({min:1,max:30})},n.prototype.d100=function(){return this.natural({min:1,max:100})},n.prototype.rpg=function(t,n){n=e(n);if(null===t)throw Error("A type of die roll must be included");var r=t.toLowerCase().split("d"),i=[];if(2!==r.length||!parseInt(r[0],10)||!parseInt(r[1],10))throw Error("Invalid format provided. Please provide #d# where the first # is the number of dice to roll, the second # is the max of each die");for(var s=r[0];0<s;s--)i[s-1]=this.natural({min:1,max:r[1]});return"undefined"!=typeof n.sum&&n.sum?i.reduce(function(e,t){return e+t}):i},n.prototype.guid=function(e){return e=e||{version:5},this.string({pool:"ABCDEF1234567890",length:8})+"-"+this.string({pool:"ABCDEF1234567890",length:4})+"-"+e.version+this.string({pool:"ABCDEF1234567890",length:3})+"-"+this.string({pool:"AB89",length:1})+this.string({pool:"ABCDEF1234567890",length:3})+"-"+this.string({pool:"ABCDEF1234567890",length:12})},n.prototype.hash=function(t){return t=e(t,{length:40,casing:"lower"}),this.string({pool:"upper"===t.casing?"0123456789ABCDEF":"0123456789abcdef",length:t.length})},n.prototype.luhn_check=function(e){return e=e.toString(),+e.substring(e.length-1)===this.luhn_calculate(+e.substring(0,e.length-1))},n.prototype.luhn_calculate=function(e){e=e.toString().split("").reverse();for(var t=0,n=0,r=e.length;r>n;++n){var i=+e[n];0===n%2&&(i*=2,9<i&&(i-=9)),t+=i}return 9*t%10},n.prototype.mersenne_twister=function(e){return new r(e)},n.prototype.VERSION="0.5.4";var r=function(e){void 0===e&&(e=(new Date).getTime()),this.N=624,this.M=397,this.MATRIX_A=2567483615,this.UPPER_MASK=2147483648,this.LOWER_MASK=2147483647,this.mt=Array(this.N),this.mti=this.N+1,this.init_genrand(e)};r.prototype.init_genrand=function(e){this.mt[0]=e>>>0;for(this.mti=1;this.mti<this.N;this.mti++)e=this.mt[this.mti-1]^this.mt[this.mti-1]>>>30,this.mt[this.mti]=(1812433253*((e&4294901760)>>>16)<<16)+1812433253*(e&65535)+this.mti,this.mt[this.mti]>>>=0},r.prototype.init_by_array=function(e,t){var n=1,r=0,i,s;this.init_genrand(19650218);for(i=this.N>t?this.N:t;i;i--)s=this.mt[n-1]^this.mt[n-1]>>>30,this.mt[n]=(this.mt[n]^(1664525*((s&4294901760)>>>16)<<16)+1664525*(s&65535))+e[r]+r,this.mt[n]>>>=0,n++,r++,n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1),r>=t&&(r=0);for(i=this.N-1;i;i--)s=this.mt[n-1]^this.mt[n-1]>>>30,this.mt[n]=(this.mt[n]^(1566083941*((s&4294901760)>>>16)<<16)+1566083941*(s&65535))-n,this.mt[n]>>>=0,n++,n>=this.N&&(this.mt[0]=this.mt[this.N-1],n=1);this.mt[0]=2147483648},r.prototype.genrand_int32=function(){var e,t=[0,this.MATRIX_A];if(this.mti>=this.N){var n;this.mti===this.N+1&&this.init_genrand(5489);for(n=0;n<this.N-this.M;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+this.M]^e>>>1^t[e&1];for(;n<this.N-1;n++)e=this.mt[n]&this.UPPER_MASK|this.mt[n+1]&this.LOWER_MASK,this.mt[n]=this.mt[n+(this.M-this.N)]^e>>>1^t[e&1];e=this.mt[this.N-1]&this.UPPER_MASK|this.mt[0]&this.LOWER_MASK,this.mt[this.N-1]=this.mt[this.M-1]^e>>>1^t[e&1],this.mti=0}return e=this.mt[this.mti++],e^=e>>>11,e^=e<<7&2636928640,e^=e<<15&4022730752,(e^e>>>18)>>>0},r.prototype.genrand_int31=function(){return this.genrand_int32()>>>1},r.prototype.genrand_real1=function(){return this.genrand_int32()*(1/4294967295)},r.prototype.random=function(){return this.genrand_int32()*(1/4294967296)},r.prototype.genrand_real3=function(){return(this.genrand_int32()+.5)*(1/4294967296)},r.prototype.genrand_res53=function(){var e=this.genrand_int32()>>>5,t=this.genrand_int32()>>>6;return 1.1102230246251565e-16*(67108864*e+t)},"undefined"!=typeof exports&&("undefined"!=typeof module&&module.exports&&(exports=module.exports=n),exports.Chance=n),"function"==typeof define&&define.amd&&define("Chance",[],function(){return n}),"object"==typeof window&&"object"==typeof window.document&&(window.Chance=n,window.chance=new n)}(),define("lib/Random",function(){}),define("core/Monogatari",["lib/Class","lib/Random"],function(){function t(e){return e+(e<0?-0.5:.5)>>0}function n(e){return e+(e<0?0:1)>>0}function r(e){return e|0}function i(e){return e>0?e:-e}function s(e,t){return e<t?e:t}function o(e,t){return e>t?e:t}var e={};e._undefined=undefined,e.acos=Math.acos,e.sqrt=Math.sqrt,e.sin=Math.sin,e.cos=Math.cos,e.tan=Math.tan,e.atan=Math.atan,e.atan2=Math.atan2,e.pow=Math.pow,e.min=s,e.max=o,e.abs=i,e.round=t,e.ceil=n,e.floor=r,e.Random=chance,window.Monogatari=e}),define("core/Timer",["core/Monogatari"],function(){function e(){this._last=0,this._cycleTime=1e9,this.time=0,this.maxStep=60}function t(){this._lastTime=0,this._ticks=0,this._fps=0}Monogatari.Time=new e,e.prototype.tick=function(){var e=Date.now(),t=e-this._last;this.time>this._cycleTime&&(this.time=0),this.time+=Monogatari.min(t,this.maxStep),this._last=e},e.prototype.getTime=function(){return this.time>this._cycleTime&&(this.time=0),this.time},e.prototype.compare=function(e){return e>this.time?this.time+this._cycleTime-e:this.time-e},Monogatari.Frames=new t,t.prototype.getFps=function(){var e=Monogatari.Time.getTime(),t=e-this._lastTime;return t>=1e3&&(this._fps=this._ticks,this._ticks=0,this._lastTime=e),this._ticks++,this._fps}}),define("core/Constants",["core/Monogatari"],function(){function e(){this.BROWSER_ANDROID=1,this.BROWSER_CHROME=2,this.BROWSER_FIREFOX=3,this.BROWSER_IOS=4,this.BROWSER_SAFARI=5,this.BROWSER_OPERA=6,this.BROWSER_BLACKBERRY=7,this.BROWSER_IE=8,this.MODE_DEBUG=1,this.MODE_RELEASE=2,this.FRAME_RATE_60FPS=.016666666667,this.ONE_MEGABYTE=1048576,this.RADTODEG=57.295779513082,this.DEGTORAD=.0174532925199,this.SQRT_2=1.41421356237,this.PI=3.14159265358979,this.PI_2=6.28318530717958,this.PI_OVER_180=.0174532925199,this.PI_OVER_360=.0087266462599,this.ONE_DEGREE=this.PI_OVER_180,this.ASSET_STATE_LOADING=1,this.ASSET_STATE_LOADED=2,this.ASSET_STATE_FAILED=3,this.AUDIO_STATE_STOPED=0,this.AUDIO_STATE_PLAYING=1,this.AUDIO_STATE_PAUSED=2,this.AUDIO_STATE_FINISHED=3,this.COMPONENT_STATE_INITIALIZING=0,this.COMPONENT_STATE_BUFFERING=1,this.COMPONENT_STATE_READY=2,this.COMPONENT_STATE_FAILED=3,this.COMPONENT_BASE=0,this.COMPONENT_NODE=1,this.COMPONENT_THREE_OBJECT=2,this.COMPONENT_RIGID_BODY=3,this.COMPONENT_SPRITE=4,this.COMPONENT_STATIC_TEXT=5,this.COMPONENT_AUDIO_SOURCE=6,this.COMPONENT_PARTICLE_EMITTER=7,this.COMPONENT_CUSTOM=-1,this.FONT_CHARS_SIMPLE="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789_()-,.[]!?@$* ",this.REGEXP_URL=/(http|https):\/\/[\w-]+(\.[\w-]+)+([\w.,@?^=%&amp;:\/~+#-]*[\w@?^=%&amp;\/~+#-])?/,this.REGEXP_BETWEEN_SQUARE_BRACKETS=/\[[\w|\W]+\]/,this.REGEXP_ENDLINE=/\r\n|\r|\n/,this.PHYSICS_BODYTYPE_STATIC=1,this.PHYSICS_BODYTYPE_KINEMATIC=2,this.PHYSICS_BODYTYPE_DYNAMIC=3,this.DEFAULT_CAMERA_ID="default_camera_id",this.DEFAULT_SCENE_ID="default_scene_id"}Monogatari.Constants=new e}),define("core/String",["core/Monogatari","core/Constants"],function(){function e(){}Monogatari.String=new e,e.prototype.left=function(e,t){return t<=0?"":t>e.length?e:e.substring(0,t)},e.prototype.right=function(e,t){if(t<=0)return"";if(t>e.length)return e;var n=e.length;return e.substring(n,n-t)},e.prototype.endsWith=function(e,t){var n=e.length-t.length;return n>=0&&e.indexOf(t,n)===n},e.prototype.startsWith=function(e,t){return e.lastIndexOf(t,0)===0},e.prototype.contains=function(e,t){return e.indexOf(t)!=-1},e.prototype.getFileExtension=function(e){return/\.([a-zA-Z0-9]+)/.exec(e)[1]},e.prototype.isBetweenSquareBraquets=function(e){return/\[[\w|\W]+\]/.test(e)},e.prototype.isUrl=function(e){return Monogatari.Constants.REGEXP_URL.test(e)},e.prototype.isAlpha=function(e){return!/[^a-zA-Z]/.test(e)},e.prototype.isNumeric=function(e){return!/[^0-9]/.test(e)},e.prototype.isAlphaNumeric=function(e){return!/[^a-zA-Z0-9]/.test(e)},e.prototype.countOf=function(e,t){return e&&t?e.split(t).length-1:0},e.prototype.format=function(e){var t,n=Monogatari.Array.flat(arguments);n.shift();for(var r=0,i=n.length;r<i;r++)t=new RegExp("\\{"+r+"\\}","gi"),e=e.replace(t,n[r]);return e},e.prototype.trim=function(e){return e.replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},e.prototype.utf8_encode=function(e){e=(e+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var t="",n=0,r=0,i=0;i=e.length;for(var s=0;s<i;s++){var o=e.charCodeAt(s),u=null;o<128?r++:o>127&&o<2048?u=String.fromCharCode(o>>6|192)+String.fromCharCode(o&63|128):u=String.fromCharCode(o>>12|224)+String.fromCharCode(o>>6&63|128)+String.fromCharCode(o&63|128),u!=null&&(r>n&&(t+=e.substring(n,r)),t+=u,n=r=s+1)}return r>n&&(t+=e.substring(n,e.length)),t},e.prototype.utf8_decode=function(e){var t=[],n=0,r=0,i=0,s=0,o=0;e+="";while(n<e.length)i=e.charCodeAt(n),i<128?(t[r++]=String.fromCharCode(i),n++):i>191&&i<224?(s=e.charCodeAt(n+1),t[r++]=String.fromCharCode((i&31)<<6|s&63),n+=2):(s=e.charCodeAt(n+1),o=e.charCodeAt(n+2),t[r++]=String.fromCharCode((i&15)<<12|(s&63)<<6|o&63),n+=3);return t.join("")}}),define("core/Util",["core/Monogatari","core/Constants"],function(){function e(){this._browserDetect={},this._browserDetect.agent=window.navigator.userAgent,this._browserDetect.version=window.navigator.appVersion,this._browserDetect.plataform=window.navigator.platform;var e=this._browserDetect.agent;this._browserDetect.isFirefox=e.indexOf("Firefox")>-1,this._browserDetect.isOpera=window.opera!=null,this._browserDetect.isChrome=e.indexOf("Chrome")>-1,this._browserDetect.isIOS=e.indexOf("iPod")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1,this._browserDetect.isAndroid=e.indexOf("Android")>-1,this._browserDetect.isBlackberry=e.indexOf("Blackberry")>-1,this._browserDetect.isIE=e.indexOf("MSIE")>-1}Monogatari.Util=new e,e.prototype.createUniqueId=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=Math.random()*16|0,n=e=="x"?t:t&3|8;return n.toString(16)})},e.prototype.equals=function(e,t){return e===null||t===null?e===null&&t===null:typeof e=="string"?e===t:typeof e!="object"?e===t:e.equals instanceof Function?e.equals(t):e===t},e.prototype.parseUnitSize=function(e){var t=e.length-2;return t<0?e:e.indexOf("pt")===t?parseFloat(e.substring(0,t))*1.25:e.indexOf("pc")===t?parseFloat(e.substring(0,t))*15:e.indexOf("mm")===t?parseFloat(e.substring(0,t))*3.543307:e.indexOf("cm")===t?parseFloat(e.substring(0,t))*35.43307:e.indexOf("in")===t?parseFloat(e.substring(0,t))*90:e.indexOf("px")===t?parseFloat(e.substring(0,t)):parseFloat(e)},e.prototype.typeOf=function(e){return Object.prototype.toString.apply(e)},e.prototype.store=function(e,t,n){n?localStorage.setItem(e,JSON.stringify(t)):localStorage.setItem(e,t)},e.prototype.getBrowser=function(){if(this._browserDetect.isAndroid)return Monogatari.Constants.BROWSER_ANDROID;if(this._browserDetect.isChrome)return Monogatari.Constants.BROWSER_CHROME;if(this._browserDetect.isFirefox)return Monogatari.Constants.BROWSER_FIREFOX;if(this._browserDetect.isIOS)return Monogatari.Constants.BROWSER_IOS;if(this._browserDetect.isOpera)return Monogatari.Constants.BROWSER_OPERA;if(this._browserDetect.isBlackberry)return Monogatari.Constants.BROWSER_BLACKBERRY;if(this._browserDetect.isIE)return Monogatari.Constants.BROWSER_IE}}),define("core/Array",["core/Monogatari","core/Util"],function(){function e(){}Monogatari.Array=new e,e.prototype.float32Concat=function(e,t){var n=e.length,r=new Float32Array(n+t.length);return r.set(e),r.set(t,n),r},e.prototype.quicksort=function(e){if(e.length==0)return new Array;var t=new Array,n=new Array,r=e[0];for(var i=1,s=e.length;i<s;i++)e[i]<r?t[t.length]=e[i]:n[n.length]=e[i];return this.quicksort(t).concat(r,this.quicksort(n))},e.prototype.unique=function(e){var t=[],n=!1;for(var r=0,i=e.length;r<i;r++){n=!1;for(var s=0;s<t.length;s++)if(Monogatari.Util.equals(e[r],t[s])){n=!0;break}n||t.push(e[r])}return t},e.prototype.aphabeticalSort=function(e){return this.isArray(e)?(e.sort(function(e,t){return e.group<t.group?-1:e.group<t.group?1:0}),e):null},e.prototype.isArray=function(e){return Object.prototype.toString.apply(e)==="[object Array]"},e.prototype.indexOf=function(e,t,n){var r;if(this.isArray(t)){if(t.indexOf&&typeof t.indexOf=="function")return t.indexOf(e,n);r=t.length,n=n?n<0?max(0,r+n):n:0;for(;n<r;n++)if(n in t&&t[n]===e)return n}return-1},e.prototype.inArray=function(e,t,n){return Monogatari.Array.indexOf(e,t,n)>=0?!0:!1},e.prototype.remove=function(e,t,n){var r=e.slice((n||t)+1||e.length);return e.length=t<0?e.length+t:t,e.push.apply(e,r)},e.prototype.equals=function(e,t){var n=e.length,r=t.length;if(n!=r)return!1;for(var i=0;i<r;i++){if(this.isArray(e[i])){if(!this.equals(e[i],t[i]))return!1;continue}if(!Monogatari.Util.equals(e[i],t[i]))return!1}return!0},e.prototype.intersection=function(e,t){var n=concat.apply(Array.prototype,slice.call(t,1));return Monogatari.Array.unique(e).filter(function(e){return Monogatari.Array.inArray(e,n)})},e.prototype.difference=function(e,t){var n=concat.apply(Array.prototype,slice.call(t,1)),r=Monogatari.Array.unique(e).filter(function(e){return!Monogatari.Array.inArray(e,n)});return r},e.prototype.chunk=function(e,t){for(var n,r=0,i=-1,s=e.length,o=[];r<s;r++)(n=r%t)?o[i][n]=e[r]:o[++i]=[e[r]];return o},e.prototype.flat=function(e){return e.reduce(function(e,t){return e.concat(t)},[])}}),define("core/collection/Iterator",["core/Monogatari","core/Array"],function(){Monogatari.Iterator=Class.extend({init:function(e){if(!(e instanceof Array))return console.log("Unable to iterate: "+e),null;this.index=-1,this.hasNext=function(){return this.index+1<e.length},this.next=function(){return e[++this.index]}}}),Monogatari.ListIterator=Monogatari.Iterator.extend({init:function(e){if(!(e instanceof Array))return console.log("Unable to iterate: "+e),null;this._super(e),this.hasPrevious=function(){return this.index>0},this.previous=function(){return e[--this.index]},this.first=function(){return this.index=-1,e.length>0?e[0]:null},this.last=function(){return this.index=e.length-1,e.length>0?e[this.index]:null}}}),Monogatari.MapIterator=Class.extend({init:function(e,t){this.index=-1,this.hasNext=function(){return this.index+1<e.length},this.hasPrevious=function(){return this.index>0},this.next=function(){return t[e[++this.index]]},this.previous=function(){return t[e[--this.index]]},this.first=function(){return this.index=-1,e.length>0?t[e[0]]:null},this.last=function(){return this.index=e.length-1,e.length>0?t[e[this.index]]:null}}}),Monogatari.TreeIterator=Class.extend({init:function(e,t){this.index=-1,this.hasNext=function(){return this.index+1<e.length},this.hasPrevious=function(){return this.index>0},this.next=function(){return t[e[++this.index]].value},this.previous=function(){return t[e[--this.index]].value},this.first=function(){return this.index=-1,e.length>0?t[e[0]]:null},this.last=function(){return this.index=e.length-1,e.length>0?t[e[this.index]].value:null}}})}),define("core/collection/Map",["core/Monogatari","core/Array","core/collection/Iterator"],function(){Monogatari.Map=Class.extend({init:function(e,t){this._keys=e?e:new Array,this._values=t?t:{}},contains:function(e){return Monogatari.Array.inArray(e,this._keys)},get:function(e){return this.contains(e)?this._values[e]:null},put:function(e,t){var n=e?e:this.size();return this.contains(n)||this._keys.push(n),t?this._values[n]=t:this._values[n]||(this._values[n]=null),this._values[n]},size:function(){return this._keys.length},nullify:function(e){this._values[e]&&(this._values[e]=null)},concat:function(e){var t=e.getKeys(),n=e.getValues();for(var r=0,i=t.length;r<i;r++)this.put(t[r],n[r])},remove:function(e){if(this.contains(e))for(var t=0,n=this._keys.length;t<n;t++)this._keys[t]===e&&this._keys.splice(t,1)},removeFromCache:function(e){if(this.contains(e)){this._values[e]=null,delete this._values[e];for(var t=0,n=this._keys.length;t<n;t++)this._keys[t]===e&&this._keys.splice(t,1)}},clear:function(){this._values.length=0,this._values={},this._keys.length=0},isEmpty:function(){return this.size()===0},call:function(e,t){this.contains(e)&&typeof this._values[e]=="function"&&this._values[e](t)},getKeys:function(){return this._keys},getValues:function(){var e=new Array;for(var t=0,n=this.size();t<n;t++)e[t]=this._values[this._keys[t]];return e},toArray:function(){return this.getValues()},toJSON:function(){var e={};for(var t=0,n=this.size();t<n;t++)e[this._keys[t]]=this._values[this._keys[t]];return JSON.stringify(e)},clone:function(){return new Monogatari.Map(this._keys,this._values)},iterator:function(){return new Monogatari.MapIterator(this._keys,this._values)}})}),define("engine/EventManager",["core/Monogatari","core/Constants","core/collection/Map"],function(){function e(){this._listeners=new Monogatari.Map,this._iterator=this._listeners.iterator()}Monogatari.Event=function(e,t){this.type=e,this.handler=t},Monogatari.Message=function(e,t,n,r,i){this.from=e,this.to=t,this.type=n,this.message=r,this.handler=i},Monogatari.EventManager=new e,e.prototype.addListener=function(e,t,n){this._listeners.put(e,new Monogatari.Event(t,n))},e.prototype.notify=function(e,t){this._iterator.first();var n;while(this._iterator.hasNext())n=this._iterator.next(),n.type==e&&n.handler(t)},e.prototype.removeListener=function(e){this._listeners.removeFromCache(e)}}),this.createjs=this.createjs||{},function(){var e=createjs.PreloadJS=createjs.PreloadJS||{};e.version="NEXT",e.buildDate="Thu, 12 Dec 2013 23:37:07 GMT"}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n){this.initialize(e,t,n)},t=e.prototype;t.type=null,t.target=null,t.currentTarget=null,t.eventPhase=0,t.bubbles=!1,t.cancelable=!1,t.timeStamp=0,t.defaultPrevented=!1,t.propagationStopped=!1,t.immediatePropagationStopped=!1,t.removed=!1,t.initialize=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=(new Date).getTime()},t.preventDefault=function(){this.defaultPrevented=!0},t.stopPropagation=function(){this.propagationStopped=!0},t.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},t.remove=function(){this.removed=!0},t.clone=function(){return new e(this.type,this.bubbles,this.cancelable)},t.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=e}(),this.createjs=this.createjs||{},function(){var e=function(){},t=e.prototype;e.initialize=function(e){e.addEventListener=t.addEventListener,e.on=t.on,e.removeEventListener=e.off=t.removeEventListener,e.removeAllEventListeners=t.removeAllEventListeners,e.hasEventListener=t.hasEventListener,e.dispatchEvent=t.dispatchEvent,e._dispatchEvent=t._dispatchEvent,e.willTrigger=t.willTrigger},t._listeners=null,t._captureListeners=null,t.initialize=function(){},t.addEventListener=function(e,t,n){var r;r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var i=r[e];return i&&this.removeEventListener(e,t,n),i=r[e],i?i.push(t):r[e]=[t],t},t.on=function(e,t,n,r,i,s){return t.handleEvent&&(n=n||t,t=t.handleEvent),n=n||this,this.addEventListener(e,function(e){t.call(n,e,i),r&&e.remove()},s)},t.removeEventListener=function(e,t,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[e];if(i)for(var s=0,o=i.length;o>s;s++)if(i[s]==t){1==o?delete r[e]:i.splice(s,1);break}}},t.off=t.removeEventListener,t.removeAllEventListeners=function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null},t.dispatchEvent=function(e,t){if("string"==typeof e){var n=this._listeners;if(!n||!n[e])return!1;e=new createjs.Event(e)}if(e.target=t||this,e.bubbles&&this.parent){for(var r=this,i=[r];r.parent;)i.push(r=r.parent);var s,o=i.length;for(s=o-1;s>=0&&!e.propagationStopped;s--)i[s]._dispatchEvent(e,1+(0==s));for(s=1;o>s&&!e.propagationStopped;s++)i[s]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented},t.hasEventListener=function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])},t.willTrigger=function(e){for(var t=this;t;){if(t.hasEventListener(e))return!0;t=t.parent}return!1},t.toString=function(){return"[EventDispatcher]"},t._dispatchEvent=function(e,t){var n,r=1==t?this._captureListeners:this._listeners;if(e&&r){var i=r[e.type];if(!i||!(n=i.length))return;e.currentTarget=this,e.eventPhase=t,e.removed=!1,i=i.slice();for(var s=0;n>s&&!e.immediatePropagationStopped;s++){var o=i[s];o.handleEvent?o.handleEvent(e):o(e),e.removed&&(this.off(e.type,o,1==t),e.removed=!1)}}},createjs.EventDispatcher=e}(),this.createjs=this.createjs||{},function(){createjs.indexOf=function(e,t){for(var n=0,r=e.length;r>n;n++)if(t===e[n])return n;return-1}}(),this.createjs=this.createjs||{},function(){createjs.proxy=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,Array.prototype.slice.call(arguments,0).concat(n))}}}(),this.createjs=this.createjs||{},function(){var e=function(){this.init()};e.prototype=new createjs.EventDispatcher;var t=e.prototype,n=e;n.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?)|(.{0,2}\/{1}))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,n.PATH_PATTERN=/^(?:(\w+:)\/{2})|(.{0,2}\/{1})?([/.]*?(?:[^?]+)?\/?)?$/,t.loaded=!1,t.canceled=!1,t.progress=0,t._item=null,t.getItem=function(){return this._item},t.init=function(){},t.load=function(){},t.close=function(){},t._sendLoadStart=function(){this._isCanceled()||this.dispatchEvent("loadstart")},t._sendProgress=function(e){if(!this._isCanceled()){var t=null;"number"==typeof e?(this.progress=e,t=new createjs.Event("progress"),t.loaded=this.progress,t.total=1):(t=e,this.progress=e.loaded/e.total,(isNaN(this.progress)||1/0==this.progress)&&(this.progress=0)),t.progress=this.progress,this.hasEventListener("progress")&&this.dispatchEvent(t)}},t._sendComplete=function(){this._isCanceled()||this.dispatchEvent("complete")},t._sendError=function(e){!this._isCanceled()&&this.hasEventListener("error")&&(null==e&&(e=new createjs.Event("error")),this.dispatchEvent(e))},t._isCanceled=function(){return null==window.createjs||this.canceled?!0:!1},t._parseURI=function(e){return e?e.match(n.FILE_PATTERN):null},t._parsePath=function(e){return e?e.match(n.PATH_PATTERN):null},t._formatQueryString=function(e,t){if(null==e)throw new Error("You must specify data.");var n=[];for(var r in e)n.push(r+"="+escape(e[r]));return t&&(n=n.concat(t)),n.join("&")},t.buildPath=function(e,t){if(null==t)return e;var n=[],r=e.indexOf("?");if(-1!=r){var i=e.slice(r+1);n=n.concat(i.split("&"))}return-1!=r?e.slice(0,r)+"?"+this._formatQueryString(t,n):e+"?"+this._formatQueryString(t,n)},t._isCrossDomain=function(e){var t=document.createElement("a");t.href=e.src;var n=document.createElement("a");n.href=location.href;var r=""!=t.hostname&&(t.port!=n.port||t.protocol!=n.protocol||t.hostname!=n.hostname);return r},t._isLocal=function(e){var t=document.createElement("a");return t.href=e.src,""==t.hostname&&"file:"==t.protocol},t.toString=function(){return"[PreloadJS AbstractLoader]"},createjs.AbstractLoader=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n){this.init(e,t,n)},t=e.prototype=new createjs.AbstractLoader,n=e;n.loadTimeout=8e3,n.LOAD_TIMEOUT=0,n.BINARY="binary",n.CSS="css",n.IMAGE="image",n.JAVASCRIPT="javascript",n.JSON="json",n.JSONP="jsonp",n.MANIFEST="manifest",n.SOUND="sound",n.SVG="svg",n.TEXT="text",n.XML="xml",n.POST="POST",n.GET="GET",t._basePath=null,t._crossOrigin="",t.useXHR=!0,t.stopOnError=!1,t.maintainScriptOrder=!0,t.next=null,t._typeCallbacks=null,t._extensionCallbacks=null,t._loadStartWasDispatched=!1,t._maxConnections=1,t._currentlyLoadingScript=null,t._currentLoads=null,t._loadQueue=null,t._loadQueueBackup=null,t._loadItemsById=null,t._loadItemsBySrc=null,t._loadedResults=null,t._loadedRawResults=null,t._numItems=0,t._numItemsLoaded=0,t._scriptOrder=null,t._loadedScripts=null,t.init=function(e,t,n){this._numItems=this._numItemsLoaded=0,this._paused=!1,this._loadStartWasDispatched=!1,this._currentLoads=[],this._loadQueue=[],this._loadQueueBackup=[],this._scriptOrder=[],this._loadedScripts=[],this._loadItemsById={},this._loadItemsBySrc={},this._loadedResults={},this._loadedRawResults={},this._typeCallbacks={},this._extensionCallbacks={},this._basePath=t,this.setUseXHR(e),this._crossOrigin=n===!0?"Anonymous":n===!1||null==n?"":n},t.setUseXHR=function(e){return this.useXHR=0!=e&&null!=window.XMLHttpRequest,this.useXHR},t.removeAll=function(){this.remove()},t.remove=function(e){var t=null;if(!e||e instanceof Array){if(e)t=e;else if(arguments.length>0)return}else t=[e];var n=!1;if(t){for(;t.length;){var r=t.pop(),i=this.getResult(r);for(s=this._loadQueue.length-1;s>=0;s--)if(o=this._loadQueue[s].getItem(),o.id==r||o.src==r){this._loadQueue.splice(s,1)[0].cancel();break}for(s=this._loadQueueBackup.length-1;s>=0;s--)if(o=this._loadQueueBackup[s].getItem(),o.id==r||o.src==r){this._loadQueueBackup.splice(s,1)[0].cancel();break}if(i)delete this._loadItemsById[i.id],delete this._loadItemsBySrc[i.src],this._disposeItem(i);else for(var s=this._currentLoads.length-1;s>=0;s--){var o=this._currentLoads[s].getItem();if(o.id==r||o.src==r){this._currentLoads.splice(s,1)[0].cancel(),n=!0;break}}}n&&this._loadNext()}else{this.close();for(var u in this._loadItemsById)this._disposeItem(this._loadItemsById[u]);this.init(this.useXHR)}},t.reset=function(){this.close();for(var e in this._loadItemsById)this._disposeItem(this._loadItemsById[e]);for(var t=[],n=0,r=this._loadQueueBackup.length;r>n;n++)t.push(this._loadQueueBackup[n].getItem());this.loadManifest(t,!1)},n.isBinary=function(e){switch(e){case createjs.LoadQueue.IMAGE:case createjs.LoadQueue.BINARY:return!0;default:return!1}},n.isText=function(e){switch(e){case createjs.LoadQueue.TEXT:case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:case createjs.LoadQueue.XML:case createjs.LoadQueue.HTML:case createjs.LoadQueue.CSS:case createjs.LoadQueue.SVG:case createjs.LoadQueue.JAVASCRIPT:return!0;default:return!1}},t.installPlugin=function(e){if(null!=e&&null!=e.getPreloadHandlers){var t=e.getPreloadHandlers();if(t.scope=e,null!=t.types)for(var n=0,r=t.types.length;r>n;n++)this._typeCallbacks[t.types[n]]=t;if(null!=t.extensions)for(n=0,r=t.extensions.length;r>n;n++)this._extensionCallbacks[t.extensions[n]]=t}},t.setMaxConnections=function(e){this._maxConnections=e,!this._paused&&this._loadQueue.length>0&&this._loadNext()},t.loadFile=function(e,t,n){if(null==e){var r=new createjs.Event("error");return r.text="PRELOAD_NO_FILE",this._sendError(r),void 0}this._addItem(e,null,n),t!==!1?this.setPaused(!1):this.setPaused(!0)},t.loadManifest=function(e,t,r){var i=null,s=null;if(e instanceof Array){if(0==e.length){var o=new createjs.Event("error");return o.text="PRELOAD_MANIFEST_EMPTY",this._sendError(o),void 0}i=e}else if("string"==typeof e)i=[{src:e,type:n.MANIFEST}];else{if("object"!=typeof e){var o=new createjs.Event("error");return o.text="PRELOAD_MANIFEST_NULL",this._sendError(o),void 0}if(void 0!==e.src){if(null==e.type)e.type=n.MANIFEST;else if(e.type!=n.MANIFEST){var o=new createjs.Event("error");o.text="PRELOAD_MANIFEST_ERROR",this._sendError(o)}i=[e]}else void 0!==e.manifest&&(i=e.manifest,s=e.path)}for(var u=0,a=i.length;a>u;u++)this._addItem(i[u],s,r);t!==!1?this.setPaused(!1):this.setPaused(!0)},t.load=function(){this.setPaused(!1)},t.getItem=function(e){return this._loadItemsById[e]||this._loadItemsBySrc[e]},t.getResult=function(e,t){var n=this._loadItemsById[e]||this._loadItemsBySrc[e];if(null==n)return null;var r=n.id;return t&&this._loadedRawResults[r]?this._loadedRawResults[r]:this._loadedResults[r]},t.setPaused=function(e){this._paused=e,this._paused||this._loadNext()},t.close=function(){for(;this._currentLoads.length;)this._currentLoads.pop().cancel();this._scriptOrder.length=0,this._loadedScripts.length=0,this.loadStartWasDispatched=!1},t._addItem=function(e,t,n){var r=this._createLoadItem(e,t,n);if(null!=r){var i=this._createLoader(r);null!=i&&(this._loadQueue.push(i),this._loadQueueBackup.push(i),this._numItems++,this._updateProgress(),this.maintainScriptOrder&&r.type==createjs.LoadQueue.JAVASCRIPT&&i instanceof createjs.XHRLoader&&(this._scriptOrder.push(r),this._loadedScripts.push(null)))}},t._createLoadItem=function(e,t,n){var r=null;switch(typeof e){case"string":r={src:e};break;case"object":r=window.HTMLAudioElement&&e instanceof window.HTMLAudioElement?{tag:e,src:r.tag.src,type:createjs.LoadQueue.SOUND}:e;break;default:return null}var i=this._parseURI(r.src);null!=i&&(r.ext=i[6]),null==r.type&&(r.type=this._getTypeByExtension(r.ext));var s="",o=n||this._basePath,u=r.src;if(i&&null==i[1]&&null==i[3])if(t){s=t;var a=this._parsePath(t);u=t+u,null!=o&&a&&null==a[1]&&null==a[2]&&(s=o+s)}else null!=o&&(s=o);if(r.src=s+r.src,r.path=s,(r.type==createjs.LoadQueue.JSON||r.type==createjs.LoadQueue.MANIFEST)&&(r._loadAsJSONP=null!=r.callback),r.type==createjs.LoadQueue.JSONP&&null==r.callback)throw new Error("callback is required for loading JSONP requests.");(void 0===r.tag||null===r.tag)&&(r.tag=this._createTag(r)),(void 0===r.id||null===r.id||""===r.id)&&(r.id=u);var f=this._typeCallbacks[r.type]||this._extensionCallbacks[r.ext];if(f){var l=f.callback.call(f.scope,r.src,r.type,r.id,r.data,s,this);if(l===!1)return null;l===!0||(null!=l.src&&(r.src=l.src),null!=l.id&&(r.id=l.id),null!=l.tag&&(r.tag=l.tag),null!=l.completeHandler&&(r.completeHandler=l.completeHandler),l.type&&(r.type=l.type),i=this._parseURI(r.src),null!=i&&null!=i[6]&&(r.ext=i[6].toLowerCase()))}return this._loadItemsById[r.id]=r,this._loadItemsBySrc[r.src]=r,r},t._createLoader=function(e){var t=this.useXHR;switch(e.type){case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:t=!e._loadAsJSONP;break;case createjs.LoadQueue.XML:case createjs.LoadQueue.TEXT:t=!0;break;case createjs.LoadQueue.SOUND:case createjs.LoadQueue.JSONP:t=!1;break;case null:return null}return t?new createjs.XHRLoader(e,this._crossOrigin):new createjs.TagLoader(e)},t._loadNext=function(){if(!this._paused){this._loadStartWasDispatched||(this._sendLoadStart(),this._loadStartWasDispatched=!0),this._numItems==this._numItemsLoaded?(this.loaded=!0,this._sendComplete(),this.next&&this.next.load&&this.next.load()):this.loaded=!1;for(var e=0;e<this._loadQueue.length&&!(this._currentLoads.length>=this._maxConnections);e++){var t=this._loadQueue[e];if(this.maintainScriptOrder&&t instanceof createjs.TagLoader&&t.getItem().type==createjs.LoadQueue.JAVASCRIPT){if(this._currentlyLoadingScript)continue;this._currentlyLoadingScript=!0}this._loadQueue.splice(e,1),e--,this._loadItem(t)}}},t._loadItem=function(e){e.on("progress",this._handleProgress,this),e.on("complete",this._handleFileComplete,this),e.on("error",this._handleFileError,this),this._currentLoads.push(e),this._sendFileStart(e.getItem()),e.load()},t._handleFileError=function(e){var t=e.target;this._numItemsLoaded++,this._updateProgress();var n=new createjs.Event("error");n.text="FILE_LOAD_ERROR",n.item=t.getItem(),this._sendError(n),this.stopOnError||(this._removeLoadItem(t),this._loadNext())},t._handleFileComplete=function(e){var t=e.target,n=t.getItem();if(this._loadedResults[n.id]=t.getResult(),t instanceof createjs.XHRLoader&&(this._loadedRawResults[n.id]=t.getResult(!0)),this._removeLoadItem(t),this.maintainScriptOrder&&n.type==createjs.LoadQueue.JAVASCRIPT){if(!(t instanceof createjs.TagLoader))return this._loadedScripts[createjs.indexOf(this._scriptOrder,n)]=n,this._checkScriptLoadOrder(t),void 0;this._currentlyLoadingScript=!1}if(delete n._loadAsJSONP,n.type==createjs.LoadQueue.MANIFEST){var r=t.getResult();null!=r&&void 0!==r.manifest&&this.loadManifest(r,!0)}this._processFinishedLoad(n,t)},t._processFinishedLoad=function(e,t){this._numItemsLoaded++,this._updateProgress(),this._sendFileComplete(e,t),this._loadNext()},t._checkScriptLoadOrder=function(){for(var e=this._loadedScripts.length,t=0;e>t;t++){var n=this._loadedScripts[t];if(null===n)break;if(n!==!0){var r=this._loadedResults[n.id];(document.body||document.getElementsByTagName("body")[0]).appendChild(r),this._processFinishedLoad(n),this._loadedScripts[t]=!0}}},t._removeLoadItem=function(e){for(var t=this._currentLoads.length,n=0;t>n;n++)if(this._currentLoads[n]==e){this._currentLoads.splice(n,1);break}},t._handleProgress=function(e){var t=e.target;this._sendFileProgress(t.getItem(),t.progress),this._updateProgress()},t._updateProgress=function(){var e=this._numItemsLoaded/this._numItems,t=this._numItems-this._numItemsLoaded;if(t>0){for(var n=0,r=0,i=this._currentLoads.length;i>r;r++)n+=this._currentLoads[r].progress;e+=n/t*(t/this._numItems)}this._sendProgress(e)},t._disposeItem=function(e){delete this._loadedResults[e.id],delete this._loadedRawResults[e.id],delete this._loadItemsById[e.id],delete this._loadItemsBySrc[e.src]},t._createTag=function(e){var t=null;switch(e.type){case createjs.LoadQueue.IMAGE:return t=document.createElement("img"),""==this._crossOrigin||this._isLocal(e)||(t.crossOrigin=this._crossOrigin),t;case createjs.LoadQueue.SOUND:return t=document.createElement("audio"),t.autoplay=!1,t;case createjs.LoadQueue.JSON:case createjs.LoadQueue.JSONP:case createjs.LoadQueue.JAVASCRIPT:case createjs.LoadQueue.MANIFEST:return t=document.createElement("script"),t.type="text/javascript",t;case createjs.LoadQueue.CSS:return t=this.useXHR?document.createElement("style"):document.createElement("link"),t.rel="stylesheet",t.type="text/css",t;case createjs.LoadQueue.SVG:return this.useXHR?t=document.createElement("svg"):(t=document.createElement("object"),t.type="image/svg+xml"),t}return null},t._getTypeByExtension=function(e){if(null==e)return createjs.LoadQueue.TEXT;switch(e.toLowerCase()){case"jpeg":case"jpg":case"gif":case"png":case"webp":case"bmp":return createjs.LoadQueue.IMAGE;case"ogg":case"mp3":case"wav":return createjs.LoadQueue.SOUND;case"json":return createjs.LoadQueue.JSON;case"xml":return createjs.LoadQueue.XML;case"css":return createjs.LoadQueue.CSS;case"js":return createjs.LoadQueue.JAVASCRIPT;case"svg":return createjs.LoadQueue.SVG;default:return createjs.LoadQueue.TEXT}},t._sendFileProgress=function(e,t){if(this._isCanceled())return this._cleanUp(),void 0;if(this.hasEventListener("fileprogress")){var n=new createjs.Event("fileprogress");n.progress=t,n.loaded=t,n.total=1,n.item=e,this.dispatchEvent(n)}},t._sendFileComplete=function(e,t){if(!this._isCanceled()){var n=new createjs.Event("fileload");n.loader=t,n.item=e,n.result=this._loadedResults[e.id],n.rawResult=this._loadedRawResults[e.id],e.completeHandler&&e.completeHandler(n),this.hasEventListener("fileload")&&this.dispatchEvent(n)}},t._sendFileStart=function(e){var t=new createjs.Event("filestart");t.item=e,this.hasEventListener("filestart")&&this.dispatchEvent(t)},t.toString=function(){return"[PreloadJS LoadQueue]"},createjs.LoadQueue=e;var r=function(){};r.init=function(){var e=navigator.userAgent;r.isFirefox=e.indexOf("Firefox")>-1,r.isOpera=null!=window.opera,r.isChrome=e.indexOf("Chrome")>-1,r.isIOS=e.indexOf("iPod")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1},r.init(),createjs.LoadQueue.BrowserDetect=r}(),this.createjs=this.createjs||{},function(){var e=function(e){this.init(e)},t=e.prototype=new createjs.AbstractLoader;t._loadTimeout=null,t._tagCompleteProxy=null,t._isAudio=!1,t._tag=null,t._jsonResult=null,t.init=function(e){this._item=e,this._tag=e.tag,this._isAudio=window.HTMLAudioElement&&e.tag instanceof window.HTMLAudioElement,this._tagCompleteProxy=createjs.proxy(this._handleLoad,this)},t.getResult=function(){return this._item.type==createjs.LoadQueue.JSONP||this._item.type==createjs.LoadQueue.MANIFEST?this._jsonResult:this._tag},t.cancel=function(){this.canceled=!0,this._clean()},t.load=function(){var e=this._item,t=this._tag;clearTimeout(this._loadTimeout);var n=createjs.LoadQueue.LOAD_TIMEOUT;0==n&&(n=createjs.LoadQueue.loadTimeout),this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),n),this._isAudio&&(t.src=null,t.preload="auto"),t.onerror=createjs.proxy(this._handleError,this),this._isAudio?(t.onstalled=createjs.proxy(this._handleStalled,this),t.addEventListener("canplaythrough",this._tagCompleteProxy,!1)):(t.onload=createjs.proxy(this._handleLoad,this),t.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this));var r=this.buildPath(e.src,e.values);switch(e.type){case createjs.LoadQueue.CSS:t.href=r;break;case createjs.LoadQueue.SVG:t.data=r;break;default:t.src=r}if(e.type==createjs.LoadQueue.JSONP||e.type==createjs.LoadQueue.JSON||e.type==createjs.LoadQueue.MANIFEST){if(null==e.callback)throw new Error("callback is required for loading JSONP requests.");if(null!=window[e.callback])throw new Error('JSONP callback "'+e.callback+'" already exists on window. You need to specify a different callback. Or re-name the current one.');window[e.callback]=createjs.proxy(this._handleJSONPLoad,this)}(e.type==createjs.LoadQueue.SVG||e.type==createjs.LoadQueue.JSONP||e.type==createjs.LoadQueue.JSON||e.type==createjs.LoadQueue.MANIFEST||e.type==createjs.LoadQueue.JAVASCRIPT||e.type==createjs.LoadQueue.CSS)&&(this._startTagVisibility=t.style.visibility,t.style.visibility="hidden",(document.body||document.getElementsByTagName("body")[0]).appendChild(t)),null!=t.load&&t.load()},t._handleJSONPLoad=function(e){this._jsonResult=e},t._handleTimeout=function(){this._clean();var e=new createjs.Event("error");e.text="PRELOAD_TIMEOUT",this._sendError(e)},t._handleStalled=function(){},t._handleError=function(){this._clean();var e=new createjs.Event("error");this._sendError(e)},t._handleReadyStateChange=function(){clearTimeout(this._loadTimeout);var e=this.getItem().tag;("loaded"==e.readyState||"complete"==e.readyState)&&this._handleLoad()},t._handleLoad=function(){if(!this._isCanceled()){var e=this.getItem(),t=e.tag;if(!(this.loaded||this._isAudio&&4!==t.readyState)){switch(this.loaded=!0,e.type){case createjs.LoadQueue.SVG:case createjs.LoadQueue.JSON:case createjs.LoadQueue.JSONP:case createjs.LoadQueue.MANIFEST:case createjs.LoadQueue.CSS:t.style.visibility=this._startTagVisibility,(document.body||document.getElementsByTagName("body")[0]).removeChild(t)}this._clean(),this._sendComplete()}}},t._clean=function(){clearTimeout(this._loadTimeout);var e=this.getItem(),t=e.tag;null!=t&&(t.onload=null,t.removeEventListener&&t.removeEventListener("canplaythrough",this._tagCompleteProxy,!1),t.onstalled=null,t.onprogress=null,t.onerror=null,null!=t.parentNode&&e.type==createjs.LoadQueue.SVG&&e.type==createjs.LoadQueue.JSON&&e.type==createjs.LoadQueue.MANIFEST&&e.type==createjs.LoadQueue.CSS&&e.type==createjs.LoadQueue.JSONP&&t.parentNode.removeChild(t));var e=this.getItem();(e.type==createjs.LoadQueue.JSONP||e.type==createjs.LoadQueue.MANIFEST)&&(window[e.callback]=null)},t.toString=function(){return"[PreloadJS TagLoader]"},createjs.TagLoader=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t){this.init(e,t)},t=e.prototype=new createjs.AbstractLoader;t._request=null,t._loadTimeout=null,t._xhrLevel=1,t._response=null,t._rawResponse=null,t._crossOrigin="",t.init=function(e,t){this._item=e,this._crossOrigin=t,!this._createXHR(e)},t.getResult=function(e){return e&&this._rawResponse?this._rawResponse:this._response},t.cancel=function(){this.canceled=!0,this._clean(),this._request.abort()},t.load=function(){if(null==this._request)return this._handleError(),void 0;if(this._request.onloadstart=createjs.proxy(this._handleLoadStart,this),this._request.onprogress=createjs.proxy(this._handleProgress,this),this._request.onabort=createjs.proxy(this._handleAbort,this),this._request.onerror=createjs.proxy(this._handleError,this),this._request.ontimeout=createjs.proxy(this._handleTimeout,this),1==this._xhrLevel){var e=createjs.LoadQueue.LOAD_TIMEOUT;if(0==e)e=createjs.LoadQueue.loadTimeout;else try{console.warn("LoadQueue.LOAD_TIMEOUT has been deprecated in favor of LoadQueue.loadTimeout")}catch(t){}this._loadTimeout=setTimeout(createjs.proxy(this._handleTimeout,this),e)}this._request.onload=createjs.proxy(this._handleLoad,this),this._request.onreadystatechange=createjs.proxy(this._handleReadyStateChange,this);try{this._item.values&&this._item.method!=createjs.LoadQueue.GET?this._item.method==createjs.LoadQueue.POST&&this._request.send(this._formatQueryString(this._item.values)):this._request.send()}catch(n){var r=new createjs.Event("error");r.error=n,this._sendError(r)}},t.getAllResponseHeaders=function(){return this._request.getAllResponseHeaders instanceof Function?this._request.getAllResponseHeaders():null},t.getResponseHeader=function(e){return this._request.getResponseHeader instanceof Function?this._request.getResponseHeader(e):null},t._handleProgress=function(e){if(e&&!(e.loaded>0&&0==e.total)){var t=new createjs.Event("progress");t.loaded=e.loaded,t.total=e.total,this._sendProgress(t)}},t._handleLoadStart=function(){clearTimeout(this._loadTimeout),this._sendLoadStart()},t._handleAbort=function(){this._clean();var e=new createjs.Event("error");e.text="XHR_ABORTED",this._sendError(e)},t._handleError=function(){this._clean();var e=new createjs.Event("error");this._sendError(e)},t._handleReadyStateChange=function(){4==this._request.readyState&&this._handleLoad()},t._handleLoad=function(){if(!this.loaded){if(this.loaded=!0,!this._checkError())return this._handleError(),void 0;this._response=this._getResponse(),this._clean();var e=this._generateTag();e&&this._sendComplete()}},t._handleTimeout=function(e){this._clean();var t=new createjs.Event("error");t.text="PRELOAD_TIMEOUT",this._sendError(e)},t._checkError=function(){var e=parseInt(this._request.status);switch(e){case 404:case 0:return!1}return!0},t._getResponse=function(){if(null!=this._response)return this._response;if(null!=this._request.response)return this._request.response;try{if(null!=this._request.responseText)return this._request.responseText}catch(e){}try{if(null!=this._request.responseXML)return this._request.responseXML}catch(e){}return null},t._createXHR=function(e){var t=this._isCrossDomain(e),n=null;if(t&&window.XDomainRequest)n=new XDomainRequest;else if(window.XMLHttpRequest)n=new XMLHttpRequest;else try{n=new ActiveXObject("Msxml2.XMLHTTP.6.0")}catch(r){try{n=new ActiveXObject("Msxml2.XMLHTTP.3.0")}catch(r){try{n=new ActiveXObject("Msxml2.XMLHTTP")}catch(r){return!1}}}createjs.LoadQueue.isText(e.type)&&n.overrideMimeType&&n.overrideMimeType("text/plain; charset=utf-8"),this._xhrLevel="string"==typeof n.responseType?2:1;var i=null;return i=e.method==createjs.LoadQueue.GET?this.buildPath(e.src,e.values):e.src,n.open(e.method||createjs.LoadQueue.GET,i,!0),t&&n instanceof XMLHttpRequest&&1==this._xhrLevel&&n.setRequestHeader("Origin",location.origin),e.values&&e.method==createjs.LoadQueue.POST&&n.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),createjs.LoadQueue.isBinary(e.type)&&(n.responseType="arraybuffer"),this._request=n,!0},t._clean=function(){clearTimeout(this._loadTimeout);var e=this._request;e.onloadstart=null,e.onprogress=null,e.onabort=null,e.onerror=null,e.onload=null,e.ontimeout=null,e.onloadend=null,e.onreadystatechange=null},t._generateTag=function(){var e=this._item.type,t=this._item.tag;switch(e){case createjs.LoadQueue.IMAGE:return t.onload=createjs.proxy(this._handleTagReady,this),""!=this._crossOrigin&&(t.crossOrigin="Anonymous"),t.src=this.buildPath(this._item.src,this._item.values),this._rawResponse=this._response,this._response=t,!1;case createjs.LoadQueue.JAVASCRIPT:return t=document.createElement("script"),t.text=this._response,this._rawResponse=this._response,this._response=t,!0;case createjs.LoadQueue.CSS:var n=document.getElementsByTagName("head")[0];if(n.appendChild(t),t.styleSheet)t.styleSheet.cssText=this._response;else{var r=document.createTextNode(this._response);t.appendChild(r)}return this._rawResponse=this._response,this._response=t,!0;case createjs.LoadQueue.XML:var i=this._parseXML(this._response,"text/xml");return this._rawResponse=this._response,this._response=i,!0;case createjs.LoadQueue.SVG:var i=this._parseXML(this._response,"image/svg+xml");return this._rawResponse=this._response,null!=i.documentElement?(t.appendChild(i.documentElement),this._response=t):this._response=i,!0;case createjs.LoadQueue.JSON:case createjs.LoadQueue.MANIFEST:var s={};try{s=JSON.parse(this._response)}catch(o){s=o}return this._rawResponse=this._response,this._response=s,!0}return!0},t._parseXML=function(e,t){var n=null;try{if(window.DOMParser){var r=new DOMParser;n=r.parseFromString(e,t)}else n=new ActiveXObject("Microsoft.XMLDOM"),n.async=!1,n.loadXML(e)}catch(i){}return n},t._handleTagReady=function(){this._sendComplete()},t.toString=function(){return"[PreloadJS XHRLoader]"},createjs.XHRLoader=e}(),"object"!=typeof JSON&&(JSON={}),function(){function f(e){return 10>e?"0"+e:e}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function str(e,t){var n,r,i,s,o,u=gap,a=t[e];switch(a&&"object"==typeof a&&"function"==typeof a.toJSON&&(a=a.toJSON(e)),"function"==typeof rep&&(a=rep.call(t,e,a)),typeof a){case"string":return quote(a);case"number":return isFinite(a)?String(a):"null";case"boolean":case"null":return String(a);case"object":if(!a)return"null";if(gap+=indent,o=[],"[object Array]"===Object.prototype.toString.apply(a)){for(s=a.length,n=0;s>n;n+=1)o[n]=str(n,a)||"null";return i=0===o.length?"[]":gap?"[\n"+gap+o.join(",\n"+gap)+"\n"+u+"]":"["+o.join(",")+"]",gap=u,i}if(rep&&"object"==typeof rep)for(s=rep.length,n=0;s>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],i=str(r,a),i&&o.push(quote(r)+(gap?": ":":")+i));else for(r in a)Object.prototype.hasOwnProperty.call(a,r)&&(i=str(r,a),i&&o.push(quote(r)+(gap?": ":":")+i));return i=0===o.length?"{}":gap?"{\n"+gap+o.join(",\n"+gap)+"\n"+u+"}":"{"+o.join(",")+"}",gap=u,i}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","  ":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,i=e[t];if(i&&"object"==typeof i)for(n in i)Object.prototype.hasOwnProperty.call(i,n)&&(r=walk(i,n),void 0!==r?i[n]=r:delete i[n]);return reviver.call(e,t,i)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),this.createjs=this.createjs||{},function(){var e=createjs.SoundJS=createjs.SoundJS||{};e.version="0.5.2",e.buildDate="Thu, 12 Dec 2013 23:33:37 GMT"}(),this.createjs=this.createjs||{},function(){var e=function(){},t=e.prototype;e.initialize=function(e){e.addEventListener=t.addEventListener,e.on=t.on,e.removeEventListener=e.off=t.removeEventListener,e.removeAllEventListeners=t.removeAllEventListeners,e.hasEventListener=t.hasEventListener,e.dispatchEvent=t.dispatchEvent,e._dispatchEvent=t._dispatchEvent,e.willTrigger=t.willTrigger},t._listeners=null,t._captureListeners=null,t.initialize=function(){},t.addEventListener=function(e,t,n){var r;r=n?this._captureListeners=this._captureListeners||{}:this._listeners=this._listeners||{};var i=r[e];return i&&this.removeEventListener(e,t,n),i=r[e],i?i.push(t):r[e]=[t],t},t.on=function(e,t,n,r,i,s){return t.handleEvent&&(n=n||t,t=t.handleEvent),n=n||this,this.addEventListener(e,function(e){t.call(n,e,i),r&&e.remove()},s)},t.removeEventListener=function(e,t,n){var r=n?this._captureListeners:this._listeners;if(r){var i=r[e];if(i)for(var s=0,o=i.length;o>s;s++)if(i[s]==t){1==o?delete r[e]:i.splice(s,1);break}}},t.off=t.removeEventListener,t.removeAllEventListeners=function(e){e?(this._listeners&&delete this._listeners[e],this._captureListeners&&delete this._captureListeners[e]):this._listeners=this._captureListeners=null},t.dispatchEvent=function(e,t){if("string"==typeof e){var n=this._listeners;if(!n||!n[e])return!1;e=new createjs.Event(e)}if(e.target=t||this,e.bubbles&&this.parent){for(var r=this,i=[r];r.parent;)i.push(r=r.parent);var s,o=i.length;for(s=o-1;s>=0&&!e.propagationStopped;s--)i[s]._dispatchEvent(e,1+(0==s));for(s=1;o>s&&!e.propagationStopped;s++)i[s]._dispatchEvent(e,3)}else this._dispatchEvent(e,2);return e.defaultPrevented},t.hasEventListener=function(e){var t=this._listeners,n=this._captureListeners;return!!(t&&t[e]||n&&n[e])},t.willTrigger=function(e){for(var t=this;t;){if(t.hasEventListener(e))return!0;t=t.parent}return!1},t.toString=function(){return"[EventDispatcher]"},t._dispatchEvent=function(e,t){var n,r=1==t?this._captureListeners:this._listeners;if(e&&r){var i=r[e.type];if(!i||!(n=i.length))return;e.currentTarget=this,e.eventPhase=t,e.removed=!1,i=i.slice();for(var s=0;n>s&&!e.immediatePropagationStopped;s++){var o=i[s];o.handleEvent?o.handleEvent(e):o(e),e.removed&&(this.off(e.type,o,1==t),e.removed=!1)}}},createjs.EventDispatcher=e}(),this.createjs=this.createjs||{},function(){var e=function(e,t,n){this.initialize(e,t,n)},t=e.prototype;t.type=null,t.target=null,t.currentTarget=null,t.eventPhase=0,t.bubbles=!1,t.cancelable=!1,t.timeStamp=0,t.defaultPrevented=!1,t.propagationStopped=!1,t.immediatePropagationStopped=!1,t.removed=!1,t.initialize=function(e,t,n){this.type=e,this.bubbles=t,this.cancelable=n,this.timeStamp=(new Date).getTime()},t.preventDefault=function(){this.defaultPrevented=!0},t.stopPropagation=function(){this.propagationStopped=!0},t.stopImmediatePropagation=function(){this.immediatePropagationStopped=this.propagationStopped=!0},t.remove=function(){this.removed=!0},t.clone=function(){return new e(this.type,this.bubbles,this.cancelable)},t.toString=function(){return"[Event (type="+this.type+")]"},createjs.Event=e}(),this.createjs=this.createjs||{},function(){createjs.indexOf=function(e,t){for(var n=0,r=e.length;r>n;n++)if(t===e[n])return n;return-1}}(),this.createjs=this.createjs||{},function(){createjs.proxy=function(e,t){var n=Array.prototype.slice.call(arguments,2);return function(){return e.apply(t,Array.prototype.slice.call(arguments,0).concat(n))}}}(),this.createjs=this.createjs||{},function(){function e(){throw"Sound cannot be instantiated"}function t(e,t){this.init(e,t)}function n(){this.isDefault=!0,this.addEventListener=this.removeEventListener=this.removeAllEventListeners=this.dispatchEvent=this.hasEventListener=this._listeners=this._interrupt=this._playFailed=this.pause=this.resume=this.play=this._beginPlaying=this._cleanUp=this.stop=this.setMasterVolume=this.setVolume=this.mute=this.setMute=this.getMute=this.setPan=this.getPosition=this.setPosition=this.playFailed=function(){return!1},this.getVolume=this.getPan=this.getDuration=function(){return 0},this.playState=e.PLAY_FAILED,this.toString=function(){return"[Sound Default Sound Instance]"}}function r(){}var i=e;i.DELIMITER="|",i.INTERRUPT_ANY="any",i.INTERRUPT_EARLY="early",i.INTERRUPT_LATE="late",i.INTERRUPT_NONE="none",i.PLAY_INITED="playInited",i.PLAY_SUCCEEDED="playSucceeded",i.PLAY_INTERRUPTED="playInterrupted",i.PLAY_FINISHED="playFinished",i.PLAY_FAILED="playFailed",i.SUPPORTED_EXTENSIONS=["mp3","ogg","mpeg","wav","m4a","mp4","aiff","wma","mid"],i.EXTENSION_MAP={m4a:"mp4"},i.FILE_PATTERN=/^(?:(\w+:)\/{2}(\w+(?:\.\w+)*\/?))?([/.]*?(?:[^?]+)?\/)?((?:[^/?]+)\.(\w+))(?:\?(\S+)?)?$/,i.defaultInterruptBehavior=i.INTERRUPT_NONE,i.alternateExtensions=[],i._lastID=0,i.activePlugin=null,i._pluginsRegistered=!1,i._masterVolume=1,i._masterMute=!1,i._instances=[],i._idHash={},i._preloadHash={},i._defaultSoundInstance=null,i.addEventListener=null,i.removeEventListener=null,i.removeAllEventListeners=null,i.dispatchEvent=null,i.hasEventListener=null,i._listeners=null,createjs.EventDispatcher.initialize(i),i._sendFileLoadEvent=function(e){if(i._preloadHash[e])for(var t=0,n=i._preloadHash[e].length;n>t;t++){var r=i._preloadHash[e][t];if(i._preloadHash[e][t]=!0,i.hasEventListener("fileload")){var s=new createjs.Event("fileload");s.src=r.src,s.id=r.id,s.data=r.data,i.dispatchEvent(s)}}},i.getPreloadHandlers=function(){return{callback:createjs.proxy(i.initLoad,i),types:["sound"],extensions:i.SUPPORTED_EXTENSIONS}},i.registerPlugin=function(e){try{console.log("createjs.Sound.registerPlugin has been deprecated. Please use registerPlugins.")}catch(t){}return i._registerPlugin(e)},i._registerPlugin=function(e){return i._pluginsRegistered=!0,null==e?!1:e.isSupported()?(i.activePlugin=new e,!0):!1},i.registerPlugins=function(e){for(var t=0,n=e.length;n>t;t++){var r=e[t];if(i._registerPlugin(r))return!0}return!1},i.initializeDefaultPlugins=function(){return null!=i.activePlugin?!0:i._pluginsRegistered?!1:i.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin])?!0:!1},i.isReady=function(){return null!=i.activePlugin},i.getCapabilities=function(){return null==i.activePlugin?null:i.activePlugin._capabilities},i.getCapability=function(e){return null==i.activePlugin?null:i.activePlugin._capabilities[e]},i.initLoad=function(e,t,n,r,s){e=e.replace(s,"");var o=i.registerSound(e,n,r,!1,s);return null==o?!1:o},i.registerSound=function(e,n,r,s,o){if(!i.initializeDefaultPlugins())return!1;if(e instanceof Object&&(o=n,n=e.id,r=e.data,e=e.src),i.alternateExtensions.length)var u=i._parsePath2(e,"sound",n,r);else var u=i._parsePath(e,"sound",n,r);if(null==u)return!1;null!=o&&(e=o+e,u.src=o+u.src),null!=n&&(i._idHash[n]=u.src);var a=null;null!=r&&(isNaN(r.channels)?isNaN(r)||(a=parseInt(r)):a=parseInt(r.channels));var f=i.activePlugin.register(u.src,a);if(null!=f&&(null!=f.numChannels&&(a=f.numChannels),t.create(u.src,a),null!=r&&isNaN(r)?r.channels=u.data.channels=a||t.maxPerChannel():r=u.data=a||t.maxPerChannel(),null!=f.tag?u.tag=f.tag:f.src&&(u.src=f.src),null!=f.completeHandler&&(u.completeHandler=f.completeHandler),f.type&&(u.type=f.type)),0!=s)if(i._preloadHash[u.src]||(i._preloadHash[u.src]=[]),i._preloadHash[u.src].push({src:e,id:n,data:r}),1==i._preloadHash[u.src].length)i.activePlugin.preload(u.src,f);else if(1==i._preloadHash[u.src][0])return!0;return u},i.registerManifest=function(e,t){for(var n=[],r=0,i=e.length;i>r;r++)n[r]=createjs.Sound.registerSound(e[r].src,e[r].id,e[r].data,e[r].preload,t);return n},i.removeSound=function(e,n){if(null==i.activePlugin)return!1;if(e instanceof Object&&(e=e.src),e=i._getSrcById(e),i.alternateExtensions.length)var r=i._parsePath2(e);else var r=i._parsePath(e);if(null==r)return!1;null!=n&&(r.src=n+r.src),e=r.src;for(var s in i._idHash)i._idHash[s]==e&&delete i._idHash[s];return t.removeSrc(e),delete i._preloadHash[e],i.activePlugin.removeSound(e),!0},i.removeManifest=function(e,t){for(var n=[],r=0,i=e.length;i>r;r++)n[r]=createjs.Sound.removeSound(e[r].src,t);return n},i.removeAllSounds=function(){i._idHash={},i._preloadHash={},t.removeAll(),i.activePlugin.removeAllSounds()},i.loadComplete=function(e){if(i.alternateExtensions.length)var t=i._parsePath2(e,"sound");else var t=i._parsePath(e,"sound");return e=t?i._getSrcById(t.src):i._getSrcById(e),1==i._preloadHash[e][0]},i._parsePath=function(e,t,n,r){"string"!=typeof e&&(e=e.toString());var s=e.split(i.DELIMITER);if(s.length>1)try{console.log('createjs.Sound.DELIMITER "|" loading approach has been deprecated. Please use the new alternateExtensions property.')}catch(o){}for(var u={type:t||"sound",id:n,data:r},a=i.getCapabilities(),f=0,l=s.length;l>f;f++){var c=s[f],h=c.match(i.FILE_PATTERN);if(null==h)return!1;var p=h[4],d=h[5];if(a[d]&&createjs.indexOf(i.SUPPORTED_EXTENSIONS,d)>-1)return u.name=p,u.src=c,u.extension=d,u}return null},i._parsePath2=function(e,t,n,r){"string"!=typeof e&&(e=e.toString());var s=e.match(i.FILE_PATTERN);if(null==s)return!1;for(var o=s[4],u=s[5],a=i.getCapabilities(),f=0;!a[u];)if(u=i.alternateExtensions[f++],f>i.alternateExtensions.length)return null;e=e.replace("."+s[5],"."+u);var l={type:t||"sound",id:n,data:r};return l.name=o,l.src=e,l.extension=u,l},i.play=function(e,t,n,r,s,o,u){var a=i.createInstance(e),f=i._playInstance(a,t,n,r,s,o,u);return f||a.playFailed(),a},i.createInstance=function(n){if(!i.initializeDefaultPlugins())return i._defaultSoundInstance;if(n=i._getSrcById(n),i.alternateExtensions.length)var r=i._parsePath2(n,"sound");else var r=i._parsePath(n,"sound");var s=null;return null!=r&&null!=r.src?(t.create(r.src),s=i.activePlugin.create(r.src)):s=e._defaultSoundInstance,s.uniqueId=i._lastID++,s},i.setVolume=function(e){if(null==Number(e))return!1;if(e=Math.max(0,Math.min(1,e)),i._masterVolume=e,!this.activePlugin||!this.activePlugin.setVolume||!this.activePlugin.setVolume(e))for(var t=this._instances,n=0,r=t.length;r>n;n++)t[n].setMasterVolume(e)},i.getVolume=function(){return i._masterVolume},i.setMute=function(e){if(null==e||void 0==e)return!1;if(this._masterMute=e,!this.activePlugin||!this.activePlugin.setMute||!this.activePlugin.setMute(e))for(var t=this._instances,n=0,r=t.length;r>n;n++)t[n].setMasterMute(e);return!0},i.getMute=function(){return this._masterMute},i.stop=function(){for(var e=this._instances,t=e.length;t--;)e[t].stop()},i._playInstance=function(e,t,n,r,s,o,u){if(t instanceof Object&&(n=t.delay,r=t.offset,s=t.loop,o=t.volume,u=t.pan,t=t.interrupt),t=t||i.defaultInterruptBehavior,null==n&&(n=0),null==r&&(r=e.getPosition()),null==s&&(s=0),null==o&&(o=e.volume),null==u&&(u=e.pan),0==n){var a=i._beginPlaying(e,t,r,s,o,u);if(!a)return!1}else{var f=setTimeout(function(){i._beginPlaying(e,t,r,s,o,u)},n);e._delayTimeoutId=f}return this._instances.push(e),!0},i._beginPlaying=function(e,n,r,i,s,o){if(!t.add(e,n))return!1;var u=e._beginPlaying(r,i,s,o);if(!u){var a=createjs.indexOf(this._instances,e);return a>-1&&this._instances.splice(a,1),!1}return!0},i._getSrcById=function(e){return null==i._idHash||null==i._idHash[e]?e:i._idHash[e]},i._playFinished=function(e){t.remove(e);var n=createjs.indexOf(this._instances,e);n>-1&&this._instances.splice(n,1)},createjs.Sound=e,t.channels={},t.create=function(e,n){var r=t.get(e);return null==r?(t.channels[e]=new t(e,n),!0):!1},t.removeSrc=function(e){var n=t.get(e);return null==n?!1:(n.removeAll(),delete t.channels[e],!0)},t.removeAll=function(){for(var e in t.channels)t.channels[e].removeAll();t.channels={}},t.add=function(e,n){var r=t.get(e.src);return null==r?!1:r.add(e,n)},t.remove=function(e){var n=t.get(e.src);return null==n?!1:(n.remove(e),!0)},t.maxPerChannel=function(){return s.maxDefault},t.get=function(e){return t.channels[e]};var s=t.prototype;s.src=null,s.max=null,s.maxDefault=100,s.length=0,s.init=function(e,t){this.src=e,this.max=t||this.maxDefault,-1==this.max&&(this.max=this.maxDefault),this._instances=[]},s.get=function(e){return this._instances[e]},s.add=function(e,t){return this.getSlot(t,e)?(this._instances.push(e),this.length++,!0):!1},s.remove=function(e){var t=createjs.indexOf(this._instances,e);return-1==t?!1:(this._instances.splice(t,1),this.length--,!0)},s.removeAll=function(){for(var e=this.length-1;e>=0;e--)this._instances[e].stop()},s.getSlot=function(t){for(var n,r,i=0,s=this.max;s>i;i++){if(n=this.get(i),null==n)return!0;(t!=e.INTERRUPT_NONE||n.playState==e.PLAY_FINISHED)&&(0!=i?n.playState==e.PLAY_FINISHED||n.playState==e.PLAY_INTERRUPTED||n.playState==e.PLAY_FAILED?r=n:(t==e.INTERRUPT_EARLY&&n.getPosition()<r.getPosition()||t==e.INTERRUPT_LATE&&n.getPosition()>r.getPosition())&&(r=n):r=n)}return null!=r?(r._interrupt(),this.remove(r),!0):!1},s.toString=function(){return"[Sound SoundChannel]"},e._defaultSoundInstance=new n,r.init=function(){var e=window.navigator.userAgent;r.isFirefox=e.indexOf("Firefox")>-1,r.isOpera=null!=window.opera,r.isChrome=e.indexOf("Chrome")>-1,r.isIOS=e.indexOf("iPod")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1,r.isAndroid=e.indexOf("Android")>-1,r.isBlackberry=e.indexOf("Blackberry")>-1},r.init(),createjs.Sound.BrowserDetect=r}(),this.createjs=this.createjs||{},function(){function e(){this._init()}var t=e;t._capabilities=null,t.isSupported=function(){var e=createjs.Sound.BrowserDetect.isIOS||createjs.Sound.BrowserDetect.isAndroid||createjs.Sound.BrowserDetect.isBlackberry;return"file:"!=location.protocol||e||this._isFileXHRSupported()?(t._generateCapabilities(),null==t.context?!1:!0):!1},t._isFileXHRSupported=function(){var e=!0,t=new XMLHttpRequest;try{t.open("GET","fail.fail",!1)}catch(n){return e=!1}t.onerror=function(){e=!1},t.onload=function(){e=404==this.status||200==this.status||0==this.status&&""!=this.response};try{t.send()}catch(n){e=!1}return e},t._generateCapabilities=function(){if(null==t._capabilities){var e=document.createElement("audio");if(null==e.canPlayType)return null;if(window.webkitAudioContext)t.context=new webkitAudioContext;else{if(!window.AudioContext)return null;t.context=new AudioContext}t._compatibilitySetUp(),t.playEmptySound(),t._capabilities={panning:!0,volume:!0,tracks:-1};for(var n=createjs.Sound.SUPPORTED_EXTENSIONS,r=createjs.Sound.EXTENSION_MAP,i=0,s=n.length;s>i;i++){var o=n[i],u=r[o]||o;t._capabilities[o]="no"!=e.canPlayType("audio/"+o)&&""!=e.canPlayType("audio/"+o)||"no"!=e.canPlayType("audio/"+u)&&""!=e.canPlayType("audio/"+u)}t.context.destination.numberOfChannels<2&&(t._capabilities.panning=!1),t.dynamicsCompressorNode=t.context.createDynamicsCompressor(),t.dynamicsCompressorNode.connect(t.context.destination),t.gainNode=t.context.createGain(),t.gainNode.connect(t.dynamicsCompressorNode)}},t._compatibilitySetUp=function(){if(!t.context.createGain){t.context.createGain=t.context.createGainNode;var e=t.context.createBufferSource();e.__proto__.start=e.__proto__.noteGrainOn,e.__proto__.stop=e.__proto__.noteOff,this._panningModel=0}},t.playEmptySound=function(){var e=this.context.createBuffer(1,1,22050),t=this.context.createBufferSource();t.buffer=e,t.connect(this.context.destination),t.start(0,0,0)};var n=e.prototype;n._capabilities=null,n._volume=1,n.context=null,n._panningModel="equalpower",n.dynamicsCompressorNode=null,n.gainNode=null,n._arrayBuffers=null,n._init=function(){this._capabilities=t._capabilities,this._arrayBuffers={},this.context=t.context,this.gainNode=t.gainNode,this.dynamicsCompressorNode=t.dynamicsCompressorNode},n.register=function(e){this._arrayBuffers[e]=!0;var t=new createjs.WebAudioPlugin.Loader(e,this);return{tag:t}},n.isPreloadStarted=function(e){return null!=this._arrayBuffers[e]},n.isPreloadComplete=function(e){return null!=this._arrayBuffers[e]&&1!=this._arrayBuffers[e]},n.removeSound=function(e){delete this._arrayBuffers[e]},n.removeAllSounds=function(){this._arrayBuffers={}},n.addPreloadResults=function(e,t){this._arrayBuffers[e]=t},n._handlePreloadComplete=function(){createjs.Sound._sendFileLoadEvent(this.src)},n.preload=function(e){this._arrayBuffers[e]=!0;var t=new createjs.WebAudioPlugin.Loader(e,this);t.onload=this._handlePreloadComplete,t.load()},n.create=function(e){return this.isPreloadStarted(e)||this.preload(e),new createjs.WebAudioPlugin.SoundInstance(e,this)},n.setVolume=function(e){return this._volume=e,this._updateVolume(),!0},n._updateVolume=function(){var e=createjs.Sound._masterMute?0:this._volume;e!=this.gainNode.gain.value&&(this.gainNode.gain.value=e)},n.getVolume=function(){return this._volume},n.setMute=function(){return this._updateVolume(),!0},n.toString=function(){return"[WebAudioPlugin]"},createjs.WebAudioPlugin=e}(),function(){function e(e,t){this._init(e,t)}var t=e.prototype=new createjs.EventDispatcher;t.src=null,t.uniqueId=-1,t.playState=null,t._owner=null,t._offset=0,t._delay=0,t._volume=1;try{Object.defineProperty(t,"volume",{get:function(){return this._volume},set:function(e){return null==Number(e)?!1:(e=Math.max(0,Math.min(1,e)),this._volume=e,this._updateVolume(),void 0)}})}catch(n){}t._pan=0;try{Object.defineProperty(t,"pan",{get:function(){return this._pan},set:function(e){return this._owner._capabilities.panning&&null!=Number(e)?(e=Math.max(-1,Math.min(1,e)),this._pan=e,this.panNode.setPosition(e,0,-0.5),void 0):!1}})}catch(n){}t._duration=0,t._remainingLoops=0,t._delayTimeoutId=null,t._soundCompleteTimeout=null,t.gainNode=null,t.panNode=null,t.sourceNode=null,t._sourceNodeNext=null,t._muted=!1,t._paused=!1,t._startTime=0,t._endedHandler=null,t._sendEvent=function(e){var t=new createjs.Event(e);this.dispatchEvent(t)},t._init=function(e,t){this._owner=t,this.src=e,this.gainNode=this._owner.context.createGain(),this.panNode=this._owner.context.createPanner(),this.panNode.panningModel=this._owner._panningModel,this.panNode.connect(this.gainNode),this._owner.isPreloadComplete(this.src)&&(this._duration=1e3*this._owner._arrayBuffers[this.src].duration),this._endedHandler=createjs.proxy(this._handleSoundComplete,this)},t._cleanUp=function(){this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this.sourceNode=this._cleanUpAudioNode(this.sourceNode),this._sourceNodeNext=this._cleanUpAudioNode(this._sourceNodeNext)),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(0),clearTimeout(this._delayTimeoutId),clearTimeout(this._soundCompleteTimeout),this._startTime=0,null!=window.createjs&&createjs.Sound._playFinished(this)},t._cleanUpAudioNode=function(e){return e&&(e.stop(0),e.disconnect(this.panNode),e=null),e},t._interrupt=function(){this._cleanUp(),this.playState=createjs.Sound.PLAY_INTERRUPTED,this._paused=!1,this._sendEvent("interrupted")},t._handleSoundReady=function(){if(null!=window.createjs){if(1e3*this._offset>this.getDuration())return this.playFailed(),void 0;this._offset<0&&(this._offset=0),this.playState=createjs.Sound.PLAY_SUCCEEDED,this._paused=!1,this.gainNode.connect(this._owner.gainNode);var e=this._owner._arrayBuffers[this.src].duration;this.sourceNode=this._createAndPlayAudioNode(this._owner.context.currentTime-e,this._offset),this._duration=1e3*e,this._startTime=this.sourceNode.startTime-this._offset,this._soundCompleteTimeout=setTimeout(this._endedHandler,1e3*(e-this._offset)),0!=this._remainingLoops&&(this._sourceNodeNext=this._createAndPlayAudioNode(this._startTime,0))}},t._createAndPlayAudioNode=function(e,t){var n=this._owner.context.createBufferSource();return n.buffer=this._owner._arrayBuffers[this.src],n.connect(this.panNode),this._owner.context.currentTime,n.startTime=e+n.buffer.duration,n.start(n.startTime,t,n.buffer.duration-t),n},t.play=function(e,t,n,r,i,s){this._cleanUp(),createjs.Sound._playInstance(this,e,t,n,r,i,s)},t._beginPlaying=function(e,t,n,r){return null!=window.createjs&&this.src?(this._offset=e/1e3,this._remainingLoops=t,this.volume=n,this.pan=r,this._owner.isPreloadComplete(this.src)?(this._handleSoundReady(null),this._sendEvent("succeeded"),1):(this.playFailed(),void 0)):void 0},t.pause=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED?!1:(this._paused=!0,this._offset=this._owner.context.currentTime-this._startTime,this._cleanUpAudioNode(this.sourceNode),this._cleanUpAudioNode(this._sourceNodeNext),0!=this.gainNode.numberOfOutputs&&this.gainNode.disconnect(),clearTimeout(this._delayTimeoutId),clearTimeout(this._soundCompleteTimeout),!0)},t.resume=function(){return this._paused?(this._handleSoundReady(null),!0):!1},t.stop=function(){return this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this._offset=0,!0},t.setVolume=function(e){return this.volume=e,!0},t._updateVolume=function(){var e=this._muted?0:this._volume;return e!=this.gainNode.gain.value?(this.gainNode.gain.value=e,!0):!1},t.getVolume=function(){return this.volume},t.setMute=function(e){return null==e||void 0==e?!1:(this._muted=e,this._updateVolume(),!0)},t.getMute=function(){return this._muted},t.setPan=function(e){return this.pan=e,this.pan!=e?!1:void 0},t.getPan=function(){return this.pan},t.getPosition=function(){if(this._paused||null==this.sourceNode)var e=this._offset;else var e=this._owner.context.currentTime-this._startTime;return 1e3*e},t.setPosition=function(e){return this._offset=e/1e3,this.sourceNode&&this.playState==createjs.Sound.PLAY_SUCCEEDED&&(this._cleanUpAudioNode(this.sourceNode),this._cleanUpAudioNode(this._sourceNodeNext),clearTimeout(this._soundCompleteTimeout)),this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||this._handleSoundReady(null),!0},t.getDuration=function(){return this._duration},t._handleSoundComplete=function(){return this._offset=0,0!=this._remainingLoops?(this._remainingLoops--,this._sourceNodeNext?(this._cleanUpAudioNode(this.sourceNode),this.sourceNode=this._sourceNodeNext,this._startTime=this.sourceNode.startTime,this._sourceNodeNext=this._createAndPlayAudioNode(this._startTime,0),this._soundCompleteTimeout=setTimeout(this._endedHandler,this._duration)):this._handleSoundReady(null),this._sendEvent("loop"),void 0):(null!=window.createjs&&(this._cleanUp(),this.playState=createjs.Sound.PLAY_FINISHED,this._sendEvent("complete")),void 0)},t.playFailed=function(){null!=window.createjs&&(this._cleanUp(),this.playState=createjs.Sound.PLAY_FAILED,this._sendEvent("failed"))},t.toString=function(){return"[WebAudioPlugin SoundInstance]"},createjs.WebAudioPlugin.SoundInstance=e}(),function(){function e(e,t){this._init(e,t)}var t=e.prototype;t.request=null,t.owner=null,t.progress=-1,t.src=null,t.originalSrc=null,t.result=null,t.onload=null,t.onprogress=null,t.onError=null,t._init=function(e,t){this.src=e,this.originalSrc=e,this.owner=t},t.load=function(e){null!=e&&(this.src=e),this.request=new XMLHttpRequest,this.request.open("GET",this.src,!0),this.request.responseType="arraybuffer",this.request.onload=createjs.proxy(this.handleLoad,this),this.request.onError=createjs.proxy(this.handleError,this),this.request.onprogress=createjs.proxy(this.handleProgress,this),this.request.send()},t.handleProgress=function(e,t){this.progress=e/t,null!=this.onprogress&&this.onprogress({loaded:e,total:t,progress:this.progress})},t.handleLoad=function(){this.owner.context.decodeAudioData(this.request.response,createjs.proxy(this.handleAudioDecoded,this),createjs.proxy(this.handleError,this))},t.handleAudioDecoded=function(e){this.progress=1,this.result=e,this.src=this.originalSrc,this.owner.addPreloadResults(this.src,this.result),this.onload&&this.onload()},t.handleError=function(e){this.owner.removeSound(this.src),this.onerror&&this.onerror(e)},t.toString=function(){return"[WebAudioPlugin Loader]"},createjs.WebAudioPlugin.Loader=e}(),this.createjs=this.createjs||{},function(){function e(){this._init()}var t=e;t.MAX_INSTANCES=30,t._AUDIO_READY="canplaythrough",t._AUDIO_ENDED="ended",t._AUDIO_SEEKED="seeked",t._AUDIO_STALLED="stalled",t._capabilities=null,t.enableIOS=!1,t.isSupported=function(){if(createjs.Sound.BrowserDetect.isIOS&&!t.enableIOS)return!1;t._generateCapabilities();var e=t.tag;return null==e||null==t._capabilities?!1:!0},t._generateCapabilities=function(){if(null==t._capabilities){var e=t.tag=document.createElement("audio");if(null==e.canPlayType)return null;t._capabilities={panning:!0,volume:!0,tracks:-1};for(var n=createjs.Sound.SUPPORTED_EXTENSIONS,r=createjs.Sound.EXTENSION_MAP,i=0,s=n.length;s>i;i++){var o=n[i],u=r[o]||o;t._capabilities[o]="no"!=e.canPlayType("audio/"+o)&&""!=e.canPlayType("audio/"+o)||"no"!=e.canPlayType("audio/"+u)&&""!=e.canPlayType("audio/"+u)}}};var n=e.prototype;n._capabilities=null,n._audioSources=null,n.defaultNumChannels=2,n.loadedHandler=null,n._init=function(){this._capabilities=t._capabilities,this._audioSources={}},n.register=function(e,t){this._audioSources[e]=!0;for(var n=createjs.HTMLAudioPlugin.TagPool.get(e),r=null,i=t||this.defaultNumChannels,s=0;i>s;s++)r=this._createTag(e),n.add(r);if(r.id=e,this.loadedHandler=createjs.proxy(this._handleTagLoad,this),r.addEventListener&&r.addEventListener("canplaythrough",this.loadedHandler),null==r.onreadystatechange)r.onreadystatechange=this.loadedHandler;else{var o=r.onreadystatechange;r.onreadystatechange=function(){o(),this.loadedHandler()}}return{tag:r,numChannels:i}},n._handleTagLoad=function(e){e.target.removeEventListener&&e.target.removeEventListener("canplaythrough",this.loadedHandler),e.target.onreadystatechange=null,e.target.src!=e.target.id&&createjs.HTMLAudioPlugin.TagPool.checkSrc(e.target.id)},n._createTag=function(e){var t=document.createElement("audio");return t.autoplay=!1,t.preload="none",t.src=e,t},n.removeSound=function(e){delete this._audioSources[e],createjs.HTMLAudioPlugin.TagPool.remove(e)},n.removeAllSounds=function(){this._audioSources={},createjs.HTMLAudioPlugin.TagPool.removeAll()},n.create=function(e){if(!this.isPreloadStarted(e)){var t=createjs.HTMLAudioPlugin.TagPool.get(e),n=this._createTag(e);n.id=e,t.add(n),this.preload(e,{tag:n})}return new createjs.HTMLAudioPlugin.SoundInstance(e,this)},n.isPreloadStarted=function(e){return null!=this._audioSources[e]},n.preload=function(e,t){this._audioSources[e]=!0,new createjs.HTMLAudioPlugin.Loader(e,t.tag)},n.toString=function(){return"[HTMLAudioPlugin]"},createjs.HTMLAudioPlugin=e}(),function(){function e(e,t){this._init(e,t)}var t=e.prototype=new createjs.EventDispatcher;t.src=null,t.uniqueId=-1,t.playState=null,t._owner=null,t.loaded=!1,t._offset=0,t._delay=0,t._volume=1;try{Object.defineProperty(t,"volume",{get:function(){return this._volume},set:function(e){null!=Number(e)&&(e=Math.max(0,Math.min(1,e)),this._volume=e,this._updateVolume())}})}catch(n){}t.pan=0,t._duration=0,t._remainingLoops=0,t._delayTimeoutId=null,t.tag=null,t._muted=!1,t._paused=!1,t._endedHandler=null,t._readyHandler=null,t._stalledHandler=null,t.loopHandler=null,t._init=function(e,t){this.src=e,this._owner=t,this._endedHandler=createjs.proxy(this._handleSoundComplete,this),this._readyHandler=createjs.proxy(this._handleSoundReady,this),this._stalledHandler=createjs.proxy(this._handleSoundStalled,this),this.loopHandler=createjs.proxy(this.handleSoundLoop,this)},t._sendEvent=function(e){var t=new createjs.Event(e);this.dispatchEvent(t)},t._cleanUp=function(){var e=this.tag;if(null!=e){e.pause(),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),e.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1);try{e.currentTime=0}catch(t){}createjs.HTMLAudioPlugin.TagPool.setInstance(this.src,e),this.tag=null}clearTimeout(this._delayTimeoutId),null!=window.createjs&&createjs.Sound._playFinished(this)},t._interrupt=function(){null!=this.tag&&(this.playState=createjs.Sound.PLAY_INTERRUPTED,this._cleanUp(),this._paused=!1,this._sendEvent("interrupted"))},t.play=function(e,t,n,r,i,s){this._cleanUp(),createjs.Sound._playInstance(this,e,t,n,r,i,s)},t._beginPlaying=function(e,t,n,r){if(null==window.createjs)return-1;var i=this.tag=createjs.HTMLAudioPlugin.TagPool.getInstance(this.src);return null==i?(this.playFailed(),-1):(i.addEventListener(createjs.HTMLAudioPlugin._AUDIO_ENDED,this._endedHandler,!1),this._offset=e,this.volume=n,this.pan=r,this._updateVolume(),this._remainingLoops=t,4!==i.readyState?(i.addEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),i.addEventListener(createjs.HTMLAudioPlugin._AUDIO_STALLED,this._stalledHandler,!1),i.preload="auto",i.load()):this._handleSoundReady(null),this._sendEvent("succeeded"),1)},t._handleSoundStalled=function(){this._cleanUp(),this._sendEvent("failed")},t._handleSoundReady=function(){if(null!=window.createjs){if(this._duration=1e3*this.tag.duration,this.playState=createjs.Sound.PLAY_SUCCEEDED,this._paused=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_READY,this._readyHandler,!1),this._offset>=this.getDuration())return this.playFailed(),void 0;this._offset>0&&(this.tag.currentTime=.001*this._offset),-1==this._remainingLoops&&(this.tag.loop=!0),0!=this._remainingLoops&&(this.tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1),this.tag.loop=!0),this.tag.play()}},t.pause=function(){return this._paused||this.playState!=createjs.Sound.PLAY_SUCCEEDED||null==this.tag?!1:(this._paused=!0,this.tag.pause(),clearTimeout(this._delayTimeoutId),!0)},t.resume=function(){return this._paused&&null!=this.tag?(this._paused=!1,this.tag.play(),!0):!1},t.stop=function(){return this._offset=0,this.pause(),this.playState=createjs.Sound.PLAY_FINISHED,this._cleanUp(),!0},t.setMasterVolume=function(){return this._updateVolume(),!0},t.setVolume=function(e){return this.volume=e,!0},t._updateVolume=function(){if(null!=this.tag){var e=this._muted||createjs.Sound._masterMute?0:this._volume*createjs.Sound._masterVolume;return e!=this.tag.volume&&(this.tag.volume=e),!0}return!1},t.getVolume=function(){return this.volume},t.setMasterMute=function(){return this._updateVolume(),!0},t.setMute=function(e){return null==e||void 0==e?!1:(this._muted=e,this._updateVolume(),!0)},t.getMute=function(){return this._muted},t.setPan=function(){return!1},t.getPan=function(){return 0},t.getPosition=function(){return null==this.tag?this._offset:1e3*this.tag.currentTime},t.setPosition=function(e){if(null==this.tag)this._offset=e;else{this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1);try{this.tag.currentTime=.001*e}catch(t){return!1}this.tag.addEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1)}return!0},t.getDuration=function(){return this._duration},t._handleSoundComplete=function(){this._offset=0,null!=window.createjs&&(this.playState=createjs.Sound.PLAY_FINISHED,this._cleanUp(),this._sendEvent("complete"))},t.handleSoundLoop=function(){this._offset=0,this._remainingLoops--,0==this._remainingLoops&&(this.tag.loop=!1,this.tag.removeEventListener(createjs.HTMLAudioPlugin._AUDIO_SEEKED,this.loopHandler,!1)),this._sendEvent("loop")},t.playFailed=function(){null!=window.createjs&&(this.playState=createjs.Sound.PLAY_FAILED,this._cleanUp(),this._sendEvent("failed"))},t.toString=function(){return"[HTMLAudioPlugin SoundInstance]"},createjs.HTMLAudioPlugin.SoundInstance=e}(),function(){function e(e,t){this._init(e,t)}var t=e.prototype;t.src=null,t.tag=null,t.preloadTimer=null,t.loadedHandler=null,t._init=function(e,t){if(this.src=e,this.tag=t,this.preloadTimer=setInterval(createjs.proxy(this.preloadTick,this),200),this.loadedHandler=createjs.proxy(this.sendLoadedEvent,this),this.tag.addEventListener&&this.tag.addEventListener("canplaythrough",this.loadedHandler),null==this.tag.onreadystatechange)this.tag.onreadystatechange=createjs.proxy(this.sendLoadedEvent,this);else{var n=this.tag.onreadystatechange;this.tag.onreadystatechange=function(){n(),this.tag.onreadystatechange=createjs.proxy(this.sendLoadedEvent,this)}}this.tag.preload="auto",this.tag.load()},t.preloadTick=function(){var e=this.tag.buffered,t=this.tag.duration;e.length>0&&e.end(0)>=t-1&&this.handleTagLoaded()},t.handleTagLoaded=function(){clearInterval(this.preloadTimer)},t.sendLoadedEvent=function(){this.tag.removeEventListener&&this.tag.removeEventListener("canplaythrough",this.loadedHandler),this.tag.onreadystatechange=null,createjs.Sound._sendFileLoadEvent(this.src)},t.toString=function(){return"[HTMLAudioPlugin Loader]"},createjs.HTMLAudioPlugin.Loader=e}(),function(){function e(e){this._init(e)}var t=e;t.tags={},t.get=function(n){var r=t.tags[n];return null==r&&(r=t.tags[n]=new e(n)),r},t.remove=function(e){var n=t.tags[e];return null==n?!1:(n.removeAll(),delete t.tags[e],!0)},t.removeAll=function(){for(var e in t.tags)t.tags[e].removeAll();t.tags={}},t.getInstance=function(e){var n=t.tags[e];return null==n?null:n.get()},t.setInstance=function(e,n){var r=t.tags[e];return null==r?null:r.set(n)},t.checkSrc=function(e){var n=t.tags[e];return null==n?null:(n.checkSrcChange(),void 0)};var n=e.prototype;n.src=null,n.length=0,n.available=0,n.tags=null,n._init=function(e){this.src=e,this.tags=[]},n.add=function(e){this.tags.push(e),this.length++,this.available++},n.removeAll=function(){for(;this.length--;)delete this.tags[this.length];this.src=null,this.tags.length=0},n.get=function(){if(0==this.tags.length)return null;this.available=this.tags.length;var e=this.tags.pop();return null==e.parentNode&&document.body.appendChild(e),e},n.set=function(e){var t=createjs.indexOf(this.tags,e);-1==t&&this.tags.push(e),this.available=this.tags.length},n.checkSrcChange=function(){for(var e=this.tags.length-1,t=this.tags[e].src;e--;)this.tags[e].src=t},n.toString=function(){return"[HTMLAudioPlugin TagPool]"},createjs.HTMLAudioPlugin.TagPool=e}(),define("lib/Sound",function(){}),define("engine/AudioManager",["core/Monogatari","core/Constants","lib/Sound"],function(){function e(){createjs.Sound.registerPlugins([createjs.WebAudioPlugin,createjs.HTMLAudioPlugin]),this.queue=new createjs.LoadQueue,createjs.Sound.alternateExtensions=["mp3"],this.queue.installPlugin(createjs.Sound),this.queue.addEventListener("complete",function(e){Monogatari.EventManager.notify("AudioManager.allAudioLoaded")}),this.queue.addEventListener("fileload",function(e){Monogatari.EventManager.notify("AudioManager.audioFileLoaded",e.result.src)}),this.queue.addEventListener("error",function(e){Monogatari.EventManager.notify("AudioManager.audioFailed",e)}),this.queue.addEventListener("progress",function(e){Monogatari.EventManager.notify("AudioManager.audioLoading",Monogatari.AudioManager.queue.progress.toFixed(2)*100)})}Monogatari.AudioManager=new e,e.prototype.load=function(e){if(e){var t={src:e};this.queue.loadFile(t,!0)}},e.prototype.isLoaded=function(e){return this.queue._loadItemsById[e]||this.queue._loadItemsBySrc[e]?!0:!1},e.prototype.get=function(e){return createjs.Sound.createInstance(e)}}),function(e,t,n){function u(e){return function(){return this[e]}}function f(e,t){var n=e.split("."),i=a;!(n[0]in i)&&i.execScript&&i.execScript("var "+n[0]);for(var s;n.length&&(s=n.shift());)!n.length&&t!==r?i[s]=t:i=i[s]?i[s]:i[s]={}}function l(e,t,n){return e.call.apply(e.bind,arguments)}function c(e,t,n){if(!e)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),e.apply(t,n)}}return function(){return e.apply(t,arguments)}}function h(e,t,n){return h=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?l:c,h.apply(s,arguments)}function d(e,t){this.G=e,this.u=t||e,this.z=this.u.document,this.R=r}function v(e,n,r){e=e.z.getElementsByTagName(n)[0],e||(e=t.documentElement),e&&e.lastChild&&e.insertBefore(r,e.lastChild)}function m(e,t){return e.createElement("link",{rel:"stylesheet",href:t})}function g(e,t){return e.createElement("script",{src:t})}function y(e,t){for(var n=e.className.split(/\s+/),r=0,i=n.length;r<i;r++)if(n[r]==t)return;n.push(t),e.className=n.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function b(e,t){for(var n=e.className.split(/\s+/),r=[],i=0,s=n.length;i<s;i++)n[i]!=t&&r.push(n[i]);e.className=r.join(" ").replace(/\s+/g," ").replace(/^\s+|\s+$/,"")}function w(e,t){for(var n=e.className.split(/\s+/),r=0,s=n.length;r<s;r++)if(n[r]==t)return i;return o}function E(e){if(e.R===r){var t=e.z.createElement("p");t.innerHTML='<a style="top:1px;">w</a>',e.R=/top/.test(t.getElementsByTagName("a")[0].getAttribute("style"))}return e.R}function S(e){var t=e.u.location.protocol;return"about:"==t&&(t=e.G.location.protocol),"https:"==t?"https:":"http:"}function x(e,t,n){this.w=e,this.T=t,this.Aa=n}function T(e,t,n,r){this.e=e!=s?e:s,this.o=t!=s?t:s,this.ba=n!=s?n:s,this.f=r!=s?r:s}function C(e){e=N.exec(e);var t=s,n=s,r=s,i=s;return e&&(e[1]!==s&&e[1]&&(t=parseInt(e[1],10)),e[2]!==s&&e[2]&&(n=parseInt(e[2],10)),e[3]!==s&&e[3]&&(r=parseInt(e[3],10)),e[4]!==s&&e[4]&&(i=/^[0-9]+$/.test(e[4])?parseInt(e[4],10):e[4])),new T(t,n,r,i)}function k(e,t,n,r,i,s,o,u,a,f,l){this.J=e,this.Ga=t,this.za=n,this.ga=r,this.Ea=i,this.fa=s,this.xa=o,this.Fa=u,this.wa=a,this.ea=f,this.k=l}function L(e,t){this.a=e,this.H=t}function O(e){var t=D(e.a,/(iPod|iPad|iPhone|Android|Windows Phone|BB\d{2}|BlackBerry)/,1);return""!=t?(/BB\d{2}/.test(t)&&(t="BlackBerry"),t):(e=D(e.a,/(Linux|Mac_PowerPC|Macintosh|Windows|CrOS)/,1),""!=e?("Mac_PowerPC"==e&&(e="Macintosh"),e):"Unknown")}function M(e){var t=D(e.a,/(OS X|Windows NT|Android) ([^;)]+)/,2);if(t||(t=D(e.a,/Windows Phone( OS)? ([^;)]+)/,2))||(t=D(e.a,/(iPhone )?OS ([\d_]+)/,2)))return t;if(t=D(e.a,/(?:Linux|CrOS) ([^;)]+)/,1))for(var t=t.split(/\s/),n=0;n<t.length;n+=1)if(/^[\d\._]+$/.test(t[n]))return t[n];return(e=D(e.a,/(BB\d{2}|BlackBerry).*?Version\/([^\s]*)/,2))?e:"Unknown"}function _(e){var t=O(e),n=M(e),r=C(n),i=D(e.a,/AppleWeb(?:K|k)it\/([\d\.\+]+)/,1),s=C(i),u="Unknown",a=new T,f="Unknown",l=o;return/OPR\/[\d.]+/.test(e.a)?u="Opera":-1!=e.a.indexOf("Chrome")||-1!=e.a.indexOf("CrMo")||-1!=e.a.indexOf("CriOS")?u="Chrome":/Silk\/\d/.test(e.a)?u="Silk":"BlackBerry"==t||"Android"==t?u="BuiltinBrowser":-1!=e.a.indexOf("PhantomJS")?u="PhantomJS":-1!=e.a.indexOf("Safari")?u="Safari":-1!=e.a.indexOf("AdobeAIR")&&(u="AdobeAIR"),"BuiltinBrowser"==u?f="Unknown":"Silk"==u?f=D(e.a,/Silk\/([\d\._]+)/,1):"Chrome"==u?f=D(e.a,/(Chrome|CrMo|CriOS)\/([\d\.]+)/,2):-1!=e.a.indexOf("Version/")?f=D(e.a,/Version\/([\d\.\w]+)/,1):"AdobeAIR"==u?f=D(e.a,/AdobeAIR\/([\d\.]+)/,1):"Opera"==u?f=D(e.a,/OPR\/([\d.]+)/,1):"PhantomJS"==u&&(f=D(e.a,/PhantomJS\/([\d.]+)/,1)),a=C(f),l="AdobeAIR"==u?2<a.e||2==a.e&&5<=a.o:"BlackBerry"==t?10<=r.e:"Android"==t?2<r.e||2==r.e&&1<r.o:526<=s.e||525<=s.e&&13<=s.o,new k(u,a,f,"AppleWebKit",s,i,t,r,n,P(e.H),new x(l,536>s.e||536==s.e&&11>s.o,"iPhone"==t||"iPad"==t||"iPod"==t||"Macintosh"==t))}function D(e,t,n){return(e=e.match(t))&&e[n]?e[n]:""}function P(e){if(e.documentMode)return e.documentMode}function H(e){this.va=e||"-"}function B(e,t){this.J=e,this.U=4,this.K="n";var n=(t||"n4").match(/^([nio])([1-9])$/i);n&&(this.K=n[1],this.U=parseInt(n[2],10))}function j(e){return e.K+e.U}function F(e){var t=4,n="n",r=s;return e&&((r=e.match(/(normal|oblique|italic)/i))&&r[1]&&(n=r[1].substr(0,1).toLowerCase()),(r=e.match(/([1-9]00|normal|bold)/i))&&r[1]&&(/bold/i.test(r[1])?t=7:/[1-9]00/.test(r[1])&&(t=parseInt(r[1].substr(0,1),10)))),n+t}function I(e,t,n){this.c=e,this.h=t,this.M=n,this.j="wf",this.g=new H("-")}function q(e){y(e.h,e.g.f(e.j,"loading")),U(e,"loading")}function R(e){b(e.h,e.g.f(e.j,"loading")),w(e.h,e.g.f(e.j,"active"))||y(e.h,e.g.f(e.j,"inactive")),U(e,"inactive")}function U(e,t,n){e.M[t]&&(n?e.M[t](n.getName(),j(n)):e.M[t]())}function z(e,t){this.c=e,this.C=t,this.s=this.c.createElement("span",{"aria-hidden":"true"},this.C)}function W(e,t){var n=e.s,r;r=[];for(var i=t.J.split(/,\s*/),s=0;s<i.length;s++){var o=i[s].replace(/['"]/g,"");-1==o.indexOf(" ")?r.push(o):r.push("'"+o+"'")}r=r.join(","),i="normal",s=t.U+"00","o"===t.K?i="oblique":"i"===t.K&&(i="italic"),r="position:absolute;top:-999px;left:-999px;font-size:300px;width:auto;height:auto;line-height:normal;margin:0;padding:0;font-variant:normal;white-space:nowrap;font-family:"+r+";"+("font-style:"+i+";font-weight:"+s+";"),E(e.c)?n.setAttribute("style",r):n.style.cssText=r}function X(e){v(e.c,"body",e.s)}function V(e,t,n,r,i,o,u,a){this.V=e,this.ta=t,this.c=n,this.q=r,this.C=a||"BESbswy",this.k=i,this.F={},this.S=o||5e3,this.Z=u||s,this.B=this.A=s,e=new z(this.c,this.C),X(e);for(var f in $)$.hasOwnProperty(f)&&(W(e,new B($[f],j(this.q))),this.F[$[f]]=e.s.offsetWidth);e.remove()}function J(e,t,n){for(var r in $)if($.hasOwnProperty(r)&&t===e.F[$[r]]&&n===e.F[$[r]])return i;return o}function K(e){var t=e.A.s.offsetWidth,n=e.B.s.offsetWidth;t===e.F.serif&&n===e.F["sans-serif"]||e.k.T&&J(e,t,n)?p()-e.ya>=e.S?e.k.T&&J(e,t,n)&&(e.Z===s||e.Z.hasOwnProperty(e.q.getName()))?Q(e,e.V):Q(e,e.ta):setTimeout(h(function(){K(this)},e),25):Q(e,e.V)}function Q(e,t){e.A.remove(),e.B.remove(),t(e.q)}function G(e,t,n,r){this.c=t,this.t=n,this.N=0,this.ca=this.Y=o,this.S=r,this.k=e.k}function Y(e,t,n,r,i){if(0===t.length&&i)R(e.t);else{e.N+=t.length,i&&(e.Y=i);for(i=0;i<t.length;i++){var s=t[i],o=n[s.getName()],u=e.t,a=s;y(u.h,u.g.f(u.j,a.getName(),j(a).toString(),"loading")),U(u,"fontloading",a),(new V(h(e.ha,e),h(e.ia,e),e.c,s,e.k,e.S,r,o)).start()}}}function Z(e){0==--e.N&&e.Y&&(e.ca?(e=e.t,b(e.h,e.g.f(e.j,"loading")),b(e.h,e.g.f(e.j,"inactive")),y(e.h,e.g.f(e.j,"active")),U(e,"active")):R(e.t))}function et(e,t,n){this.G=e,this.W=t,this.a=n,this.O=this.P=0}function tt(e,t){it.W.$[e]=t}function st(e,t,n){this.a=e,this.c=t,this.d=n,this.m=[]}function ot(e,t){this.c=e,this.d=t,this.m=[]}function ut(e,t,n){this.L=e?e:t+at,this.p=[],this.Q=[],this.da=n||""}function ft(e){this.p=e,this.aa=[],this.I={}}function dt(e,t,n){this.a=e,this.c=t,this.d=n}function mt(e,t){this.c=e,this.d=t}function yt(e){var t=e.split(":");e=t[0];if(t[1]){for(var n=t[1].split(","),t=[],r=0,i=n.length;r<i;r++){var s=n[r];if(s){var o=gt[s];t.push(o?o:s)}}n=[];for(r=0;r<t.length;r+=1)n.push(new B(e,t[r]));return n}return[new B(e)]}function bt(e,t){this.c=e,this.d=t}function wt(e,t){this.c=e,this.d=t,this.m=[]}var r=void 0,i=!0,s=null,o=!1,a=this,p=Date.now||function(){return+(new Date)};d.prototype.createElement=function(e,t,n){e=this.z.createElement(e);if(t)for(var r in t)if(t.hasOwnProperty(r))if("style"==r){var i=e,s=t[r];E(this)?i.setAttribute("style",s):i.style.cssText=s}else e.setAttribute(r,t[r]);return n&&e.appendChild(this.z.createTextNode(n)),e},f("webfont.BrowserInfo",x),x.prototype.qa=u("w"),x.prototype.hasWebFontSupport=x.prototype.qa,x.prototype.ra=u("T"),x.prototype.hasWebKitFallbackBug=x.prototype.ra,x.prototype.sa=u("Aa"),x.prototype.hasWebKitMetricsBug=x.prototype.sa;var N=/^([0-9]+)(?:[\._-]([0-9]+))?(?:[\._-]([0-9]+))?(?:[\._+-]?(.*))?$/;T.prototype.toString=function(){return[this.e,this.o||"",this.ba||"",this.f||""].join("")},f("webfont.UserAgent",k),k.prototype.getName=u("J"),k.prototype.getName=k.prototype.getName,k.prototype.pa=u("za"),k.prototype.getVersion=k.prototype.pa,k.prototype.la=u("ga"),k.prototype.getEngine=k.prototype.la,k.prototype.ma=u("fa"),k.prototype.getEngineVersion=k.prototype.ma,k.prototype.na=u("xa"),k.prototype.getPlatform=k.prototype.na,k.prototype.oa=u("wa"),k.prototype.getPlatformVersion=k.prototype.oa,k.prototype.ka=u("ea"),k.prototype.getDocumentMode=k.prototype.ka,k.prototype.ja=u("k"),k.prototype.getBrowserInfo=k.prototype.ja;var A=new k("Unknown",new T,"Unknown","Unknown",new T,"Unknown","Unknown",new T,"Unknown",r,new x(o,o,o));L.prototype.parse=function(){var e;if(-1!=this.a.indexOf("MSIE")){e=O(this);var t=M(this),n=C(t),r=D(this.a,/MSIE ([\d\w\.]+)/,1),i=C(r);e=new k("MSIE",i,r,"MSIE",i,r,e,n,t,P(this.H),new x("Windows"==e&&6<=i.e||"Windows Phone"==e&&8<=n.e,o,o))}else if(-1!=this.a.indexOf("Opera"))e:{e="Unknown";var t=D(this.a,/Presto\/([\d\w\.]+)/,1),n=C(t),r=M(this),i=C(r),u=P(this.H);n.e!==s?e="Presto":(-1!=this.a.indexOf("Gecko")&&(e="Gecko"),t=D(this.a,/rv:([^\)]+)/,1),n=C(t));if(-1!=this.a.indexOf("Opera Mini/")){var a=D(this.a,/Opera Mini\/([\d\.]+)/,1),f=C(a);e=new k("OperaMini",f,a,e,n,t,O(this),i,r,u,new x(o,o,o))}else{if(-1!=this.a.indexOf("Version/")&&(a=D(this.a,/Version\/([\d\.]+)/,1),f=C(a),f.e!==s)){e=new k("Opera",f,a,e,n,t,O(this),i,r,u,new x(10<=f.e,o,o));break e}a=D(this.a,/Opera[\/ ]([\d\.]+)/,1),f=C(a),e=f.e!==s?new k("Opera",f,a,e,n,t,O(this),i,r,u,new x(10<=f.e,o,o)):new k("Opera",new T,"Unknown",e,n,t,O(this),i,r,u,new x(o,o,o))}}else/OPR\/[\d.]+/.test(this.a)?e=_(this):/AppleWeb(K|k)it/.test(this.a)?e=_(this):-1!=this.a.indexOf("Gecko")?(e="Unknown",t=new T,n="Unknown",r=M(this),i=C(r),u=o,-1!=this.a.indexOf("Firefox")?(e="Firefox",n=D(this.a,/Firefox\/([\d\w\.]+)/,1),t=C(n),u=3<=t.e&&5<=t.o):-1!=this.a.indexOf("Mozilla")&&(e="Mozilla"),a=D(this.a,/rv:([^\)]+)/,1),f=C(a),u||(u=1<f.e||1==f.e&&9<f.o||1==f.e&&9==f.o&&2<=f.ba||a.match(/1\.9\.1b[123]/)!=s||a.match(/1\.9\.1\.[\d\.]+/)!=s),e=new k(e,t,n,"Gecko",f,a,O(this),i,r,P(this.H),new x(u,o,o))):e=A;return e},H.prototype.f=function(e){for(var t=[],n=0;n<arguments.length;n++)t.push(arguments[n].replace(/[\W_]+/g,"").toLowerCase());return t.join(this.va)},B.prototype.getName=u("J"),z.prototype.remove=function(){var e=this.s;e.parentNode&&e.parentNode.removeChild(e)};var $={Da:"serif",Ca:"sans-serif",Ba:"monospace"};V.prototype.start=function(){this.A=new z(this.c,this.C),X(this.A),this.B=new z(this.c,this.C),X(this.B),this.ya=p(),W(this.A,new B(this.q.getName()+",serif",j(this.q))),W(this.B,new B(this.q.getName()+",sans-serif",j(this.q))),K(this)},G.prototype.ha=function(e){var t=this.t;b(t.h,t.g.f(t.j,e.getName(),j(e).toString(),"loading")),b(t.h,t.g.f(t.j,e.getName(),j(e).toString(),"inactive")),y(t.h,t.g.f(t.j,e.getName(),j(e).toString(),"active")),U(t,"fontactive",e),this.ca=i,Z(this)},G.prototype.ia=function(e){var t=this.t;b(t.h,t.g.f(t.j,e.getName(),j(e).toString(),"loading")),w(t.h,t.g.f(t.j,e.getName(),j(e).toString(),"active"))||y(t.h,t.g.f(t.j,e.getName(),j(e).toString(),"inactive")),U(t,"fontinactive",e),Z(this)},et.prototype.load=function(e){var t=e.context||this.G;this.c=new d(this.G,t),t=new I(this.c,t.document.documentElement,e);if(this.a.k.w){var n=this.W,r=this.c,i=[],s;for(s in e)if(e.hasOwnProperty(s)){var o=n.$[s];o&&i.push(o(e[s],r))}e=e.timeout,this.O=this.P=i.length,e=new G(this.a,this.c,t,e),s=0;for(n=i.length;s<n;s++)r=i[s],r.v(this.a,h(this.ua,this,r,t,e))}else R(t)},et.prototype.ua=function(e,t,n,r){var i=this;r?e.load(function(e,r,o){var u=0==--i.P;u&&q(t),setTimeout(function(){Y(n,e,r||{},o||s,u)},0)}):(e=0==--this.P,this.O--,e&&(0==this.O?R(t):q(t)),Y(n,[],{},s,e))};var nt=e,rt=(new L(navigator.userAgent,t)).parse(),it=nt.WebFont=new et(e,new function(){this.$={}},rt);it.load=it.load,st.prototype.v=function(e,t){var n=this,r=n.d.projectId,u=n.d.version;if(r){var a=n.c.u,f=n.c.createElement("script");f.id="__MonotypeAPIScript__"+r;var l=o;f.onload=f.onreadystatechange=function(){if(!l&&(!this.readyState||"loaded"===this.readyState||"complete"===this.readyState)){l=i;if(a["__mti_fntLst"+r]){var o=a["__mti_fntLst"+r]();if(o)for(var u=0;u<o.length;u++)n.m.push(new B(o[u].fontfamily))}t(e.k.w),f.onload=f.onreadystatechange=s}},f.src=n.D(r,u),v(this.c,"head",f)}else t(i)},st.prototype.D=function(e,t){var n=S(this.c),r=(this.d.api||"fast.fonts.com/jsapi").replace(/^.*http(s?):(\/\/)?/,"");return n+"//"+r+"/"+e+".js"+(t?"?v="+t:"")},st.prototype.load=function(e){e(this.m)},tt("monotype",function(e,n){var r=(new L(navigator.userAgent,t)).parse();return new st(r,n,e)}),ot.prototype.D=function(e){return S(this.c)+(this.d.api||"//f.fontdeck.com/s/css/js/")+(this.c.u.location.hostname||this.c.G.location.hostname)+"/"+e+".js"},ot.prototype.v=function(e,t){var n=this.d.id,r=this.c.u,s=this;n?(r.__webfontfontdeckmodule__||(r.__webfontfontdeckmodule__={}),r.__webfontfontdeckmodule__[n]=function(e,n){for(var r=0,i=n.fonts.length;r<i;++r){var o=n.fonts[r];s.m.push(new B(o.name,F("font-weight:"+o.weight+";font-style:"+o.style)))}t(e)},n=g(this.c,this.D(n)),v(this.c,"head",n)):t(i)},ot.prototype.load=function(e){e(this.m)},tt("fontdeck",function(e,t){return new ot(t,e)});var at="//fonts.googleapis.com/css";ut.prototype.f=function(){if(0==this.p.length)throw Error("No fonts to load !");if(-1!=this.L.indexOf("kit="))return this.L;for(var e=this.p.length,t=[],n=0;n<e;n++)t.push(this.p[n].replace(/ /g,"+"));return e=this.L+"?family="+t.join("%7C"),0<this.Q.length&&(e+="&subset="+this.Q.join(",")),0<this.da.length&&(e+="&text="+encodeURIComponent(this.da)),e};var lt={latin:"BESbswy",cyrillic:"&#1081;&#1103;&#1046;",greek:"&#945;&#946;&#931;",khmer:"&#x1780;&#x1781;&#x1782;",Hanuman:"&#x1780;&#x1781;&#x1782;"},ct={thin:"1",extralight:"2","extra-light":"2",ultralight:"2","ultra-light":"2",light:"3",regular:"4",book:"4",medium:"5","semi-bold":"6",semibold:"6","demi-bold":"6",demibold:"6",bold:"7","extra-bold":"8",extrabold:"8","ultra-bold":"8",ultrabold:"8",black:"9",heavy:"9",l:"3",r:"4",b:"7"},ht={i:"i",italic:"i",n:"n",normal:"n"},pt=RegExp("^(thin|(?:(?:extra|ultra)-?)?light|regular|book|medium|(?:(?:semi|demi|extra|ultra)-?)?bold|black|heavy|l|r|b|[1-9]00)?(n|i|normal|italic)?$");ft.prototype.parse=function(){for(var e=this.p.length,t=0;t<e;t++){var n=this.p[t].split(":"),i=n[0].replace(/\+/g," "),o=["n4"];if(2<=n.length){var u,a=n[1];u=[];if(a)for(var a=a.split(","),f=a.length,l=0;l<f;l++){var c;c=a[l];if(c.match(/^[\w]+$/)){c=pt.exec(c.toLowerCase());var h=r;if(c==s)h="";else{h=r,h=c[1];if(h==s||""==h)h="4";else var p=ct[h],h=p?p:isNaN(h)?"4":h.substr(0,1);h=[c[2]==s||""==c[2]?"n":ht[c[2]],h].join("")}c=h}else c="";c&&u.push(c)}0<u.length&&(o=u),3==n.length&&(n=n[2],u=[],n=n?n.split(","):u,0<n.length&&(n=lt[n[0]])&&(this.I[i]=n))}this.I[i]||(n=lt[i])&&(this.I[i]=n);for(n=0;n<o.length;n+=1)this.aa.push(new B(i,o[n]))}};var vt={Arimo:i,Cousine:i,Tinos:i};dt.prototype.v=function(e,t){t(e.k.w)},dt.prototype.load=function(e){var t=this.c;if("MSIE"==this.a.getName()&&this.d.blocking!=i){var n=h(this.X,this,e),r=function(){t.z.body?n():setTimeout(r,0)};r()}else this.X(e)},dt.prototype.X=function(e){for(var t=this.c,n=new ut(this.d.api,S(t),this.d.text),r=this.d.families,i=r.length,s=0;s<i;s++){var o=r[s].split(":");3==o.length&&n.Q.push(o.pop());var u="";2==o.length&&""!=o[1]&&(u=":"),n.p.push(o.join(u))}r=new ft(r),r.parse(),v(t,"head",m(t,n.f())),e(r.aa,r.I,vt)},tt("google",function(e,n){var r=(new L(navigator.userAgent,t)).parse();return new dt(r,n,e)});var gt={regular:"n4",bold:"n7",italic:"i4",bolditalic:"i7",r:"n4",b:"n7",i:"i4",bi:"i7"};mt.prototype.v=function(e,t){return t(e.k.w)},mt.prototype.load=function(e){v(this.c,"head",m(this.c,S(this.c)+"//webfonts.fontslive.com/css/"+this.d.key+".css"));for(var t=this.d.families,n=[],r=0,i=t.length;r<i;r++)n.push.apply(n,yt(t[r]));e(n)},tt("ascender",function(e,t){return new mt(t,e)}),bt.prototype.load=function(e){var t,n,r=this.d.urls||[],i=this.d.families||[];t=0;for(n=r.length;t<n;t++)v(this.c,"head",m(this.c,r[t]));r=[],t=0;for(n=i.length;t<n;t++){var s=i[t].split(":");if(s[1])for(var o=s[1].split(","),u=0;u<o.length;u+=1)r.push(new B(s[0],o[u]));else r.push(new B(s[0]))}e(r)},bt.prototype.v=function(e,t){return t(e.k.w)},tt("custom",function(e,t){return new bt(t,e)}),wt.prototype.D=function(e){var t=S(this.c);return(this.d.api||t+"//use.typekit.net")+"/"+e+".js"},wt.prototype.v=function(e,t){var n=this.d.id,r=this.d,s=this.c.u,o=this;n?(s.__webfonttypekitmodule__||(s.__webfonttypekitmodule__={}),s.__webfonttypekitmodule__[n]=function(n){n(e,r,function(e,n,r){for(var i=0;i<n.length;i+=1){var s=r[n[i]];if(s)for(var u=0;u<s.length;u+=1)o.m.push(new B(n[i],s[u]));else o.m.push(new B(n[i]))}t(e)})},n=g(this.c,this.D(n)),v(this.c,"head",n)):t(i)},wt.prototype.load=function(e){e(this.m)},tt("typekit",function(e,t){return new wt(t,e)}),e.WebFontConfig&&it.load(e.WebFontConfig)}(this,document),define("lib/Webfont",function(){}),define("core/io/file/FontLoader",["core/Monogatari","lib/Webfont"],function(){function e(){}Monogatari.FontLoader=new e,e.prototype.load=function(e,t,n,r){var i=r||this;WebFont.load({google:{families:[e]},fontactive:function(e,n){t.apply(i,[e,n])},fontinactive:function(e,t){n.apply(i,[e,t])}})}}),define("engine/entity/asset/FontAsset",["core/Monogatari"],function(){Monogatari.FontAsset=function(){this.name,this.family,this.status,this.color}}),define("engine/FontManager",["core/Monogatari","core/Constants","core/collection/Map","core/io/file/FontLoader","engine/entity/asset/FontAsset"],function(){function e(){this.fonts=new Monogatari.Map,this._fontIterator=this.fonts.iterator()}Monogatari.FontManager=new e,e.prototype.load=function(e){if(!this.fonts.contains(e)){var t=new Monogatari.FontAsset;t.family=e,t.status=Monogatari.Constants.ASSET_STATE_LOADING,this.fonts.put(e,t),Monogatari.FontLoader.load(e,this.onload,this.onloadFailed)}},e.prototype.isLoaded=function(e){var t=this.fonts.get(e);return t&&t.status===Monogatari.Constants.ASSET_STATE_LOADED?!0:!1},e.prototype.isAllLoaded=function(){var e;this._fontIterator.first();while(this._fontIterator.hasNext()){e=this._fontIterator.next();if(e&&e.status!=Monogatari.Constants.ASSET_STATE_LOADED)return!1}return!0},e.prototype.onload=function(e){var t=Monogatari.FontManager.fonts.get(e);t.status=Monogatari.Constants.ASSET_STATE_LOADED},e.prototype.onloadFailed=function(e){var t=Monogatari.FontManager.fonts.get(e);t.status=Monogatari.Constants.ASSET_STATE_FAILED},e.prototype.unloadAll=function(){fonts.clear()}});var THREE={REVISION:"66"};self.console=self.console||{info:function(){},log:function(){},debug:function(){},warn:function(){},error:function(){}},function(){for(var e=0,t=["ms","moz","webkit","o"],n=0;n<t.length&&!self.requestAnimationFrame;++n)self.requestAnimationFrame=self[t[n]+"RequestAnimationFrame"],self.cancelAnimationFrame=self[t[n]+"CancelAnimationFrame"]||self[t[n]+"CancelRequestAnimationFrame"];void 0===self.requestAnimationFrame&&void 0!==self.setTimeout&&(self.requestAnimationFrame=function(t){var n=Date.now(),r=Math.max(0,16-(n-e)),i=self.setTimeout(function(){t(n+r)},r);return e=n+r,i}),void 0===self.cancelAnimationFrame&&void 0!==self.clearTimeout&&(self.cancelAnimationFrame=function(e){self.clearTimeout(e)})}(),THREE.CullFaceNone=0,THREE.CullFaceBack=1,THREE.CullFaceFront=2,THREE.CullFaceFrontBack=3,THREE.FrontFaceDirectionCW=0,THREE.FrontFaceDirectionCCW=1,THREE.BasicShadowMap=0,THREE.PCFShadowMap=1,THREE.PCFSoftShadowMap=2,THREE.FrontSide=0,THREE.BackSide=1,THREE.DoubleSide=2,THREE.NoShading=0,THREE.FlatShading=1,THREE.SmoothShading=2,THREE.NoColors=0,THREE.FaceColors=1,THREE.VertexColors=2,THREE.NoBlending=0,THREE.NormalBlending=1,THREE.AdditiveBlending=2,THREE.SubtractiveBlending=3,THREE.MultiplyBlending=4,THREE.CustomBlending=5,THREE.AddEquation=100,THREE.SubtractEquation=101,THREE.ReverseSubtractEquation=102,THREE.ZeroFactor=200,THREE.OneFactor=201,THREE.SrcColorFactor=202,THREE.OneMinusSrcColorFactor=203,THREE.SrcAlphaFactor=204,THREE.OneMinusSrcAlphaFactor=205,THREE.DstAlphaFactor=206,THREE.OneMinusDstAlphaFactor=207,THREE.DstColorFactor=208,THREE.OneMinusDstColorFactor=209,THREE.SrcAlphaSaturateFactor=210,THREE.MultiplyOperation=0,THREE.MixOperation=1,THREE.AddOperation=2,THREE.UVMapping=function(){},THREE.CubeReflectionMapping=function(){},THREE.CubeRefractionMapping=function(){},THREE.SphericalReflectionMapping=function(){},THREE.SphericalRefractionMapping=function(){},THREE.RepeatWrapping=1e3,THREE.ClampToEdgeWrapping=1001,THREE.MirroredRepeatWrapping=1002,THREE.NearestFilter=1003,THREE.NearestMipMapNearestFilter=1004,THREE.NearestMipMapLinearFilter=1005,THREE.LinearFilter=1006,THREE.LinearMipMapNearestFilter=1007,THREE.LinearMipMapLinearFilter=1008,THREE.UnsignedByteType=1009,THREE.ByteType=1010,THREE.ShortType=1011,THREE.UnsignedShortType=1012,THREE.IntType=1013,THREE.UnsignedIntType=1014,THREE.FloatType=1015,THREE.UnsignedShort4444Type=1016,THREE.UnsignedShort5551Type=1017,THREE.UnsignedShort565Type=1018,THREE.AlphaFormat=1019,THREE.RGBFormat=1020,THREE.RGBAFormat=1021,THREE.LuminanceFormat=1022,THREE.LuminanceAlphaFormat=1023,THREE.RGB_S3TC_DXT1_Format=2001,THREE.RGBA_S3TC_DXT1_Format=2002,THREE.RGBA_S3TC_DXT3_Format=2003,THREE.RGBA_S3TC_DXT5_Format=2004,THREE.Color=function(e){return 3===arguments.length?this.setRGB(arguments[0],arguments[1],arguments[2]):this.set(e)},THREE.Color.prototype={constructor:THREE.Color,r:1,g:1,b:1,set:function(e){return e instanceof THREE.Color?this.copy(e):"number"==typeof e?this.setHex(e):"string"==typeof e&&this.setStyle(e),this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,this},setRGB:function(e,t,n){return this.r=e,this.g=t,this.b=n,this},setHSL:function(e,t,n){if(0===t)this.r=this.g=this.b=n;else{var r=function(e,t,n){return 0>n&&(n+=1),1<n&&(n-=1),n<1/6?e+6*(t-e)*n:.5>n?t:n<2/3?e+6*(t-e)*(2/3-n):e};t=.5>=n?n*(1+t):n+t-n*t,n=2*n-t,this.r=r(n,t,e+1/3),this.g=r(n,t,e),this.b=r(n,t,e-1/3)}return this},setStyle:function(e){if(/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.test(e))return e=/^rgb\((\d+), ?(\d+), ?(\d+)\)$/i.exec(e),this.r=Math.min(255,parseInt(e[1],10))/255,this.g=Math.min(255,parseInt(e[2],10))/255,this.b=Math.min(255,parseInt(e[3],10))/255,this;if(/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.test(e))return e=/^rgb\((\d+)\%, ?(\d+)\%, ?(\d+)\%\)$/i.exec(e),this.r=Math.min(100,parseInt(e[1],10))/100,this.g=Math.min(100,parseInt(e[2],10))/100,this.b=Math.min(100,parseInt(e[3],10))/100,this;if(/^\#([0-9a-f]{6})$/i.test(e))return e=/^\#([0-9a-f]{6})$/i.exec(e),this.setHex(parseInt(e[1],16)),this;if(/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.test(e))return e=/^\#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(e),this.setHex(parseInt(e[1]+e[1]+e[2]+e[2]+e[3]+e[3],16)),this;if(/^(\w+)$/i.test(e))return this.setHex(THREE.ColorKeywords[e]),this},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e){return this.r=e.r*e.r,this.g=e.g*e.g,this.b=e.b*e.b,this},copyLinearToGamma:function(e){return this.r=Math.sqrt(e.r),this.g=Math.sqrt(e.g),this.b=Math.sqrt(e.b),this},convertGammaToLinear:function(){var e=this.r,t=this.g,n=this.b;return this.r=e*e,this.g=t*t,this.b=n*n,this},convertLinearToGamma:function(){return this.r=Math.sqrt(this.r),this.g=Math.sqrt(this.g),this.b=Math.sqrt(this.b),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e=e||{h:0,s:0,l:0};var t=this.r,n=this.g,r=this.b,i=Math.max(t,n,r),s=Math.min(t,n,r),o,u=(s+i)/2;if(s===i)s=o=0;else{var a=i-s,s=.5>=u?a/(i+s):a/(2-i-s);switch(i){case t:o=(n-r)/a+(n<r?6:0);break;case n:o=(r-t)/a+2;break;case r:o=(t-n)/a+4}o/=6}return e.h=o,e.s=s,e.l=u,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,n){var r=this.getHSL();return r.h+=e,r.s+=t,r.l+=n,this.setHSL(r.h,r.s,r.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e){return this.r=e[0],this.g=e[1],this.b=e[2],this},toArray:function(){return[this.r,this.g,this.b]},clone:function(){return(new THREE.Color).setRGB(this.r,this.g,this.b)}},THREE.ColorKeywords={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},THREE.Quaternion=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._w=void 0!==r?r:1},THREE.Quaternion.prototype={constructor:THREE.Quaternion,_x:0,_y:0,_z:0,_w:0,_euler:void 0,_updateEuler:function(e){void 0!==this._euler&&this._euler.setFromQuaternion(this,void 0,!1)},get x(){return this._x},set x(e){this._x=e,this._updateEuler()},get y(){return this._y},set y(e){this._y=e,this._updateEuler()},get z(){return this._z},set z(e){this._z=e,this._updateEuler()},get w(){return this._w},set w(e){this._w=e,this._updateEuler()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._updateEuler(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._w=e._w,this._updateEuler(),this},setFromEuler:function(e,t){if(0==e instanceof THREE.Euler)throw Error("ERROR: Quaternion's .setFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var n=Math.cos(e._x/2),r=Math.cos(e._y/2),i=Math.cos(e._z/2),s=Math.sin(e._x/2),o=Math.sin(e._y/2),u=Math.sin(e._z/2);return"XYZ"===e.order?(this._x=s*r*i+n*o*u,this._y=n*o*i-s*r*u,this._z=n*r*u+s*o*i,this._w=n*r*i-s*o*u):"YXZ"===e.order?(this._x=s*r*i+n*o*u,this._y=n*o*i-s*r*u,this._z=n*r*u-s*o*i,this._w=n*r*i+s*o*u):"ZXY"===e.order?(this._x=s*r*i-n*o*u,this._y=n*o*i+s*r*u,this._z=n*r*u+s*o*i,this._w=n*r*i-s*o*u):"ZYX"===e.order?(this._x=s*r*i-n*o*u,this._y=n*o*i+s*r*u,this._z=n*r*u-s*o*i,this._w=n*r*i+s*o*u):"YZX"===e.order?(this._x=s*r*i+n*o*u,this._y=n*o*i+s*r*u,this._z=n*r*u-s*o*i,this._w=n*r*i-s*o*u):"XZY"===e.order&&(this._x=s*r*i-n*o*u,this._y=n*o*i-s*r*u,this._z=n*r*u+s*o*i,this._w=n*r*i+s*o*u),!1!==t&&this._updateEuler(),this},setFromAxisAngle:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._updateEuler(),this},setFromRotationMatrix:function(e){var t=e.elements,n=t[0];e=t[4];var r=t[8],i=t[1],s=t[5],o=t[9],u=t[2],a=t[6],t=t[10],f=n+s+t;return 0<f?(n=.5/Math.sqrt(f+1),this._w=.25/n,this._x=(a-o)*n,this._y=(r-u)*n,this._z=(i-e)*n):n>s&&n>t?(n=2*Math.sqrt(1+n-s-t),this._w=(a-o)/n,this._x=.25*n,this._y=(e+i)/n,this._z=(r+u)/n):s>t?(n=2*Math.sqrt(1+s-n-t),this._w=(r-u)/n,this._x=(e+i)/n,this._y=.25*n,this._z=(o+a)/n):(n=2*Math.sqrt(1+t-n-s),this._w=(i-e)/n,this._x=(r+u)/n,this._y=(o+a)/n,this._z=.25*n),this._updateEuler(),this},inverse:function(){return this.conjugate().normalize(),this},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._updateEuler(),this},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return 0===e?(this._z=this._y=this._x=0,this._w=1):(e=1/e,this._x*=e,this._y*=e,this._z*=e,this._w*=e),this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Quaternion's .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},multiplyQuaternions:function(e,t){var n=e._x,r=e._y,i=e._z,s=e._w,o=t._x,u=t._y,a=t._z,f=t._w;return this._x=n*f+s*o+r*a-i*u,this._y=r*f+s*u+i*o-n*a,this._z=i*f+s*a+n*u-r*o,this._w=s*f-n*o-r*u-i*a,this._updateEuler(),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Quaternion's .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},slerp:function(e,t){var n=this._x,r=this._y,i=this._z,s=this._w,o=s*e._w+n*e._x+r*e._y+i*e._z;0>o?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e);if(1<=o)return this._w=s,this._x=n,this._y=r,this._z=i,this;var u=Math.acos(o),a=Math.sqrt(1-o*o);return.001>Math.abs(a)?(this._w=.5*(s+this._w),this._x=.5*(n+this._x),this._y=.5*(r+this._y),this._z=.5*(i+this._z),this):(o=Math.sin((1-t)*u)/a,u=Math.sin(t*u)/a,this._w=s*o+this._w*u,this._x=n*o+this._x*u,this._y=r*o+this._y*u,this._z=i*o+this._z*u,this._updateEuler(),this)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],this._w=e[3],this._updateEuler(),this},toArray:function(){return[this._x,this._y,this._z,this._w]},clone:function(){return new THREE.Quaternion(this._x,this._y,this._z,this._w)}},THREE.Quaternion.slerp=function(e,t,n,r){return n.copy(e).slerp(t,r)},THREE.Vector2=function(e,t){this.x=e||0,this.y=t||0},THREE.Vector2.prototype={constructor:THREE.Vector2,set:function(e,t){return this.x=e,this.y=t,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScalar:function(e){return this.x+=e,this.y+=e,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector2's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e):this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new THREE.Vector2,t=new THREE.Vector2),e.set(n,n),t.set(r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},normalize:function(){return this.divideScalar(this.length())},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x;return e=this.y-e.y,t*t+e*e},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e){return this.x=e[0],this.y=e[1],this},toArray:function(){return[this.x,this.y]},clone:function(){return new THREE.Vector2(this.x,this.y)}},THREE.Vector3=function(e,t,n){this.x=e||0,this.y=t||0,this.z=n||0},THREE.Vector3.prototype={constructor:THREE.Vector3,set:function(e,t,n){return this.x=e,this.y=t,this.z=n,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector3's .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(){var e;return function(t){return 0==t instanceof THREE.Euler&&console.error("ERROR: Vector3's .applyEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code."),void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromEuler(t)),this}}(),applyAxisAngle:function(){var e;return function(t,n){return void 0===e&&(e=new THREE.Quaternion),this.applyQuaternion(e.setFromAxisAngle(t,n)),this}}(),applyMatrix3:function(e){var t=this.x,n=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[3]*n+e[6]*r,this.y=e[1]*t+e[4]*n+e[7]*r,this.z=e[2]*t+e[5]*n+e[8]*r,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[4]*n+e[8]*r+e[12],this.y=e[1]*t+e[5]*n+e[9]*r+e[13],this.z=e[2]*t+e[6]*n+e[10]*r+e[14],this},applyProjection:function(e){var t=this.x,n=this.y,r=this.z;e=e.elements;var i=1/(e[3]*t+e[7]*n+e[11]*r+e[15]);return this.x=(e[0]*t+e[4]*n+e[8]*r+e[12])*i,this.y=(e[1]*t+e[5]*n+e[9]*r+e[13])*i,this.z=(e[2]*t+e[6]*n+e[10]*r+e[14])*i,this},applyQuaternion:function(e){var t=this.x,n=this.y,r=this.z,i=e.x,s=e.y,o=e.z;e=e.w;var u=e*t+s*r-o*n,a=e*n+o*t-i*r,f=e*r+i*n-s*t,t=-i*t-s*n-o*r;return this.x=u*e+t*-i+a*-o-f*-s,this.y=a*e+t*-s+f*-i-u*-o,this.z=f*e+t*-o+u*-s-a*-i,this},transformDirection:function(e){var t=this.x,n=this.y,r=this.z;return e=e.elements,this.x=e[0]*t+e[4]*n+e[8]*r,this.y=e[1]*t+e[5]*n+e[9]*r,this.z=e[2]*t+e[6]*n+e[10]*r,this.normalize(),this},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e,this.z*=e):this.z=this.y=this.x=0,this},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new THREE.Vector3,t=new THREE.Vector3),e.set(n,n,n),t.set(r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},cross:function(e,t){if(void 0!==t)return console.warn("DEPRECATED: Vector3's .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t);var n=this.x,r=this.y,i=this.z;return this.x=r*e.z-i*e.y,this.y=i*e.x-n*e.z,this.z=n*e.y-r*e.x,this},crossVectors:function(e,t){var n=e.x,r=e.y,i=e.z,s=t.x,o=t.y,u=t.z;return this.x=r*u-i*o,this.y=i*s-n*u,this.z=n*o-r*s,this},projectOnVector:function(){var e,t;return function(n){return void 0===e&&(e=new THREE.Vector3),e.copy(n).normalize(),t=this.dot(e),this.copy(e).multiplyScalar(t)}}(),projectOnPlane:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),e.copy(this).projectOnVector(t),this.sub(e)}}(),reflect:function(){var e;return function(t){return void 0===e&&(e=new THREE.Vector3),this.sub(e.copy(t).multiplyScalar(2*this.dot(t)))}}(),angleTo:function(e){return e=this.dot(e)/(this.length()*e.length()),Math.acos(THREE.Math.clamp(e,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,n=this.y-e.y;return e=this.z-e.z,t*t+n*n+e*e},setEulerFromRotationMatrix:function(e,t){console.error("REMOVED: Vector3's setEulerFromRotationMatrix has been removed in favor of Euler.setFromRotationMatrix(), please update your code.")},setEulerFromQuaternion:function(e,t){console.error("REMOVED: Vector3's setEulerFromQuaternion: has been removed in favor of Euler.setFromQuaternion(), please update your code.")},getPositionFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getPositionFromMatrix() has been renamed to .setFromMatrixPosition(). Please update your code."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("DEPRECATED: Vector3's .getScaleFromMatrix() has been renamed to .setFromMatrixScale(). Please update your code."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("DEPRECATED: Vector3's .getColumnFromMatrix() has been renamed to .setFromMatrixColumn(). Please update your code."),this.setFromMatrixColumn(e,t)},setFromMatrixPosition:function(e){return this.x=e.elements[12],this.y=e.elements[13],this.z=e.elements[14],this},setFromMatrixScale:function(e){var t=this.set(e.elements[0],e.elements[1],e.elements[2]).length(),n=this.set(e.elements[4],e.elements[5],e.elements[6]).length();return e=this.set(e.elements[8],e.elements[9],e.elements[10]).length(),this.x=t,this.y=n,this.z=e,this},setFromMatrixColumn:function(e,t){var n=4*e,r=t.elements;return this.x=r[n],this.y=r[n+1],this.z=r[n+2],this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this},toArray:function(){return[this.x,this.y,this.z]},clone:function(){return new THREE.Vector3(this.x,this.y,this.z)}},THREE.Vector4=function(e,t,n,r){this.x=e||0,this.y=t||0,this.z=n||0,this.w=void 0!==r?r:1},THREE.Vector4.prototype={constructor:THREE.Vector4,set:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw Error("index is out of range: "+e)}},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw Error("index is out of range: "+e)}},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this},add:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},sub:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Vector4's .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,n=this.y,r=this.z,i=this.w;return e=e.elements,this.x=e[0]*t+e[4]*n+e[8]*r+e[12]*i,this.y=e[1]*t+e[5]*n+e[9]*r+e[13]*i,this.z=e[2]*t+e[6]*n+e[10]*r+e[14]*i,this.w=e[3]*t+e[7]*n+e[11]*r+e[15]*i,this},divideScalar:function(e){return 0!==e?(e=1/e,this.x*=e,this.y*=e,this.z*=e,this.w*=e):(this.z=this.y=this.x=0,this.w=1),this},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return 1e-4>t?(this.x=1,this.z=this.y=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,n,r;e=e.elements;var i=e[0];r=e[4];var s=e[8],o=e[1],u=e[5],a=e[9];n=e[2],t=e[6];var f=e[10];return.01>Math.abs(r-o)&&.01>Math.abs(s-n)&&.01>Math.abs(a-t)?.1>Math.abs(r+o)&&.1>Math.abs(s+n)&&.1>Math.abs(a+t)&&.1>Math.abs(i+u+f-3)?(this.set(1,0,0,0),this):(e=Math.PI,i=(i+1)/2,u=(u+1)/2,f=(f+1)/2,r=(r+o)/4,s=(s+n)/4,a=(a+t)/4,i>u&&i>f?.01>i?(t=0,r=n=.707106781):(t=Math.sqrt(i),n=r/t,r=s/t):u>f?.01>u?(t=.707106781,n=0,r=.707106781):(n=Math.sqrt(u),t=r/n,r=a/n):.01>f?(n=t=.707106781,r=0):(r=Math.sqrt(f),t=s/r,n=a/r),this.set(t,n,r,e),this):(e=Math.sqrt((t-a)*(t-a)+(s-n)*(s-n)+(o-r)*(o-r)),.001>Math.abs(e)&&(e=1),this.x=(t-a)/e,this.y=(s-n)/e,this.z=(o-r)/e,this.w=Math.acos((i+u+f-1)/2),this)},min:function(e){return this.x>e.x&&(this.x=e.x),this.y>e.y&&(this.y=e.y),this.z>e.z&&(this.z=e.z),this.w>e.w&&(this.w=e.w),this},max:function(e){return this.x<e.x&&(this.x=e.x),this.y<e.y&&(this.y=e.y),this.z<e.z&&(this.z=e.z),this.w<e.w&&(this.w=e.w),this},clamp:function(e,t){return this.x<e.x?this.x=e.x:this.x>t.x&&(this.x=t.x),this.y<e.y?this.y=e.y:this.y>t.y&&(this.y=t.y),this.z<e.z?this.z=e.z:this.z>t.z&&(this.z=t.z),this.w<e.w?this.w=e.w:this.w>t.w&&(this.w=t.w),this},clampScalar:function(){var e,t;return function(n,r){return void 0===e&&(e=new THREE.Vector4,t=new THREE.Vector4),e.set(n,n,n,n),t.set(r,r,r,r),this.clamp(e,t)}}(),floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=0>this.x?Math.ceil(this.x):Math.floor(this.x),this.y=0>this.y?Math.ceil(this.y):Math.floor(this.y),this.z=0>this.z?Math.ceil(this.z):Math.floor(this.z),this.w=0>this.w?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.multiplyScalar(-1)},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},lengthManhattan:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length())},setLength:function(e){var t=this.length();return 0!==t&&e!==t&&this.multiplyScalar(e/t),this},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e){return this.x=e[0],this.y=e[1],this.z=e[2],this.w=e[3],this},toArray:function(){return[this.x,this.y,this.z,this.w]},clone:function(){return new THREE.Vector4(this.x,this.y,this.z,this.w)}},THREE.Euler=function(e,t,n,r){this._x=e||0,this._y=t||0,this._z=n||0,this._order=r||THREE.Euler.DefaultOrder},THREE.Euler.RotationOrders="XYZ YZX ZXY XZY YXZ ZYX".split(" "),THREE.Euler.DefaultOrder="XYZ",THREE.Euler.prototype={constructor:THREE.Euler,_x:0,_y:0,_z:0,_order:THREE.Euler.DefaultOrder,_quaternion:void 0,_updateQuaternion:function(){void 0!==this._quaternion&&this._quaternion.setFromEuler(this,!1)},get x(){return this._x},set x(e){this._x=e,this._updateQuaternion()},get y(){return this._y},set y(e){this._y=e,this._updateQuaternion()},get z(){return this._z},set z(e){this._z=e,this._updateQuaternion()},get order(){return this._order},set order(e){this._order=e,this._updateQuaternion()},set:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._order=r||this._order,this._updateQuaternion(),this},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._updateQuaternion(),this},setFromRotationMatrix:function(e,t){function n(e){return Math.min(Math.max(e,-1),1)}var r=e.elements,i=r[0],s=r[4],o=r[8],u=r[1],a=r[5],f=r[9],l=r[2],c=r[6],r=r[10];return t=t||this._order,"XYZ"===t?(this._y=Math.asin(n(o)),.99999>Math.abs(o)?(this._x=Math.atan2(-f,r),this._z=Math.atan2(-s,i)):(this._x=Math.atan2(c,a),this._z=0)):"YXZ"===t?(this._x=Math.asin(-n(f)),.99999>Math.abs(f)?(this._y=Math.atan2(o,r),this._z=Math.atan2(u,a)):(this._y=Math.atan2(-l,i),this._z=0)):"ZXY"===t?(this._x=Math.asin(n(c)),.99999>Math.abs(c)?(this._y=Math.atan2(-l,r),this._z=Math.atan2(-s,a)):(this._y=0,this._z=Math.atan2(u,i))):"ZYX"===t?(this._y=Math.asin(-n(l)),.99999>Math.abs(l)?(this._x=Math.atan2(c,r),this._z=Math.atan2(u,i)):(this._x=0,this._z=Math.atan2(-s,a))):"YZX"===t?(this._z=Math.asin(n(u)),.99999>Math.abs(u)?(this._x=Math.atan2(-f,a),this._y=Math.atan2(-l,i)):(this._x=0,this._y=Math.atan2(o,r))):"XZY"===t?(this._z=Math.asin(-n(s)),.99999>Math.abs(s)?(this._x=Math.atan2(c,a),this._y=Math.atan2(o,i)):(this._x=Math.atan2(-f,r),this._y=0)):console.warn("WARNING: Euler.setFromRotationMatrix() given unsupported order: "+t),this._order=t,this._updateQuaternion(),this},setFromQuaternion:function(e,t,n){function r(e){return Math.min(Math.max(e,-1),1)}var i=e.x*e.x,s=e.y*e.y,o=e.z*e.z,u=e.w*e.w;return t=t||this._order,"XYZ"===t?(this._x=Math.atan2(2*(e.x*e.w-e.y*e.z),u-i-s+o),this._y=Math.asin(r(2*(e.x*e.z+e.y*e.w))),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u+i-s-o)):"YXZ"===t?(this._x=Math.asin(r(2*(e.x*e.w-e.y*e.z))),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u-i-s+o),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u-i+s-o)):"ZXY"===t?(this._x=Math.asin(r(2*(e.x*e.w+e.y*e.z))),this._y=Math.atan2(2*(e.y*e.w-e.z*e.x),u-i-s+o),this._z=Math.atan2(2*(e.z*e.w-e.x*e.y),u-i+s-o)):"ZYX"===t?(this._x=Math.atan2(2*(e.x*e.w+e.z*e.y),u-i-s+o),this._y=Math.asin(r(2*(e.y*e.w-e.x*e.z))),this._z=Math.atan2(2*(e.x*e.y+e.z*e.w),u+i-s-o)):"YZX"===t?(this._x=Math.atan2(2*(e.x*e.w-e.z*e.y),u-i+s-o),this._y=Math.atan2(2*(e.y*e.w-e.x*e.z),u+i-s-o),this._z=Math.asin(r(2*(e.x*e.y+e.z*e.w)))):"XZY"===t?(this._x=Math.atan2(2*(e.x*e.w+e.y*e.z),u-i+s-o),this._y=Math.atan2(2*(e.x*e.z+e.y*e.w),u+i-s-o),this._z=Math.asin(r(2*(e.z*e.w-e.x*e.y)))):console.warn("WARNING: Euler.setFromQuaternion() given unsupported order: "+t),this._order=t,!1!==n&&this._updateQuaternion(),this},reorder:function(){var e=new THREE.Quaternion;return function(t){e.setFromEuler(this),this.setFromQuaternion(e,t)}}(),fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._updateQuaternion(),this},toArray:function(){return[this._x,this._y,this._z,this._order]},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},clone:function(){return new THREE.Euler(this._x,this._y,this._z,this._order)}},THREE.Line3=function(e,t){this.start=void 0!==e?e:new THREE.Vector3,this.end=void 0!==t?t:new THREE.Vector3},THREE.Line3.prototype={constructor:THREE.Line3,set:function(e,t){return this.start.copy(e),this.end.copy(t),this},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},center:function(e){return(e||new THREE.Vector3).addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return(e||new THREE.Vector3).subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){var n=t||new THREE.Vector3;return this.delta(n).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r){e.subVectors(n,this.start),t.subVectors(this.end,this.start);var i=t.dot(t),i=t.dot(e)/i;return r&&(i=THREE.Math.clamp(i,0,1)),i}}(),closestPointToPoint:function(e,t,n){return e=this.closestPointToPointParameter(e,t),n=n||new THREE.Vector3,this.delta(n).multiplyScalar(e).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)},clone:function(){return(new THREE.Line3).copy(this)}},THREE.Box2=function(e,t){this.min=void 0!==e?e:new THREE.Vector2(Infinity,Infinity),this.max=void 0!==t?t:new THREE.Vector2(-Infinity,-Infinity)},THREE.Box2.prototype={constructor:THREE.Box2,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var n=1,r=e.length;n<r;n++)t=e[n],t.x<this.min.x?this.min.x=t.x:t.x>this.max.x&&(this.max.x=t.x),t.y<this.min.y?this.min.y=t.y:t.y>this.max.y&&(this.max.y=t.y)}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector2;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=Infinity,this.max.x=this.max.y=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},center:function(e){return(e||new THREE.Vector2).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector2).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y?!0:!1},getParameter:function(e,t){return(t||new THREE.Vector2).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y?!1:!0},clampPoint:function(e,t){return(t||new THREE.Vector2).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector2;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box2).copy(this)}},THREE.Box3=function(e,t){this.min=void 0!==e?e:new THREE.Vector3(Infinity,Infinity,Infinity),this.max=void 0!==t?t:new THREE.Vector3(-Infinity,-Infinity,-Infinity)},THREE.Box3.prototype={constructor:THREE.Box3,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},addPoint:function(e){e.x<this.min.x?this.min.x=e.x:e.x>this.max.x&&(this.max.x=e.x),e.y<this.min.y?this.min.y=e.y:e.y>this.max.y&&(this.max.y=e.y),e.z<this.min.z?this.min.z=e.z:e.z>this.max.z&&(this.max.z=e.z)},setFromPoints:function(e){if(0<e.length){var t=e[0];this.min.copy(t),this.max.copy(t);for(var t=1,n=e.length;t<n;t++)this.addPoint(e[t])}else this.makeEmpty();return this},setFromCenterAndSize:function(){var e=new THREE.Vector3;return function(t,n){var r=e.copy(n).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}}(),setFromObject:function(){var e=new THREE.Vector3;return function(t){var n=this;return t.updateMatrixWorld(!0),this.makeEmpty(),t.traverse(function(t){if(void 0!==t.geometry&&void 0!==t.geometry.vertices)for(var r=t.geometry.vertices,i=0,s=r.length;i<s;i++)e.copy(r[i]),e.applyMatrix4(t.matrixWorld),n.expandByPoint(e)}),this}}(),copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=Infinity,this.max.x=this.max.y=this.max.z=-Infinity,this},empty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},center:function(e){return(e||new THREE.Vector3).addVectors(this.min,this.max).multiplyScalar(.5)},size:function(e){return(e||new THREE.Vector3).subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z?!1:!0},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z?!0:!1},getParameter:function(e,t){return(t||new THREE.Vector3).set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},isIntersectionBox:function(e){return e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z?!1:!0},clampPoint:function(e,t){return(t||new THREE.Vector3).copy(e).clamp(this.min,this.max)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){return e.copy(t).clamp(this.min,this.max).sub(t).length()}}(),getBoundingSphere:function(){var e=new THREE.Vector3;return function(t){return t=t||new THREE.Sphere,t.center=this.center(),t.radius=.5*this.size(e).length(),t}}(),intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(){var e=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,new THREE.Vector3];return function(t){return e[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),e[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),e[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),e[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),e[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),e[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),e[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),e[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.makeEmpty(),this.setFromPoints(e),this}}(),translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)},clone:function(){return(new THREE.Box3).copy(this)}},THREE.Matrix3=function(e,t,n,r,i,s,o,u,a){this.elements=new Float32Array(9),this.set(void 0!==e?e:1,t||0,n||0,r||0,void 0!==i?i:1,s||0,o||0,u||0,void 0!==a?a:1)},THREE.Matrix3.prototype={constructor:THREE.Matrix3,set:function(e,t,n,r,i,s,o,u,a){var f=this.elements;return f[0]=e,f[3]=t,f[6]=n,f[1]=r,f[4]=i,f[7]=s,f[2]=o,f[5]=u,f[8]=a,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},copy:function(e){return e=e.elements,this.set(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8]),this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix3's .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var n=0,r=t.length;n<r;n+=3)e.x=t[n],e.y=t[n+1],e.z=t[n+2],e.applyMatrix3(this),t[n]=e.x,t[n+1]=e.y,t[n+2]=e.z;return t}}(),multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],i=e[3],s=e[4],o=e[5],u=e[6],a=e[7],e=e[8];return t*s*e-t*o*a-n*i*e+n*o*u+r*i*a-r*s*u},getInverse:function(e,t){var n=e.elements,r=this.elements;r[0]=n[10]*n[5]-n[6]*n[9],r[1]=-n[10]*n[1]+n[2]*n[9],r[2]=n[6]*n[1]-n[2]*n[5],r[3]=-n[10]*n[4]+n[6]*n[8],r[4]=n[10]*n[0]-n[2]*n[8],r[5]=-n[6]*n[0]+n[2]*n[4],r[6]=n[9]*n[4]-n[5]*n[8],r[7]=-n[9]*n[0]+n[1]*n[8],r[8]=n[5]*n[0]-n[1]*n[4],n=n[0]*r[0]+n[1]*r[3]+n[2]*r[6];if(0===n){if(t)throw Error("Matrix3.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix3.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.getInverse(e).transpose(),this},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8]]},clone:function(){var e=this.elements;return new THREE.Matrix3(e[0],e[3],e[6],e[1],e[4],e[7],e[2],e[5],e[8])}},THREE.Matrix4=function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements=new Float32Array(16);m[0]=void 0!==e?e:1,m[4]=t||0,m[8]=n||0,m[12]=r||0,m[1]=i||0,m[5]=void 0!==s?s:1,m[9]=o||0,m[13]=u||0,m[2]=a||0,m[6]=f||0,m[10]=void 0!==l?l:1,m[14]=c||0,m[3]=h||0,m[7]=p||0,m[11]=d||0,m[15]=void 0!==v?v:1},THREE.Matrix4.prototype={constructor:THREE.Matrix4,set:function(e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=i,m[5]=s,m[9]=o,m[13]=u,m[2]=a,m[6]=f,m[10]=l,m[14]=c,m[3]=h,m[7]=p,m[11]=d,m[15]=v,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},copy:function(e){return this.elements.set(e.elements),this},extractPosition:function(e){return console.warn("DEPRECATED: Matrix4's .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},copyPosition:function(e){var t=this.elements;return e=e.elements,t[12]=e[12],t[13]=e[13],t[14]=e[14],this},extractRotation:function(){var e=new THREE.Vector3;return function(t){var n=this.elements;t=t.elements;var r=1/e.set(t[0],t[1],t[2]).length(),i=1/e.set(t[4],t[5],t[6]).length(),s=1/e.set(t[8],t[9],t[10]).length();return n[0]=t[0]*r,n[1]=t[1]*r,n[2]=t[2]*r,n[4]=t[4]*i,n[5]=t[5]*i,n[6]=t[6]*i,n[8]=t[8]*s,n[9]=t[9]*s,n[10]=t[10]*s,this}}(),makeRotationFromEuler:function(e){0==e instanceof THREE.Euler&&console.error("ERROR: Matrix's .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.  Please update your code.");var t=this.elements,n=e.x,r=e.y,i=e.z,s=Math.cos(n),n=Math.sin(n),o=Math.cos(r),r=Math.sin(r),u=Math.cos(i),i=Math.sin(i);if("XYZ"===e.order){e=s*u;var a=s*i,f=n*u,l=n*i;t[0]=o*u,t[4]=-o*i,t[8]=r,t[1]=a+f*r,t[5]=e-l*r,t[9]=-n*o,t[2]=l-e*r,t[6]=f+a*r,t[10]=s*o}else"YXZ"===e.order?(e=o*u,a=o*i,f=r*u,l=r*i,t[0]=e+l*n,t[4]=f*n-a,t[8]=s*r,t[1]=s*i,t[5]=s*u,t[9]=-n,t[2]=a*n-f,t[6]=l+e*n,t[10]=s*o):"ZXY"===e.order?(e=o*u,a=o*i,f=r*u,l=r*i,t[0]=e-l*n,t[4]=-s*i,t[8]=f+a*n,t[1]=a+f*n,t[5]=s*u,t[9]=l-e*n,t[2]=-s*r,t[6]=n,t[10]=s*o):"ZYX"===e.order?(e=s*u,a=s*i,f=n*u,l=n*i,t[0]=o*u,t[4]=f*r-a,t[8]=e*r+l,t[1]=o*i,t[5]=l*r+e,t[9]=a*r-f,t[2]=-r,t[6]=n*o,t[10]=s*o):"YZX"===e.order?(e=s*o,a=s*r,f=n*o,l=n*r,t[0]=o*u,t[4]=l-e*i,t[8]=f*i+a,t[1]=i,t[5]=s*u,t[9]=-n*u,t[2]=-r*u,t[6]=a*i+f,t[10]=e-l*i):"XZY"===e.order&&(e=s*o,a=s*r,f=n*o,l=n*r,t[0]=o*u,t[4]=-i,t[8]=r*u,t[1]=e*i+l,t[5]=s*u,t[9]=a*i-f,t[2]=f*i-a,t[6]=n*u,t[10]=l*i+e);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},setRotationFromQuaternion:function(e){return console.warn("DEPRECATED: Matrix4's .setRotationFromQuaternion() has been deprecated in favor of makeRotationFromQuaternion.  Please update your code."),this.makeRotationFromQuaternion(e)},makeRotationFromQuaternion:function(e){var t=this.elements,n=e.x,r=e.y,i=e.z,s=e.w,o=n+n,u=r+r,a=i+i;e=n*o;var f=n*u,n=n*a,l=r*u,r=r*a,i=i*a,o=s*o,u=s*u,s=s*a;return t[0]=1-(l+i),t[4]=f-s,t[8]=n+u,t[1]=f+s,t[5]=1-(e+i),t[9]=r-o,t[2]=n-u,t[6]=r+o,t[10]=1-(e+l),t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},lookAt:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(r,i,s){var o=this.elements;return n.subVectors(r,i).normalize(),0===n.length()&&(n.z=1),e.crossVectors(s,n).normalize(),0===e.length()&&(n.x+=1e-4,e.crossVectors(s,n).normalize()),t.crossVectors(n,e),o[0]=e.x,o[4]=t.x,o[8]=n.x,o[1]=e.y,o[5]=t.y,o[9]=n.y,o[2]=e.z,o[6]=t.z,o[10]=n.z,this}}(),multiply:function(e,t){return void 0!==t?(console.warn("DEPRECATED: Matrix4's .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},multiplyMatrices:function(e,t){var n=e.elements,r=t.elements,i=this.elements,s=n[0],o=n[4],u=n[8],a=n[12],f=n[1],l=n[5],c=n[9],h=n[13],p=n[2],d=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],n=n[15],w=r[0],E=r[4],S=r[8],x=r[12],T=r[1],N=r[5],C=r[9],k=r[13],L=r[2],A=r[6],O=r[10],M=r[14],_=r[3],D=r[7],P=r[11],r=r[15];return i[0]=s*w+o*T+u*L+a*_,i[4]=s*E+o*N+u*A+a*D,i[8]=s*S+o*C+u*O+a*P,i[12]=s*x+o*k+u*M+a*r,i[1]=f*w+l*T+c*L+h*_,i[5]=f*E+l*N+c*A+h*D,i[9]=f*S+l*C+c*O+h*P,i[13]=f*x+l*k+c*M+h*r,i[2]=p*w+d*T+v*L+m*_,i[6]=p*E+d*N+v*A+m*D,i[10]=p*S+d*C+v*O+m*P,i[14]=p*x+d*k+v*M+m*r,i[3]=g*w+y*T+b*L+n*_,i[7]=g*E+y*N+b*A+n*D,i[11]=g*S+y*C+b*O+n*P,i[15]=g*x+y*k+b*M+n*r,this},multiplyToArray:function(e,t,n){var r=this.elements;return this.multiplyMatrices(e,t),n[0]=r[0],n[1]=r[1],n[2]=r[2],n[3]=r[3],n[4]=r[4],n[5]=r[5],n[6]=r[6],n[7]=r[7],n[8]=r[8],n[9]=r[9],n[10]=r[10],n[11]=r[11],n[12]=r[12],n[13]=r[13],n[14]=r[14],n[15]=r[15],this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},multiplyVector3:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) or vector.applyProjection( matrix ) instead."),e.applyProjection(this)},multiplyVector4:function(e){return console.warn("DEPRECATED: Matrix4's .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){var e=new THREE.Vector3;return function(t){for(var n=0,r=t.length;n<r;n+=3)e.x=t[n],e.y=t[n+1],e.z=t[n+2],e.applyProjection(this),t[n]=e.x,t[n+1]=e.y,t[n+2]=e.z;return t}}(),rotateAxis:function(e){console.warn("DEPRECATED: Matrix4's .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("DEPRECATED: Matrix4's .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},determinant:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],i=e[12],s=e[1],o=e[5],u=e[9],a=e[13],f=e[2],l=e[6],c=e[10],h=e[14];return e[3]*(+i*u*l-r*a*l-i*o*c+n*a*c+r*o*h-n*u*h)+e[7]*(+t*u*h-t*a*c+i*s*c-r*s*h+r*a*f-i*u*f)+e[11]*(+t*a*l-t*o*h-i*s*l+n*s*h+i*o*f-n*a*f)+e[15]*(-r*o*f-t*u*l+t*o*c+r*s*l-n*s*c+n*u*f)},transpose:function(){var e=this.elements,t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this},flattenToArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},flattenToArrayOffset:function(e,t){var n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e},getPosition:function(){var e=new THREE.Vector3;return function(){console.warn("DEPRECATED: Matrix4's .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead.");var t=this.elements;return e.set(t[12],t[13],t[14])}}(),setPosition:function(e){var t=this.elements;return t[12]=e.x,t[13]=e.y,t[14]=e.z,this},getInverse:function(e,t){var n=this.elements,r=e.elements,i=r[0],s=r[4],o=r[8],u=r[12],a=r[1],f=r[5],l=r[9],c=r[13],h=r[2],p=r[6],d=r[10],v=r[14],m=r[3],g=r[7],y=r[11],r=r[15];n[0]=l*v*g-c*d*g+c*p*y-f*v*y-l*p*r+f*d*r,n[4]=u*d*g-o*v*g-u*p*y+s*v*y+o*p*r-s*d*r,n[8]=o*c*g-u*l*g+u*f*y-s*c*y-o*f*r+s*l*r,n[12]=u*l*p-o*c*p-u*f*d+s*c*d+o*f*v-s*l*v,n[1]=c*d*m-l*v*m-c*h*y+a*v*y+l*h*r-a*d*r,n[5]=o*v*m-u*d*m+u*h*y-i*v*y-o*h*r+i*d*r,n[9]=u*l*m-o*c*m-u*a*y+i*c*y+o*a*r-i*l*r,n[13]=o*c*h-u*l*h+u*a*d-i*c*d-o*a*v+i*l*v,n[2]=f*v*m-c*p*m+c*h*g-a*v*g-f*h*r+a*p*r,n[6]=u*p*m-s*v*m-u*h*g+i*v*g+s*h*r-i*p*r,n[10]=s*c*m-u*f*m+u*a*g-i*c*g-s*a*r+i*f*r,n[14]=u*f*h-s*c*h-u*a*p+i*c*p+s*a*v-i*f*v,n[3]=l*p*m-f*d*m-l*h*g+a*d*g+f*h*y-a*p*y,n[7]=s*d*m-o*p*m+o*h*g-i*d*g-s*h*y+i*p*y,n[11]=o*f*m-s*l*m-o*a*g+i*l*g+s*a*y-i*f*y,n[15]=s*l*h-o*f*h+o*a*p-i*l*p-s*a*d+i*f*d,n=i*n[0]+a*n[4]+h*n[8]+m*n[12];if(0==n){if(t)throw Error("Matrix4.getInverse(): can't invert matrix, determinant is 0");return console.warn("Matrix4.getInverse(): can't invert matrix, determinant is 0"),this.identity(),this}return this.multiplyScalar(1/n),this},translate:function(e){console.warn("DEPRECATED: Matrix4's .translate() has been removed.")},rotateX:function(e){console.warn("DEPRECATED: Matrix4's .rotateX() has been removed.")},rotateY:function(e){console.warn("DEPRECATED: Matrix4's .rotateY() has been removed.")},rotateZ:function(e){console.warn("DEPRECATED: Matrix4's .rotateZ() has been removed.")},rotateByAxis:function(e,t){console.warn("DEPRECATED: Matrix4's .rotateByAxis() has been removed.")},scale:function(e){var t=this.elements,n=e.x,r=e.y;return e=e.z,t[0]*=n,t[4]*=r,t[8]*=e,t[1]*=n,t[5]*=r,t[9]*=e,t[2]*=n,t[6]*=r,t[10]*=e,t[3]*=n,t[7]*=r,t[11]*=e,this},getMaxScaleOnAxis:function(){var e=this.elements;return Math.sqrt(Math.max(e[0]*e[0]+e[1]*e[1]+e[2]*e[2],Math.max(e[4]*e[4]+e[5]*e[5]+e[6]*e[6],e[8]*e[8]+e[9]*e[9]+e[10]*e[10])))},makeTranslation:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(1,0,0,0,0,t,-e,0,0,e,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,0,e,0,0,1,0,0,-e,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e);return e=Math.sin(e),this.set(t,-e,0,0,e,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var n=Math.cos(t),r=Math.sin(t),i=1-n,s=e.x,o=e.y,u=e.z,a=i*s,f=i*o;return this.set(a*s+n,a*o-r*u,a*u+r*o,0,a*o+r*u,f*o+n,f*u-r*s,0,a*u-r*o,f*u+r*s,i*u*u+n,0,0,0,0,1),this},makeScale:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this},compose:function(e,t,n){return this.makeRotationFromQuaternion(t),this.scale(n),this.setPosition(e),this},decompose:function(){var e=new THREE.Vector3,t=new THREE.Matrix4;return function(n,r,i){var s=this.elements,o=e.set(s[0],s[1],s[2]).length(),u=e.set(s[4],s[5],s[6]).length(),f=e.set(s[8],s[9],s[10]).length();0>this.determinant()&&(o=-o),n.x=s[12],n.y=s[13],n.z=s[14],t.elements.set(this.elements),n=1/o;var s=1/u,l=1/f;return t.elements[0]*=n,t.elements[1]*=n,t.elements[2]*=n,t.elements[4]*=s,t.elements[5]*=s,t.elements[6]*=s,t.elements[8]*=l,t.elements[9]*=l,t.elements[10]*=l,r.setFromRotationMatrix(t),i.x=o,i.y=u,i.z=f,this}}(),makeFrustum:function(e,t,n,r,i,s){var o=this.elements;return o[0]=2*i/(t-e),o[4]=0,o[8]=(t+e)/(t-e),o[12]=0,o[1]=0,o[5]=2*i/(r-n),o[9]=(r+n)/(r-n),o[13]=0,o[2]=0,o[6]=0,o[10]=-(s+i)/(s-i),o[14]=-2*s*i/(s-i),o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this},makePerspective:function(e,t,n,r){e=n*Math.tan(THREE.Math.degToRad(.5*e));var i=-e;return this.makeFrustum(i*t,e*t,i,e,n,r)},makeOrthographic:function(e,t,n,r,i,s){var o=this.elements,u=t-e,a=n-r,f=s-i;return o[0]=2/u,o[4]=0,o[8]=0,o[12]=-((t+e)/u),o[1]=0,o[5]=2/a,o[9]=0,o[13]=-((n+r)/a),o[2]=0,o[6]=0,o[10]=-2/f,o[14]=-((s+i)/f),o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},fromArray:function(e){return this.elements.set(e),this},toArray:function(){var e=this.elements;return[e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15]]},clone:function(){var e=this.elements;return new THREE.Matrix4(e[0],e[4],e[8],e[12],e[1],e[5],e[9],e[13],e[2],e[6],e[10],e[14],e[3],e[7],e[11],e[15])}},THREE.Ray=function(e,t){this.origin=void 0!==e?e:new THREE.Vector3,this.direction=void 0!==t?t:new THREE.Vector3},THREE.Ray.prototype={constructor:THREE.Ray,set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return(t||new THREE.Vector3).copy(this.direction).multiplyScalar(e).add(this.origin)},recast:function(){var e=new THREE.Vector3;return function(t){return this.origin.copy(this.at(t,e)),this}}(),closestPointToPoint:function(e,t){var n=t||new THREE.Vector3;n.subVectors(e,this.origin);var r=n.dot(this.direction);return 0>r?n.copy(this.origin):n.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(){var e=new THREE.Vector3;return function(t){var n=e.subVectors(t,this.origin).dot(this.direction);return 0>n?this.origin.distanceTo(t):(e.copy(this.direction).multiplyScalar(n).add(this.origin),e.distanceTo(t))}}(),distanceSqToSegment:function(e,t,n,r){var i=e.clone().add(t).multiplyScalar(.5),s=t.clone().sub(e).normalize(),o=.5*e.distanceTo(t),u=this.origin.clone().sub(i);e=-this.direction.dot(s),t=u.dot(this.direction);var a=-u.dot(s),f=u.lengthSq(),l=Math.abs(1-e*e),c,h;return 0<=l?(u=e*a-t,c=e*t-a,h=o*l,0<=u?c>=-h?c<=h?(o=1/l,u*=o,c*=o,e=u*(u+e*c+2*t)+c*(e*u+c+2*a)+f):(c=o,u=Math.max(0,-(e*c+t)),e=-u*u+c*(c+2*a)+f):(c=-o,u=Math.max(0,-(e*c+t)),e=-u*u+c*(c+2*a)+f):c<=-h?(u=Math.max(0,-(-e*o+t)),c=0<u?-o:Math.min(Math.max(-o,-a),o),e=-u*u+c*(c+2*a)+f):c<=h?(u=0,c=Math.min(Math.max(-o,-a),o),e=c*(c+2*a)+f):(u=Math.max(0,-(e*o+t)),c=0<u?o:Math.min(Math.max(-o,-a),o),e=-u*u+c*(c+2*a)+f)):(c=0<e?-o:o,u=Math.max(0,-(e*c+t)),e=-u*u+c*(c+2*a)+f),n&&n.copy(this.direction.clone().multiplyScalar(u).add(this.origin)),r&&r.copy(s.clone().multiplyScalar(c).add(i)),e},isIntersectionSphere:function(e){return this.distanceToPoint(e.center)<=e.radius},isIntersectionPlane:function(e){var t=e.distanceToPoint(this.origin);return 0===t||0>e.normal.dot(this.direction)*t?!0:!1},distanceToPlane:function(e){var t=e.normal.dot(this.direction);return 0==t?0==e.distanceToPoint(this.origin)?0:null:(e=-(this.origin.dot(e.normal)+e.constant)/t,0<=e?e:null)},intersectPlane:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)},isIntersectionBox:function(){var e=new THREE.Vector3;return function(t){return null!==this.intersectBox(t,e)}}(),intersectBox:function(e,t){var n,r,i,s,o;r=1/this.direction.x,s=1/this.direction.y,o=1/this.direction.z;var u=this.origin;0<=r?(n=(e.min.x-u.x)*r,r*=e.max.x-u.x):(n=(e.max.x-u.x)*r,r*=e.min.x-u.x),0<=s?(i=(e.min.y-u.y)*s,s*=e.max.y-u.y):(i=(e.max.y-u.y)*s,s*=e.min.y-u.y);if(n>s||i>r)return null;if(i>n||n!==n)n=i;if(s<r||r!==r)r=s;0<=o?(i=(e.min.z-u.z)*o,o*=e.max.z-u.z):(i=(e.max.z-u.z)*o,o*=e.min.z-u.z);if(n>o||i>r)return null;if(i>n||n!==n)n=i;if(o<r||r!==r)r=o;return 0>r?null:this.at(0<=n?n:r,t)},intersectTriangle:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3,r=new THREE.Vector3;return function(i,s,o,u,f){t.subVectors(s,i),n.subVectors(o,i),r.crossVectors(t,n),s=this.direction.dot(r);if(0<s){if(u)return null;u=1}else{if(!(0>s))return null;u=-1,s=-s}return e.subVectors(this.origin,i),i=u*this.direction.dot(n.crossVectors(e,n)),0>i?null:(o=u*this.direction.dot(t.cross(e)),0>o||i+o>s?null:(i=-u*e.dot(r),0>i?null:this.at(i/s,f)))}}(),applyMatrix4:function(e){return this.direction.add(this.origin).applyMatrix4(e),this.origin.applyMatrix4(e),this.direction.sub(this.origin),this.direction.normalize(),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)},clone:function(){return(new THREE.Ray).copy(this)}},THREE.Sphere=function(e,t){this.center=void 0!==e?e:new THREE.Vector3,this.radius=void 0!==t?t:0},THREE.Sphere.prototype={constructor:THREE.Sphere,set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(){var e=new THREE.Box3;return function(t,n){var r=this.center;void 0!==n?r.copy(n):e.setFromPoints(t).center(r);for(var i=0,s=0,o=t.length;s<o;s++)i=Math.max(i,r.distanceToSquared(t[s]));return this.radius=Math.sqrt(i),this}}(),copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return 0>=this.radius},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},clampPoint:function(e,t){var n=this.center.distanceToSquared(e),r=t||new THREE.Vector3;return r.copy(e),n>this.radius*this.radius&&(r.sub(this.center).normalize(),r.multiplyScalar(this.radius).add(this.center)),r},getBoundingBox:function(e){return e=e||new THREE.Box3,e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius*=e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius},clone:function(){return(new THREE.Sphere).copy(this)}},THREE.Frustum=function(e,t,n,r,i,s){this.planes=[void 0!==e?e:new THREE.Plane,void 0!==t?t:new THREE.Plane,void 0!==n?n:new THREE.Plane,void 0!==r?r:new THREE.Plane,void 0!==i?i:new THREE.Plane,void 0!==s?s:new THREE.Plane]},THREE.Frustum.prototype={constructor:THREE.Frustum,set:function(e,t,n,r,i,s){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(i),o[5].copy(s),this},copy:function(e){for(var t=this.planes,n=0;6>n;n++)t[n].copy(e.planes[n]);return this},setFromMatrix:function(e){var t=this.planes,n=e.elements;e=n[0];var r=n[1],i=n[2],s=n[3],o=n[4],u=n[5],a=n[6],f=n[7],l=n[8],c=n[9],h=n[10],p=n[11],d=n[12],v=n[13],m=n[14],n=n[15];return t[0].setComponents(s-e,f-o,p-l,n-d).normalize(),t[1].setComponents(s+e,f+o,p+l,n+d).normalize(),t[2].setComponents(s+r,f+u,p+c,n+v).normalize(),t[3].setComponents(s-r,f-u,p-c,n-v).normalize(),t[4].setComponents(s-i,f-a,p-h,n-m).normalize(),t[5].setComponents(s+i,f+a,p+h,n+m).normalize(),this},intersectsObject:function(){var e=new THREE.Sphere;return function(t){var n=t.geometry;return null===n.boundingSphere&&n.computeBoundingSphere(),e.copy(n.boundingSphere),e.applyMatrix4(t.matrixWorld),this.intersectsSphere(e)}}(),intersectsSphere:function(e){var t=this.planes,n=e.center;e=-e.radius;for(var r=0;6>r;r++)if(t[r].distanceToPoint(n)<e)return!1;return!0},intersectsBox:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n){for(var r=this.planes,i=0;6>i;i++){var s=r[i];e.x=0<s.normal.x?n.min.x:n.max.x,t.x=0<s.normal.x?n.max.x:n.min.x,e.y=0<s.normal.y?n.min.y:n.max.y,t.y=0<s.normal.y?n.max.y:n.min.y,e.z=0<s.normal.z?n.min.z:n.max.z,t.z=0<s.normal.z?n.max.z:n.min.z;var o=s.distanceToPoint(e),s=s.distanceToPoint(t);if(0>o&&0>s)return!1}return!0}}(),containsPoint:function(e){for(var t=this.planes,n=0;6>n;n++)if(0>t[n].distanceToPoint(e))return!1;return!0},clone:function(){return(new THREE.Frustum).copy(this)}},THREE.Plane=function(e,t){this.normal=void 0!==e?e:new THREE.Vector3(1,0,0),this.constant=void 0!==t?t:0},THREE.Plane.prototype={constructor:THREE.Plane,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r,i){return r=e.subVectors(i,r).cross(t.subVectors(n,r)).normalize(),this.setFromNormalAndCoplanarPoint(r,n),this}}(),copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return this.orthoPoint(e,t).sub(e).negate()},orthoPoint:function(e,t){var n=this.distanceToPoint(e);return(t||new THREE.Vector3).copy(this.normal).multiplyScalar(n)},isIntersectionLine:function(e){var t=this.distanceToPoint(e.start);return e=this.distanceToPoint(e.end),0>t&&0<e||0>e&&0<t},intersectLine:function(){var e=new THREE.Vector3;return function(t,n){var r=n||new THREE.Vector3,i=t.delta(e),s=this.normal.dot(i);if(0!=s)return s=-(t.start.dot(this.normal)+this.constant)/s,0>s||1<s?void 0:r.copy(i).multiplyScalar(s).add(t.start);if(0==this.distanceToPoint(t.start))return r.copy(t.start)}}(),coplanarPoint:function(e){return(e||new THREE.Vector3).copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Matrix3;return function(r,i){var s=i||n.getNormalMatrix(r),s=e.copy(this.normal).applyMatrix3(s),o=this.coplanarPoint(t);return o.applyMatrix4(r),this.setFromNormalAndCoplanarPoint(s,o),this}}(),translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant==this.constant},clone:function(){return(new THREE.Plane).copy(this)}},THREE.Math={PI2:2*Math.PI,generateUUID:function(){var e="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split(""),t=Array(36),n=0,r;return function(){for(var i=0;36>i;i++)8==i||13==i||18==i||23==i?t[i]="-":14==i?t[i]="4":(2>=n&&(n=33554432+16777216*Math.random()|0),r=n&15,n>>=4,t[i]=e[19==i?r&3|8:r]);return t.join("")}}(),clamp:function(e,t,n){return e<t?t:e>n?n:e},clampBottom:function(e,t){return e<t?t:e},mapLinear:function(e,t,n,r,i){return r+(e-t)*(i-r)/(n-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*(3-2*e))},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t),e*e*e*(e*(6*e-15)+10))},random16:function(){return(65280*Math.random()+255*Math.random())/65535},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},sign:function(e){return 0>e?-1:0<e?1:0},degToRad:function(){var e=Math.PI/180;return function(t){return t*e}}(),radToDeg:function(){var e=180/Math.PI;return function(t){return t*e}}(),isPowerOfTwo:function(e){return 0===(e&e-1)&&0!==e}},THREE.Spline=function(e){function t(e,t,n,r,i,s,o){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t}this.points=e;var n=[],r={x:0,y:0,z:0},i,s,o,u,a,f,l,c,h;this.initFromArray=function(e){this.points=[];for(var t=0;t<e.length;t++)this.points[t]={x:e[t][0],y:e[t][1],z:e[t][2]}},this.getPoint=function(e){return i=(this.points.length-1)*e,s=Math.floor(i),o=i-s,n[0]=0===s?s:s-1,n[1]=s,n[2]=s>this.points.length-2?this.points.length-1:s+1,n[3]=s>this.points.length-3?this.points.length-1:s+2,f=this.points[n[0]],l=this.points[n[1]],c=this.points[n[2]],h=this.points[n[3]],u=o*o,a=o*u,r.x=t(f.x,l.x,c.x,h.x,o,u,a),r.y=t(f.y,l.y,c.y,h.y,o,u,a),r.z=t(f.z,l.z,c.z,h.z,o,u,a),r},this.getControlPointsArray=function(){var e,t,n=this.points.length,r=[];for(e=0;e<n;e++)t=this.points[e],r[e]=[t.x,t.y,t.z];return r},this.getLength=function(e){var t,n,r,i=t=t=0,s=new THREE.Vector3,o=new THREE.Vector3,u=[],a=0;u[0]=0,e||(e=100),n=this.points.length*e,s.copy(this.points[0]);for(e=1;e<n;e++)t=e/n,r=this.getPoint(t),o.copy(r),a+=o.distanceTo(s),s.copy(r),t*=this.points.length-1,t=Math.floor(t),t!=i&&(u[t]=a,i=t);return u[u.length]=a,{chunks:u,total:a}},this.reparametrizeByArcLength=function(e){var t,n,r,i,s,o,u=[],a=new THREE.Vector3,f=this.getLength();u.push(a.copy(this.points[0]).clone());for(t=1;t<this.points.length;t++){n=f.chunks[t]-f.chunks[t-1],o=Math.ceil(e*n/f.total),i=(t-1)/(this.points.length-1),s=t/(this.points.length-1);for(n=1;n<o-1;n++)r=i+1/o*n*(s-i),r=this.getPoint(r),u.push(a.copy(r).clone());u.push(a.copy(this.points[t]).clone())}this.points=u}},THREE.Triangle=function(e,t,n){this.a=void 0!==e?e:new THREE.Vector3,this.b=void 0!==t?t:new THREE.Vector3,this.c=void 0!==n?n:new THREE.Vector3},THREE.Triangle.normal=function(){var e=new THREE.Vector3;return function(t,n,r,i){return i=i||new THREE.Vector3,i.subVectors(r,n),e.subVectors(t,n),i.cross(e),t=i.lengthSq(),0<t?i.multiplyScalar(1/Math.sqrt(t)):i.set(0,0,0)}}(),THREE.Triangle.barycoordFromPoint=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(r,i,s,o,u){e.subVectors(o,i),t.subVectors(s,i),n.subVectors(r,i),r=e.dot(e),i=e.dot(t),s=e.dot(n);var f=t.dot(t);o=t.dot(n);var l=r*f-i*i;return u=u||new THREE.Vector3,0==l?u.set(-2,-1,-1):(l=1/l,f=(f*s-i*o)*l,r=(r*o-i*s)*l,u.set(1-f-r,r,f))}}(),THREE.Triangle.containsPoint=function(){var e=new THREE.Vector3;return function(t,n,r,i){return t=THREE.Triangle.barycoordFromPoint(t,n,r,i,e),0<=t.x&&0<=t.y&&1>=t.x+t.y}}(),THREE.Triangle.prototype={constructor:THREE.Triangle,set:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this},setFromPointsAndIndices:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},area:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){return e.subVectors(this.c,this.b),t.subVectors(this.a,this.b),.5*e.cross(t).length()}}(),midpoint:function(e){return(e||new THREE.Vector3).addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},normal:function(e){return THREE.Triangle.normal(this.a,this.b,this.c,e)},plane:function(e){return(e||new THREE.Plane).setFromCoplanarPoints(this.a,this.b,this.c)},barycoordFromPoint:function(e,t){return THREE.Triangle.barycoordFromPoint(e,this.a,this.b,this.c,t)},containsPoint:function(e){return THREE.Triangle.containsPoint(e,this.a,this.b,this.c)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)},clone:function(){return(new THREE.Triangle).copy(this)}},THREE.Vertex=function(e){return console.warn("THREE.Vertex has been DEPRECATED. Use THREE.Vector3 instead."),e},THREE.UV=function(e,t){return console.warn("THREE.UV has been DEPRECATED. Use THREE.Vector2 instead."),new THREE.Vector2(e,t)},THREE.Clock=function(e){this.autoStart=void 0!==e?e:!0,this.elapsedTime=this.oldTime=this.startTime=0,this.running=!1},THREE.Clock.prototype={constructor:THREE.Clock,start:function(){this.oldTime=this.startTime=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;this.autoStart&&!this.running&&this.start();if(this.running){var t=void 0!==self.performance&&void 0!==self.performance.now?self.performance.now():Date.now(),e=.001*(t-this.oldTime);this.oldTime=t,this.elapsedTime+=e}return e}},THREE.EventDispatcher=function(){},THREE.EventDispatcher.prototype={constructor:THREE.EventDispatcher,apply:function(e){e.addEventListener=THREE.EventDispatcher.prototype.addEventListener,e.hasEventListener=THREE.EventDispatcher.prototype.hasEventListener,e.removeEventListener=THREE.EventDispatcher.prototype.removeEventListener,e.dispatchEvent=THREE.EventDispatcher.prototype.dispatchEvent},addEventListener:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)},hasEventListener:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)?!0:!1},removeEventListener:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}},dispatchEvent:function(){var e=[];return function(t){if(void 0!==this._listeners){var n=this._listeners[t.type];if(void 0!==n){t.target=this;for(var r=n.length,i=0;i<r;i++)e[i]=n[i];for(i=0;i<r;i++)e[i].call(this,t)}}}}()},function(e){e.Raycaster=function(t,n,r,i){this.ray=new e.Ray(t,n),this.near=r||0,this.far=i||Infinity};var t=new e.Sphere,n=new e.Ray;new e.Plane,new e.Vector3;var r=new e.Vector3,i=new e.Matrix4,s=function(e,t){return e.distance-t.distance},o=new e.Vector3,u=new e.Vector3,a=new e.Vector3,f=function(s,l,p){if(s instanceof e.Sprite){r.setFromMatrixPosition(s.matrixWorld);var v=l.ray.distanceToPoint(r);if(v>s.scale.x)return p;p.push({distance:v,point:s.position,face:null,object:s})}else if(s instanceof e.LOD)r.setFromMatrixPosition(s.matrixWorld),v=l.ray.origin.distanceTo(r),f(s.getObjectForDistance(v),l,p);else if(s instanceof e.Mesh){var m=s.geometry;null===m.boundingSphere&&m.computeBoundingSphere(),t.copy(m.boundingSphere),t.applyMatrix4(s.matrixWorld);if(!1===l.ray.isIntersectionSphere(t))return p;i.getInverse(s.matrixWorld),n.copy(l.ray).applyMatrix4(i);if(null!==m.boundingBox&&!1===n.isIntersectionBox(m.boundingBox))return p;if(m instanceof e.BufferGeometry){var y=s.material;if(void 0===y)return p;var w=m.attributes,E,S,x=l.precision;if(void 0!==w.index)for(var T=m.offsets,N=w.index.array,C=w.position.array,L=0,A=T.length;L<A;++L)for(var w=T[L].start,O=T[L].index,m=w,M=w+T[L].count;m<M;m+=3){w=O+N[m],E=O+N[m+1],S=O+N[m+2],o.set(C[3*w],C[3*w+1],C[3*w+2]),u.set(C[3*E],C[3*E+1],C[3*E+2]),a.set(C[3*S],C[3*S+1],C[3*S+2]);var _=y.side===e.BackSide?n.intersectTriangle(a,u,o,!0):n.intersectTriangle(o,u,a,y.side!==e.DoubleSide);null!==_&&(_.applyMatrix4(s.matrixWorld),v=l.ray.origin.distanceTo(_),v<x||v<l.near||v>l.far||p.push({distance:v,point:_,indices:[w,E,S],face:null,faceIndex:null,object:s}))}else for(C=w.position.array,m=0,M=w.position.array.length;m<M;m+=3)w=m,E=m+1,S=m+2,o.set(C[3*w],C[3*w+1],C[3*w+2]),u.set(C[3*E],C[3*E+1],C[3*E+2]),a.set(C[3*S],C[3*S+1],C[3*S+2]),_=y.side===e.BackSide?n.intersectTriangle(a,u,o,!0):n.intersectTriangle(o,u,a,y.side!==e.DoubleSide),null!==_&&(_.applyMatrix4(s.matrixWorld),v=l.ray.origin.distanceTo(_),v<x||v<l.near||v>l.far||p.push({distance:v,point:_,indices:[w,E,S],face:null,faceIndex:null,object:s}))}else if(m instanceof e.Geometry)for(N=s.material instanceof e.MeshFaceMaterial,C=!0===N?s.material.materials:null,x=l.precision,T=m.vertices,L=0,A=m.faces.length;L<A;L++)if(O=m.faces[L],y=!0===N?C[O.materialIndex]:s.material,void 0!==y){w=T[O.a],E=T[O.b],S=T[O.c];if(!0===y.morphTargets){v=m.morphTargets,_=s.morphTargetInfluences,o.set(0,0,0),u.set(0,0,0),a.set(0,0,0);for(var M=0,D=v.length;M<D;M++){var P=_[M];if(0!==P){var H=v[M].vertices;o.x+=(H[O.a].x-w.x)*P,o.y+=(H[O.a].y-w.y)*P,o.z+=(H[O.a].z-w.z)*P,u.x+=(H[O.b].x-E.x)*P,u.y+=(H[O.b].y-E.y)*P,u.z+=(H[O.b].z-E.z)*P,a.x+=(H[O.c].x-S.x)*P,a.y+=(H[O.c].y-S.y)*P,a.z+=(H[O.c].z-S.z)*P}}o.add(w),u.add(E),a.add(S),w=o,E=u,S=a}_=y.side===e.BackSide?n.intersectTriangle(S,E,w,!0):n.intersectTriangle(w,E,S,y.side!==e.DoubleSide),null!==_&&(_.applyMatrix4(s.matrixWorld),v=l.ray.origin.distanceTo(_),v<x||v<l.near||v>l.far||p.push({distance:v,point:_,face:O,faceIndex:L,object:s}))}}else if(s instanceof e.Line){x=l.linePrecision,y=x*x,m=s.geometry,null===m.boundingSphere&&m.computeBoundingSphere(),t.copy(m.boundingSphere),t.applyMatrix4(s.matrixWorld);if(!1===l.ray.isIntersectionSphere(t))return p;i.getInverse(s.matrixWorld),n.copy(l.ray).applyMatrix4(i);if(m instanceof e.Geometry)for(T=m.vertices,x=T.length,w=new e.Vector3,E=new e.Vector3,S=s.type===e.LineStrip?1:2,m=0;m<x-1;m+=S)n.distanceSqToSegment(T[m],T[m+1],E,w)>y||(v=n.origin.distanceTo(E),v<l.near||v>l.far||p.push({distance:v,point:w.clone().applyMatrix4(s.matrixWorld),face:null,faceIndex:null,object:s}))}},l=function(e,t,n){e=e.getDescendants();for(var r=0,i=e.length;r<i;r++)f(e[r],t,n)};e.Raycaster.prototype.precision=1e-4,e.Raycaster.prototype.linePrecision=1,e.Raycaster.prototype.set=function(e,t){this.ray.set(e,t)},e.Raycaster.prototype.intersectObject=function(e,t){var n=[];return!0===t&&l(e,this,n),f(e,this,n),n.sort(s),n},e.Raycaster.prototype.intersectObjects=function(e,t){for(var n=[],r=0,i=e.length;r<i;r++)f(e[r],this,n),!0===t&&l(e[r],this,n);return n.sort(s),n}}(THREE),THREE.Object3D=function(){this.id=THREE.Object3DIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.parent=void 0,this.children=[],this.up=new THREE.Vector3(0,1,0),this.position=new THREE.Vector3,this._rotation=new THREE.Euler,this._quaternion=new THREE.Quaternion,this.scale=new THREE.Vector3(1,1,1),this._rotation._quaternion=this.quaternion,this._quaternion._euler=this.rotation,this.renderDepth=null,this.rotationAutoUpdate=!0,this.matrix=new THREE.Matrix4,this.matrixWorld=new THREE.Matrix4,this.visible=this.matrixWorldNeedsUpdate=this.matrixAutoUpdate=!0,this.receiveShadow=this.castShadow=!1,this.frustumCulled=!0,this.userData={}},THREE.Object3D.prototype={constructor:THREE.Object3D,get rotation(){return this._rotation},set rotation(e){this._rotation=e,this._rotation._quaternion=this._quaternion,this._quaternion._euler=this._rotation,this._rotation._updateQuaternion()},get quaternion(){return this._quaternion},set quaternion(e){this._quaternion=e,this._quaternion._euler=this._rotation,this._rotation._quaternion=this._quaternion,this._quaternion._updateEuler()},get eulerOrder(){return console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order},set eulerOrder(e){console.warn("DEPRECATED: Object3D's .eulerOrder has been moved to Object3D's .rotation.order."),this.rotation.order=e},get useQuaternion(){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},set useQuaternion(e){console.warn("DEPRECATED: Object3D's .useQuaternion has been removed. The library now uses quaternions by default.")},applyMatrix:function(e){this.matrix.multiplyMatrices(e,this.matrix),this.matrix.decompose(this.position,this.quaternion,this.scale)},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(){var e=new THREE.Quaternion;return function(t,n){return e.setFromAxisAngle(t,n),this.quaternion.multiply(e),this}}(),rotateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.rotateOnAxis(e,t)}}(),rotateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.rotateOnAxis(e,t)}}(),translateOnAxis:function(){var e=new THREE.Vector3;return function(t,n){return e.copy(t),e.applyQuaternion(this.quaternion),this.position.add(e.multiplyScalar(n)),this}}(),translate:function(e,t){return console.warn("DEPRECATED: Object3D's .translate() has been removed. Use .translateOnAxis( axis, distance ) instead. Note args have been changed."),this.translateOnAxis(t,e)},translateX:function(){var e=new THREE.Vector3(1,0,0);return function(t){return this.translateOnAxis(e,t)}}(),translateY:function(){var e=new THREE.Vector3(0,1,0);return function(t){return this.translateOnAxis(e,t)}}(),translateZ:function(){var e=new THREE.Vector3(0,0,1);return function(t){return this.translateOnAxis(e,t)}}(),localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(){var e=new THREE.Matrix4;return function(t){return t.applyMatrix4(e.getInverse(this.matrixWorld))}}(),lookAt:function(){var e=new THREE.Matrix4;return function(t){e.lookAt(t,this.position,this.up),this.quaternion.setFromRotationMatrix(e)}}(),add:function(e){if(e===this)console.warn("THREE.Object3D.add: An object can't be added as a child of itself.");else if(e instanceof THREE.Object3D){void 0!==e.parent&&e.parent.remove(e),e.parent=this,e.dispatchEvent({type:"added"}),this.children.push(e);for(var t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__addObject(e)}},remove:function(e){var t=this.children.indexOf(e);if(-1!==t){e.parent=void 0,e.dispatchEvent({type:"removed"}),this.children.splice(t,1);for(t=this;void 0!==t.parent;)t=t.parent;void 0!==t&&t instanceof THREE.Scene&&t.__removeObject(e)}},traverse:function(e){e(this);for(var t=0,n=this.children.length;t<n;t++)this.children[t].traverse(e)},getObjectById:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.id===e||!0===t&&(i=i.getObjectById(e,t),void 0!==i))return i}},getObjectByName:function(e,t){for(var n=0,r=this.children.length;n<r;n++){var i=this.children[n];if(i.name===e||!0===t&&(i=i.getObjectByName(e,t),void 0!==i))return i}},getChildByName:function(e,t){return console.warn("DEPRECATED: Object3D's .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e,t)},getDescendants:function(e){void 0===e&&(e=[]),Array.prototype.push.apply(e,this.children);for(var t=0,n=this.children.length;t<n;t++)this.children[t].getDescendants(e);return e},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){!0===this.matrixAutoUpdate&&this.updateMatrix();if(!0===this.matrixWorldNeedsUpdate||!0===e)void 0===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},clone:function(e,t){void 0===e&&(e=new THREE.Object3D),void 0===t&&(t=!0),e.name=this.name,e.up.copy(this.up),e.position.copy(this.position),e.quaternion.copy(this.quaternion),e.scale.copy(this.scale),e.renderDepth=this.renderDepth,e.rotationAutoUpdate=this.rotationAutoUpdate,e.matrix.copy(this.matrix),e.matrixWorld.copy(this.matrixWorld),e.matrixAutoUpdate=this.matrixAutoUpdate,e.matrixWorldNeedsUpdate=this.matrixWorldNeedsUpdate,e.visible=this.visible,e.castShadow=this.castShadow,e.receiveShadow=this.receiveShadow,e.frustumCulled=this.frustumCulled,e.userData=JSON.parse(JSON.stringify(this.userData));if(!0===t)for(var n=0;n<this.children.length;n++)e.add(this.children[n].clone());return e}},THREE.EventDispatcher.prototype.apply(THREE.Object3D.prototype),THREE.Object3DIdCount=0,THREE.Projector=function(){function e(){if(l===h){var e=new THREE.RenderableVertex;return c.push(e),h++,l++,e}return c[l++]}function t(){if(d===m){var e=new THREE.RenderableFace;return v.push(e),m++,d++,e}return v[d++]}function n(){if(y===w){var e=new THREE.RenderableLine;return b.push(e),w++,y++,e}return b[y++]}function r(e,t){return e.z!==t.z?t.z-e.z:e.id!==t.id?e.id-t.id:0}function i(e,t){var n=0,r=1,i=e.z+e.w,s=t.z+t.w,o=-e.z+e.w,u=-t.z+t.w;return 0<=i&&0<=s&&0<=o&&0<=u?!0:0>i&&0>s||0>o&&0>u?!1:(0>i?n=Math.max(n,i/(i-s)):0>s&&(r=Math.min(r,i/(i-s))),0>o?n=Math.max(n,o/(o-u)):0>u&&(r=Math.min(r,o/(o-u))),r<n?!1:(e.lerp(t,n),t.lerp(e,1-r),!0))}var s,o,u=[],a=0,f,l,c=[],h=0,p,d,v=[],m=0,g,y,b=[],w=0,E,S,x=[],T=0,N={objects:[],lights:[],elements:[]},C=new THREE.Vector3,k=new THREE.Vector3,L=new THREE.Vector3,A=new THREE.Vector3,O=new THREE.Vector4,M=new THREE.Box3(new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,1,1)),_=new THREE.Box3,D=Array(3),P=new THREE.Matrix4,H=new THREE.Matrix4,B,j=new THREE.Matrix4,F=new THREE.Matrix3,I=new THREE.Frustum,q=new THREE.Vector4,R=new THREE.Vector4;this.projectVector=function(e,t){return t.matrixWorldInverse.getInverse(t.matrixWorld),H.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),e.applyProjection(H)},this.unprojectVector=function(){var e=new THREE.Matrix4;return function(t,n){return e.getInverse(n.projectionMatrix),H.multiplyMatrices(n.matrixWorld,e),t.applyProjection(H)}}(),this.pickingRay=function(e,t){e.z=-1;var n=new THREE.Vector3(e.x,e.y,1);return this.unprojectVector(e,t),this.unprojectVector(n,t),n.sub(e).normalize(),new THREE.Raycaster(e,n)};var U=function(e){if(!1!==e.visible){if(e instanceof THREE.Light)N.lights.push(e);else if(e instanceof THREE.Mesh||e instanceof THREE.Line||e instanceof THREE.Sprite)if(!1===e.frustumCulled||!0===I.intersectsObject(e)){if(o===a){var t=new THREE.RenderableObject;u.push(t),a++,o++,s=t}else s=u[o++];s.id=e.id,s.object=e,null!==e.renderDepth?s.z=e.renderDepth:(A.setFromMatrixPosition(e.matrixWorld),A.applyProjection(H),s.z=A.z),N.objects.push(s)}for(var t=0,n=e.children.length;t<n;t++)U(e.children[t])}},z=new function(){var r=[],i=null,s=new THREE.Matrix3,o=function(e){var t=e.positionWorld,n=e.positionScreen;t.copy(e.position).applyMatrix4(B),n.copy(t).applyMatrix4(H),t=1/n.w,n.x*=t,n.y*=t,n.z*=t,e.visible=-1<=n.x&&1>=n.x&&-1<=n.y&&1>=n.y&&-1<=n.z&&1>=n.z},u=function(e,t,n){return D[0]=e.positionScreen,D[1]=t.positionScreen,D[2]=n.positionScreen,!0===e.visible||!0===t.visible||!0===n.visible||M.isIntersectionBox(_.setFromPoints(D))?0>(n.positionScreen.x-e.positionScreen.x)*(t.positionScreen.y-e.positionScreen.y)-(n.positionScreen.y-e.positionScreen.y)*(t.positionScreen.x-e.positionScreen.x):!1};return{setObject:function(e){i=e,s.getNormalMatrix(i.matrixWorld),r.length=0},projectVertex:o,checkTriangleVisibility:u,pushVertex:function(t,n,r){f=e(),f.position.set(t,n,r),o(f)},pushNormal:function(e,t,n){r.push(e,t,n)},pushLine:function(e,t){var r=c[e],s=c[t];g=n(),g.id=i.id,g.v1.copy(r),g.v2.copy(s),g.z=(r.positionScreen.z+s.positionScreen.z)/2,g.material=i.material,N.elements.push(g)},pushTriangle:function(e,n,o){var a=c[e],f=c[n],l=c[o];if(!0===u(a,f,l)){p=t(),p.id=i.id,p.v1.copy(a),p.v2.copy(f),p.v3.copy(l),p.z=(a.positionScreen.z+f.positionScreen.z+l.positionScreen.z)/3;for(a=0;3>a;a++)f=3*arguments[a],l=p.vertexNormalsModel[a],l.set(r[f+0],r[f+1],r[f+2]),l.applyMatrix3(s).normalize();p.vertexNormalsLength=3,p.material=i.material,N.elements.push(p)}}}};this.projectScene=function(s,u,a,f){var h,v,m,b,w,A,M,_,D;S=y=d=0,N.elements.length=0,!0===s.autoUpdate&&s.updateMatrixWorld(),void 0===u.parent&&u.updateMatrixWorld(),P.copy(u.matrixWorldInverse.getInverse(u.matrixWorld)),H.multiplyMatrices(u.projectionMatrix,P),I.setFromMatrix(H),o=0,N.objects.length=0,N.lights.length=0,U(s),!0===a&&N.objects.sort(r),s=0;for(a=N.objects.length;s<a;s++)if(h=N.objects[s].object,v=h.geometry,z.setObject(h),B=h.matrixWorld,l=0,h instanceof THREE.Mesh){if(v instanceof THREE.BufferGeometry){if(A=v.attributes,b=v.offsets,void 0!==A.position){_=A.position.array,h=0;for(v=_.length;h<v;h+=3)z.pushVertex(_[h],_[h+1],_[h+2]);D=A.normal.array,h=0;for(v=D.length;h<v;h+=3)z.pushNormal(D[h],D[h+1],D[h+2]);if(void 0!==A.index)if(A=A.index.array,0<b.length)for(s=0;s<b.length;s++)for(v=b[s],_=v.index,h=v.start,v=v.start+v.count;h<v;h+=3)z.pushTriangle(A[h]+_,A[h+1]+_,A[h+2]+_);else for(h=0,v=A.length;h<v;h+=3)z.pushTriangle(A[h],A[h+1],A[h+2]);else for(h=0,v=_.length/3;h<v;h+=3)z.pushTriangle(h,h+1,h+2)}}else if(v instanceof THREE.Geometry2)for(m=v.vertices,b=h=0,v=m.length;h<v;h+=9,b+=3)z.pushVertex(m[h+0],m[h+1],m[h+2]),z.pushVertex(m[h+3],m[h+4],m[h+5]),z.pushVertex(m[h+6],m[h+7],m[h+8]),z.pushTriangle(b+0,b+1,b+2);else if(v instanceof THREE.Geometry){m=v.vertices,b=v.faces,A=v.faceVertexUvs,F.getNormalMatrix(B),_=h.material instanceof THREE.MeshFaceMaterial,D=!0===_?h.material:null;for(var W=0,X=m.length;W<X;W++){var $=m[W];z.pushVertex($.x,$.y,$.z)}W=0;for(X=b.length;W<X;W++){m=b[W];var J=!0===_?D.materials[m.materialIndex]:h.material;if(void 0!==J){M=J.side;var $=c[m.a],G=c[m.b],Z=c[m.c];if(!0===J.morphTargets){w=v.morphTargets;var et=h.morphTargetInfluences,tt=$.position,nt=G.position,rt=Z.position;C.set(0,0,0),k.set(0,0,0),L.set(0,0,0);for(var it=0,st=w.length;it<st;it++){var ot=et[it];if(0!==ot){var ut=w[it].vertices;C.x+=(ut[m.a].x-tt.x)*ot,C.y+=(ut[m.a].y-tt.y)*ot,C.z+=(ut[m.a].z-tt.z)*ot,k.x+=(ut[m.b].x-nt.x)*ot,k.y+=(ut[m.b].y-nt.y)*ot,k.z+=(ut[m.b].z-nt.z)*ot,L.x+=(ut[m.c].x-rt.x)*ot,L.y+=(ut[m.c].y-rt.y)*ot,L.z+=(ut[m.c].z-rt.z)*ot}}$.position.add(C),G.position.add(k),Z.position.add(L),z.projectVertex($),z.projectVertex(G),z.projectVertex(Z)}et=z.checkTriangleVisibility($,G,Z);if(!(!1===et&&M===THREE.FrontSide||!0===et&&M===THREE.BackSide)){p=t(),p.id=h.id,p.v1.copy($),p.v2.copy(G),p.v3.copy(Z),p.normalModel.copy(m.normal),!1!==et||M!==THREE.BackSide&&M!==THREE.DoubleSide||p.normalModel.negate(),p.normalModel.applyMatrix3(F).normalize(),p.centroidModel.copy(m.centroid).applyMatrix4(B),w=m.vertexNormals,tt=0;for(nt=Math.min(w.length,3);tt<nt;tt++)rt=p.vertexNormalsModel[tt],rt.copy(w[tt]),!1!==et||M!==THREE.BackSide&&M!==THREE.DoubleSide||rt.negate(),rt.applyMatrix3(F).normalize();p.vertexNormalsLength=w.length,w=0;for(et=Math.min(A.length,3);w<et;w++)if(M=A[w][W],void 0!==M)for(tt=0,nt=M.length;tt<nt;tt++)p.uvs[w][tt]=M[tt];p.color=m.color,p.material=J,p.z=($.positionScreen.z+G.positionScreen.z+Z.positionScreen.z)/3,N.elements.push(p)}}}}}else if(h instanceof THREE.Line){if(v instanceof THREE.BufferGeometry){if(A=v.attributes,void 0!==A.position){_=A.position.array,h=0;for(v=_.length;h<v;h+=3)z.pushVertex(_[h],_[h+1],_[h+2]);if(void 0!==A.index)for(A=A.index.array,h=0,v=A.length;h<v;h+=2)z.pushLine(A[h],A[h+1]);else for(h=0,v=_.length/3-1;h<v;h++)z.pushLine(h,h+1)}}else if(v instanceof THREE.Geometry&&(j.multiplyMatrices(H,B),m=h.geometry.vertices,0!==m.length))for($=e(),$.positionScreen.copy(m[0]).applyMatrix4(j),v=h.type===THREE.LinePieces?2:1,W=1,X=m.length;W<X;W++)$=e(),$.positionScreen.copy(m[W]).applyMatrix4(j),0<(W+1)%v||(G=c[l-2],q.copy($.positionScreen),R.copy(G.positionScreen),!0===i(q,R)&&(q.multiplyScalar(1/q.w),R.multiplyScalar(1/R.w),g=n(),g.id=h.id,g.v1.positionScreen.copy(q),g.v2.positionScreen.copy(R),g.z=Math.max(q.z,R.z),g.material=h.material,h.material.vertexColors===THREE.VertexColors&&(g.vertexColors[0].copy(h.geometry.colors[W]),g.vertexColors[1].copy(h.geometry.colors[W-1])),N.elements.push(g)))}else h instanceof THREE.Sprite&&(O.set(B.elements[12],B.elements[13],B.elements[14],1),O.applyMatrix4(H),v=1/O.w,O.z*=v,-1<=O.z&&1>=O.z&&(S===T?(b=new THREE.RenderableSprite,x.push(b),T++,S++,E=b):E=x[S++],E.id=h.id,E.x=O.x*v,E.y=O.y*v,E.z=O.z,E.object=h,E.rotation=h.rotation,E.scale.x=h.scale.x*Math.abs(E.x-(O.x+u.projectionMatrix.elements[0])/(O.w+u.projectionMatrix.elements[12])),E.scale.y=h.scale.y*Math.abs(E.y-(O.y+u.projectionMatrix.elements[5])/(O.w+u.projectionMatrix.elements[13])),E.material=h.material,N.elements.push(E)));return!0===f&&N.elements.sort(r),N}},THREE.Face3=function(e,t,n,r,i,s){this.a=e,this.b=t,this.c=n,this.normal=r instanceof THREE.Vector3?r:new THREE.Vector3,this.vertexNormals=r instanceof Array?r:[],this.color=i instanceof THREE.Color?i:new THREE.Color,this.vertexColors=i instanceof Array?i:[],this.vertexTangents=[],this.materialIndex=void 0!==s?s:0,this.centroid=new THREE.Vector3},THREE.Face3.prototype={constructor:THREE.Face3,clone:function(){var e=new THREE.Face3(this.a,this.b,this.c);e.normal.copy(this.normal),e.color.copy(this.color),e.centroid.copy(this.centroid),e.materialIndex=this.materialIndex;var t,n;t=0;for(n=this.vertexNormals.length;t<n;t++)e.vertexNormals[t]=this.vertexNormals[t].clone();t=0;for(n=this.vertexColors.length;t<n;t++)e.vertexColors[t]=this.vertexColors[t].clone();t=0;for(n=this.vertexTangents.length;t<n;t++)e.vertexTangents[t]=this.vertexTangents[t].clone();return e}},THREE.Face4=function(e,t,n,r,i,s,o){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new THREE.Face3(e,t,n,i,s,o)},THREE.Geometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphColors=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingSphere=this.boundingBox=null,this.hasTangents=!1,this.dynamic=!0,this.buffersNeedUpdate=this.lineDistancesNeedUpdate=this.colorsNeedUpdate=this.tangentsNeedUpdate=this.normalsNeedUpdate=this.uvsNeedUpdate=this.elementsNeedUpdate=this.verticesNeedUpdate=!1},THREE.Geometry.prototype={constructor:THREE.Geometry,applyMatrix:function(e){for(var t=(new THREE.Matrix3).getNormalMatrix(e),n=0,r=this.vertices.length;n<r;n++)this.vertices[n].applyMatrix4(e);n=0;for(r=this.faces.length;n<r;n++){var i=this.faces[n];i.normal.applyMatrix3(t).normalize();for(var s=0,o=i.vertexNormals.length;s<o;s++)i.vertexNormals[s].applyMatrix3(t).normalize();i.centroid.applyMatrix4(e)}this.boundingBox instanceof THREE.Box3&&this.computeBoundingBox(),this.boundingSphere instanceof THREE.Sphere&&this.computeBoundingSphere()},computeCentroids:function(){var e,t,n;e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n.centroid.set(0,0,0),n.centroid.add(this.vertices[n.a]),n.centroid.add(this.vertices[n.b]),n.centroid.add(this.vertices[n.c]),n.centroid.divideScalar(3)},computeFaceNormals:function(){for(var e=new THREE.Vector3,t=new THREE.Vector3,n=0,r=this.faces.length;n<r;n++){var i=this.faces[n],s=this.vertices[i.a],o=this.vertices[i.b];e.subVectors(this.vertices[i.c],o),t.subVectors(s,o),e.cross(t),e.normalize(),i.normal.copy(e)}},computeVertexNormals:function(e){var t,n,r;r=Array(this.vertices.length),t=0;for(n=this.vertices.length;t<n;t++)r[t]=new THREE.Vector3;if(e){var i,s,o,u=new THREE.Vector3,a=new THREE.Vector3;new THREE.Vector3,new THREE.Vector3,new THREE.Vector3,e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],i=this.vertices[n.a],s=this.vertices[n.b],o=this.vertices[n.c],u.subVectors(o,s),a.subVectors(i,s),u.cross(a),r[n.a].add(u),r[n.b].add(u),r[n.c].add(u)}else for(e=0,t=this.faces.length;e<t;e++)n=this.faces[e],r[n.a].add(n.normal),r[n.b].add(n.normal),r[n.c].add(n.normal);t=0;for(n=this.vertices.length;t<n;t++)r[t].normalize();e=0;for(t=this.faces.length;e<t;e++)n=this.faces[e],n.vertexNormals[0]=r[n.a].clone(),n.vertexNormals[1]=r[n.b].clone(),n.vertexNormals[2]=r[n.c].clone()},computeMorphNormals:function(){var e,t,n,r,i;n=0;for(r=this.faces.length;n<r;n++)for(i=this.faces[n],i.__originalFaceNormal?i.__originalFaceNormal.copy(i.normal):i.__originalFaceNormal=i.normal.clone(),i.__originalVertexNormals||(i.__originalVertexNormals=[]),e=0,t=i.vertexNormals.length;e<t;e++)i.__originalVertexNormals[e]?i.__originalVertexNormals[e].copy(i.vertexNormals[e]):i.__originalVertexNormals[e]=i.vertexNormals[e].clone();var s=new THREE.Geometry;s.faces=this.faces,e=0;for(t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[],i=this.morphNormals[e].faceNormals;var o=this.morphNormals[e].vertexNormals,u,a;n=0;for(r=this.faces.length;n<r;n++)u=new THREE.Vector3,a={a:new THREE.Vector3,b:new THREE.Vector3,c:new THREE.Vector3},i.push(u),o.push(a)}o=this.morphNormals[e],s.vertices=this.morphTargets[e].vertices,s.computeFaceNormals(),s.computeVertexNormals(),n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],u=o.faceNormals[n],a=o.vertexNormals[n],u.copy(i.normal),a.a.copy(i.vertexNormals[0]),a.b.copy(i.vertexNormals[1]),a.c.copy(i.vertexNormals[2])}n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],i.normal=i.__originalFaceNormal,i.vertexNormals=i.__originalVertexNormals},computeTangents:function(){var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,g=[],y=[];n=new THREE.Vector3;var b=new THREE.Vector3,w=new THREE.Vector3,E=new THREE.Vector3,S=new THREE.Vector3;e=0;for(t=this.vertices.length;e<t;e++)g[e]=new THREE.Vector3,y[e]=new THREE.Vector3;e=0;for(t=this.faces.length;e<t;e++)i=this.faces[e],s=this.faceVertexUvs[0][e],r=i.a,m=i.b,i=i.c,o=this.vertices[r],u=this.vertices[m],a=this.vertices[i],f=s[0],l=s[1],c=s[2],s=u.x-o.x,h=a.x-o.x,p=u.y-o.y,d=a.y-o.y,u=u.z-o.z,o=a.z-o.z,a=l.x-f.x,v=c.x-f.x,l=l.y-f.y,f=c.y-f.y,c=1/(a*f-v*l),n.set((f*s-l*h)*c,(f*p-l*d)*c,(f*u-l*o)*c),b.set((a*h-v*s)*c,(a*d-v*p)*c,(a*o-v*u)*c),g[r].add(n),g[m].add(n),g[i].add(n),y[r].add(b),y[m].add(b),y[i].add(b);b=["a","b","c","d"],e=0;for(t=this.faces.length;e<t;e++)for(i=this.faces[e],n=0;n<Math.min(i.vertexNormals.length,3);n++)S.copy(i.vertexNormals[n]),r=i[b[n]],m=g[r],w.copy(m),w.sub(S.multiplyScalar(S.dot(m))).normalize(),E.crossVectors(i.vertexNormals[n],m),r=E.dot(y[r]),r=0>r?-1:1,i.vertexTangents[n]=new THREE.Vector4(w.x,w.y,w.z,r);this.hasTangents=!0},computeLineDistances:function(){for(var e=0,t=this.vertices,n=0,r=t.length;n<r;n++)0<n&&(e+=t[n].distanceTo(t[n-1])),this.lineDistances[n]=e},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),this.boundingSphere.setFromPoints(this.vertices)},mergeVertices:function(){var e={},t=[],n=[],r,i=Math.pow(10,4),s,o;s=0;for(o=this.vertices.length;s<o;s++)r=this.vertices[s],r=Math.round(r.x*i)+"_"+Math.round(r.y*i)+"_"+Math.round(r.z*i),void 0===e[r]?(e[r]=s,t.push(this.vertices[s]),n[s]=t.length-1):n[s]=n[e[r]];e=[],s=0;for(o=this.faces.length;s<o;s++)for(i=this.faces[s],i.a=n[i.a],i.b=n[i.b],i.c=n[i.c],i=[i.a,i.b,i.c],r=0;3>r;r++)if(i[r]==i[(r+1)%3]){e.push(s);break}for(s=e.length-1;0<=s;s--)for(i=e[s],this.faces.splice(i,1),n=0,o=this.faceVertexUvs.length;n<o;n++)this.faceVertexUvs[n].splice(i,1);return s=this.vertices.length-t.length,this.vertices=t,s},makeGroups:function(){var e=0;return function(t){var n,r,i,s,o={},u=this.morphTargets.length,f=this.morphNormals.length;this.geometryGroups={},n=0;for(r=this.faces.length;n<r;n++)i=this.faces[n],i=t?i.materialIndex:0,i in o||(o[i]={hash:i,counter:0}),s=o[i].hash+"_"+o[i].counter,s in this.geometryGroups||(this.geometryGroups[s]={faces3:[],materialIndex:i,vertices:0,numMorphTargets:u,numMorphNormals:f}),65535<this.geometryGroups[s].vertices+3&&(o[i].counter+=1,s=o[i].hash+"_"+o[i].counter,s in this.geometryGroups||(this.geometryGroups[s]={faces3:[],materialIndex:i,vertices:0,numMorphTargets:u,numMorphNormals:f})),this.geometryGroups[s].faces3.push(n),this.geometryGroups[s].vertices+=3;this.geometryGroupsList=[];for(var l in this.geometryGroups)this.geometryGroups[l].id=e++,this.geometryGroupsList.push(this.geometryGroups[l])}}(),clone:function(){for(var e=new THREE.Geometry,t=this.vertices,n=0,r=t.length;n<r;n++)e.vertices.push(t[n].clone());t=this.faces,n=0;for(r=t.length;n<r;n++)e.faces.push(t[n].clone());t=this.faceVertexUvs[0],n=0;for(r=t.length;n<r;n++){for(var i=t[n],s=[],o=0,u=i.length;o<u;o++)s.push(new THREE.Vector2(i[o].x,i[o].y));e.faceVertexUvs[0].push(s)}return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry.prototype),THREE.GeometryIdCount=0,THREE.Geometry2=function(e){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.vertices=void 0!==e?new Float32Array(3*e):[],this.normals=void 0!==e?new Float32Array(3*e):[],this.uvs=void 0!==e?new Float32Array(2*e):[],this.boundingSphere=this.boundingBox=null},THREE.Geometry2.prototype={constructor:THREE.Geometry2,applyMatrix:function(e){e.multiplyVector3Array(this.vertices)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.vertices,t=this.boundingBox;3<=e.length&&(t.min.x=t.max.x=e[0],t.min.y=t.max.y=e[1],t.min.z=t.max.z=e[2]);for(var n=3,r=e.length;n<r;n+=3){var i=e[n],s=e[n+1],o=e[n+2];i<t.min.x?t.min.x=i:i>t.max.x&&(t.max.x=i),s<t.min.y?t.min.y=s:s>t.max.y&&(t.max.y=s),o<t.min.z?t.min.z=o:o>t.max.z&&(t.max.z=o)}},computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere),e.makeEmpty();for(var n=this.vertices,r=this.boundingSphere.center,i=0,s=n.length;i<s;i+=3)t.set(n[i],n[i+1],n[i+2]),e.addPoint(t);e.center(r);for(var o=0,i=0,s=n.length;i<s;i+=3)t.set(n[i],n[i+1],n[i+2]),o=Math.max(o,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o)}}(),dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Geometry2.prototype),THREE.BufferGeometry=function(){this.id=THREE.GeometryIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.attributes={},this.offsets=[],this.boundingSphere=this.boundingBox=null},THREE.BufferGeometry.prototype={constructor:THREE.BufferGeometry,addAttribute:function(e,t,n,r){this.attributes[e]={itemSize:r,array:new t(n*r)}},applyMatrix:function(e){var t=this.attributes.position;void 0!==t&&(e.multiplyVector3Array(t.array),t.needsUpdate=!0),t=this.attributes.normal,void 0!==t&&((new THREE.Matrix3).getNormalMatrix(e).multiplyVector3Array(t.array),t.needsUpdate=!0)},computeBoundingBox:function(){null===this.boundingBox&&(this.boundingBox=new THREE.Box3);var e=this.attributes.position.array;if(e){var t=this.boundingBox;3<=e.length&&(t.min.x=t.max.x=e[0],t.min.y=t.max.y=e[1],t.min.z=t.max.z=e[2]);for(var n=3,r=e.length;n<r;n+=3){var i=e[n],s=e[n+1],o=e[n+2];i<t.min.x?t.min.x=i:i>t.max.x&&(t.max.x=i),s<t.min.y?t.min.y=s:s>t.max.y&&(t.max.y=s),o<t.min.z?t.min.z=o:o>t.max.z&&(t.max.z=o)}}if(void 0===e||0===e.length)this.boundingBox.min.set(0,0,0),this.boundingBox.max.set(0,0,0)},computeBoundingSphere:function(){var e=new THREE.Box3,t=new THREE.Vector3;return function(){null===this.boundingSphere&&(this.boundingSphere=new THREE.Sphere);var n=this.attributes.position.array;if(n){e.makeEmpty();for(var r=this.boundingSphere.center,i=0,s=n.length;i<s;i+=3)t.set(n[i],n[i+1],n[i+2]),e.addPoint(t);e.center(r);for(var o=0,i=0,s=n.length;i<s;i+=3)t.set(n[i],n[i+1],n[i+2]),o=Math.max(o,r.distanceToSquared(t));this.boundingSphere.radius=Math.sqrt(o)}}}(),computeVertexNormals:function(){if(this.attributes.position){var e,t,n,r;e=this.attributes.position.array.length;if(void 0===this.attributes.normal)this.attributes.normal={itemSize:3,array:new Float32Array(e)};else for(e=0,t=this.attributes.normal.array.length;e<t;e++)this.attributes.normal.array[e]=0;var i=this.attributes.position.array,s=this.attributes.normal.array,o,u,a,f,l,c,h=new THREE.Vector3,p=new THREE.Vector3,d=new THREE.Vector3,v=new THREE.Vector3,m=new THREE.Vector3;if(this.attributes.index){var g=this.attributes.index.array,y=this.offsets;n=0;for(r=y.length;n<r;++n){t=y[n].start,o=y[n].count;var b=y[n].index;e=t;for(t+=o;e<t;e+=3)o=b+g[e],u=b+g[e+1],a=b+g[e+2],f=i[3*o],l=i[3*o+1],c=i[3*o+2],h.set(f,l,c),f=i[3*u],l=i[3*u+1],c=i[3*u+2],p.set(f,l,c),f=i[3*a],l=i[3*a+1],c=i[3*a+2],d.set(f,l,c),v.subVectors(d,p),m.subVectors(h,p),v.cross(m),s[3*o]+=v.x,s[3*o+1]+=v.y,s[3*o+2]+=v.z,s[3*u]+=v.x,s[3*u+1]+=v.y,s[3*u+2]+=v.z,s[3*a]+=v.x,s[3*a+1]+=v.y,s[3*a+2]+=v.z}}else for(e=0,t=i.length;e<t;e+=9)f=i[e],l=i[e+1],c=i[e+2],h.set(f,l,c),f=i[e+3],l=i[e+4],c=i[e+5],p.set(f,l,c),f=i[e+6],l=i[e+7],c=i[e+8],d.set(f,l,c),v.subVectors(d,p),m.subVectors(h,p),v.cross(m),s[e]=v.x,s[e+1]=v.y,s[e+2]=v.z,s[e+3]=v.x,s[e+4]=v.y,s[e+5]=v.z,s[e+6]=v.x,s[e+7]=v.y,s[e+8]=v.z;this.normalizeNormals(),this.normalsNeedUpdate=!0}},normalizeNormals:function(){for(var e=this.attributes.normal.array,t,n,r,i=0,s=e.length;i<s;i+=3)t=e[i],n=e[i+1],r=e[i+2],t=1/Math.sqrt(t*t+n*n+r*r),e[i]*=t,e[i+1]*=t,e[i+2]*=t},computeTangents:function(){function e(e,t,n){c=r[3*e],h=r[3*e+1],p=r[3*e+2],d=r[3*t],v=r[3*t+1],m=r[3*t+2],g=r[3*n],y=r[3*n+1],b=r[3*n+2],w=s[2*e],E=s[2*e+1],S=s[2*t],x=s[2*t+1],T=s[2*n],N=s[2*n+1],C=d-c,k=g-c,L=v-h,A=y-h,O=m-p,M=b-p,_=S-w,D=T-w,P=x-E,H=N-E,B=1/(_*H-D*P),j.set((H*C-P*k)*B,(H*L-P*A)*B,(H*O-P*M)*B),F.set((_*k-D*C)*B,(_*A-D*L)*B,(_*M-D*O)*B),a[e].add(j),a[t].add(j),a[n].add(j),f[e].add(F),f[t].add(F),f[n].add(F)}function t(e){J.x=i[3*e],J.y=i[3*e+1],J.z=i[3*e+2],K.copy(J),G=a[e],V.copy(G),V.sub(J.multiplyScalar(J.dot(G))).normalize(),$.crossVectors(K,G),Y=$.dot(f[e]),Q=0>Y?-1:1,u[4*e]=V.x,u[4*e+1]=V.y,u[4*e+2]=V.z,u[4*e+3]=Q}if(void 0===this.attributes.index||void 0===this.attributes.position||void 0===this.attributes.normal||void 0===this.attributes.uv)console.warn("Missing required attributes (index, position, normal or uv) in BufferGeometry.computeTangents()");else{var n=this.attributes.index.array,r=this.attributes.position.array,i=this.attributes.normal.array,s=this.attributes.uv.array,o=r.length/3;void 0===this.attributes.tangent&&(this.attributes.tangent={itemSize:4,array:new Float32Array(4*o)});for(var u=this.attributes.tangent.array,a=[],f=[],l=0;l<o;l++)a[l]=new THREE.Vector3,f[l]=new THREE.Vector3;var c,h,p,d,v,m,g,y,b,w,E,S,x,T,N,C,k,L,A,O,M,_,D,P,H,B,j=new THREE.Vector3,F=new THREE.Vector3,I,q,R,U,z,W=this.offsets,l=0;for(q=W.length;l<q;++l){I=W[l].start,R=W[l].count;var X=W[l].index,o=I;for(I+=R;o<I;o+=3)R=X+n[o],U=X+n[o+1],z=X+n[o+2],e(R,U,z)}var V=new THREE.Vector3,$=new THREE.Vector3,J=new THREE.Vector3,K=new THREE.Vector3,Q,G,Y,l=0;for(q=W.length;l<q;++l)for(I=W[l].start,R=W[l].count,X=W[l].index,o=I,I+=R;o<I;o+=3)R=X+n[o],U=X+n[o+1],z=X+n[o+2],t(R),t(U),t(z)}},computeOffsets:function(e){var t=e;void 0===e&&(t=65535),Date.now(),e=this.attributes.index.array;for(var n=this.attributes.position.array,r=e.length/3,i=new Uint16Array(e.length),s=0,o=0,u=[{start:0,count:0,index:0}],a=u[0],f=0,l=0,c=new Int32Array(6),h=new Int32Array(n.length),p=new Int32Array(n.length),d=0;d<n.length;d++)h[d]=-1,p[d]=-1;for(n=0;n<r;n++){for(var v=l=0;3>v;v++)d=e[3*n+v],-1==h[d]?(c[2*v]=d,c[2*v+1]=-1,l++):h[d]<a.index?(c[2*v]=d,c[2*v+1]=-1,f++):(c[2*v]=d,c[2*v+1]=h[d]);if(o+l>a.index+t)for(a={start:s,count:0,index:o},u.push(a),l=0;6>l;l+=2)v=c[l+1],-1<v&&v<a.index&&(c[l+1]=-1);for(l=0;6>l;l+=2)d=c[l],v=c[l+1],-1===v&&(v=o++),h[d]=v,p[v]=d,i[s++]=v-a.index,a.count++}return this.reorderBuffers(i,p,o),this.offsets=u},reorderBuffers:function(e,t,n){var r={},i=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],s;for(s in this.attributes)if("index"!=s)for(var o=this.attributes[s].array,u=0,a=i.length;u<a;u++){var f=i[u];if(o instanceof f){r[s]=new f(this.attributes[s].itemSize*n);break}}for(i=0;i<n;i++)for(s in o=t[i],this.attributes)if("index"!=s)for(var u=this.attributes[s].array,a=this.attributes[s].itemSize,f=r[s],l=0;l<a;l++)f[i*a+l]=u[o*a+l];this.attributes.index.array=e;for(s in this.attributes)"index"!=s&&(this.attributes[s].array=r[s],this.attributes[s].numItems=this.attributes[s].itemSize*n)},clone:function(){var e=new THREE.BufferGeometry,t=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array],n;for(n in this.attributes){for(var r=this.attributes[n],i=r.array,s={itemSize:r.itemSize,array:null},r=0,o=t.length;r<o;r++){var u=t[r];if(i instanceof u){s.array=new u(i);break}}e.attributes[n]=s}r=0;for(o=this.offsets.length;r<o;r++)t=this.offsets[r],e.offsets.push({start:t.start,index:t.index,count:t.count});return e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.BufferGeometry.prototype),THREE.Camera=function(){THREE.Object3D.call(this),this.matrixWorldInverse=new THREE.Matrix4,this.projectionMatrix=new THREE.Matrix4},THREE.Camera.prototype=Object.create(THREE.Object3D.prototype),THREE.Camera.prototype.lookAt=function(){var e=new THREE.Matrix4;return function(t){e.lookAt(this.position,t,this.up),this.quaternion.setFromRotationMatrix(e)}}(),THREE.Camera.prototype.clone=function(e){return void 0===e&&(e=new THREE.Camera),THREE.Object3D.prototype.clone.call(this,e),e.matrixWorldInverse.copy(this.matrixWorldInverse),e.projectionMatrix.copy(this.projectionMatrix),e},THREE.OrthographicCamera=function(e,t,n,r,i,s){THREE.Camera.call(this),this.left=e,this.right=t,this.top=n,this.bottom=r,this.near=void 0!==i?i:.1,this.far=void 0!==s?s:2e3,this.updateProjectionMatrix()},THREE.OrthographicCamera.prototype=Object.create(THREE.Camera.prototype),THREE.OrthographicCamera.prototype.updateProjectionMatrix=function(){this.projectionMatrix.makeOrthographic(this.left,this.right,this.top,this.bottom,this.near,this.far)},THREE.OrthographicCamera.prototype.clone=function(){var e=new THREE.OrthographicCamera;return THREE.Camera.prototype.clone.call(this,e),e.left=this.left,e.right=this.right,e.top=this.top,e.bottom=this.bottom,e.near=this.near,e.far=this.far,e},THREE.PerspectiveCamera=function(e,t,n,r){THREE.Camera.call(this),this.fov=void 0!==e?e:50,this.aspect=void 0!==t?t:1,this.near=void 0!==n?n:.1,this.far=void 0!==r?r:2e3,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype=Object.create(THREE.Camera.prototype),THREE.PerspectiveCamera.prototype.setLens=function(e,t){void 0===t&&(t=24),this.fov=2*THREE.Math.radToDeg(Math.atan(t/(2*e))),this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.setViewOffset=function(e,t,n,r,i,s){this.fullWidth=e,this.fullHeight=t,this.x=n,this.y=r,this.width=i,this.height=s,this.updateProjectionMatrix()},THREE.PerspectiveCamera.prototype.updateProjectionMatrix=function(){if(this.fullWidth){var e=this.fullWidth/this.fullHeight,t=Math.tan(THREE.Math.degToRad(.5*this.fov))*this.near,n=-t,r=e*n,e=Math.abs(e*t-r),n=Math.abs(t-n);this.projectionMatrix.makeFrustum(r+this.x*e/this.fullWidth,r+(this.x+this.width)*e/this.fullWidth,t-(this.y+this.height)*n/this.fullHeight,t-this.y*n/this.fullHeight,this.near,this.far)}else this.projectionMatrix.makePerspective(this.fov,this.aspect,this.near,this.far)},THREE.PerspectiveCamera.prototype.clone=function(){var e=new THREE.PerspectiveCamera;return THREE.Camera.prototype.clone.call(this,e),e.fov=this.fov,e.aspect=this.aspect,e.near=this.near,e.far=this.far,e},THREE.Light=function(e){THREE.Object3D.call(this),this.color=new THREE.Color(e)},THREE.Light.prototype=Object.create(THREE.Object3D.prototype),THREE.Light.prototype.clone=function(e){return void 0===e&&(e=new THREE.Light),THREE.Object3D.prototype.clone.call(this,e),e.color.copy(this.color),e},THREE.AmbientLight=function(e){THREE.Light.call(this,e)},THREE.AmbientLight.prototype=Object.create(THREE.Light.prototype),THREE.AmbientLight.prototype.clone=function(){var e=new THREE.AmbientLight;return THREE.Light.prototype.clone.call(this,e),e},THREE.AreaLight=function(e,t){THREE.Light.call(this,e),this.normal=new THREE.Vector3(0,-1,0),this.right=new THREE.Vector3(1,0,0),this.intensity=void 0!==t?t:1,this.height=this.width=1,this.constantAttenuation=1.5,this.linearAttenuation=.5,this.quadraticAttenuation=.1},THREE.AreaLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight=function(e,t){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraLeft=-500,this.shadowCameraTop=this.shadowCameraRight=500,this.shadowCameraBottom=-500,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowCascade=!1,this.shadowCascadeOffset=new THREE.Vector3(0,0,-1e3),this.shadowCascadeCount=2,this.shadowCascadeBias=[0,0,0],this.shadowCascadeWidth=[512,512,512],this.shadowCascadeHeight=[512,512,512],this.shadowCascadeNearZ=[-1,.99,.998],this.shadowCascadeFarZ=[.99,.998,1],this.shadowCascadeArray=[],this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.DirectionalLight.prototype=Object.create(THREE.Light.prototype),THREE.DirectionalLight.prototype.clone=function(){var e=new THREE.DirectionalLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.HemisphereLight=function(e,t,n){THREE.Light.call(this,e),this.position.set(0,100,0),this.groundColor=new THREE.Color(t),this.intensity=void 0!==n?n:1},THREE.HemisphereLight.prototype=Object.create(THREE.Light.prototype),THREE.HemisphereLight.prototype.clone=function(){var e=new THREE.HemisphereLight;return THREE.Light.prototype.clone.call(this,e),e.groundColor.copy(this.groundColor),e.intensity=this.intensity,e},THREE.PointLight=function(e,t,n){THREE.Light.call(this,e),this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0},THREE.PointLight.prototype=Object.create(THREE.Light.prototype),THREE.PointLight.prototype.clone=function(){var e=new THREE.PointLight;return THREE.Light.prototype.clone.call(this,e),e.intensity=this.intensity,e.distance=this.distance,e},THREE.SpotLight=function(e,t,n,r,i){THREE.Light.call(this,e),this.position.set(0,1,0),this.target=new THREE.Object3D,this.intensity=void 0!==t?t:1,this.distance=void 0!==n?n:0,this.angle=void 0!==r?r:Math.PI/3,this.exponent=void 0!==i?i:10,this.onlyShadow=this.castShadow=!1,this.shadowCameraNear=50,this.shadowCameraFar=5e3,this.shadowCameraFov=50,this.shadowCameraVisible=!1,this.shadowBias=0,this.shadowDarkness=.5,this.shadowMapHeight=this.shadowMapWidth=512,this.shadowMatrix=this.shadowCamera=this.shadowMapSize=this.shadowMap=null},THREE.SpotLight.prototype=Object.create(THREE.Light.prototype),THREE.SpotLight.prototype.clone=function(){var e=new THREE.SpotLight;return THREE.Light.prototype.clone.call(this,e),e.target=this.target.clone(),e.intensity=this.intensity,e.distance=this.distance,e.angle=this.angle,e.exponent=this.exponent,e.castShadow=this.castShadow,e.onlyShadow=this.onlyShadow,e},THREE.Loader=function(e){this.statusDomElement=(this.showStatus=e)?THREE.Loader.prototype.addStatusElement():null,this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){}},THREE.Loader.prototype={constructor:THREE.Loader,crossOrigin:void 0,addStatusElement:function(){var e=document.createElement("div");return e.style.position="absolute",e.style.right="0px",e.style.top="0px",e.style.fontSize="0.8em",e.style.textAlign="left",e.style.background="rgba(0,0,0,0.25)",e.style.color="#fff",e.style.width="120px",e.style.padding="0.5em 0.5em 0.5em 0.5em",e.style.zIndex=1e3,e.innerHTML="Loading ...",e},updateProgress:function(e){var t="Loaded ",t=e.total?t+((100*e.loaded/e.total).toFixed(0)+"%"):t+((e.loaded/1e3).toFixed(2)+" KB");this.statusDomElement.innerHTML=t},extractUrlBase:function(e){return e=e.split("/"),1===e.length?"./":(e.pop(),e.join("/")+"/")},initMaterials:function(e,t){for(var n=[],r=0;r<e.length;++r)n[r]=THREE.Loader.prototype.createMaterial(e[r],t);return n},needsTangents:function(e){for(var t=0,n=e.length;t<n;t++)if(e[t]instanceof THREE.ShaderMaterial)return!0;return!1},createMaterial:function(e,t){function n(e){return e=Math.log(e)/Math.LN2,Math.floor(e)==e}function r(e){return e=Math.log(e)/Math.LN2,Math.pow(2,Math.round(e))}function i(e,t){var i=new Image;i.onload=function(){if(n(this.width)&&n(this.height))e.image=this;else{var t=r(this.width),i=r(this.height);e.image.width=t,e.image.height=i,e.image.getContext("2d").drawImage(this,0,0,t,i)}e.needsUpdate=!0},void 0!==u.crossOrigin&&(i.crossOrigin=u.crossOrigin),i.src=t}function s(e,n,r,s,o,u,a){var f=/\.dds$/i.test(r),l=t+r;if(f){var c=THREE.ImageUtils.loadCompressedTexture(l);e[n]=c}else c=document.createElement("canvas"),e[n]=new THREE.Texture(c);e[n].sourceFile=r,s&&(e[n].repeat.set(s[0],s[1]),1!==s[0]&&(e[n].wrapS=THREE.RepeatWrapping),1!==s[1]&&(e[n].wrapT=THREE.RepeatWrapping)),o&&e[n].offset.set(o[0],o[1]),u&&(r={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==r[u[0]]&&(e[n].wrapS=r[u[0]]),void 0!==r[u[1]]&&(e[n].wrapT=r[u[1]])),a&&(e[n].anisotropy=a),f||i(e[n],l)}function o(e){return(255*e[0]<<16)+(255*e[1]<<8)+255*e[2]}var u=this,a="MeshLambertMaterial",f={color:15658734,opacity:1,map:null,lightMap:null,normalMap:null,bumpMap:null,wireframe:!1};if(e.shading){var l=e.shading.toLowerCase();"phong"===l?a="MeshPhongMaterial":"basic"===l&&(a="MeshBasicMaterial")}void 0!==e.blending&&void 0!==THREE[e.blending]&&(f.blending=THREE[e.blending]);if(void 0!==e.transparent||1>e.opacity)f.transparent=e.transparent;return void 0!==e.depthTest&&(f.depthTest=e.depthTest),void 0!==e.depthWrite&&(f.depthWrite=e.depthWrite),void 0!==e.visible&&(f.visible=e.visible),void 0!==e.flipSided&&(f.side=THREE.BackSide),void 0!==e.doubleSided&&(f.side=THREE.DoubleSide),void 0!==e.wireframe&&(f.wireframe=e.wireframe),void 0!==e.vertexColors&&("face"===e.vertexColors?f.vertexColors=THREE.FaceColors:e.vertexColors&&(f.vertexColors=THREE.VertexColors)),e.colorDiffuse?f.color=o(e.colorDiffuse):e.DbgColor&&(f.color=e.DbgColor),e.colorSpecular&&(f.specular=o(e.colorSpecular)),e.colorAmbient&&(f.ambient=o(e.colorAmbient)),e.transparency&&(f.opacity=e.transparency),e.specularCoef&&(f.shininess=e.specularCoef),e.mapDiffuse&&t&&s(f,"map",e.mapDiffuse,e.mapDiffuseRepeat,e.mapDiffuseOffset,e.mapDiffuseWrap,e.mapDiffuseAnisotropy),e.mapLight&&t&&s(f,"lightMap",e.mapLight,e.mapLightRepeat,e.mapLightOffset,e.mapLightWrap,e.mapLightAnisotropy),e.mapBump&&t&&s(f,"bumpMap",e.mapBump,e.mapBumpRepeat,e.mapBumpOffset,e.mapBumpWrap,e.mapBumpAnisotropy),e.mapNormal&&t&&s(f,"normalMap",e.mapNormal,e.mapNormalRepeat,e.mapNormalOffset,e.mapNormalWrap,e.mapNormalAnisotropy),e.mapSpecular&&t&&s(f,"specularMap",e.mapSpecular,e.mapSpecularRepeat,e.mapSpecularOffset,e.mapSpecularWrap,e.mapSpecularAnisotropy),e.mapBumpScale&&(f.bumpScale=e.mapBumpScale),e.mapNormal?(a=THREE.ShaderLib.normalmap,l=THREE.UniformsUtils.clone(a.uniforms),l.tNormal.value=f.normalMap,e.mapNormalFactor&&l.uNormalScale.value.set(e.mapNormalFactor,e.mapNormalFactor),f.map&&(l.tDiffuse.value=f.map,l.enableDiffuse.value=!0),f.specularMap&&(l.tSpecular.value=f.specularMap,l.enableSpecular.value=!0),f.lightMap&&(l.tAO.value=f.lightMap,l.enableAO.value=!0),l.diffuse.value.setHex(f.color),l.specular.value.setHex(f.specular),l.ambient.value.setHex(f.ambient),l.shininess.value=f.shininess,void 0!==f.opacity&&(l.opacity.value=f.opacity),a=new THREE.ShaderMaterial({fragmentShader:a.fragmentShader,vertexShader:a.vertexShader,uniforms:l,lights:!0,fog:!0}),f.transparent&&(a.transparent=!0)):a=new THREE[a](f),void 0!==e.DbgName&&(a.name=e.DbgName),a}},THREE.XHRLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.XHRLoader.prototype={constructor:THREE.XHRLoader,load:function(e,t,n,r){var i=this,s=new XMLHttpRequest;void 0!==t&&s.addEventListener("load",function(n){t(n.target.responseText),i.manager.itemEnd(e)},!1),void 0!==n&&s.addEventListener("progress",function(e){n(e)},!1),void 0!==r&&s.addEventListener("error",function(e){r(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.open("GET",e,!0),s.send(null),i.manager.itemStart(e)},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.ImageLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ImageLoader.prototype={constructor:THREE.ImageLoader,load:function(e,t,n,r){var i=this,s=document.createElement("img");return void 0!==t&&s.addEventListener("load",function(n){i.manager.itemEnd(e),t(this)},!1),void 0!==n&&s.addEventListener("progress",function(e){n(e)},!1),void 0!==r&&s.addEventListener("error",function(e){r(e)},!1),void 0!==this.crossOrigin&&(s.crossOrigin=this.crossOrigin),s.src=e,i.manager.itemStart(e),s},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.JSONLoader=function(e){THREE.Loader.call(this,e),this.withCredentials=!1},THREE.JSONLoader.prototype=Object.create(THREE.Loader.prototype),THREE.JSONLoader.prototype.load=function(e,t,n){n=n&&"string"==typeof n?n:this.extractUrlBase(e),this.onLoadStart(),this.loadAjaxJSON(this,e,t,n)},THREE.JSONLoader.prototype.loadAjaxJSON=function(e,t,n,r,i){var s=new XMLHttpRequest,o=0;s.onreadystatechange=function(){if(s.readyState===s.DONE)if(200===s.status||0===s.status){if(s.responseText){var u=JSON.parse(s.responseText);if("scene"===u.metadata.type){console.error('THREE.JSONLoader: "'+t+'" seems to be a Scene. Use THREE.SceneLoader instead.');return}u=e.parse(u,r),n(u.geometry,u.materials)}else console.error('THREE.JSONLoader: "'+t+'" seems to be unreachable or the file is empty.');e.onLoadComplete()}else console.error("THREE.JSONLoader: Couldn't load \""+t+'" ('+s.status+")");else s.readyState===s.LOADING?i&&(0===o&&(o=s.getResponseHeader("Content-Length")),i({total:o,loaded:s.responseText.length})):s.readyState===s.HEADERS_RECEIVED&&void 0!==i&&(o=s.getResponseHeader("Content-Length"))},s.open("GET",t,!0),s.withCredentials=this.withCredentials,s.send(null)},THREE.JSONLoader.prototype.parse=function(e,t){var n=new THREE.Geometry,r=void 0!==e.scale?1/e.scale:1;return function(t){var r,i,s,o,u,f,l,h,p,d,v,m,g,y=e.faces;f=e.vertices;var b=e.normals,w=e.colors,E=0;if(void 0!==e.uvs){for(r=0;r<e.uvs.length;r++)e.uvs[r].length&&E++;for(r=0;r<E;r++)n.faceVertexUvs[r]=[]}o=0;for(u=f.length;o<u;)r=new THREE.Vector3,r.x=f[o++]*t,r.y=f[o++]*t,r.z=f[o++]*t,n.vertices.push(r);o=0;for(u=y.length;o<u;)if(t=y[o++],p=t&1,s=t&2,r=t&8,l=t&16,d=t&32,f=t&64,t&=128,p){p=new THREE.Face3,p.a=y[o],p.b=y[o+1],p.c=y[o+3],v=new THREE.Face3,v.a=y[o+1],v.b=y[o+2],v.c=y[o+3],o+=4,s&&(s=y[o++],p.materialIndex=s,v.materialIndex=s),s=n.faces.length;if(r)for(r=0;r<E;r++)for(m=e.uvs[r],n.faceVertexUvs[r][s]=[],n.faceVertexUvs[r][s+1]=[],i=0;4>i;i++)h=y[o++],g=m[2*h],h=m[2*h+1],g=new THREE.Vector2(g,h),2!==i&&n.faceVertexUvs[r][s].push(g),0!==i&&n.faceVertexUvs[r][s+1].push(g);l&&(l=3*y[o++],p.normal.set(b[l++],b[l++],b[l]),v.normal.copy(p.normal));if(d)for(r=0;4>r;r++)l=3*y[o++],d=new THREE.Vector3(b[l++],b[l++],b[l]),2!==r&&p.vertexNormals.push(d),0!==r&&v.vertexNormals.push(d);f&&(f=y[o++],f=w[f],p.color.setHex(f),v.color.setHex(f));if(t)for(r=0;4>r;r++)f=y[o++],f=w[f],2!==r&&p.vertexColors.push(new THREE.Color(f)),0!==r&&v.vertexColors.push(new THREE.Color(f));n.faces.push(p),n.faces.push(v)}else{p=new THREE.Face3,p.a=y[o++],p.b=y[o++],p.c=y[o++],s&&(s=y[o++],p.materialIndex=s),s=n.faces.length;if(r)for(r=0;r<E;r++)for(m=e.uvs[r],n.faceVertexUvs[r][s]=[],i=0;3>i;i++)h=y[o++],g=m[2*h],h=m[2*h+1],g=new THREE.Vector2(g,h),n.faceVertexUvs[r][s].push(g);l&&(l=3*y[o++],p.normal.set(b[l++],b[l++],b[l]));if(d)for(r=0;3>r;r++)l=3*y[o++],d=new THREE.Vector3(b[l++],b[l++],b[l]),p.vertexNormals.push(d);f&&(f=y[o++],p.color.setHex(w[f]));if(t)for(r=0;3>r;r++)f=y[o++],p.vertexColors.push(new THREE.Color(w[f]));n.faces.push(p)}}(r),function(){if(e.skinWeights)for(var t=0,r=e.skinWeights.length;t<r;t+=2)n.skinWeights.push(new THREE.Vector4(e.skinWeights[t],e.skinWeights[t+1],0,0));if(e.skinIndices)for(t=0,r=e.skinIndices.length;t<r;t+=2)n.skinIndices.push(new THREE.Vector4(e.skinIndices[t],e.skinIndices[t+1],0,0));n.bones=e.bones,n.bones&&0<n.bones.length&&(n.skinWeights.length!==n.skinIndices.length||n.skinIndices.length!==n.vertices.length)&&console.warn("When skinning, number of vertices ("+n.vertices.length+"), skinIndices ("+n.skinIndices.length+"), and skinWeights ("+n.skinWeights.length+") should match."),n.animation=e.animation,n.animations=e.animations}(),function(t){if(void 0!==e.morphTargets){var r,i,s,o,u,f;r=0;for(i=e.morphTargets.length;r<i;r++)for(n.morphTargets[r]={},n.morphTargets[r].name=e.morphTargets[r].name,n.morphTargets[r].vertices=[],u=n.morphTargets[r].vertices,f=e.morphTargets[r].vertices,s=0,o=f.length;s<o;s+=3){var l=new THREE.Vector3;l.x=f[s]*t,l.y=f[s+1]*t,l.z=f[s+2]*t,u.push(l)}}if(void 0!==e.morphColors)for(r=0,i=e.morphColors.length;r<i;r++)for(n.morphColors[r]={},n.morphColors[r].name=e.morphColors[r].name,n.morphColors[r].colors=[],o=n.morphColors[r].colors,u=e.morphColors[r].colors,t=0,s=u.length;t<s;t+=3)f=new THREE.Color(16755200),f.setRGB(u[t],u[t+1],u[t+2]),o.push(f)}(r),n.computeCentroids(),n.computeFaceNormals(),n.computeBoundingSphere(),void 0===e.materials?{geometry:n}:(r=this.initMaterials(e.materials,t),this.needsTangents(r)&&n.computeTangents(),{geometry:n,materials:r})},THREE.LoadingManager=function(e,t,n){var r=this,i=0,s=0;this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(e){s++},this.itemEnd=function(e){i++,void 0!==r.onProgress&&r.onProgress(e,i,s),i===s&&void 0!==r.onLoad&&r.onLoad()}},THREE.DefaultLoadingManager=new THREE.LoadingManager,THREE.BufferGeometryLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.BufferGeometryLoader.prototype={constructor:THREE.BufferGeometryLoader,load:function(e,t,n,r){var i=this;n=new THREE.XHRLoader,n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE.BufferGeometry,n=e.attributes,r=e.offsets;e=e.boundingSphere;for(var i in n){var s=n[i];t.attributes[i]={itemSize:s.itemSize,array:new self[s.type](s.array)}}return void 0!==r&&(t.offsets=JSON.parse(JSON.stringify(r))),void 0!==e&&(t.boundingSphere=new THREE.Sphere((new THREE.Vector3).fromArray(void 0!==e.center?e.center:[0,0,0]),e.radius)),t}},THREE.Geometry2Loader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.Geometry2Loader.prototype={constructor:THREE.Geometry2Loader,load:function(e,t,n,r){var i=this;n=new THREE.XHRLoader,n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE.Geometry2(e.vertices.length/3),n=["vertices","normals","uvs"],r=e.boundingSphere,i;for(i in n){var s=n[i];t[s].set(e[s])}return void 0!==r&&(t.boundingSphere=new THREE.Sphere((new THREE.Vector3).fromArray(void 0!==r.center?r.center:[0,0,0]),r.radius)),t}},THREE.MaterialLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.MaterialLoader.prototype={constructor:THREE.MaterialLoader,load:function(e,t,n,r){var i=this;n=new THREE.XHRLoader,n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=new THREE[e.type];void 0!==e.color&&t.color.setHex(e.color),void 0!==e.ambient&&t.ambient.setHex(e.ambient),void 0!==e.emissive&&t.emissive.setHex(e.emissive),void 0!==e.specular&&t.specular.setHex(e.specular),void 0!==e.shininess&&(t.shininess=e.shininess),void 0!==e.vertexColors&&(t.vertexColors=e.vertexColors),void 0!==e.blending&&(t.blending=e.blending),void 0!==e.side&&(t.side=e.side),void 0!==e.opacity&&(t.opacity=e.opacity),void 0!==e.transparent&&(t.transparent=e.transparent),void 0!==e.wireframe&&(t.wireframe=e.wireframe);if(void 0!==e.materials)for(var n=0,r=e.materials.length;n<r;n++)t.materials.push(this.parse(e.materials[n]));return t}},THREE.ObjectLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.ObjectLoader.prototype={constructor:THREE.ObjectLoader,load:function(e,t,n,r){var i=this;n=new THREE.XHRLoader(i.manager),n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){t(i.parse(JSON.parse(e)))})},setCrossOrigin:function(e){this.crossOrigin=e},parse:function(e){var t=this.parseGeometries(e.geometries),n=this.parseMaterials(e.materials);return this.parseObject(e.object,t,n)},parseGeometries:function(e){var t={};if(void 0!==e)for(var n=new THREE.JSONLoader,r=new THREE.Geometry2Loader,i=new THREE.BufferGeometryLoader,s=0,o=e.length;s<o;s++){var u,a=e[s];switch(a.type){case"PlaneGeometry":u=new THREE.PlaneGeometry(a.width,a.height,a.widthSegments,a.heightSegments);break;case"BoxGeometry":case"CubeGeometry":u=new THREE.BoxGeometry(a.width,a.height,a.depth,a.widthSegments,a.heightSegments,a.depthSegments);break;case"CircleGeometry":u=new THREE.CircleGeometry(a.radius,a.segments);break;case"CylinderGeometry":u=new THREE.CylinderGeometry(a.radiusTop,a.radiusBottom,a.height,a.radialSegments,a.heightSegments,a.openEnded);break;case"SphereGeometry":u=new THREE.SphereGeometry(a.radius,a.widthSegments,a.heightSegments,a.phiStart,a.phiLength,a.thetaStart,a.thetaLength);break;case"IcosahedronGeometry":u=new THREE.IcosahedronGeometry(a.radius,a.detail);break;case"TorusGeometry":u=new THREE.TorusGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.arc);break;case"TorusKnotGeometry":u=new THREE.TorusKnotGeometry(a.radius,a.tube,a.radialSegments,a.tubularSegments,a.p,a.q,a.heightScale);break;case"BufferGeometry":u=i.parse(a.data);break;case"Geometry2":u=r.parse(a.data);break;case"Geometry":u=n.parse(a.data).geometry}u.uuid=a.uuid,void 0!==a.name&&(u.name=a.name),t[a.uuid]=u}return t},parseMaterials:function(e){var t={};if(void 0!==e)for(var n=new THREE.MaterialLoader,r=0,i=e.length;r<i;r++){var s=e[r],o=n.parse(s);o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),t[s.uuid]=o}return t},parseObject:function(){var e=new THREE.Matrix4;return function(t,n,r){var i;switch(t.type){case"Scene":i=new THREE.Scene;break;case"PerspectiveCamera":i=new THREE.PerspectiveCamera(t.fov,t.aspect,t.near,t.far);break;case"OrthographicCamera":i=new THREE.OrthographicCamera(t.left,t.right,t.top,t.bottom,t.near,t.far);break;case"AmbientLight":i=new THREE.AmbientLight(t.color);break;case"DirectionalLight":i=new THREE.DirectionalLight(t.color,t.intensity);break;case"PointLight":i=new THREE.PointLight(t.color,t.intensity,t.distance);break;case"SpotLight":i=new THREE.SpotLight(t.color,t.intensity,t.distance,t.angle,t.exponent);break;case"HemisphereLight":i=new THREE.HemisphereLight(t.color,t.groundColor,t.intensity);break;case"Mesh":i=n[t.geometry];var s=r[t.material];void 0===i&&console.error("THREE.ObjectLoader: Undefined geometry "+t.geometry),void 0===s&&console.error("THREE.ObjectLoader: Undefined material "+t.material),i=new THREE.Mesh(i,s);break;case"Sprite":s=r[t.material],void 0===s&&console.error("THREE.ObjectLoader: Undefined material "+t.material),i=new THREE.Sprite(s);break;default:i=new THREE.Object3D}i.uuid=t.uuid,void 0!==t.name&&(i.name=t.name),void 0!==t.matrix?(e.fromArray(t.matrix),e.decompose(i.position,i.quaternion,i.scale)):(void 0!==t.position&&i.position.fromArray(t.position),void 0!==t.rotation&&i.rotation.fromArray(t.rotation),void 0!==t.scale&&i.scale.fromArray(t.scale)),void 0!==t.visible&&(i.visible=t.visible),void 0!==t.userData&&(i.userData=t.userData);if(void 0!==t.children)for(var o in t.children)i.add(this.parseObject(t.children[o],n,r));return i}}()},THREE.SceneLoader=function(){this.onLoadStart=function(){},this.onLoadProgress=function(){},this.onLoadComplete=function(){},this.callbackSync=function(){},this.callbackProgress=function(){},this.geometryHandlers={},this.hierarchyHandlers={},this.addGeometryHandler("ascii",THREE.JSONLoader)},THREE.SceneLoader.prototype={constructor:THREE.SceneLoader,load:function(e,t,n,r){var i=this;n=new THREE.XHRLoader(i.manager),n.setCrossOrigin(this.crossOrigin),n.load(e,function(n){i.parse(JSON.parse(n),t,e)})},setCrossOrigin:function(e){this.crossOrigin=e},addGeometryHandler:function(e,t){this.geometryHandlers[e]={loaderClass:t}},addHierarchyHandler:function(e,t){this.hierarchyHandlers[e]={loaderClass:t}},parse:function(e,t,n){function r(e,t){return"relativeToHTML"==t?e:p+e}function i(){s(T.scene,C.objects)}function s(e,t){var n,i,o,u,f,l;for(l in t){var c=T.objects[l],p=t[l];if(void 0===c){if(p.type&&p.type in h.hierarchyHandlers){if(void 0===p.loading){n={type:1,url:1,material:1,position:1,rotation:1,scale:1,visible:1,children:1,userData:1,skin:1,morph:1,mirroredLoop:1,duration:1};var g={},y;for(y in p)y in n||(g[y]=p[y]);v=T.materials[p.material],p.loading=!0,n=h.hierarchyHandlers[p.type].loaderObject,n.options?n.load(r(p.url,C.urlBaseType),a(l,e,v,p)):n.load(r(p.url,C.urlBaseType),a(l,e,v,p),g)}}else if(void 0!==p.geometry){if(d=T.geometries[p.geometry]){c=!1,v=T.materials[p.material],c=v instanceof THREE.ShaderMaterial,i=p.position,o=p.rotation,u=p.scale,n=p.matrix,f=p.quaternion,p.material||(v=new THREE.MeshFaceMaterial(T.face_materials[p.geometry])),v instanceof THREE.MeshFaceMaterial&&0===v.materials.length&&(v=new THREE.MeshFaceMaterial(T.face_materials[p.geometry]));if(v instanceof THREE.MeshFaceMaterial)for(g=0;g<v.materials.length;g++)c=c||v.materials[g]instanceof THREE.ShaderMaterial;c&&d.computeTangents(),p.skin?c=new THREE.SkinnedMesh(d,v):p.morph?(c=new THREE.MorphAnimMesh(d,v),void 0!==p.duration&&(c.duration=p.duration),void 0!==p.time&&(c.time=p.time),void 0!==p.mirroredLoop&&(c.mirroredLoop=p.mirroredLoop),v.morphNormals&&d.computeMorphNormals()):c=new THREE.Mesh(d,v),c.name=l,n?(c.matrixAutoUpdate=!1,c.matrix.set(n[0],n[1],n[2],n[3],n[4],n[5],n[6],n[7],n[8],n[9],n[10],n[11],n[12],n[13],n[14],n[15])):(c.position.fromArray(i),f?c.quaternion.fromArray(f):c.rotation.fromArray(o),c.scale.fromArray(u)),c.visible=p.visible,c.castShadow=p.castShadow,c.receiveShadow=p.receiveShadow,e.add(c),T.objects[l]=c}}else if("AmbientLight"===p.type||"PointLight"===p.type||"DirectionalLight"===p.type||"SpotLight"===p.type||"HemisphereLight"===p.type||"AreaLight"===p.type){g=p.color,n=p.intensity,i=p.distance,o=p.position,u=p.rotation;switch(p.type){case"AmbientLight":b=new THREE.AmbientLight(g);break;case"PointLight":b=new THREE.PointLight(g,n,i),b.position.fromArray(o);break;case"DirectionalLight":b=new THREE.DirectionalLight(g,n),b.position.fromArray(p.direction);break;case"SpotLight":b=new THREE.SpotLight(g,n,i,1),b.angle=p.angle,b.position.fromArray(o),b.target.set(o[0],o[1]-i,o[2]),b.target.applyEuler(new THREE.Euler(u[0],u[1],u[2],"XYZ"));break;case"HemisphereLight":b=new THREE.DirectionalLight(g,n,i),b.target.set(o[0],o[1]-i,o[2]),b.target.applyEuler(new THREE.Euler(u[0],u[1],u[2],"XYZ"));break;case"AreaLight":b=new THREE.AreaLight(g,n),b.position.fromArray(o),b.width=p.size,b.height=p.size_y}e.add(b),b.name=l,T.lights[l]=b,T.objects[l]=b}else"PerspectiveCamera"===p.type||"OrthographicCamera"===p.type?(i=p.position,o=p.rotation,f=p.quaternion,"PerspectiveCamera"===p.type?m=new THREE.PerspectiveCamera(p.fov,p.aspect,p.near,p.far):"OrthographicCamera"===p.type&&(m=new THREE.OrthographicCamera(p.left,p.right,p.top,p.bottom,p.near,p.far)),m.name=l,m.position.fromArray(i),void 0!==f?m.quaternion.fromArray(f):void 0!==o&&m.rotation.fromArray(o),e.add(m),T.cameras[l]=m,T.objects[l]=m):(i=p.position,o=p.rotation,u=p.scale,f=p.quaternion,c=new THREE.Object3D,c.name=l,c.position.fromArray(i),f?c.quaternion.fromArray(f):c.rotation.fromArray(o),c.scale.fromArray(u),c.visible=void 0!==p.visible?p.visible:!1,e.add(c),T.objects[l]=c,T.empties[l]=c);if(c){if(void 0!==p.userData)for(var w in p.userData)c.userData[w]=p.userData[w];if(void 0!==p.groups)for(g=0;g<p.groups.length;g++)n=p.groups[g],void 0===T.groups[n]&&(T.groups[n]=[]),T.groups[n].push(l)}}void 0!==c&&void 0!==p.children&&s(c,p.children)}}function o(e,t,n,r,s){var o=s.rotation,u=s.quaternion,a=s.scale;e.position.fromArray(s.position),u?e.quaternion.fromArray(u):e.rotation.fromArray(o),e.scale.fromArray(a),r&&e.traverse(function(e){e.material=r});var f=void 0!==s.visible?s.visible:!0;e.traverse(function(e){e.visible=f}),n.add(e),e.name=t,T.objects[t]=e,i()}function u(e){return function(t,n){t.name=e,T.geometries[e]=t,T.face_materials[e]=n,i(),w-=1,h.onLoadComplete(),l()}}function a(e,t,n,r){return function(i){o(i.content?i.content:i.dae?i.scene:i,e,t,n,r),w-=1,h.onLoadComplete(),l()}}function f(e){return function(t,n){t.name=e,T.geometries[e]=t,T.face_materials[e]=n}}function l(){h.callbackProgress({totalModels:S,totalTextures:x,loadedModels:S-w,loadedTextures:x-E},T),h.onLoadProgress();if(0===w&&0===E){for(var e=0;e<N.length;e++){var n=N[e],r=T.objects[n.targetName];r?n.object.target=r:(n.object.target=new THREE.Object3D,T.scene.add(n.object.target)),n.object.target.userData.targetInverse=n.object}t(T)}}function c(e,t){t(e);if(void 0!==e.children)for(var n in e.children)c(e.children[n],t)}var h=this,p=THREE.Loader.prototype.extractUrlBase(n),d,v,m,g,y,b,w,E,S,x,T,N=[],C=e,k;for(k in this.geometryHandlers)e=this.geometryHandlers[k].loaderClass,this.geometryHandlers[k].loaderObject=new e;for(k in this.hierarchyHandlers)e=this.hierarchyHandlers[k].loaderClass,this.hierarchyHandlers[k].loaderObject=new e;E=w=0,T={scene:new THREE.Scene,geometries:{},face_materials:{},materials:{},textures:{},objects:{},cameras:{},lights:{},fogs:{},empties:{},groups:{}},C.transform&&(k=C.transform.position,e=C.transform.rotation,n=C.transform.scale,k&&T.scene.position.fromArray(k),e&&T.scene.rotation.fromArray(e),n&&T.scene.scale.fromArray(n),k||e||n)&&(T.scene.updateMatrix(),T.scene.updateMatrixWorld()),k=function(e){return function(){E-=e,l(),h.onLoadComplete()}};for(var L in C.fogs)e=C.fogs[L],"linear"===e.type?g=new THREE.Fog(0,e.near,e.far):"exp2"===e.type&&(g=new THREE.FogExp2(0,e.density)),e=e.color,g.color.setRGB(e[0],e[1],e[2]),T.fogs[L]=g;for(var A in C.geometries)g=C.geometries[A],g.type in this.geometryHandlers&&(w+=1,h.onLoadStart());for(var O in C.objects)c(C.objects[O],function(e){e.type&&e.type in h.hierarchyHandlers&&(w+=1,h.onLoadStart())});S=w;for(A in C.geometries)if(g=C.geometries[A],"cube"===g.type)d=new THREE.BoxGeometry(g.width,g.height,g.depth,g.widthSegments,g.heightSegments,g.depthSegments),d.name=A,T.geometries[A]=d;else if("plane"===g.type)d=new THREE.PlaneGeometry(g.width,g.height,g.widthSegments,g.heightSegments),d.name=A,T.geometries[A]=d;else if("sphere"===g.type)d=new THREE.SphereGeometry(g.radius,g.widthSegments,g.heightSegments),d.name=A,T.geometries[A]=d;else if("cylinder"===g.type)d=new THREE.CylinderGeometry(g.topRad,g.botRad,g.height,g.radSegs,g.heightSegs),d.name=A,T.geometries[A]=d;else if("torus"===g.type)d=new THREE.TorusGeometry(g.radius,g.tube,g.segmentsR,g.segmentsT),d.name=A,T.geometries[A]=d;else if("icosahedron"===g.type)d=new THREE.IcosahedronGeometry(g.radius,g.subdivisions),d.name=A,T.geometries[A]=d;else if(g.type in this.geometryHandlers){O={};for(y in g)"type"!==y&&"url"!==y&&(O[y]=g[y]);this.geometryHandlers[g.type].loaderObject.load(r(g.url,C.urlBaseType),u(A),O)}else"embedded"===g.type&&(O=C.embeds[g.id],O.metadata=C.metadata,O&&(O=this.geometryHandlers.ascii.loaderObject.parse(O,""),f(A)(O.geometry,O.materials)));for(var M in C.textures)if(A=C.textures[M],A.url instanceof Array)for(E+=A.url.length,y=0;y<A.url.length;y++)h.onLoadStart();else E+=1,h.onLoadStart();x=E;for(M in C.textures){A=C.textures[M],void 0!==A.mapping&&void 0!==THREE[A.mapping]&&(A.mapping=new THREE[A.mapping]);if(A.url instanceof Array){O=A.url.length,g=[];for(y=0;y<O;y++)g[y]=r(A.url[y],C.urlBaseType);y=(y=/\.dds$/i.test(g[0]))?THREE.ImageUtils.loadCompressedTextureCube(g,A.mapping,k(O)):THREE.ImageUtils.loadTextureCube(g,A.mapping,k(O))}else y=/\.dds$/i.test(A.url),O=r(A.url,C.urlBaseType),g=k(1),y=y?THREE.ImageUtils.loadCompressedTexture(O,A.mapping,g):THREE.ImageUtils.loadTexture(O,A.mapping,g),void 0!==THREE[A.minFilter]&&(y.minFilter=THREE[A.minFilter]),void 0!==THREE[A.magFilter]&&(y.magFilter=THREE[A.magFilter]),A.anisotropy&&(y.anisotropy=A.anisotropy),A.repeat&&(y.repeat.set(A.repeat[0],A.repeat[1]),1!==A.repeat[0]&&(y.wrapS=THREE.RepeatWrapping),1!==A.repeat[1]&&(y.wrapT=THREE.RepeatWrapping)),A.offset&&y.offset.set(A.offset[0],A.offset[1]),A.wrap&&(O={repeat:THREE.RepeatWrapping,mirror:THREE.MirroredRepeatWrapping},void 0!==O[A.wrap[0]]&&(y.wrapS=O[A.wrap[0]]),void 0!==O[A.wrap[1]]&&(y.wrapT=O[A.wrap[1]]));T.textures[M]=y}var _,D;for(_ in C.materials){M=C.materials[_];for(D in M.parameters)"envMap"===D||"map"===D||"lightMap"===D||"bumpMap"===D?M.parameters[D]=T.textures[M.parameters[D]]:"shading"===D?M.parameters[D]="flat"===M.parameters[D]?THREE.FlatShading:THREE.SmoothShading:"side"===D?M.parameters[D]="double"==M.parameters[D]?THREE.DoubleSide:"back"==M.parameters[D]?THREE.BackSide:THREE.FrontSide:"blending"===D?M.parameters[D]=M.parameters[D]in THREE?THREE[M.parameters[D]]:THREE.NormalBlending:"combine"===D?M.parameters[D]=M.parameters[D]in THREE?THREE[M.parameters[D]]:THREE.MultiplyOperation:"vertexColors"===D?"face"==M.parameters[D]?M.parameters[D]=THREE.FaceColors:M.parameters[D]&&(M.parameters[D]=THREE.VertexColors):"wrapRGB"===D&&(k=M.parameters[D],M.parameters[D]=new THREE.Vector3(k[0],k[1],k[2]));void 0!==M.parameters.opacity&&1>M.parameters.opacity&&(M.parameters.transparent=!0),M.parameters.normalMap?(k=THREE.ShaderLib.normalmap,A=THREE.UniformsUtils.clone(k.uniforms),y=M.parameters.color,O=M.parameters.specular,g=M.parameters.ambient,L=M.parameters.shininess,A.tNormal.value=T.textures[M.parameters.normalMap],M.parameters.normalScale&&A.uNormalScale.value.set(M.parameters.normalScale[0],M.parameters.normalScale[1]),M.parameters.map&&(A.tDiffuse.value=M.parameters.map,A.enableDiffuse.value=!0),M.parameters.envMap&&(A.tCube.value=M.parameters.envMap,A.enableReflection.value=!0,A.reflectivity.value=M.parameters.reflectivity),M.parameters.lightMap&&(A.tAO.value=M.parameters.lightMap,A.enableAO.value=!0),M.parameters.specularMap&&(A.tSpecular.value=T.textures[M.parameters.specularMap],A.enableSpecular.value=!0),M.parameters.displacementMap&&(A.tDisplacement.value=T.textures[M.parameters.displacementMap],A.enableDisplacement.value=!0,A.uDisplacementBias.value=M.parameters.displacementBias,A.uDisplacementScale.value=M.parameters.displacementScale),A.diffuse.value.setHex(y),A.specular.value.setHex(O),A.ambient.value.setHex(g),A.shininess.value=L,M.parameters.opacity&&(A.opacity.value=M.parameters.opacity),v=new THREE.ShaderMaterial({fragmentShader:k.fragmentShader,vertexShader:k.vertexShader,uniforms:A,lights:!0,fog:!0})):v=new THREE[M.type](M.parameters),v.name=_,T.materials[_]=v}for(_ in C.materials)if(M=C.materials[_],M.parameters.materials){D=[];for(y=0;y<M.parameters.materials.length;y++)D.push(T.materials[M.parameters.materials[y]]);T.materials[_].materials=D}i(),T.cameras&&C.defaults.camera&&(T.currentCamera=T.cameras[C.defaults.camera]),T.fogs&&C.defaults.fog&&(T.scene.fog=T.fogs[C.defaults.fog]),h.callbackSync(T),l()}},THREE.TextureLoader=function(e){this.manager=void 0!==e?e:THREE.DefaultLoadingManager},THREE.TextureLoader.prototype={constructor:THREE.TextureLoader,load:function(e,t,n,r){n=new THREE.ImageLoader(this.manager),n.setCrossOrigin(this.crossOrigin),n.load(e,function(e){e=new THREE.Texture(e),e.needsUpdate=!0,void 0!==t&&t(e)})},setCrossOrigin:function(e){this.crossOrigin=e}},THREE.Material=function(){this.id=THREE.MaterialIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.side=THREE.FrontSide,this.opacity=1,this.transparent=!1,this.blending=THREE.NormalBlending,this.blendSrc=THREE.SrcAlphaFactor,this.blendDst=THREE.OneMinusSrcAlphaFactor,this.blendEquation=THREE.AddEquation,this.depthWrite=this.depthTest=!0,this.polygonOffset=!1,this.overdraw=this.alphaTest=this.polygonOffsetUnits=this.polygonOffsetFactor=0,this.needsUpdate=this.visible=!0},THREE.Material.prototype={constructor:THREE.Material,setValues:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0===n)console.warn("THREE.Material: '"+t+"' parameter is undefined.");else if(t in this){var r=this[t];r instanceof THREE.Color?r.set(n):r instanceof THREE.Vector3&&n instanceof THREE.Vector3?r.copy(n):this[t]="overdraw"==t?Number(n):n}}},clone:function(e){return void 0===e&&(e=new THREE.Material),e.name=this.name,e.side=this.side,e.opacity=this.opacity,e.transparent=this.transparent,e.blending=this.blending,e.blendSrc=this.blendSrc,e.blendDst=this.blendDst,e.blendEquation=this.blendEquation,e.depthTest=this.depthTest,e.depthWrite=this.depthWrite,e.polygonOffset=this.polygonOffset,e.polygonOffsetFactor=this.polygonOffsetFactor,e.polygonOffsetUnits=this.polygonOffsetUnits,e.alphaTest=this.alphaTest,e.overdraw=this.overdraw,e.visible=this.visible,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Material.prototype),THREE.MaterialIdCount=0,THREE.LineBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.linewidth=1,this.linejoin=this.linecap="round",this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineBasicMaterial.prototype.clone=function(){var e=new THREE.LineBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.linecap=this.linecap,e.linejoin=this.linejoin,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.LineDashedMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.scale=this.linewidth=1,this.dashSize=3,this.gapSize=1,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.LineDashedMaterial.prototype=Object.create(THREE.Material.prototype),THREE.LineDashedMaterial.prototype.clone=function(){var e=new THREE.LineDashedMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.linewidth=this.linewidth,e.scale=this.scale,e.dashSize=this.dashSize,e.gapSize=this.gapSize,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.MeshBasicMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshBasicMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshBasicMaterial.prototype.clone=function(){var e=new THREE.MeshBasicMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e},THREE.MeshLambertMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.wrapAround=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.envMap=this.specularMap=this.lightMap=this.map=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshLambertMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshLambertMaterial.prototype.clone=function(){var e=new THREE.MeshLambertMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshPhongMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.ambient=new THREE.Color(16777215),this.emissive=new THREE.Color(0),this.specular=new THREE.Color(1118481),this.shininess=30,this.wrapAround=this.metal=!1,this.wrapRGB=new THREE.Vector3(1,1,1),this.bumpMap=this.lightMap=this.map=null,this.bumpScale=1,this.normalMap=null,this.normalScale=new THREE.Vector2(1,1),this.envMap=this.specularMap=null,this.combine=THREE.MultiplyOperation,this.reflectivity=1,this.refractionRatio=.98,this.fog=!0,this.shading=THREE.SmoothShading,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinejoin=this.wireframeLinecap="round",this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.setValues(e)},THREE.MeshPhongMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshPhongMaterial.prototype.clone=function(){var e=new THREE.MeshPhongMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.ambient.copy(this.ambient),e.emissive.copy(this.emissive),e.specular.copy(this.specular),e.shininess=this.shininess,e.metal=this.metal,e.wrapAround=this.wrapAround,e.wrapRGB.copy(this.wrapRGB),e.map=this.map,e.lightMap=this.lightMap,e.bumpMap=this.bumpMap,e.bumpScale=this.bumpScale,e.normalMap=this.normalMap,e.normalScale.copy(this.normalScale),e.specularMap=this.specularMap,e.envMap=this.envMap,e.combine=this.combine,e.reflectivity=this.reflectivity,e.refractionRatio=this.refractionRatio,e.fog=this.fog,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.wireframeLinecap=this.wireframeLinecap,e.wireframeLinejoin=this.wireframeLinejoin,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.MeshDepthMaterial=function(e){THREE.Material.call(this),this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)},THREE.MeshDepthMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshDepthMaterial.prototype.clone=function(){var e=new THREE.MeshDepthMaterial;return THREE.Material.prototype.clone.call(this,e),e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshNormalMaterial=function(e){THREE.Material.call(this,e),this.shading=THREE.FlatShading,this.wireframe=!1,this.wireframeLinewidth=1,this.morphTargets=!1,this.setValues(e)},THREE.MeshNormalMaterial.prototype=Object.create(THREE.Material.prototype),THREE.MeshNormalMaterial.prototype.clone=function(){var e=new THREE.MeshNormalMaterial;return THREE.Material.prototype.clone.call(this,e),e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e},THREE.MeshFaceMaterial=function(e){this.materials=e instanceof Array?e:[]},THREE.MeshFaceMaterial.prototype.clone=function(){for(var e=new THREE.MeshFaceMaterial,t=0;t<this.materials.length;t++)e.materials.push(this.materials[t].clone());return e},THREE.ParticleSystemMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.size=1,this.sizeAttenuation=!0,this.vertexColors=!1,this.fog=!0,this.setValues(e)},THREE.ParticleSystemMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ParticleSystemMaterial.prototype.clone=function(){var e=new THREE.ParticleSystemMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.size=this.size,e.sizeAttenuation=this.sizeAttenuation,e.vertexColors=this.vertexColors,e.fog=this.fog,e},THREE.ParticleBasicMaterial=THREE.ParticleSystemMaterial,THREE.ShaderMaterial=function(e){THREE.Material.call(this),this.vertexShader=this.fragmentShader="void main() {}",this.uniforms={},this.defines={},this.attributes=null,this.shading=THREE.SmoothShading,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.lights=this.fog=!1,this.vertexColors=THREE.NoColors,this.morphNormals=this.morphTargets=this.skinning=!1,this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName="position",this.setValues(e)},THREE.ShaderMaterial.prototype=Object.create(THREE.Material.prototype),THREE.ShaderMaterial.prototype.clone=function(){var e=new THREE.ShaderMaterial;return THREE.Material.prototype.clone.call(this,e),e.fragmentShader=this.fragmentShader,e.vertexShader=this.vertexShader,e.uniforms=THREE.UniformsUtils.clone(this.uniforms),e.attributes=this.attributes,e.defines=this.defines,e.shading=this.shading,e.wireframe=this.wireframe,e.wireframeLinewidth=this.wireframeLinewidth,e.fog=this.fog,e.lights=this.lights,e.vertexColors=this.vertexColors,e.skinning=this.skinning,e.morphTargets=this.morphTargets,e.morphNormals=this.morphNormals,e},THREE.SpriteMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.map=null,this.rotation=0,this.fog=!1,this.setValues(e)},THREE.SpriteMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteMaterial.prototype.clone=function(){var e=new THREE.SpriteMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.map=this.map,e.rotation=this.rotation,e.fog=this.fog,e},THREE.SpriteCanvasMaterial=function(e){THREE.Material.call(this),this.color=new THREE.Color(16777215),this.program=function(e,t){},this.setValues(e)},THREE.SpriteCanvasMaterial.prototype=Object.create(THREE.Material.prototype),THREE.SpriteCanvasMaterial.prototype.clone=function(){var e=new THREE.SpriteCanvasMaterial;return THREE.Material.prototype.clone.call(this,e),e.color.copy(this.color),e.program=this.program,e},THREE.ParticleCanvasMaterial=THREE.SpriteCanvasMaterial,THREE.Texture=function(e,t,n,r,i,s,o,u,a){this.id=THREE.TextureIdCount++,this.uuid=THREE.Math.generateUUID(),this.name="",this.image=e,this.mipmaps=[],this.mapping=void 0!==t?t:new THREE.UVMapping,this.wrapS=void 0!==n?n:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==r?r:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==i?i:THREE.LinearFilter,this.minFilter=void 0!==s?s:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==a?a:1,this.format=void 0!==o?o:THREE.RGBAFormat,this.type=void 0!==u?u:THREE.UnsignedByteType,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this._needsUpdate=!1,this.onUpdate=null},THREE.Texture.prototype={constructor:THREE.Texture,get needsUpdate(){return this._needsUpdate},set needsUpdate(e){!0===e&&this.update(),this._needsUpdate=e},clone:function(e){return void 0===e&&(e=new THREE.Texture),e.image=this.image,e.mipmaps=this.mipmaps.slice(0),e.mapping=this.mapping,e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.format=this.format,e.type=this.type,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.generateMipmaps=this.generateMipmaps,e.premultiplyAlpha=this.premultiplyAlpha,e.flipY=this.flipY,e.unpackAlignment=this.unpackAlignment,e},update:function(){this.dispatchEvent({type:"update"})},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.Texture.prototype),THREE.TextureIdCount=0,THREE.CompressedTexture=function(e,t,n,r,i,s,o,u,a,f,l){THREE.Texture.call(this,null,s,o,u,a,f,r,i,l),this.image={width:t,height:n},this.mipmaps=e,this.generateMipmaps=!1},THREE.CompressedTexture.prototype=Object.create(THREE.Texture.prototype),THREE.CompressedTexture.prototype.clone=function(){var e=new THREE.CompressedTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.DataTexture=function(e,t,n,r,i,s,o,u,a,f,l){THREE.Texture.call(this,null,s,o,u,a,f,r,i,l),this.image={data:e,width:t,height:n}},THREE.DataTexture.prototype=Object.create(THREE.Texture.prototype),THREE.DataTexture.prototype.clone=function(){var e=new THREE.DataTexture;return THREE.Texture.prototype.clone.call(this,e),e},THREE.ParticleSystem=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.ParticleSystemMaterial({color:16777215*Math.random()}),this.frustumCulled=this.sortParticles=!1},THREE.ParticleSystem.prototype=Object.create(THREE.Object3D.prototype),THREE.ParticleSystem.prototype.clone=function(e){return void 0===e&&(e=new THREE.ParticleSystem(this.geometry,this.material)),e.sortParticles=this.sortParticles,THREE.Object3D.prototype.clone.call(this,e),e},THREE.Line=function(e,t,n){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.LineBasicMaterial({color:16777215*Math.random()}),this.type=void 0!==n?n:THREE.LineStrip},THREE.LineStrip=0,THREE.LinePieces=1,THREE.Line.prototype=Object.create(THREE.Object3D.prototype),THREE.Line.prototype.clone=function(e){return void 0===e&&(e=new THREE.Line(this.geometry,this.material,this.type)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Mesh=function(e,t){THREE.Object3D.call(this),this.geometry=void 0!==e?e:new THREE.Geometry,this.material=void 0!==t?t:new THREE.MeshBasicMaterial({color:16777215*Math.random()}),this.updateMorphTargets()},THREE.Mesh.prototype=Object.create(THREE.Object3D.prototype),THREE.Mesh.prototype.updateMorphTargets=function(){if(void 0!==this.geometry.morphTargets&&0<this.geometry.morphTargets.length){this.morphTargetBase=-1,this.morphTargetForcedOrder=[],this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var e=0,t=this.geometry.morphTargets.length;e<t;e++)this.morphTargetInfluences.push(0),this.morphTargetDictionary[this.geometry.morphTargets[e].name]=e}},THREE.Mesh.prototype.getMorphTargetIndexByName=function(e){return void 0!==this.morphTargetDictionary[e]?this.morphTargetDictionary[e]:(console.log("THREE.Mesh.getMorphTargetIndexByName: morph target "+e+" does not exist. Returning 0."),0)},THREE.Mesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.Mesh(this.geometry,this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Bone=function(e){THREE.Object3D.call(this),this.skin=e,this.skinMatrix=new THREE.Matrix4},THREE.Bone.prototype=Object.create(THREE.Object3D.prototype),THREE.Bone.prototype.update=function(e,t){this.matrixAutoUpdate&&(t|=this.updateMatrix());if(t||this.matrixWorldNeedsUpdate)e?this.skinMatrix.multiplyMatrices(e,this.matrix):this.skinMatrix.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,t=!0;var n,r=this.children.length;for(n=0;n<r;n++)this.children[n].update(this.skinMatrix,t)},THREE.SkinnedMesh=function(e,t,n){THREE.Mesh.call(this,e,t),this.useVertexTexture=void 0!==n?n:!0,this.identityMatrix=new THREE.Matrix4,this.bones=[],this.boneMatrices=[];var r,i,s;if(this.geometry&&void 0!==this.geometry.bones){for(e=0;e<this.geometry.bones.length;e++)n=this.geometry.bones[e],r=n.pos,i=n.rotq,s=n.scl,t=this.addBone(),t.name=n.name,t.position.set(r[0],r[1],r[2]),t.quaternion.set(i[0],i[1],i[2],i[3]),void 0!==s?t.scale.set(s[0],s[1],s[2]):t.scale.set(1,1,1);for(e=0;e<this.bones.length;e++)n=this.geometry.bones[e],t=this.bones[e],-1===n.parent?this.add(t):this.bones[n.parent].add(t);e=this.bones.length,this.useVertexTexture?(this.boneTextureHeight=this.boneTextureWidth=e=256<e?64:64<e?32:16<e?16:8,this.boneMatrices=new Float32Array(this.boneTextureWidth*this.boneTextureHeight*4),this.boneTexture=new THREE.DataTexture(this.boneMatrices,this.boneTextureWidth,this.boneTextureHeight,THREE.RGBAFormat,THREE.FloatType),this.boneTexture.minFilter=THREE.NearestFilter,this.boneTexture.magFilter=THREE.NearestFilter,this.boneTexture.generateMipmaps=!1,this.boneTexture.flipY=!1):this.boneMatrices=new Float32Array(16*e),this.pose()}},THREE.SkinnedMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.SkinnedMesh.prototype.addBone=function(e){return void 0===e&&(e=new THREE.Bone(this)),this.bones.push(e),e},THREE.SkinnedMesh.prototype.updateMatrixWorld=function(){var e=new THREE.Matrix4;return function(t){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||t)this.parent?this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1;t=0;for(var n=this.children.length;t<n;t++){var r=this.children[t];r instanceof THREE.Bone?r.update(this.identityMatrix,!1):r.updateMatrixWorld(!0)}if(void 0==this.boneInverses)for(this.boneInverses=[],t=0,n=this.bones.length;t<n;t++)r=new THREE.Matrix4,r.getInverse(this.bones[t].skinMatrix),this.boneInverses.push(r);t=0;for(n=this.bones.length;t<n;t++)e.multiplyMatrices(this.bones[t].skinMatrix,this.boneInverses[t]),e.flattenToArrayOffset(this.boneMatrices,16*t);this.useVertexTexture&&(this.boneTexture.needsUpdate=!0)}}(),THREE.SkinnedMesh.prototype.pose=function(){this.updateMatrixWorld(!0),this.normalizeSkinWeights()},THREE.SkinnedMesh.prototype.normalizeSkinWeights=function(){if(this.geometry instanceof THREE.Geometry)for(var e=0;e<this.geometry.skinIndices.length;e++){var t=this.geometry.skinWeights[e],n=1/t.lengthManhattan();Infinity!==n?t.multiplyScalar(n):t.set(1)}},THREE.SkinnedMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.SkinnedMesh(this.geometry,this.material,this.useVertexTexture)),THREE.Mesh.prototype.clone.call(this,e),e},THREE.MorphAnimMesh=function(e,t){THREE.Mesh.call(this,e,t),this.duration=1e3,this.mirroredLoop=!1,this.currentKeyframe=this.lastKeyframe=this.time=0,this.direction=1,this.directionBackwards=!1,this.setFrameRange(0,this.geometry.morphTargets.length-1)},THREE.MorphAnimMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphAnimMesh.prototype.setFrameRange=function(e,t){this.startKeyframe=e,this.endKeyframe=t,this.length=this.endKeyframe-this.startKeyframe+1},THREE.MorphAnimMesh.prototype.setDirectionForward=function(){this.direction=1,this.directionBackwards=!1},THREE.MorphAnimMesh.prototype.setDirectionBackward=function(){this.direction=-1,this.directionBackwards=!0},THREE.MorphAnimMesh.prototype.parseAnimations=function(){var e=this.geometry;e.animations||(e.animations={});for(var t,n=e.animations,r=/([a-z]+)(\d+)/,i=0,s=e.morphTargets.length;i<s;i++){var o=e.morphTargets[i].name.match(r);if(o&&1<o.length){o=o[1],n[o]||(n[o]={start:Infinity,end:-Infinity});var u=n[o];i<u.start&&(u.start=i),i>u.end&&(u.end=i),t||(t=o)}}e.firstAnimation=t},THREE.MorphAnimMesh.prototype.setAnimationLabel=function(e,t,n){this.geometry.animations||(this.geometry.animations={}),this.geometry.animations[e]={start:t,end:n}},THREE.MorphAnimMesh.prototype.playAnimation=function(e,t){var n=this.geometry.animations[e];n?(this.setFrameRange(n.start,n.end),this.duration=(n.end-n.start)/t*1e3,this.time=0):console.warn("animation["+e+"] undefined")},THREE.MorphAnimMesh.prototype.updateAnimation=function(e){var t=this.duration/this.length;this.time+=this.direction*e;if(this.mirroredLoop){if(this.time>this.duration||0>this.time)this.direction*=-1,this.time>this.duration&&(this.time=this.duration,this.directionBackwards=!0),0>this.time&&(this.time=0,this.directionBackwards=!1)}else this.time%=this.duration,0>this.time&&(this.time+=this.duration);e=this.startKeyframe+THREE.Math.clamp(Math.floor(this.time/t),0,this.length-1),e!==this.currentKeyframe&&(this.morphTargetInfluences[this.lastKeyframe]=0,this.morphTargetInfluences[this.currentKeyframe]=1,this.morphTargetInfluences[e]=0,this.lastKeyframe=this.currentKeyframe,this.currentKeyframe=e),t=this.time%t/t,this.directionBackwards&&(t=1-t),this.morphTargetInfluences[this.currentKeyframe]=t,this.morphTargetInfluences[this.lastKeyframe]=1-t},THREE.MorphAnimMesh.prototype.clone=function(e){return void 0===e&&(e=new THREE.MorphAnimMesh(this.geometry,this.material)),e.duration=this.duration,e.mirroredLoop=this.mirroredLoop,e.time=this.time,e.lastKeyframe=this.lastKeyframe,e.currentKeyframe=this.currentKeyframe,e.direction=this.direction,e.directionBackwards=this.directionBackwards,THREE.Mesh.prototype.clone.call(this,e),e},THREE.LOD=function(){THREE.Object3D.call(this),this.objects=[]},THREE.LOD.prototype=Object.create(THREE.Object3D.prototype),THREE.LOD.prototype.addLevel=function(e,t){void 0===t&&(t=0),t=Math.abs(t);for(var n=0;n<this.objects.length&&!(t<this.objects[n].distance);n++);this.objects.splice(n,0,{distance:t,object:e}),this.add(e)},THREE.LOD.prototype.getObjectForDistance=function(e){for(var t=1,n=this.objects.length;t<n&&!(e<this.objects[t].distance);t++);return this.objects[t-1].object},THREE.LOD.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n){if(1<this.objects.length){e.setFromMatrixPosition(n.matrixWorld),t.setFromMatrixPosition(this.matrixWorld),n=e.distanceTo(t),this.objects[0].object.visible=!0;for(var r=1,i=this.objects.length;r<i;r++){if(!(n>=this.objects[r].distance))break;this.objects[r-1].object.visible=!1,this.objects[r].object.visible=!0}for(;r<i;r++)this.objects[r].object.visible=!1}}}(),THREE.LOD.prototype.clone=function(e){void 0===e&&(e=new THREE.LOD),THREE.Object3D.prototype.clone.call(this,e);for(var t=0,n=this.objects.length;t<n;t++){var r=this.objects[t].object.clone();r.visible=0===t,e.addLevel(r,this.objects[t].distance)}return e},THREE.Sprite=function(){var e=new THREE.Geometry2(3);return e.vertices.set([-0.5,-0.5,0,.5,-0.5,0,.5,.5,0]),function(t){THREE.Object3D.call(this),this.geometry=e,this.material=void 0!==t?t:new THREE.SpriteMaterial}}(),THREE.Sprite.prototype=Object.create(THREE.Object3D.prototype),THREE.Sprite.prototype.updateMatrix=function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},THREE.Sprite.prototype.clone=function(e){return void 0===e&&(e=new THREE.Sprite(this.material)),THREE.Object3D.prototype.clone.call(this,e),e},THREE.Particle=THREE.Sprite,THREE.Scene=function(){THREE.Object3D.call(this),this.overrideMaterial=this.fog=null,this.autoUpdate=!0,this.matrixAutoUpdate=!1,this.__lights=[],this.__objectsAdded=[],this.__objectsRemoved=[]},THREE.Scene.prototype=Object.create(THREE.Object3D.prototype),THREE.Scene.prototype.__addObject=function(e){if(e instanceof THREE.Light)-1===this.__lights.indexOf(e)&&this.__lights.push(e),e.target&&void 0===e.target.parent&&this.add(e.target);else if(!(e instanceof THREE.Camera||e instanceof THREE.Bone)){this.__objectsAdded.push(e);var t=this.__objectsRemoved.indexOf(e);-1!==t&&this.__objectsRemoved.splice(t,1)}this.dispatchEvent({type:"objectAdded",object:e}),e.dispatchEvent({type:"addedToScene",scene:this});for(t=0;t<e.children.length;t++)this.__addObject(e.children[t])},THREE.Scene.prototype.__removeObject=function(e){if(e instanceof THREE.Light){var t=this.__lights.indexOf(e);-1!==t&&this.__lights.splice(t,1);if(e.shadowCascadeArray)for(t=0;t<e.shadowCascadeArray.length;t++)this.__removeObject(e.shadowCascadeArray[t])}else e instanceof THREE.Camera||(this.__objectsRemoved.push(e),t=this.__objectsAdded.indexOf(e),-1!==t&&this.__objectsAdded.splice(t,1));this.dispatchEvent({type:"objectRemoved",object:e}),e.dispatchEvent({type:"removedFromScene",scene:this});for(t=0;t<e.children.length;t++)this.__removeObject(e.children[t])},THREE.Scene.prototype.clone=function(e){return void 0===e&&(e=new THREE.Scene),THREE.Object3D.prototype.clone.call(this,e),null!==this.fog&&(e.fog=this.fog.clone()),null!==this.overrideMaterial&&(e.overrideMaterial=this.overrideMaterial.clone()),e.autoUpdate=this.autoUpdate,e.matrixAutoUpdate=this.matrixAutoUpdate,e},THREE.Fog=function(e,t,n){this.name="",this.color=new THREE.Color(e),this.near=void 0!==t?t:1,this.far=void 0!==n?n:1e3},THREE.Fog.prototype.clone=function(){return new THREE.Fog(this.color.getHex(),this.near,this.far)},THREE.FogExp2=function(e,t){this.name="",this.color=new THREE.Color(e),this.density=void 0!==t?t:25e-5},THREE.FogExp2.prototype.clone=function(){return new THREE.FogExp2(this.color.getHex(),this.density)},THREE.CanvasRenderer=function(e){function t(e,t,n){for(var r=0,i=S.length;r<i;r++){var s=S[r];it.copy(s.color);if(s instanceof THREE.DirectionalLight){var o=St.setFromMatrixPosition(s.matrixWorld).normalize(),u=t.dot(o);0>=u||(u*=s.intensity,n.add(it.multiplyScalar(u)))}else s instanceof THREE.PointLight&&(o=St.setFromMatrixPosition(s.matrixWorld),u=t.dot(St.subVectors(o,e).normalize()),0>=u||(u*=0==s.distance?1:1-Math.min(e.distanceTo(o)/s.distance,1),0!=u&&(u*=s.intensity,n.add(it.multiplyScalar(u)))))}}function n(e,t,n,r){h(t),p(n),d(r),v(e.getStyle()),A.stroke(),yt.expandByScalar(2*t)}function r(e){m(e.getStyle()),A.fill()}function i(e){s(e.target)}function s(e){var t=e.wrapS===THREE.RepeatWrapping,n=e.wrapT===THREE.RepeatWrapping,r=e.image,i=document.createElement("canvas");i.width=r.width,i.height=r.height;var s=i.getContext("2d");s.setTransform(1,0,0,-1,0,r.height),s.drawImage(r,0,0),st[e.id]=A.createPattern(i,!0===t&&!0===n?"repeat":!0===t&&!1===n?"repeat-x":!1===t&&!0===n?"repeat-y":"no-repeat")}function o(e,t,n,r,o,u,a,f,l,c,h,p,d){if(!(d instanceof THREE.DataTexture)){!1===d.hasEventListener("update",i)&&(void 0!==d.image&&0<d.image.width&&s(d),d.addEventListener("update",i));var v=st[d.id];if(void 0!==v){m(v);var v=d.offset.x/d.repeat.x,g=d.offset.y/d.repeat.y,y=d.image.width*d.repeat.x;d=d.image.height*d.repeat.y,a=(a+v)*y,f=(f+g)*d,n-=e,r-=t,o-=e,u-=t,l=(l+v)*y-a,c=(c+g)*d-f,h=(h+v)*y-a,p=(p+g)*d-f,d=l*p-h*c,0!==d&&(v=1/d,d=(p*n-c*o)*v,c=(p*r-c*u)*v,n=(l*o-h*n)*v,r=(l*u-h*r)*v,e=e-d*a-n*f,t=t-c*a-r*f,A.save(),A.transform(d,c,n,r,e,t),A.fill(),A.restore())}else m("rgba(0,0,0,1)"),A.fill()}}function u(e,t,n,r,i,s,o,u,a,f,l,c,h){var p,d;p=h.width-1,d=h.height-1,o*=p,u*=d,n-=e,r-=t,i-=e,s-=t,a=a*p-o,f=f*d-u,l=l*p-o,c=c*d-u,d=1/(a*c-l*f),p=(c*n-f*i)*d,f=(c*r-f*s)*d,n=(a*i-l*n)*d,r=(a*s-l*r)*d,e=e-p*o-n*u,t=t-f*o-r*u,A.save(),A.transform(p,f,n,r,e,t),A.clip(),A.drawImage(h,0,0),A.restore()}function a(e,t,n,r){return Lt[0]=255*e.r|0,Lt[1]=255*e.g|0,Lt[2]=255*e.b|0,Lt[4]=255*t.r|0,Lt[5]=255*t.g|0,Lt[6]=255*t.b|0,Lt[8]=255*n.r|0,Lt[9]=255*n.g|0,Lt[10]=255*n.b|0,Lt[12]=255*r.r|0,Lt[13]=255*r.g|0,Lt[14]=255*r.b|0,Ct.putImageData(kt,0,0),Ot.drawImage(Nt,0,0),At}function f(e,t,n){var r=t.x-e.x,i=t.y-e.y,s=r*r+i*i;0!==s&&(n/=Math.sqrt(s),r*=n,i*=n,t.x+=r,t.y+=i,e.x-=r,e.y-=i)}function l(e){_!==e&&(_=A.globalAlpha=e)}function c(e){D!==e&&(e===THREE.NormalBlending?A.globalCompositeOperation="source-over":e===THREE.AdditiveBlending?A.globalCompositeOperation="lighter":e===THREE.SubtractiveBlending&&(A.globalCompositeOperation="darker"),D=e)}function h(e){B!==e&&(B=A.lineWidth=e)}function p(e){j!==e&&(j=A.lineCap=e)}function d(e){F!==e&&(F=A.lineJoin=e)}function v(e){P!==e&&(P=A.strokeStyle=e)}function m(e){H!==e&&(H=A.fillStyle=e)}function g(e,t){if(I!==e||q!==t)A.setLineDash([e,t]),I=e,q=t}console.log("THREE.CanvasRenderer",THREE.REVISION);var y=THREE.Math.smoothstep;e=e||{};var b=this,w,E,S,x=new THREE.Projector,T=void 0!==e.canvas?e.canvas:document.createElement("canvas"),N=T.width,C=T.height,k=Math.floor(N/2),L=Math.floor(C/2),A=T.getContext("2d"),O=new THREE.Color(0),M=0,_=1,D=0,P=null,H=null,B=null,j=null,F=null,I=null,q=0,R,U,z,W;new THREE.RenderableVertex,new THREE.RenderableVertex;var X,V,$,J,K,Q,G=new THREE.Color,Y=new THREE.Color,Z=new THREE.Color,et=new THREE.Color,tt=new THREE.Color,nt=new THREE.Color,rt=new THREE.Color,it=new THREE.Color,st={},ot,ut,at,ft,lt,ct,ht,pt,dt,vt,mt=new THREE.Box2,gt=new THREE.Box2,yt=new THREE.Box2,bt=new THREE.Color,wt=new THREE.Color,Et=new THREE.Color,St=new THREE.Vector3,xt=new THREE.Vector3,Tt=new THREE.Matrix3,Nt,Ct,kt,Lt,At,Ot,Mt=16;Nt=document.createElement("canvas"),Nt.width=Nt.height=2,Ct=Nt.getContext("2d"),Ct.fillStyle="rgba(0,0,0,1)",Ct.fillRect(0,0,2,2),kt=Ct.getImageData(0,0,2,2),Lt=kt.data,At=document.createElement("canvas"),At.width=At.height=Mt,Ot=At.getContext("2d"),Ot.translate(-Mt/2,-Mt/2),Ot.scale(Mt,Mt),Mt--,void 0===A.setLineDash&&(A.setLineDash=void 0!==A.mozDash?function(e){A.mozDash=null!==e[0]?e:null}:function(){}),this.domElement=T,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.sortElements=this.sortObjects=this.autoClear=!0,this.info={render:{vertices:0,faces:0}},this.supportsVertexTextures=function(){},this.setFaceCulling=function(){},this.setSize=function(e,t,n){N=e*this.devicePixelRatio,C=t*this.devicePixelRatio,k=Math.floor(N/2),L=Math.floor(C/2),T.width=N,T.height=C,1!==this.devicePixelRatio&&!1!==n&&(T.style.width=e+"px",T.style.height=t+"px"),mt.min.set(-k,-L),mt.max.set(k,L),gt.min.set(-k,-L),gt.max.set(k,L),_=1,D=0,F=j=B=H=P=null},this.setClearColor=function(e,t){O.set(e),M=void 0!==t?t:1,gt.min.set(-k,-L),gt.max.set(k,L)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getMaxAnisotropy=function(){return 0},this.clear=function(){A.setTransform(1,0,0,-1,k,L),!1===gt.empty()&&(gt.intersect(mt),gt.expandByScalar(2),1>M&&A.clearRect(gt.min.x|0,gt.min.y|0,gt.max.x-gt.min.x|0,gt.max.y-gt.min.y|0),0<M&&(c(THREE.NormalBlending),l(1),m("rgba("+Math.floor(255*O.r)+","+Math.floor(255*O.g)+","+Math.floor(255*O.b)+","+M+")"),A.fillRect(gt.min.x|0,gt.min.y|0,gt.max.x-gt.min.x|0,gt.max.y-gt.min.y|0)),gt.makeEmpty())},this.clearColor=function(){},this.clearDepth=function(){},this.clearStencil=function(){},this.render=function(e,T){if(0==T instanceof THREE.Camera)console.error("THREE.CanvasRenderer.render: camera is not an instance of THREE.Camera.");else{!0===this.autoClear&&this.clear(),A.setTransform(1,0,0,-1,k,L),b.info.render.vertices=0,b.info.render.faces=0,w=x.projectScene(e,T,this.sortObjects,this.sortElements),E=w.elements,S=w.lights,R=T,Tt.getNormalMatrix(T.matrixWorldInverse),bt.setRGB(0,0,0),wt.setRGB(0,0,0),Et.setRGB(0,0,0);for(var N=0,C=S.length;N<C;N++){var O=S[N],M=O.color;O instanceof THREE.AmbientLight?bt.add(M):O instanceof THREE.DirectionalLight?wt.add(M):O instanceof THREE.PointLight&&Et.add(M)}N=0;for(C=E.length;N<C;N++){var _=E[N],D=_.material;if(void 0!==D&&!1!==D.visible){yt.makeEmpty();if(_ instanceof THREE.RenderableSprite){U=_,U.x*=k,U.y*=L,O=U,M=D,l(M.opacity),c(M.blending);var P=_.scale.x*k,_=_.scale.y*L,D=.5*Math.sqrt(P*P+_*_);yt.min.set(O.x-D,O.y-D),yt.max.set(O.x+D,O.y+D);if(M instanceof THREE.SpriteMaterial||M instanceof THREE.ParticleSystemMaterial){var H=M.map;if(null!==H){!1===H.hasEventListener("update",i)&&(void 0!==H.image&&0<H.image.width&&s(H),H.addEventListener("update",i)),D=st[H.id],void 0!==D?m(D):m("rgba( 0, 0, 0, 1 )");var B=H.image,D=B.width*H.offset.x,j=B.height*H.offset.y,F=B.width*H.repeat.x,H=B.height*H.repeat.y,B=P/F,I=_/H;A.save(),A.translate(O.x,O.y),0!==M.rotation&&A.rotate(M.rotation),A.translate(-P/2,-_/2),A.scale(B,I),A.translate(-D,-j),A.fillRect(D,j,F,H)}else m(M.color.getStyle()),A.save(),A.translate(O.x,O.y),0!==M.rotation&&A.rotate(M.rotation),A.scale(P,-_),A.fillRect(-0.5,-0.5,1,1);A.restore()}else M instanceof THREE.SpriteCanvasMaterial&&(v(M.color.getStyle()),m(M.color.getStyle()),A.save(),A.translate(O.x,O.y),0!==M.rotation&&A.rotate(M.rotation),A.scale(P,_),M.program(A),A.restore())}else if(_ instanceof THREE.RenderableLine){if(U=_.v1,z=_.v2,U.positionScreen.x*=k,U.positionScreen.y*=L,z.positionScreen.x*=k,z.positionScreen.y*=L,yt.setFromPoints([U.positionScreen,z.positionScreen]),!0===mt.isIntersectionBox(yt))if(O=U,M=z,P=_,_=D,l(_.opacity),c(_.blending),A.beginPath(),A.moveTo(O.positionScreen.x,O.positionScreen.y),A.lineTo(M.positionScreen.x,M.positionScreen.y),_ instanceof THREE.LineBasicMaterial){h(_.linewidth),p(_.linecap),d(_.linejoin);if(_.vertexColors!==THREE.VertexColors)v(_.color.getStyle());else if(D=P.vertexColors[0].getStyle(),P=P.vertexColors[1].getStyle(),D===P)v(D);else{try{var q=A.createLinearGradient(O.positionScreen.x,O.positionScreen.y,M.positionScreen.x,M.positionScreen.y);q.addColorStop(0,D),q.addColorStop(1,P)}catch(it){q=D}v(q)}A.stroke(),yt.expandByScalar(2*_.linewidth)}else _ instanceof THREE.LineDashedMaterial&&(h(_.linewidth),p(_.linecap),d(_.linejoin),v(_.color.getStyle()),g(_.dashSize,_.gapSize),A.stroke(),yt.expandByScalar(2*_.linewidth),g(null,null))}else if(_ instanceof THREE.RenderableFace){U=_.v1,z=_.v2,W=_.v3;if(-1>U.positionScreen.z||1<U.positionScreen.z)continue;if(-1>z.positionScreen.z||1<z.positionScreen.z)continue;if(-1>W.positionScreen.z||1<W.positionScreen.z)continue;U.positionScreen.x*=k,U.positionScreen.y*=L,z.positionScreen.x*=k,z.positionScreen.y*=L,W.positionScreen.x*=k,W.positionScreen.y*=L,0<D.overdraw&&(f(U.positionScreen,z.positionScreen,D.overdraw),f(z.positionScreen,W.positionScreen,D.overdraw),f(W.positionScreen,U.positionScreen,D.overdraw)),yt.setFromPoints([U.positionScreen,z.positionScreen,W.positionScreen]);if(!0===mt.isIntersectionBox(yt)){O=U,M=z,P=W,b.info.render.vertices+=3,b.info.render.faces++,l(D.opacity),c(D.blending),X=O.positionScreen.x,V=O.positionScreen.y,$=M.positionScreen.x,J=M.positionScreen.y,K=P.positionScreen.x,Q=P.positionScreen.y;var j=X,F=V,H=$,B=J,I=K,St=Q;A.beginPath(),A.moveTo(j,F),A.lineTo(H,B),A.lineTo(I,St),A.closePath(),(D instanceof THREE.MeshLambertMaterial||D instanceof THREE.MeshPhongMaterial)&&null===D.map?(nt.copy(D.color),rt.copy(D.emissive),D.vertexColors===THREE.FaceColors&&nt.multiply(_.color),!1===D.wireframe&&D.shading===THREE.SmoothShading&&3===_.vertexNormalsLength?(Y.copy(bt),Z.copy(bt),et.copy(bt),t(_.v1.positionWorld,_.vertexNormalsModel[0],Y),t(_.v2.positionWorld,_.vertexNormalsModel[1],Z),t(_.v3.positionWorld,_.vertexNormalsModel[2],et),Y.multiply(nt).add(rt),Z.multiply(nt).add(rt),et.multiply(nt).add(rt),tt.addColors(Z,et).multiplyScalar(.5),at=a(Y,Z,et,tt),u(X,V,$,J,K,Q,0,0,1,0,0,1,at)):(G.copy(bt),t(_.centroidModel,_.normalModel,G),G.multiply(nt).add(rt),!0===D.wireframe?n(G,D.wireframeLinewidth,D.wireframeLinecap,D.wireframeLinejoin):r(G))):D instanceof THREE.MeshBasicMaterial||D instanceof THREE.MeshLambertMaterial||D instanceof THREE.MeshPhongMaterial?null!==D.map?D.map.mapping instanceof THREE.UVMapping&&(ft=_.uvs[0],o(X,V,$,J,K,Q,ft[0].x,ft[0].y,ft[1].x,ft[1].y,ft[2].x,ft[2].y,D.map)):null!==D.envMap?D.envMap.mapping instanceof THREE.SphericalReflectionMapping&&(xt.copy(_.vertexNormalsModel[0]).applyMatrix3(Tt),lt=.5*xt.x+.5,ct=.5*xt.y+.5,xt.copy(_.vertexNormalsModel[1]).applyMatrix3(Tt),ht=.5*xt.x+.5,pt=.5*xt.y+.5,xt.copy(_.vertexNormalsModel[2]).applyMatrix3(Tt),dt=.5*xt.x+.5,vt=.5*xt.y+.5,o(X,V,$,J,K,Q,lt,ct,ht,pt,dt,vt,D.envMap)):(G.copy(D.color),D.vertexColors===THREE.FaceColors&&G.multiply(_.color),!0===D.wireframe?n(G,D.wireframeLinewidth,D.wireframeLinecap,D.wireframeLinejoin):r(G)):D instanceof THREE.MeshDepthMaterial?(ot=R.near,ut=R.far,Y.r=Y.g=Y.b=1-y(O.positionScreen.z*O.positionScreen.w,ot,ut),Z.r=Z.g=Z.b=1-y(M.positionScreen.z*M.positionScreen.w,ot,ut),et.r=et.g=et.b=1-y(P.positionScreen.z*P.positionScreen.w,ot,ut),tt.addColors(Z,et).multiplyScalar(.5),at=a(Y,Z,et,tt),u(X,V,$,J,K,Q,0,0,1,0,0,1,at)):D instanceof THREE.MeshNormalMaterial&&(D.shading===THREE.FlatShading?(xt.copy(_.normalModel).applyMatrix3(Tt),G.setRGB(xt.x,xt.y,xt.z).multiplyScalar(.5).addScalar(.5),!0===D.wireframe?n(G,D.wireframeLinewidth,D.wireframeLinecap,D.wireframeLinejoin):r(G)):D.shading===THREE.SmoothShading&&(xt.copy(_.vertexNormalsModel[0]).applyMatrix3(Tt),Y.setRGB(xt.x,xt.y,xt.z).multiplyScalar(.5).addScalar(.5),xt.copy(_.vertexNormalsModel[1]).applyMatrix3(Tt),Z.setRGB(xt.x,xt.y,xt.z).multiplyScalar(.5).addScalar(.5),xt.copy(_.vertexNormalsModel[2]).applyMatrix3(Tt),et.setRGB(xt.x,xt.y,xt.z).multiplyScalar(.5).addScalar(.5),tt.addColors(Z,et).multiplyScalar(.5),at=a(Y,Z,et,tt),u(X,V,$,J,K,Q,0,0,1,0,0,1,at)))}}gt.union(yt)}}A.setTransform(1,0,0,1,0,0)}}},THREE.ShaderChunk={fog_pars_fragment:"#ifdef USE_FOG\nuniform vec3 fogColor;\n#ifdef FOG_EXP2\nuniform float fogDensity;\n#else\nuniform float fogNear;\nuniform float fogFar;\n#endif\n#endif",fog_fragment:"#ifdef USE_FOG\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\n#ifdef FOG_EXP2\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n#else\nfloat fogFactor = smoothstep( fogNear, fogFar, depth );\n#endif\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\nuniform float reflectivity;\nuniform samplerCube envMap;\nuniform float flipEnvMap;\nuniform int combine;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nuniform bool useRefract;\nuniform float refractionRatio;\n#else\nvarying vec3 vReflect;\n#endif\n#endif",envmap_fragment:"#ifdef USE_ENVMAP\nvec3 reflectVec;\n#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP )\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nreflectVec = refract( cameraToVertex, normal, refractionRatio );\n} else { \nreflectVec = reflect( cameraToVertex, normal );\n}\n#else\nreflectVec = vReflect;\n#endif\n#ifdef DOUBLE_SIDED\nfloat flipNormal = ( -1.0 + 2.0 * float( gl_FrontFacing ) );\nvec4 cubeColor = textureCube( envMap, flipNormal * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#else\nvec4 cubeColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n#endif\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\nif ( combine == 1 ) {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularStrength * reflectivity );\n} else if ( combine == 2 ) {\ngl_FragColor.xyz += cubeColor.xyz * specularStrength * reflectivity;\n} else {\ngl_FragColor.xyz = mix( gl_FragColor.xyz, gl_FragColor.xyz * cubeColor.xyz, specularStrength * reflectivity );\n}\n#endif",envmap_pars_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvarying vec3 vReflect;\nuniform float refractionRatio;\nuniform bool useRefract;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( PHONG ) || defined( LAMBERT ) || defined ( USE_SHADOWMAP )\n#ifdef USE_SKINNING\nvec4 worldPosition = modelMatrix * skinned;\n#endif\n#if defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( morphed, 1.0 );\n#endif\n#if ! defined( USE_MORPHTARGETS ) && ! defined( USE_SKINNING )\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\n#endif\n#endif",envmap_vertex:"#if defined( USE_ENVMAP ) && ! defined( USE_BUMPMAP ) && ! defined( USE_NORMALMAP )\nvec3 worldNormal = mat3( modelMatrix[ 0 ].xyz, modelMatrix[ 1 ].xyz, modelMatrix[ 2 ].xyz ) * objectNormal;\nworldNormal = normalize( worldNormal );\nvec3 cameraToVertex = normalize( worldPosition.xyz - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, worldNormal );\n}\n#endif",map_particle_pars_fragment:"#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_particle_fragment:"#ifdef USE_MAP\ngl_FragColor = gl_FragColor * texture2D( map, vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y ) );\n#endif",map_pars_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\nuniform vec4 offsetRepeat;\n#endif",map_pars_fragment:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvarying vec2 vUv;\n#endif\n#ifdef USE_MAP\nuniform sampler2D map;\n#endif",map_vertex:"#if defined( USE_MAP ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( USE_SPECULARMAP )\nvUv = uv * offsetRepeat.zw + offsetRepeat.xy;\n#endif",map_fragment:"#ifdef USE_MAP\nvec4 texelColor = texture2D( map, vUv );\n#ifdef GAMMA_INPUT\ntexelColor.xyz *= texelColor.xyz;\n#endif\ngl_FragColor = gl_FragColor * texelColor;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\nuniform sampler2D lightMap;\n#endif",lightmap_pars_vertex:"#ifdef USE_LIGHTMAP\nvarying vec2 vUv2;\n#endif",lightmap_fragment:"#ifdef USE_LIGHTMAP\ngl_FragColor = gl_FragColor * texture2D( lightMap, vUv2 );\n#endif",lightmap_vertex:"#ifdef USE_LIGHTMAP\nvUv2 = uv2;\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\nuniform sampler2D bumpMap;\nuniform float bumpScale;\nvec2 dHdxy_fwd() {\nvec2 dSTdx = dFdx( vUv );\nvec2 dSTdy = dFdy( vUv );\nfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\nfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\nfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\nreturn vec2( dBx, dBy );\n}\nvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {\nvec3 vSigmaX = dFdx( surf_pos );\nvec3 vSigmaY = dFdy( surf_pos );\nvec3 vN = surf_norm;\nvec3 R1 = cross( vSigmaY, vN );\nvec3 R2 = cross( vN, vSigmaX );\nfloat fDet = dot( vSigmaX, R1 );\nvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\nreturn normalize( abs( fDet ) * surf_norm - vGrad );\n}\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\nuniform sampler2D normalMap;\nuniform vec2 normalScale;\nvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm ) {\nvec3 q0 = dFdx( eye_pos.xyz );\nvec3 q1 = dFdy( eye_pos.xyz );\nvec2 st0 = dFdx( vUv.st );\nvec2 st1 = dFdy( vUv.st );\nvec3 S = normalize(  q0 * st1.t - q1 * st0.t );\nvec3 T = normalize( -q0 * st1.s + q1 * st0.s );\nvec3 N = normalize( surf_norm );\nvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\nmapN.xy = normalScale * mapN.xy;\nmat3 tsn = mat3( S, T, N );\nreturn normalize( tsn * mapN );\n}\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\nuniform sampler2D specularMap;\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\nvec4 texelSpecular = texture2D( specularMap, vUv );\nspecularStrength = texelSpecular.r;\n#else\nspecularStrength = 1.0;\n#endif",lights_lambert_pars_vertex:"uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif",lights_lambert_vertex:"vLightFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\nvLightBack = vec3( 0.0 );\n#endif\ntransformedNormal = normalize( transformedNormal );\n#if MAX_DIR_LIGHTS > 0\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, dirVector );\nvec3 directionalLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 directionalLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 directionalLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\ndirectionalLightWeighting = mix( directionalLightWeighting, directionalLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\ndirectionalLightWeightingBack = mix( directionalLightWeightingBack, directionalLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += directionalLightColor[ i ] * directionalLightWeighting;\n#ifdef DOUBLE_SIDED\nvLightBack += directionalLightColor[ i ] * directionalLightWeightingBack;\n#endif\n}\n#endif\n#if MAX_POINT_LIGHTS > 0\nfor( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 pointLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 pointLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 pointLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\npointLightWeighting = mix( pointLightWeighting, pointLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\npointLightWeightingBack = mix( pointLightWeightingBack, pointLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += pointLightColor[ i ] * pointLightWeighting * lDistance;\n#ifdef DOUBLE_SIDED\nvLightBack += pointLightColor[ i ] * pointLightWeightingBack * lDistance;\n#endif\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nfor( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz - mvPosition.xyz;\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - worldPosition.xyz ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( transformedNormal, lVector );\nvec3 spotLightWeighting = vec3( max( dotProduct, 0.0 ) );\n#ifdef DOUBLE_SIDED\nvec3 spotLightWeightingBack = vec3( max( -dotProduct, 0.0 ) );\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalfBack = vec3( max( -0.5 * dotProduct + 0.5, 0.0 ) );\n#endif\n#endif\n#ifdef WRAP_AROUND\nvec3 spotLightWeightingHalf = vec3( max( 0.5 * dotProduct + 0.5, 0.0 ) );\nspotLightWeighting = mix( spotLightWeighting, spotLightWeightingHalf, wrapRGB );\n#ifdef DOUBLE_SIDED\nspotLightWeightingBack = mix( spotLightWeightingBack, spotLightWeightingHalfBack, wrapRGB );\n#endif\n#endif\nvLightFront += spotLightColor[ i ] * spotLightWeighting * lDistance * spotEffect;\n#ifdef DOUBLE_SIDED\nvLightBack += spotLightColor[ i ] * spotLightWeightingBack * lDistance * spotEffect;\n#endif\n}\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( transformedNormal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nfloat hemiDiffuseWeightBack = -0.5 * dotProduct + 0.5;\nvLightFront += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\n#ifdef DOUBLE_SIDED\nvLightBack += mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeightBack );\n#endif\n}\n#endif\nvLightFront = vLightFront * diffuse + ambient * ambientLightColor + emissive;\n#ifdef DOUBLE_SIDED\nvLightBack = vLightBack * diffuse + ambient * ambientLightColor + emissive;\n#endif",lights_phong_pars_vertex:"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif",lights_phong_vertex:"#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvWorldPosition = worldPosition.xyz;\n#endif",lights_phong_pars_fragment:"uniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0 || defined( USE_BUMPMAP )\nvarying vec3 vWorldPosition;\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",lights_phong_fragment:"vec3 normal = normalize( vNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#ifdef DOUBLE_SIDED\nnormal = normal * ( -1.0 + 2.0 * float( gl_FrontFacing ) );\n#endif\n#ifdef USE_NORMALMAP\nnormal = perturbNormal2Arb( -vViewPosition, normal );\n#elif defined( USE_BUMPMAP )\nnormal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );\n#endif\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse  = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / pointLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dotProduct, 0.0 );\n#endif\npointDiffuse  += diffuse * pointLightColor[ i ] * pointDiffuseWeight * lDistance;\nvec3 pointHalfVector = normalize( lVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularStrength * max( pow( pointDotNormalHalf, shininess ), 0.0 );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * lDistance * specularNormalization;\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse  = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 lVector = lPosition.xyz + vViewPosition.xyz;\nfloat lDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nlDistance = 1.0 - min( ( length( lVector ) / spotLightDistance[ i ] ), 1.0 );\nlVector = normalize( lVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\nfloat dotProduct = dot( normal, lVector );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dotProduct, 0.0 );\n#endif\nspotDiffuse += diffuse * spotLightColor[ i ] * spotDiffuseWeight * lDistance * spotEffect;\nvec3 spotHalfVector = normalize( lVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularStrength * max( pow( spotDotNormalHalf, shininess ), 0.0 );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * lDistance * specularNormalization * spotEffect;\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse  = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, dirVector );\n#ifdef WRAP_AROUND\nfloat dirDiffuseWeightFull = max( dotProduct, 0.0 );\nfloat dirDiffuseWeightHalf = max( 0.5 * dotProduct + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( dirDiffuseWeightFull ), vec3( dirDiffuseWeightHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dotProduct, 0.0 );\n#endif\ndirDiffuse  += diffuse * directionalLightColor[ i ] * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularStrength * max( pow( dirDotNormalHalf, shininess ), 0.0 );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularStrength * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularStrength * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( emissive + totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif",color_pars_fragment:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_fragment:"#ifdef USE_COLOR\ngl_FragColor = gl_FragColor * vec4( vColor, 1.0 );\n#endif",color_pars_vertex:"#ifdef USE_COLOR\nvarying vec3 vColor;\n#endif",color_vertex:"#ifdef USE_COLOR\n#ifdef GAMMA_INPUT\nvColor = color * color;\n#else\nvColor = color;\n#endif\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n#ifdef BONE_TEXTURE\nuniform sampler2D boneTexture;\nuniform int boneTextureWidth;\nuniform int boneTextureHeight;\nmat4 getBoneMatrix( const in float i ) {\nfloat j = i * 4.0;\nfloat x = mod( j, float( boneTextureWidth ) );\nfloat y = floor( j / float( boneTextureWidth ) );\nfloat dx = 1.0 / float( boneTextureWidth );\nfloat dy = 1.0 / float( boneTextureHeight );\ny = dy * ( y + 0.5 );\nvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\nvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\nvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\nvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\nmat4 bone = mat4( v1, v2, v3, v4 );\nreturn bone;\n}\n#else\nuniform mat4 boneGlobalMatrices[ MAX_BONES ];\nmat4 getBoneMatrix( const in float i ) {\nmat4 bone = boneGlobalMatrices[ int(i) ];\nreturn bone;\n}\n#endif\n#endif",skinbase_vertex:"#ifdef USE_SKINNING\nmat4 boneMatX = getBoneMatrix( skinIndex.x );\nmat4 boneMatY = getBoneMatrix( skinIndex.y );\nmat4 boneMatZ = getBoneMatrix( skinIndex.z );\nmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n#ifdef USE_MORPHTARGETS\nvec4 skinVertex = vec4( morphed, 1.0 );\n#else\nvec4 skinVertex = vec4( position, 1.0 );\n#endif\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned      += boneMatY * skinVertex * skinWeight.y;\nskinned      += boneMatZ * skinVertex * skinWeight.z;\nskinned      += boneMatW * skinVertex * skinWeight.w;\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n#ifndef USE_MORPHNORMALS\nuniform float morphTargetInfluences[ 8 ];\n#else\nuniform float morphTargetInfluences[ 4 ];\n#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\nvec3 morphed = vec3( 0.0 );\nmorphed += ( morphTarget0 - position ) * morphTargetInfluences[ 0 ];\nmorphed += ( morphTarget1 - position ) * morphTargetInfluences[ 1 ];\nmorphed += ( morphTarget2 - position ) * morphTargetInfluences[ 2 ];\nmorphed += ( morphTarget3 - position ) * morphTargetInfluences[ 3 ];\n#ifndef USE_MORPHNORMALS\nmorphed += ( morphTarget4 - position ) * morphTargetInfluences[ 4 ];\nmorphed += ( morphTarget5 - position ) * morphTargetInfluences[ 5 ];\nmorphed += ( morphTarget6 - position ) * morphTargetInfluences[ 6 ];\nmorphed += ( morphTarget7 - position ) * morphTargetInfluences[ 7 ];\n#endif\nmorphed += position;\n#endif",default_vertex:"vec4 mvPosition;\n#ifdef USE_SKINNING\nmvPosition = modelViewMatrix * skinned;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( morphed, 1.0 );\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHTARGETS )\nmvPosition = modelViewMatrix * vec4( position, 1.0 );\n#endif\ngl_Position = projectionMatrix * mvPosition;",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\nvec3 morphedNormal = vec3( 0.0 );\nmorphedNormal +=  ( morphNormal0 - normal ) * morphTargetInfluences[ 0 ];\nmorphedNormal +=  ( morphNormal1 - normal ) * morphTargetInfluences[ 1 ];\nmorphedNormal +=  ( morphNormal2 - normal ) * morphTargetInfluences[ 2 ];\nmorphedNormal +=  ( morphNormal3 - normal ) * morphTargetInfluences[ 3 ];\nmorphedNormal += normal;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\nmat4 skinMatrix = skinWeight.x * boneMatX;\nskinMatrix 	+= skinWeight.y * boneMatY;\n#ifdef USE_MORPHNORMALS\nvec4 skinnedNormal = skinMatrix * vec4( morphedNormal, 0.0 );\n#else\nvec4 skinnedNormal = skinMatrix * vec4( normal, 0.0 );\n#endif\n#endif",defaultnormal_vertex:"vec3 objectNormal;\n#ifdef USE_SKINNING\nobjectNormal = skinnedNormal.xyz;\n#endif\n#if !defined( USE_SKINNING ) && defined( USE_MORPHNORMALS )\nobjectNormal = morphedNormal;\n#endif\n#if !defined( USE_SKINNING ) && ! defined( USE_MORPHNORMALS )\nobjectNormal = normal;\n#endif\n#ifdef FLIP_SIDED\nobjectNormal = -objectNormal;\n#endif\nvec3 transformedNormal = normalMatrix * objectNormal;",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\nuniform sampler2D shadowMap[ MAX_SHADOWS ];\nuniform vec2 shadowMapSize[ MAX_SHADOWS ];\nuniform float shadowDarkness[ MAX_SHADOWS ];\nuniform float shadowBias[ MAX_SHADOWS ];\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nfloat unpackDepth( const in vec4 rgba_depth ) {\nconst vec4 bit_shift = vec4( 1.0 / ( 256.0 * 256.0 * 256.0 ), 1.0 / ( 256.0 * 256.0 ), 1.0 / 256.0, 1.0 );\nfloat depth = dot( rgba_depth, bit_shift );\nreturn depth;\n}\n#endif",shadowmap_fragment:"#ifdef USE_SHADOWMAP\n#ifdef SHADOWMAP_DEBUG\nvec3 frustumColors[3];\nfrustumColors[0] = vec3( 1.0, 0.5, 0.0 );\nfrustumColors[1] = vec3( 0.0, 1.0, 0.8 );\nfrustumColors[2] = vec3( 0.0, 0.5, 1.0 );\n#endif\n#ifdef SHADOWMAP_CASCADE\nint inFrustumCount = 0;\n#endif\nfloat fDepth;\nvec3 shadowColor = vec3( 1.0 );\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvec3 shadowCoord = vShadowCoord[ i ].xyz / vShadowCoord[ i ].w;\nbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\nbool inFrustum = all( inFrustumVec );\n#ifdef SHADOWMAP_CASCADE\ninFrustumCount += int( inFrustum );\nbvec3 frustumTestVec = bvec3( inFrustum, inFrustumCount == 1, shadowCoord.z <= 1.0 );\n#else\nbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n#endif\nbool frustumTest = all( frustumTestVec );\nif ( frustumTest ) {\nshadowCoord.z += shadowBias[ i ];\n#if defined( SHADOWMAP_TYPE_PCF )\nfloat shadow = 0.0;\nconst float shadowDelta = 1.0 / 9.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.25 * xPixelOffset;\nfloat dy0 = -1.25 * yPixelOffset;\nfloat dx1 = 1.25 * xPixelOffset;\nfloat dy1 = 1.25 * yPixelOffset;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nfDepth = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nif ( fDepth < shadowCoord.z ) shadow += shadowDelta;\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\nfloat shadow = 0.0;\nfloat xPixelOffset = 1.0 / shadowMapSize[ i ].x;\nfloat yPixelOffset = 1.0 / shadowMapSize[ i ].y;\nfloat dx0 = -1.0 * xPixelOffset;\nfloat dy0 = -1.0 * yPixelOffset;\nfloat dx1 = 1.0 * xPixelOffset;\nfloat dy1 = 1.0 * yPixelOffset;\nmat3 shadowKernel;\nmat3 depthKernel;\ndepthKernel[0][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy0 ) ) );\ndepthKernel[0][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, 0.0 ) ) );\ndepthKernel[0][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx0, dy1 ) ) );\ndepthKernel[1][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy0 ) ) );\ndepthKernel[1][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy ) );\ndepthKernel[1][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( 0.0, dy1 ) ) );\ndepthKernel[2][0] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy0 ) ) );\ndepthKernel[2][1] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, 0.0 ) ) );\ndepthKernel[2][2] = unpackDepth( texture2D( shadowMap[ i ], shadowCoord.xy + vec2( dx1, dy1 ) ) );\nvec3 shadowZ = vec3( shadowCoord.z );\nshadowKernel[0] = vec3(lessThan(depthKernel[0], shadowZ ));\nshadowKernel[0] *= vec3(0.25);\nshadowKernel[1] = vec3(lessThan(depthKernel[1], shadowZ ));\nshadowKernel[1] *= vec3(0.25);\nshadowKernel[2] = vec3(lessThan(depthKernel[2], shadowZ ));\nshadowKernel[2] *= vec3(0.25);\nvec2 fractionalCoord = 1.0 - fract( shadowCoord.xy * shadowMapSize[i].xy );\nshadowKernel[0] = mix( shadowKernel[1], shadowKernel[0], fractionalCoord.x );\nshadowKernel[1] = mix( shadowKernel[2], shadowKernel[1], fractionalCoord.x );\nvec4 shadowValues;\nshadowValues.x = mix( shadowKernel[0][1], shadowKernel[0][0], fractionalCoord.y );\nshadowValues.y = mix( shadowKernel[0][2], shadowKernel[0][1], fractionalCoord.y );\nshadowValues.z = mix( shadowKernel[1][1], shadowKernel[1][0], fractionalCoord.y );\nshadowValues.w = mix( shadowKernel[1][2], shadowKernel[1][1], fractionalCoord.y );\nshadow = dot( shadowValues, vec4( 1.0 ) );\nshadowColor = shadowColor * vec3( ( 1.0 - shadowDarkness[ i ] * shadow ) );\n#else\nvec4 rgbaDepth = texture2D( shadowMap[ i ], shadowCoord.xy );\nfloat fDepth = unpackDepth( rgbaDepth );\nif ( fDepth < shadowCoord.z )\nshadowColor = shadowColor * vec3( 1.0 - shadowDarkness[ i ] );\n#endif\n}\n#ifdef SHADOWMAP_DEBUG\n#ifdef SHADOWMAP_CASCADE\nif ( inFrustum && inFrustumCount == 1 ) gl_FragColor.xyz *= frustumColors[ i ];\n#else\nif ( inFrustum ) gl_FragColor.xyz *= frustumColors[ i ];\n#endif\n#endif\n}\n#ifdef GAMMA_OUTPUT\nshadowColor *= shadowColor;\n#endif\ngl_FragColor.xyz = gl_FragColor.xyz * shadowColor;\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\nvarying vec4 vShadowCoord[ MAX_SHADOWS ];\nuniform mat4 shadowMatrix[ MAX_SHADOWS ];\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif",alphatest_fragment:"#ifdef ALPHATEST\nif ( gl_FragColor.a < ALPHATEST ) discard;\n#endif",linear_to_gamma_fragment:"#ifdef GAMMA_OUTPUT\ngl_FragColor.xyz = sqrt( gl_FragColor.xyz );\n#endif"},THREE.UniformsUtils={merge:function(e){var t,n,r,i={};for(t=0;t<e.length;t++)for(n in r=this.clone(e[t]),r)i[n]=r[n];return i},clone:function(e){var t,n,r,i={};for(t in e)for(n in i[t]={},e[t])r=e[t][n],i[t][n]=r instanceof THREE.Color||r instanceof THREE.Vector2||r instanceof THREE.Vector3||r instanceof THREE.Vector4||r instanceof THREE.Matrix4||r instanceof THREE.Texture?r.clone():r instanceof Array?r.slice():r;return i}},THREE.UniformsLib={common:{diffuse:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},map:{type:"t",value:null},offsetRepeat:{type:"v4",value:new THREE.Vector4(0,0,1,1)},lightMap:{type:"t",value:null},specularMap:{type:"t",value:null},envMap:{type:"t",value:null},flipEnvMap:{type:"f",value:-1},useRefract:{type:"i",value:0},reflectivity:{type:"f",value:1},refractionRatio:{type:"f",value:.98},combine:{type:"i",value:0},morphTargetInfluences:{type:"f",value:0}},bump:{bumpMap:{type:"t",value:null},bumpScale:{type:"f",value:1}},normalmap:{normalMap:{type:"t",value:null},normalScale:{type:"v2",value:new THREE.Vector2(1,1)}},fog:{fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},lights:{ambientLightColor:{type:"fv",value:[]},directionalLightDirection:{type:"fv",value:[]},directionalLightColor:{type:"fv",value:[]},hemisphereLightDirection:{type:"fv",value:[]},hemisphereLightSkyColor:{type:"fv",value:[]},hemisphereLightGroundColor:{type:"fv",value:[]},pointLightColor:{type:"fv",value:[]},pointLightPosition:{type:"fv",value:[]},pointLightDistance:{type:"fv1",value:[]},spotLightColor:{type:"fv",value:[]},spotLightPosition:{type:"fv",value:[]},spotLightDirection:{type:"fv",value:[]},spotLightDistance:{type:"fv1",value:[]},spotLightAngleCos:{type:"fv1",value:[]},spotLightExponent:{type:"fv1",value:[]}},particle:{psColor:{type:"c",value:new THREE.Color(15658734)},opacity:{type:"f",value:1},size:{type:"f",value:1},scale:{type:"f",value:1},map:{type:"t",value:null},fogDensity:{type:"f",value:25e-5},fogNear:{type:"f",value:1},fogFar:{type:"f",value:2e3},fogColor:{type:"c",value:new THREE.Color(16777215)}},shadowmap:{shadowMap:{type:"tv",value:[]},shadowMapSize:{type:"v2v",value:[]},shadowBias:{type:"fv1",value:[]},shadowDarkness:{type:"fv1",value:[]},shadowMatrix:{type:"m4v",value:[]}}},THREE.ShaderLib={basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.shadowmap]),vertexShader:[THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.skinbase_vertex,"#ifdef USE_ENVMAP",THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"#endif",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},lambert:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define LAMBERT\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_lambert_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_lambert_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform float opacity;\nvarying vec3 vLightFront;\n#ifdef DOUBLE_SIDED\nvarying vec3 vLightBack;\n#endif",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,"#ifdef DOUBLE_SIDED\nif ( gl_FrontFacing )\ngl_FragColor.xyz *= vLightFront;\nelse\ngl_FragColor.xyz *= vLightBack;\n#else\ngl_FragColor.xyz *= vLightFront;\n#endif",THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},phong:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.bump,THREE.UniformsLib.normalmap,THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{ambient:{type:"c",value:new THREE.Color(16777215)},emissive:{type:"c",value:new THREE.Color(0)},specular:{type:"c",value:new THREE.Color(1118481)},shininess:{type:"f",value:30},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),vertexShader:["#define PHONG\nvarying vec3 vViewPosition;\nvarying vec3 vNormal;",THREE.ShaderChunk.map_pars_vertex,THREE.ShaderChunk.lightmap_pars_vertex,THREE.ShaderChunk.envmap_pars_vertex,THREE.ShaderChunk.lights_phong_pars_vertex,THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.map_vertex,THREE.ShaderChunk.lightmap_vertex,THREE.ShaderChunk.color_vertex,THREE.ShaderChunk.morphnormal_vertex,THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,THREE.ShaderChunk.defaultnormal_vertex,"vNormal = normalize( transformedNormal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"vViewPosition = -mvPosition.xyz;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.envmap_vertex,THREE.ShaderChunk.lights_phong_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_pars_fragment,THREE.ShaderChunk.lightmap_pars_fragment,THREE.ShaderChunk.envmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.lights_phong_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.bumpmap_pars_fragment,THREE.ShaderChunk.normalmap_pars_fragment,THREE.ShaderChunk.specularmap_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3 ( 1.0 ), opacity );",THREE.ShaderChunk.map_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.specularmap_fragment,THREE.ShaderChunk.lights_phong_fragment,THREE.ShaderChunk.lightmap_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.envmap_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},particle_basic:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.particle,THREE.UniformsLib.shadowmap]),vertexShader:["uniform float size;\nuniform float scale;",THREE.ShaderChunk.color_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\n#ifdef USE_SIZEATTENUATION\ngl_PointSize = size * ( scale / length( mvPosition.xyz ) );\n#else\ngl_PointSize = size;\n#endif\ngl_Position = projectionMatrix * mvPosition;",THREE.ShaderChunk.worldpos_vertex,THREE.ShaderChunk.shadowmap_vertex,"}"].join("\n"),fragmentShader:["uniform vec3 psColor;\nuniform float opacity;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.map_particle_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,THREE.ShaderChunk.shadowmap_pars_fragment,"void main() {\ngl_FragColor = vec4( psColor, opacity );",THREE.ShaderChunk.map_particle_fragment,THREE.ShaderChunk.alphatest_fragment,THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},dashed:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.common,THREE.UniformsLib.fog,{scale:{type:"f",value:1},dashSize:{type:"f",value:1},totalSize:{type:"f",value:2}}]),vertexShader:["uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_vertex,"void main() {",THREE.ShaderChunk.color_vertex,"vLineDistance = scale * lineDistance;\nvec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\n}"].join("\n"),fragmentShader:["uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;",THREE.ShaderChunk.color_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\nif ( mod( vLineDistance, totalSize ) > dashSize ) {\ndiscard;\n}\ngl_FragColor = vec4( diffuse, opacity );",THREE.ShaderChunk.color_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n")},depth:{uniforms:{mNear:{type:"f",value:1},mFar:{type:"f",value:2e3},opacity:{type:"f",value:1}},vertexShader:"void main() {\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform float mNear;\nuniform float mFar;\nuniform float opacity;\nvoid main() {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat color = 1.0 - smoothstep( mNear, mFar, depth );\ngl_FragColor = vec4( vec3( color ), opacity );\n}"},normal:{uniforms:{opacity:{type:"f",value:1}},vertexShader:["varying vec3 vNormal;",THREE.ShaderChunk.morphtarget_pars_vertex,"void main() {\nvNormal = normalize( normalMatrix * normal );",THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"uniform float opacity;\nvarying vec3 vNormal;\nvoid main() {\ngl_FragColor = vec4( 0.5 * normalize( vNormal ) + 0.5, opacity );\n}"},normalmap:{uniforms:THREE.UniformsUtils.merge([THREE.UniformsLib.fog,THREE.UniformsLib.lights,THREE.UniformsLib.shadowmap,{enableAO:{type:"i",value:0},enableDiffuse:{type:"i",value:0},enableSpecular:{type:"i",value:0},enableReflection:{type:"i",value:0},enableDisplacement:{type:"i",value:0},tDisplacement:{type:"t",value:null},tDiffuse:{type:"t",value:null},tCube:{type:"t",value:null},tNormal:{type:"t",value:null},tSpecular:{type:"t",value:null},tAO:{type:"t",value:null},uNormalScale:{type:"v2",value:new THREE.Vector2(1,1)},uDisplacementBias:{type:"f",value:0},uDisplacementScale:{type:"f",value:1},diffuse:{type:"c",value:new THREE.Color(16777215)},specular:{type:"c",value:new THREE.Color(1118481)},ambient:{type:"c",value:new THREE.Color(16777215)},shininess:{type:"f",value:30},opacity:{type:"f",value:1},useRefract:{type:"i",value:0},refractionRatio:{type:"f",value:.98},reflectivity:{type:"f",value:.5},uOffset:{type:"v2",value:new THREE.Vector2(0,0)},uRepeat:{type:"v2",value:new THREE.Vector2(1,1)},wrapRGB:{type:"v3",value:new THREE.Vector3(1,1,1)}}]),fragmentShader:["uniform vec3 ambient;\nuniform vec3 diffuse;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\nuniform bool enableDiffuse;\nuniform bool enableSpecular;\nuniform bool enableAO;\nuniform bool enableReflection;\nuniform sampler2D tDiffuse;\nuniform sampler2D tNormal;\nuniform sampler2D tSpecular;\nuniform sampler2D tAO;\nuniform samplerCube tCube;\nuniform vec2 uNormalScale;\nuniform bool useRefract;\nuniform float refractionRatio;\nuniform float reflectivity;\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nuniform vec3 ambientLightColor;\n#if MAX_DIR_LIGHTS > 0\nuniform vec3 directionalLightColor[ MAX_DIR_LIGHTS ];\nuniform vec3 directionalLightDirection[ MAX_DIR_LIGHTS ];\n#endif\n#if MAX_HEMI_LIGHTS > 0\nuniform vec3 hemisphereLightSkyColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightGroundColor[ MAX_HEMI_LIGHTS ];\nuniform vec3 hemisphereLightDirection[ MAX_HEMI_LIGHTS ];\n#endif\n#if MAX_POINT_LIGHTS > 0\nuniform vec3 pointLightColor[ MAX_POINT_LIGHTS ];\nuniform vec3 pointLightPosition[ MAX_POINT_LIGHTS ];\nuniform float pointLightDistance[ MAX_POINT_LIGHTS ];\n#endif\n#if MAX_SPOT_LIGHTS > 0\nuniform vec3 spotLightColor[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightPosition[ MAX_SPOT_LIGHTS ];\nuniform vec3 spotLightDirection[ MAX_SPOT_LIGHTS ];\nuniform float spotLightAngleCos[ MAX_SPOT_LIGHTS ];\nuniform float spotLightExponent[ MAX_SPOT_LIGHTS ];\nuniform float spotLightDistance[ MAX_SPOT_LIGHTS ];\n#endif\n#ifdef WRAP_AROUND\nuniform vec3 wrapRGB;\n#endif\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.shadowmap_pars_fragment,THREE.ShaderChunk.fog_pars_fragment,"void main() {\ngl_FragColor = vec4( vec3( 1.0 ), opacity );\nvec3 specularTex = vec3( 1.0 );\nvec3 normalTex = texture2D( tNormal, vUv ).xyz * 2.0 - 1.0;\nnormalTex.xy *= uNormalScale;\nnormalTex = normalize( normalTex );\nif( enableDiffuse ) {\n#ifdef GAMMA_INPUT\nvec4 texelColor = texture2D( tDiffuse, vUv );\ntexelColor.xyz *= texelColor.xyz;\ngl_FragColor = gl_FragColor * texelColor;\n#else\ngl_FragColor = gl_FragColor * texture2D( tDiffuse, vUv );\n#endif\n}\nif( enableAO ) {\n#ifdef GAMMA_INPUT\nvec4 aoColor = texture2D( tAO, vUv );\naoColor.xyz *= aoColor.xyz;\ngl_FragColor.xyz = gl_FragColor.xyz * aoColor.xyz;\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * texture2D( tAO, vUv ).xyz;\n#endif\n}\nif( enableSpecular )\nspecularTex = texture2D( tSpecular, vUv ).xyz;\nmat3 tsb = mat3( normalize( vTangent ), normalize( vBinormal ), normalize( vNormal ) );\nvec3 finalNormal = tsb * normalTex;\n#ifdef FLIP_SIDED\nfinalNormal = -finalNormal;\n#endif\nvec3 normal = normalize( finalNormal );\nvec3 viewPosition = normalize( vViewPosition );\n#if MAX_POINT_LIGHTS > 0\nvec3 pointDiffuse = vec3( 0.0 );\nvec3 pointSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_POINT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( pointLightPosition[ i ], 1.0 );\nvec3 pointVector = lPosition.xyz + vViewPosition.xyz;\nfloat pointDistance = 1.0;\nif ( pointLightDistance[ i ] > 0.0 )\npointDistance = 1.0 - min( ( length( pointVector ) / pointLightDistance[ i ] ), 1.0 );\npointVector = normalize( pointVector );\n#ifdef WRAP_AROUND\nfloat pointDiffuseWeightFull = max( dot( normal, pointVector ), 0.0 );\nfloat pointDiffuseWeightHalf = max( 0.5 * dot( normal, pointVector ) + 0.5, 0.0 );\nvec3 pointDiffuseWeight = mix( vec3 ( pointDiffuseWeightFull ), vec3( pointDiffuseWeightHalf ), wrapRGB );\n#else\nfloat pointDiffuseWeight = max( dot( normal, pointVector ), 0.0 );\n#endif\npointDiffuse += pointDistance * pointLightColor[ i ] * diffuse * pointDiffuseWeight;\nvec3 pointHalfVector = normalize( pointVector + viewPosition );\nfloat pointDotNormalHalf = max( dot( normal, pointHalfVector ), 0.0 );\nfloat pointSpecularWeight = specularTex.r * max( pow( pointDotNormalHalf, shininess ), 0.0 );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( pointVector, pointHalfVector ), 5.0 );\npointSpecular += schlick * pointLightColor[ i ] * pointSpecularWeight * pointDiffuseWeight * pointDistance * specularNormalization;\n}\n#endif\n#if MAX_SPOT_LIGHTS > 0\nvec3 spotDiffuse = vec3( 0.0 );\nvec3 spotSpecular = vec3( 0.0 );\nfor ( int i = 0; i < MAX_SPOT_LIGHTS; i ++ ) {\nvec4 lPosition = viewMatrix * vec4( spotLightPosition[ i ], 1.0 );\nvec3 spotVector = lPosition.xyz + vViewPosition.xyz;\nfloat spotDistance = 1.0;\nif ( spotLightDistance[ i ] > 0.0 )\nspotDistance = 1.0 - min( ( length( spotVector ) / spotLightDistance[ i ] ), 1.0 );\nspotVector = normalize( spotVector );\nfloat spotEffect = dot( spotLightDirection[ i ], normalize( spotLightPosition[ i ] - vWorldPosition ) );\nif ( spotEffect > spotLightAngleCos[ i ] ) {\nspotEffect = max( pow( spotEffect, spotLightExponent[ i ] ), 0.0 );\n#ifdef WRAP_AROUND\nfloat spotDiffuseWeightFull = max( dot( normal, spotVector ), 0.0 );\nfloat spotDiffuseWeightHalf = max( 0.5 * dot( normal, spotVector ) + 0.5, 0.0 );\nvec3 spotDiffuseWeight = mix( vec3 ( spotDiffuseWeightFull ), vec3( spotDiffuseWeightHalf ), wrapRGB );\n#else\nfloat spotDiffuseWeight = max( dot( normal, spotVector ), 0.0 );\n#endif\nspotDiffuse += spotDistance * spotLightColor[ i ] * diffuse * spotDiffuseWeight * spotEffect;\nvec3 spotHalfVector = normalize( spotVector + viewPosition );\nfloat spotDotNormalHalf = max( dot( normal, spotHalfVector ), 0.0 );\nfloat spotSpecularWeight = specularTex.r * max( pow( spotDotNormalHalf, shininess ), 0.0 );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( spotVector, spotHalfVector ), 5.0 );\nspotSpecular += schlick * spotLightColor[ i ] * spotSpecularWeight * spotDiffuseWeight * spotDistance * specularNormalization * spotEffect;\n}\n}\n#endif\n#if MAX_DIR_LIGHTS > 0\nvec3 dirDiffuse = vec3( 0.0 );\nvec3 dirSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_DIR_LIGHTS; i++ ) {\nvec4 lDirection = viewMatrix * vec4( directionalLightDirection[ i ], 0.0 );\nvec3 dirVector = normalize( lDirection.xyz );\n#ifdef WRAP_AROUND\nfloat directionalLightWeightingFull = max( dot( normal, dirVector ), 0.0 );\nfloat directionalLightWeightingHalf = max( 0.5 * dot( normal, dirVector ) + 0.5, 0.0 );\nvec3 dirDiffuseWeight = mix( vec3( directionalLightWeightingFull ), vec3( directionalLightWeightingHalf ), wrapRGB );\n#else\nfloat dirDiffuseWeight = max( dot( normal, dirVector ), 0.0 );\n#endif\ndirDiffuse += directionalLightColor[ i ] * diffuse * dirDiffuseWeight;\nvec3 dirHalfVector = normalize( dirVector + viewPosition );\nfloat dirDotNormalHalf = max( dot( normal, dirHalfVector ), 0.0 );\nfloat dirSpecularWeight = specularTex.r * max( pow( dirDotNormalHalf, shininess ), 0.0 );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlick = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( dirVector, dirHalfVector ), 5.0 );\ndirSpecular += schlick * directionalLightColor[ i ] * dirSpecularWeight * dirDiffuseWeight * specularNormalization;\n}\n#endif\n#if MAX_HEMI_LIGHTS > 0\nvec3 hemiDiffuse  = vec3( 0.0 );\nvec3 hemiSpecular = vec3( 0.0 );\nfor( int i = 0; i < MAX_HEMI_LIGHTS; i ++ ) {\nvec4 lDirection = viewMatrix * vec4( hemisphereLightDirection[ i ], 0.0 );\nvec3 lVector = normalize( lDirection.xyz );\nfloat dotProduct = dot( normal, lVector );\nfloat hemiDiffuseWeight = 0.5 * dotProduct + 0.5;\nvec3 hemiColor = mix( hemisphereLightGroundColor[ i ], hemisphereLightSkyColor[ i ], hemiDiffuseWeight );\nhemiDiffuse += diffuse * hemiColor;\nvec3 hemiHalfVectorSky = normalize( lVector + viewPosition );\nfloat hemiDotNormalHalfSky = 0.5 * dot( normal, hemiHalfVectorSky ) + 0.5;\nfloat hemiSpecularWeightSky = specularTex.r * max( pow( hemiDotNormalHalfSky, shininess ), 0.0 );\nvec3 lVectorGround = -lVector;\nvec3 hemiHalfVectorGround = normalize( lVectorGround + viewPosition );\nfloat hemiDotNormalHalfGround = 0.5 * dot( normal, hemiHalfVectorGround ) + 0.5;\nfloat hemiSpecularWeightGround = specularTex.r * max( pow( hemiDotNormalHalfGround, shininess ), 0.0 );\nfloat dotProductGround = dot( normal, lVectorGround );\nfloat specularNormalization = ( shininess + 2.0001 ) / 8.0;\nvec3 schlickSky = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVector, hemiHalfVectorSky ), 5.0 );\nvec3 schlickGround = specular + vec3( 1.0 - specular ) * pow( 1.0 - dot( lVectorGround, hemiHalfVectorGround ), 5.0 );\nhemiSpecular += hemiColor * specularNormalization * ( schlickSky * hemiSpecularWeightSky * max( dotProduct, 0.0 ) + schlickGround * hemiSpecularWeightGround * max( dotProductGround, 0.0 ) );\n}\n#endif\nvec3 totalDiffuse = vec3( 0.0 );\nvec3 totalSpecular = vec3( 0.0 );\n#if MAX_DIR_LIGHTS > 0\ntotalDiffuse += dirDiffuse;\ntotalSpecular += dirSpecular;\n#endif\n#if MAX_HEMI_LIGHTS > 0\ntotalDiffuse += hemiDiffuse;\ntotalSpecular += hemiSpecular;\n#endif\n#if MAX_POINT_LIGHTS > 0\ntotalDiffuse += pointDiffuse;\ntotalSpecular += pointSpecular;\n#endif\n#if MAX_SPOT_LIGHTS > 0\ntotalDiffuse += spotDiffuse;\ntotalSpecular += spotSpecular;\n#endif\n#ifdef METAL\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient + totalSpecular );\n#else\ngl_FragColor.xyz = gl_FragColor.xyz * ( totalDiffuse + ambientLightColor * ambient ) + totalSpecular;\n#endif\nif ( enableReflection ) {\nvec3 vReflect;\nvec3 cameraToVertex = normalize( vWorldPosition - cameraPosition );\nif ( useRefract ) {\nvReflect = refract( cameraToVertex, normal, refractionRatio );\n} else {\nvReflect = reflect( cameraToVertex, normal );\n}\nvec4 cubeColor = textureCube( tCube, vec3( -vReflect.x, vReflect.yz ) );\n#ifdef GAMMA_INPUT\ncubeColor.xyz *= cubeColor.xyz;\n#endif\ngl_FragColor.xyz = mix( gl_FragColor.xyz, cubeColor.xyz, specularTex.r * reflectivity );\n}",THREE.ShaderChunk.shadowmap_fragment,THREE.ShaderChunk.linear_to_gamma_fragment,THREE.ShaderChunk.fog_fragment,"}"].join("\n"),vertexShader:["attribute vec4 tangent;\nuniform vec2 uOffset;\nuniform vec2 uRepeat;\nuniform bool enableDisplacement;\n#ifdef VERTEX_TEXTURES\nuniform sampler2D tDisplacement;\nuniform float uDisplacementScale;\nuniform float uDisplacementBias;\n#endif\nvarying vec3 vTangent;\nvarying vec3 vBinormal;\nvarying vec3 vNormal;\nvarying vec2 vUv;\nvarying vec3 vWorldPosition;\nvarying vec3 vViewPosition;",THREE.ShaderChunk.skinning_pars_vertex,THREE.ShaderChunk.shadowmap_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.skinnormal_vertex,"#ifdef USE_SKINNING\nvNormal = normalize( normalMatrix * skinnedNormal.xyz );\nvec4 skinnedTangent = skinMatrix * vec4( tangent.xyz, 0.0 );\nvTangent = normalize( normalMatrix * skinnedTangent.xyz );\n#else\nvNormal = normalize( normalMatrix * normal );\nvTangent = normalize( normalMatrix * tangent.xyz );\n#endif\nvBinormal = normalize( cross( vNormal, vTangent ) * tangent.w );\nvUv = uv * uRepeat + uOffset;\nvec3 displacedPosition;\n#ifdef VERTEX_TEXTURES\nif ( enableDisplacement ) {\nvec3 dv = texture2D( tDisplacement, uv ).xyz;\nfloat df = uDisplacementScale * dv.x + uDisplacementBias;\ndisplacedPosition = position + normalize( normal ) * df;\n} else {\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n}\n#else\n#ifdef USE_SKINNING\nvec4 skinVertex = vec4( position, 1.0 );\nvec4 skinned  = boneMatX * skinVertex * skinWeight.x;\nskinned 	  += boneMatY * skinVertex * skinWeight.y;\ndisplacedPosition  = skinned.xyz;\n#else\ndisplacedPosition = position;\n#endif\n#endif\nvec4 mvPosition = modelViewMatrix * vec4( displacedPosition, 1.0 );\nvec4 worldPosition = modelMatrix * vec4( displacedPosition, 1.0 );\ngl_Position = projectionMatrix * mvPosition;\nvWorldPosition = worldPosition.xyz;\nvViewPosition = -mvPosition.xyz;\n#ifdef USE_SHADOWMAP\nfor( int i = 0; i < MAX_SHADOWS; i ++ ) {\nvShadowCoord[ i ] = shadowMatrix[ i ] * worldPosition;\n}\n#endif\n}"].join("\n")},cube:{uniforms:{tCube:{type:"t",value:null},tFlip:{type:"f",value:-1}},vertexShader:"varying vec3 vWorldPosition;\nvoid main() {\nvec4 worldPosition = modelMatrix * vec4( position, 1.0 );\nvWorldPosition = worldPosition.xyz;\ngl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",fragmentShader:"uniform samplerCube tCube;\nuniform float tFlip;\nvarying vec3 vWorldPosition;\nvoid main() {\ngl_FragColor = textureCube( tCube, vec3( tFlip * vWorldPosition.x, vWorldPosition.yz ) );\n}"},depthRGBA:{uniforms:{},vertexShader:[THREE.ShaderChunk.morphtarget_pars_vertex,THREE.ShaderChunk.skinning_pars_vertex,"void main() {",THREE.ShaderChunk.skinbase_vertex,THREE.ShaderChunk.morphtarget_vertex,THREE.ShaderChunk.skinning_vertex,THREE.ShaderChunk.default_vertex,"}"].join("\n"),fragmentShader:"vec4 pack_depth( const in float depth ) {\nconst vec4 bit_shift = vec4( 256.0 * 256.0 * 256.0, 256.0 * 256.0, 256.0, 1.0 );\nconst vec4 bit_mask  = vec4( 0.0, 1.0 / 256.0, 1.0 / 256.0, 1.0 / 256.0 );\nvec4 res = fract( depth * bit_shift );\nres -= res.xxyz * bit_mask;\nreturn res;\n}\nvoid main() {\ngl_FragData[ 0 ] = pack_depth( gl_FragCoord.z );\n}"}},THREE.WebGLRenderer=function(e){function t(e,t){var n=e.vertices.length,r=t.material;if(r.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var i in r.attributes){var s=r.attributes[i];if(!s.__webglInitialized||s.createUniqueBuffers){s.__webglInitialized=!0;var o=1;"v2"===s.type?o=2:"v3"===s.type?o=3:"v4"===s.type?o=4:"c"===s.type&&(o=3),s.size=o,s.array=new Float32Array(n*o),s.buffer=Nt.createBuffer(),s.buffer.belongsToAttribute=i,s.needsUpdate=!0}e.__webglCustomAttributesList.push(s)}}}function n(e,t){var n=t.geometry,o=e.faces3,u=3*o.length,a=1*o.length,f=3*o.length,o=r(t,e),l=s(o),c=i(o),h=o.vertexColors?o.vertexColors:!1;e.__vertexArray=new Float32Array(3*u),c&&(e.__normalArray=new Float32Array(3*u)),n.hasTangents&&(e.__tangentArray=new Float32Array(4*u)),h&&(e.__colorArray=new Float32Array(3*u)),l&&(0<n.faceVertexUvs.length&&(e.__uvArray=new Float32Array(2*u)),1<n.faceVertexUvs.length&&(e.__uv2Array=new Float32Array(2*u))),t.geometry.skinWeights.length&&t.geometry.skinIndices.length&&(e.__skinIndexArray=new Float32Array(4*u),e.__skinWeightArray=new Float32Array(4*u)),e.__faceArray=new Uint16Array(3*a),e.__lineArray=new Uint16Array(2*f);if(e.numMorphTargets)for(e.__morphTargetsArrays=[],n=0,l=e.numMorphTargets;n<l;n++)e.__morphTargetsArrays.push(new Float32Array(3*u));if(e.numMorphNormals)for(e.__morphNormalsArrays=[],n=0,l=e.numMorphNormals;n<l;n++)e.__morphNormalsArrays.push(new Float32Array(3*u));e.__webglFaceCount=3*a,e.__webglLineCount=2*f;if(o.attributes){void 0===e.__webglCustomAttributesList&&(e.__webglCustomAttributesList=[]);for(var p in o.attributes){var a=o.attributes[p],f={},d;for(d in a)f[d]=a[d];if(!f.__webglInitialized||f.createUniqueBuffers)f.__webglInitialized=!0,n=1,"v2"===f.type?n=2:"v3"===f.type?n=3:"v4"===f.type?n=4:"c"===f.type&&(n=3),f.size=n,f.array=new Float32Array(u*n),f.buffer=Nt.createBuffer(),f.buffer.belongsToAttribute=p,a.needsUpdate=!0,f.__original=a;e.__webglCustomAttributesList.push(f)}}e.__inittedArrays=!0}function r(e,t){return e.material instanceof THREE.MeshFaceMaterial?e.material.materials[t.materialIndex]:e.material}function i(e){return e instanceof THREE.MeshBasicMaterial&&!e.envMap||e instanceof THREE.MeshDepthMaterial?!1:e&&void 0!==e.shading&&e.shading===THREE.SmoothShading?THREE.SmoothShading:THREE.FlatShading}function s(e){return e.map||e.lightMap||e.bumpMap||e.normalMap||e.specularMap||e instanceof THREE.ShaderMaterial?!0:!1}function o(e,t,n,r){var i,s,o,a;for(s in t)o=t[s],i=n[s],0<=o&&(i?(a=i.itemSize,Nt.bindBuffer(Nt.ARRAY_BUFFER,i.buffer),u(o),Nt.vertexAttribPointer(o,a,Nt.FLOAT,!1,0,r*a*4)):e.defaultAttributeValues&&(2===e.defaultAttributeValues[s].length?Nt.vertexAttrib2fv(o,e.defaultAttributeValues[s]):3===e.defaultAttributeValues[s].length&&Nt.vertexAttrib3fv(o,e.defaultAttributeValues[s])))}function u(e){0===gt[e]&&(Nt.enableVertexAttribArray(e),gt[e]=1)}function a(){for(var e in gt)1===gt[e]&&(Nt.disableVertexAttribArray(e),gt[e]=0)}function f(e,t){return e.z!==t.z?t.z-e.z:e.id-t.id}function l(e,t){return t[0]-e[0]}function c(e,t,n){if(e.length)for(var r=0,i=e.length;r<i;r++)G=$=null,K=Q=et=Z=ot=st=tt=-1,xt=!0,e[r].render(t,n,vt,mt),G=$=null,K=Q=et=Z=ot=st=tt=-1,xt=!0}function h(e,t,n,r,i,s,o,u){var a,f,l,c;t?(f=e.length-1,c=t=-1):(f=0,t=e.length,c=1);for(var h=f;h!==t;h+=c)if(a=e[h],a.render){f=a.object,l=a.buffer;if(u)a=u;else{a=a[n];if(!a)continue;o&&W.setBlending(a.blending,a.blendEquation,a.blendSrc,a.blendDst),W.setDepthTest(a.depthTest),W.setDepthWrite(a.depthWrite),C(a.polygonOffset,a.polygonOffsetFactor,a.polygonOffsetUnits)}W.setMaterialFaces(a),l instanceof THREE.BufferGeometry?W.renderBufferDirect(r,i,s,a,l,f):l instanceof THREE.Geometry2?W.renderBufferGeometry2(r,i,s,a,l,f):W.renderBuffer(r,i,s,a,l,f)}}function p(e,t,n,r,i,s,o){for(var u,a,f=0,l=e.length;f<l;f++)if(u=e[f],a=u.object,a.visible){if(o)u=o;else{u=u[t];if(!u)continue;s&&W.setBlending(u.blending,u.blendEquation,u.blendSrc,u.blendDst),W.setDepthTest(u.depthTest),W.setDepthWrite(u.depthWrite),C(u.polygonOffset,u.polygonOffsetFactor,u.polygonOffsetUnits)}W.renderImmediateObject(n,r,i,u,a)}}function d(e,r){var i,s,o;if(void 0===e.__webglInit&&(e.__webglInit=!0,e._modelViewMatrix=new THREE.Matrix4,e._normalMatrix=new THREE.Matrix3,void 0!==e.geometry&&void 0===e.geometry.__webglInit&&(e.geometry.__webglInit=!0,e.geometry.addEventListener("dispose",Ut)),s=e.geometry,void 0!==s))if(s instanceof THREE.BufferGeometry){var u,a;for(u in s.attributes)a="index"===u?Nt.ELEMENT_ARRAY_BUFFER:Nt.ARRAY_BUFFER,o=s.attributes[u],o.buffer=Nt.createBuffer(),Nt.bindBuffer(a,o.buffer),Nt.bufferData(a,o.array,Nt.STATIC_DRAW)}else if(s instanceof THREE.Geometry2){u={},a=["vertices","normals","uvs"];for(o in a){var f=s[a[o]],l=Nt.createBuffer();Nt.bindBuffer(Nt.ARRAY_BUFFER,l),Nt.bufferData(Nt.ARRAY_BUFFER,f,Nt.STATIC_DRAW),u[a[o]]=l}B[s.id]=u}else if(e instanceof THREE.Mesh){for(i in o=e.material,void 0===s.geometryGroups&&s.makeGroups(o instanceof THREE.MeshFaceMaterial),s.geometryGroups)if(o=s.geometryGroups[i],!o.__webglVertexBuffer){u=o,u.__webglVertexBuffer=Nt.createBuffer(),u.__webglNormalBuffer=Nt.createBuffer(),u.__webglTangentBuffer=Nt.createBuffer(),u.__webglColorBuffer=Nt.createBuffer(),u.__webglUVBuffer=Nt.createBuffer(),u.__webglUV2Buffer=Nt.createBuffer(),u.__webglSkinIndicesBuffer=Nt.createBuffer(),u.__webglSkinWeightsBuffer=Nt.createBuffer(),u.__webglFaceBuffer=Nt.createBuffer(),u.__webglLineBuffer=Nt.createBuffer(),f=a=void 0;if(u.numMorphTargets)for(u.__webglMorphTargetsBuffers=[],a=0,f=u.numMorphTargets;a<f;a++)u.__webglMorphTargetsBuffers.push(Nt.createBuffer());if(u.numMorphNormals)for(u.__webglMorphNormalsBuffers=[],a=0,f=u.numMorphNormals;a<f;a++)u.__webglMorphNormalsBuffers.push(Nt.createBuffer());W.info.memory.geometries++,n(o,e),s.verticesNeedUpdate=!0,s.morphTargetsNeedUpdate=!0,s.elementsNeedUpdate=!0,s.uvsNeedUpdate=!0,s.normalsNeedUpdate=!0,s.tangentsNeedUpdate=!0,s.colorsNeedUpdate=!0}}else e instanceof THREE.Line?s.__webglVertexBuffer||(o=s,o.__webglVertexBuffer=Nt.createBuffer(),o.__webglColorBuffer=Nt.createBuffer(),o.__webglLineDistanceBuffer=Nt.createBuffer(),W.info.memory.geometries++,o=s,u=o.vertices.length,o.__vertexArray=new Float32Array(3*u),o.__colorArray=new Float32Array(3*u),o.__lineDistanceArray=new Float32Array(1*u),o.__webglLineCount=u,t(o,e),s.verticesNeedUpdate=!0,s.colorsNeedUpdate=!0,s.lineDistancesNeedUpdate=!0):e instanceof THREE.ParticleSystem&&!s.__webglVertexBuffer&&(o=s,o.__webglVertexBuffer=Nt.createBuffer(),o.__webglColorBuffer=Nt.createBuffer(),W.info.memory.geometries++,o=s,u=o.vertices.length,o.__vertexArray=new Float32Array(3*u),o.__colorArray=new Float32Array(3*u),o.__sortArray=[],o.__webglParticleCount=u,t(o,e),s.verticesNeedUpdate=!0,s.colorsNeedUpdate=!0);if(void 0===e.__webglActive){if(e instanceof THREE.Mesh){if(s=e.geometry,s instanceof THREE.BufferGeometry)v(r.__webglObjects,s,e);else if(s instanceof THREE.Geometry2)v(r.__webglObjects,s,e);else if(s instanceof THREE.Geometry)for(i in s.geometryGroups)o=s.geometryGroups[i],v(r.__webglObjects,o,e)}else e instanceof THREE.Line||e instanceof THREE.ParticleSystem?(s=e.geometry,v(r.__webglObjects,s,e)):e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback?r.__webglObjectsImmediate.push({id:null,object:e,opaque:null,transparent:null,z:0}):e instanceof THREE.Sprite?r.__webglSprites.push(e):e instanceof THREE.LensFlare&&r.__webglFlares.push(e);e.__webglActive=!0}}function v(e,t,n){e.push({id:null,buffer:t,object:n,opaque:null,transparent:null,z:0})}function m(e){for(var t in e.attributes)if(e.attributes[t].needsUpdate)return!0;return!1}function g(e){for(var t in e.attributes)e.attributes[t].needsUpdate=!1}function y(e,t){e instanceof THREE.Mesh||e instanceof THREE.ParticleSystem||e instanceof THREE.Line?b(t.__webglObjects,e):e instanceof THREE.Sprite?w(t.__webglSprites,e):e instanceof THREE.LensFlare?w(t.__webglFlares,e):(e instanceof THREE.ImmediateRenderObject||e.immediateRenderCallback)&&b(t.__webglObjectsImmediate,e),delete e.__webglActive}function b(e,t){for(var n=e.length-1;0<=n;n--)e[n].object===t&&e.splice(n,1)}function w(e,t){for(var n=e.length-1;0<=n;n--)e[n]===t&&e.splice(n,1)}function E(e,t,n,r,i){Y=0,r.needsUpdate&&(r.program&&$t(r),W.initMaterial(r,t,n,i),r.needsUpdate=!1),r.morphTargets&&!i.__webglMorphTargetInfluences&&(i.__webglMorphTargetInfluences=new Float32Array(W.maxMorphTargets));var s=!1,o=r.program,u=o.uniforms,a=r.uniforms;o!==$&&(Nt.useProgram(o),$=o,s=!0),r.id!==K&&(K=r.id,s=!0);if(s||e!==G)Nt.uniformMatrix4fv(u.projectionMatrix,!1,e.projectionMatrix.elements),e!==G&&(G=e);if(r.skinning)if(Ht&&i.useVertexTexture){if(null!==u.boneTexture){var f=S();Nt.uniform1i(u.boneTexture,f),W.setTexture(i.boneTexture,f)}null!==u.boneTextureWidth&&Nt.uniform1i(u.boneTextureWidth,i.boneTextureWidth),null!==u.boneTextureHeight&&Nt.uniform1i(u.boneTextureHeight,i.boneTextureHeight)}else null!==u.boneGlobalMatrices&&Nt.uniformMatrix4fv(u.boneGlobalMatrices,!1,i.boneMatrices);if(s){n&&r.fog&&(a.fogColor.value=n.color,n instanceof THREE.Fog?(a.fogNear.value=n.near,a.fogFar.value=n.far):n instanceof THREE.FogExp2&&(a.fogDensity.value=n.density));if(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r.lights){if(xt){var l,c=f=0,h=0,p,d,v,m=Tt,g=m.directional.colors,y=m.directional.positions,b=m.point.colors,w=m.point.positions,E=m.point.distances,N=m.spot.colors,C=m.spot.positions,k=m.spot.distances,L=m.spot.directions,O=m.spot.anglesCos,M=m.spot.exponents,P=m.hemi.skyColors,H=m.hemi.groundColors,B=m.hemi.positions,j=0,F=0,I=0,q=0,R=0,U=0,z=0,X=0,V=l=0;n=v=V=0;for(s=t.length;n<s;n++)if(l=t[n],!l.onlyShadow)if(p=l.color,d=l.intensity,v=l.distance,l instanceof THREE.AmbientLight)l.visible&&(W.gammaInput?(f+=p.r*p.r,c+=p.g*p.g,h+=p.b*p.b):(f+=p.r,c+=p.g,h+=p.b));else if(l instanceof THREE.DirectionalLight){if(R+=1,l.visible&&(St.setFromMatrixPosition(l.matrixWorld),Et.setFromMatrixPosition(l.target.matrixWorld),St.sub(Et),St.normalize(),0!==St.x||0!==St.y||0!==St.z))l=3*j,y[l]=St.x,y[l+1]=St.y,y[l+2]=St.z,W.gammaInput?x(g,l,p,d*d):T(g,l,p,d),j+=1}else l instanceof THREE.PointLight?(U+=1,l.visible&&(V=3*F,W.gammaInput?x(b,V,p,d*d):T(b,V,p,d),Et.setFromMatrixPosition(l.matrixWorld),w[V]=Et.x,w[V+1]=Et.y,w[V+2]=Et.z,E[F]=v,F+=1)):l instanceof THREE.SpotLight?(z+=1,l.visible&&(V=3*I,W.gammaInput?x(N,V,p,d*d):T(N,V,p,d),Et.setFromMatrixPosition(l.matrixWorld),C[V]=Et.x,C[V+1]=Et.y,C[V+2]=Et.z,k[I]=v,St.copy(Et),Et.setFromMatrixPosition(l.target.matrixWorld),St.sub(Et),St.normalize(),L[V]=St.x,L[V+1]=St.y,L[V+2]=St.z,O[I]=Math.cos(l.angle),M[I]=l.exponent,I+=1)):l instanceof THREE.HemisphereLight&&(X+=1,l.visible&&(St.setFromMatrixPosition(l.matrixWorld),St.normalize(),0!==St.x||0!==St.y||0!==St.z))&&(v=3*q,B[v]=St.x,B[v+1]=St.y,B[v+2]=St.z,p=l.color,l=l.groundColor,W.gammaInput?(d*=d,x(P,v,p,d),x(H,v,l,d)):(T(P,v,p,d),T(H,v,l,d)),q+=1);n=3*j;for(s=Math.max(g.length,3*R);n<s;n++)g[n]=0;n=3*F;for(s=Math.max(b.length,3*U);n<s;n++)b[n]=0;n=3*I;for(s=Math.max(N.length,3*z);n<s;n++)N[n]=0;n=3*q;for(s=Math.max(P.length,3*X);n<s;n++)P[n]=0;n=3*q;for(s=Math.max(H.length,3*X);n<s;n++)H[n]=0;m.directional.length=j,m.point.length=F,m.spot.length=I,m.hemi.length=q,m.ambient[0]=f,m.ambient[1]=c,m.ambient[2]=h,xt=!1}n=Tt,a.ambientLightColor.value=n.ambient,a.directionalLightColor.value=n.directional.colors,a.directionalLightDirection.value=n.directional.positions,a.pointLightColor.value=n.point.colors,a.pointLightPosition.value=n.point.positions,a.pointLightDistance.value=n.point.distances,a.spotLightColor.value=n.spot.colors,a.spotLightPosition.value=n.spot.positions,a.spotLightDistance.value=n.spot.distances,a.spotLightDirection.value=n.spot.directions,a.spotLightAngleCos.value=n.spot.anglesCos,a.spotLightExponent.value=n.spot.exponents,a.hemisphereLightSkyColor.value=n.hemi.skyColors,a.hemisphereLightGroundColor.value=n.hemi.groundColors,a.hemisphereLightDirection.value=n.hemi.positions}if(r instanceof THREE.MeshBasicMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.MeshPhongMaterial){a.opacity.value=r.opacity,W.gammaInput?a.diffuse.value.copyGammaToLinear(r.color):a.diffuse.value=r.color,a.map.value=r.map,a.lightMap.value=r.lightMap,a.specularMap.value=r.specularMap,r.bumpMap&&(a.bumpMap.value=r.bumpMap,a.bumpScale.value=r.bumpScale),r.normalMap&&(a.normalMap.value=r.normalMap,a.normalScale.value.copy(r.normalScale));var J;r.map?J=r.map:r.specularMap?J=r.specularMap:r.normalMap?J=r.normalMap:r.bumpMap&&(J=r.bumpMap),void 0!==J&&(n=J.offset,J=J.repeat,a.offsetRepeat.value.set(n.x,n.y,J.x,J.y)),a.envMap.value=r.envMap,a.flipEnvMap.value=r.envMap instanceof THREE.WebGLRenderTargetCube?1:-1,a.reflectivity.value=r.reflectivity,a.refractionRatio.value=r.refractionRatio,a.combine.value=r.combine,a.useRefract.value=r.envMap&&r.envMap.mapping instanceof THREE.CubeRefractionMapping}r instanceof THREE.LineBasicMaterial?(a.diffuse.value=r.color,a.opacity.value=r.opacity):r instanceof THREE.LineDashedMaterial?(a.diffuse.value=r.color,a.opacity.value=r.opacity,a.dashSize.value=r.dashSize,a.totalSize.value=r.dashSize+r.gapSize,a.scale.value=r.scale):r instanceof THREE.ParticleSystemMaterial?(a.psColor.value=r.color,a.opacity.value=r.opacity,a.size.value=r.size,a.scale.value=D.height/2,a.map.value=r.map):r instanceof THREE.MeshPhongMaterial?(a.shininess.value=r.shininess,W.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.emissive.value.copyGammaToLinear(r.emissive),a.specular.value.copyGammaToLinear(r.specular)):(a.ambient.value=r.ambient,a.emissive.value=r.emissive,a.specular.value=r.specular),r.wrapAround&&a.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshLambertMaterial?(W.gammaInput?(a.ambient.value.copyGammaToLinear(r.ambient),a.emissive.value.copyGammaToLinear(r.emissive)):(a.ambient.value=r.ambient,a.emissive.value=r.emissive),r.wrapAround&&a.wrapRGB.value.copy(r.wrapRGB)):r instanceof THREE.MeshDepthMaterial?(a.mNear.value=e.near,a.mFar.value=e.far,a.opacity.value=r.opacity):r instanceof THREE.MeshNormalMaterial&&(a.opacity.value=r.opacity);if(i.receiveShadow&&!r._shadowPass&&a.shadowMatrix)for(n=J=0,s=t.length;n<s;n++)f=t[n],f.castShadow&&(f instanceof THREE.SpotLight||f instanceof THREE.DirectionalLight&&!f.shadowCascade)&&(a.shadowMap.value[J]=f.shadowMap,a.shadowMapSize.value[J]=f.shadowMapSize,a.shadowMatrix.value[J]=f.shadowMatrix,a.shadowDarkness.value[J]=f.shadowDarkness,a.shadowBias.value[J]=f.shadowBias,J++);t=r.uniformsList,a=0;for(J=t.length;a<J;a++)if(s=o.uniforms[t[a][1]])if(n=t[a][0],c=n.type,f=n.value,"i"===c)Nt.uniform1i(s,f);else if("f"===c)Nt.uniform1f(s,f);else if("v2"===c)Nt.uniform2f(s,f.x,f.y);else if("v3"===c)Nt.uniform3f(s,f.x,f.y,f.z);else if("v4"===c)Nt.uniform4f(s,f.x,f.y,f.z,f.w);else if("c"===c)Nt.uniform3f(s,f.r,f.g,f.b);else if("iv1"===c)Nt.uniform1iv(s,f);else if("iv"===c)Nt.uniform3iv(s,f);else if("fv1"===c)Nt.uniform1fv(s,f);else if("fv"===c)Nt.uniform3fv(s,f);else if("v2v"===c){void 0===n._array&&(n._array=new Float32Array(2*f.length)),c=0;for(h=f.length;c<h;c++)m=2*c,n._array[m]=f[c].x,n._array[m+1]=f[c].y;Nt.uniform2fv(s,n._array)}else if("v3v"===c){void 0===n._array&&(n._array=new Float32Array(3*f.length)),c=0;for(h=f.length;c<h;c++)m=3*c,n._array[m]=f[c].x,n._array[m+1]=f[c].y,n._array[m+2]=f[c].z;Nt.uniform3fv(s,n._array)}else if("v4v"===c){void 0===n._array&&(n._array=new Float32Array(4*f.length)),c=0;for(h=f.length;c<h;c++)m=4*c,n._array[m]=f[c].x,n._array[m+1]=f[c].y,n._array[m+2]=f[c].z,n._array[m+3]=f[c].w;Nt.uniform4fv(s,n._array)}else if("m4"===c)void 0===n._array&&(n._array=new Float32Array(16)),f.flattenToArray(n._array),Nt.uniformMatrix4fv(s,!1,n._array);else if("m4v"===c){void 0===n._array&&(n._array=new Float32Array(16*f.length)),c=0;for(h=f.length;c<h;c++)f[c].flattenToArrayOffset(n._array,16*c);Nt.uniformMatrix4fv(s,!1,n._array)}else if("t"===c){if(m=f,f=S(),Nt.uniform1i(s,f),m)if(m.image instanceof Array&&6===m.image.length){if(n=m,s=f,6===n.image.length)if(n.needsUpdate){n.image.__webglTextureCube||(n.addEventListener("dispose",zt),n.image.__webglTextureCube=Nt.createTexture(),W.info.memory.textures++),Nt.activeTexture(Nt.TEXTURE0+s),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,n.image.__webglTextureCube),Nt.pixelStorei(Nt.UNPACK_FLIP_Y_WEBGL,n.flipY),s=n instanceof THREE.CompressedTexture,f=[];for(c=0;6>c;c++)W.autoScaleCubemaps&&!s?(h=f,m=c,g=n.image[c],b=_t,g.width<=b&&g.height<=b||(w=Math.max(g.width,g.height),y=Math.floor(g.width*b/w),b=Math.floor(g.height*b/w),w=document.createElement("canvas"),w.width=y,w.height=b,w.getContext("2d").drawImage(g,0,0,g.width,g.height,0,0,y,b),g=w),h[m]=g):f[c]=n.image[c];c=f[0],h=THREE.Math.isPowerOfTwo(c.width)&&THREE.Math.isPowerOfTwo(c.height),m=_(n.format),g=_(n.type),A(Nt.TEXTURE_CUBE_MAP,n,h);for(c=0;6>c;c++)if(s)for(b=f[c].mipmaps,w=0,E=b.length;w<E;w++)y=b[w],n.format!==THREE.RGBAFormat?Nt.compressedTexImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+c,w,m,y.width,y.height,0,y.data):Nt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+c,w,m,y.width,y.height,0,m,g,y.data);else Nt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+c,0,m,m,g,f[c]);n.generateMipmaps&&h&&Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP),n.needsUpdate=!1,n.onUpdate&&n.onUpdate()}else Nt.activeTexture(Nt.TEXTURE0+s),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,n.image.__webglTextureCube)}else m instanceof THREE.WebGLRenderTargetCube?(n=m,Nt.activeTexture(Nt.TEXTURE0+f),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,n.__webglTexture)):W.setTexture(m,f)}else if("tv"===c){void 0===n._array&&(n._array=[]),c=0;for(h=n.value.length;c<h;c++)n._array[c]=S();Nt.uniform1iv(s,n._array),c=0;for(h=n.value.length;c<h;c++)m=n.value[c],f=n._array[c],m&&W.setTexture(m,f)}else console.warn("THREE.WebGLRenderer: Unknown uniform type: "+c);(r instanceof THREE.ShaderMaterial||r instanceof THREE.MeshPhongMaterial||r.envMap)&&null!==u.cameraPosition&&(Et.setFromMatrixPosition(e.matrixWorld),Nt.uniform3f(u.cameraPosition,Et.x,Et.y,Et.z)),(r instanceof THREE.MeshPhongMaterial||r instanceof THREE.MeshLambertMaterial||r instanceof THREE.ShaderMaterial||r.skinning)&&null!==u.viewMatrix&&Nt.uniformMatrix4fv(u.viewMatrix,!1,e.matrixWorldInverse.elements)}return Nt.uniformMatrix4fv(u.modelViewMatrix,!1,i._modelViewMatrix.elements),u.normalMatrix&&Nt.uniformMatrix3fv(u.normalMatrix,!1,i._normalMatrix.elements),null!==u.modelMatrix&&Nt.uniformMatrix4fv(u.modelMatrix,!1,i.matrixWorld.elements),o}function S(){var e=Y;return e>=Ot&&console.warn("WebGLRenderer: trying to use "+e+" texture units while this GPU supports only "+Ot),Y+=1,e}function x(e,t,n,r){e[t]=n.r*n.r*r,e[t+1]=n.g*n.g*r,e[t+2]=n.b*n.b*r}function T(e,t,n,r){e[t]=n.r*r,e[t+1]=n.g*r,e[t+2]=n.b*r}function N(e){e!==lt&&(Nt.lineWidth(e),lt=e)}function C(e,t,n){ut!==e&&(e?Nt.enable(Nt.POLYGON_OFFSET_FILL):Nt.disable(Nt.POLYGON_OFFSET_FILL),ut=e),!e||at===t&&ft===n||(Nt.polygonOffset(t,n),at=t,ft=n)}function k(e){e=e.split("\n");for(var t=0,n=e.length;t<n;t++)e[t]=t+1+": "+e[t];return e.join("\n")}function L(e,t){var n;return"fragment"===e?n=Nt.createShader(Nt.FRAGMENT_SHADER):"vertex"===e&&(n=Nt.createShader(Nt.VERTEX_SHADER)),Nt.shaderSource(n,t),Nt.compileShader(n),Nt.getShaderParameter(n,Nt.COMPILE_STATUS)?n:(console.error(Nt.getShaderInfoLog(n)),console.error(k(t)),null)}function A(e,t,n){n?(Nt.texParameteri(e,Nt.TEXTURE_WRAP_S,_(t.wrapS)),Nt.texParameteri(e,Nt.TEXTURE_WRAP_T,_(t.wrapT)),Nt.texParameteri(e,Nt.TEXTURE_MAG_FILTER,_(t.magFilter)),Nt.texParameteri(e,Nt.TEXTURE_MIN_FILTER,_(t.minFilter))):(Nt.texParameteri(e,Nt.TEXTURE_WRAP_S,Nt.CLAMP_TO_EDGE),Nt.texParameteri(e,Nt.TEXTURE_WRAP_T,Nt.CLAMP_TO_EDGE),Nt.texParameteri(e,Nt.TEXTURE_MAG_FILTER,M(t.magFilter)),Nt.texParameteri(e,Nt.TEXTURE_MIN_FILTER,M(t.minFilter))),Lt&&t.type!==THREE.FloatType&&(1<t.anisotropy||t.__oldAnisotropy)&&(Nt.texParameterf(e,Lt.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,Dt)),t.__oldAnisotropy=t.anisotropy)}function O(e,t){Nt.bindRenderbuffer(Nt.RENDERBUFFER,e),t.depthBuffer&&!t.stencilBuffer?(Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.DEPTH_COMPONENT16,t.width,t.height),Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_ATTACHMENT,Nt.RENDERBUFFER,e)):t.depthBuffer&&t.stencilBuffer?(Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.DEPTH_STENCIL,t.width,t.height),Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_STENCIL_ATTACHMENT,Nt.RENDERBUFFER,e)):Nt.renderbufferStorage(Nt.RENDERBUFFER,Nt.RGBA4,t.width,t.height)}function M(e){return e===THREE.NearestFilter||e===THREE.NearestMipMapNearestFilter||e===THREE.NearestMipMapLinearFilter?Nt.NEAREST:Nt.LINEAR}function _(e){if(e===THREE.RepeatWrapping)return Nt.REPEAT;if(e===THREE.ClampToEdgeWrapping)return Nt.CLAMP_TO_EDGE;if(e===THREE.MirroredRepeatWrapping)return Nt.MIRRORED_REPEAT;if(e===THREE.NearestFilter)return Nt.NEAREST;if(e===THREE.NearestMipMapNearestFilter)return Nt.NEAREST_MIPMAP_NEAREST;if(e===THREE.NearestMipMapLinearFilter)return Nt.NEAREST_MIPMAP_LINEAR;if(e===THREE.LinearFilter)return Nt.LINEAR;if(e===THREE.LinearMipMapNearestFilter)return Nt.LINEAR_MIPMAP_NEAREST;if(e===THREE.LinearMipMapLinearFilter)return Nt.LINEAR_MIPMAP_LINEAR;if(e===THREE.UnsignedByteType)return Nt.UNSIGNED_BYTE;if(e===THREE.UnsignedShort4444Type)return Nt.UNSIGNED_SHORT_4_4_4_4;if(e===THREE.UnsignedShort5551Type)return Nt.UNSIGNED_SHORT_5_5_5_1;if(e===THREE.UnsignedShort565Type)return Nt.UNSIGNED_SHORT_5_6_5;if(e===THREE.ByteType)return Nt.BYTE;if(e===THREE.ShortType)return Nt.SHORT;if(e===THREE.UnsignedShortType)return Nt.UNSIGNED_SHORT;if(e===THREE.IntType)return Nt.INT;if(e===THREE.UnsignedIntType)return Nt.UNSIGNED_INT;if(e===THREE.FloatType)return Nt.FLOAT;if(e===THREE.AlphaFormat)return Nt.ALPHA;if(e===THREE.RGBFormat)return Nt.RGB;if(e===THREE.RGBAFormat)return Nt.RGBA;if(e===THREE.LuminanceFormat)return Nt.LUMINANCE;if(e===THREE.LuminanceAlphaFormat)return Nt.LUMINANCE_ALPHA;if(e===THREE.AddEquation)return Nt.FUNC_ADD;if(e===THREE.SubtractEquation)return Nt.FUNC_SUBTRACT;if(e===THREE.ReverseSubtractEquation)return Nt.FUNC_REVERSE_SUBTRACT;if(e===THREE.ZeroFactor)return Nt.ZERO;if(e===THREE.OneFactor)return Nt.ONE;if(e===THREE.SrcColorFactor)return Nt.SRC_COLOR;if(e===THREE.OneMinusSrcColorFactor)return Nt.ONE_MINUS_SRC_COLOR;if(e===THREE.SrcAlphaFactor)return Nt.SRC_ALPHA;if(e===THREE.OneMinusSrcAlphaFactor)return Nt.ONE_MINUS_SRC_ALPHA;if(e===THREE.DstAlphaFactor)return Nt.DST_ALPHA;if(e===THREE.OneMinusDstAlphaFactor)return Nt.ONE_MINUS_DST_ALPHA;if(e===THREE.DstColorFactor)return Nt.DST_COLOR;if(e===THREE.OneMinusDstColorFactor)return Nt.ONE_MINUS_DST_COLOR;if(e===THREE.SrcAlphaSaturateFactor)return Nt.SRC_ALPHA_SATURATE;if(void 0!==At){if(e===THREE.RGB_S3TC_DXT1_Format)return At.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT1_Format)return At.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===THREE.RGBA_S3TC_DXT3_Format)return At.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===THREE.RGBA_S3TC_DXT5_Format)return At.COMPRESSED_RGBA_S3TC_DXT5_EXT}return 0}console.log("THREE.WebGLRenderer",THREE.REVISION),e=e||{};var D=void 0!==e.canvas?e.canvas:document.createElement("canvas"),P=void 0!==e.context?e.context:null,H=void 0!==e.precision?e.precision:"highp",B={},j=void 0!==e.alpha?e.alpha:!1,F=void 0!==e.premultipliedAlpha?e.premultipliedAlpha:!0,I=void 0!==e.antialias?e.antialias:!1,q=void 0!==e.stencil?e.stencil:!0,R=void 0!==e.preserveDrawingBuffer?e.preserveDrawingBuffer:!1,U=new THREE.Color(0),z=0;this.domElement=D,this.context=null,this.devicePixelRatio=void 0!==e.devicePixelRatio?e.devicePixelRatio:void 0!==self.devicePixelRatio?self.devicePixelRatio:1,this.autoUpdateObjects=this.sortObjects=this.autoClearStencil=this.autoClearDepth=this.autoClearColor=this.autoClear=!0,this.shadowMapEnabled=this.gammaOutput=this.gammaInput=!1,this.shadowMapAutoUpdate=!0,this.shadowMapType=THREE.PCFShadowMap,this.shadowMapCullFace=THREE.CullFaceFront,this.shadowMapCascade=this.shadowMapDebug=!1,this.maxMorphTargets=8,this.maxMorphNormals=4,this.autoScaleCubemaps=!0,this.renderPluginsPre=[],this.renderPluginsPost=[],this.info={memory:{programs:0,geometries:0,textures:0},render:{calls:0,vertices:0,faces:0,points:0}};var W=this,X=[],V=0,$=null,J=null,K=-1,Q=null,G=null,Y=0,Z=-1,et=-1,tt=-1,nt=-1,rt=-1,it=-1,st=-1,ot=-1,ut=null,at=null,ft=null,lt=null,ct=0,ht=0,pt=D.width,dt=D.height,vt=0,mt=0,gt=new Uint8Array(16),yt=new THREE.Frustum,bt=new THREE.Matrix4,wt=new THREE.Matrix4,Et=new THREE.Vector3,St=new THREE.Vector3,xt=!0,Tt={ambient:[0,0,0],directional:{length:0,colors:[],positions:[]},point:{length:0,colors:[],positions:[],distances:[]},spot:{length:0,colors:[],positions:[],distances:[],directions:[],anglesCos:[],exponents:[]},hemi:{length:0,skyColors:[],groundColors:[],positions:[]}},Nt,Ct,kt,Lt,At;(function(){try{var e={alpha:j,premultipliedAlpha:F,antialias:I,stencil:q,preserveDrawingBuffer:R};Nt=P||D.getContext("webgl",e)||D.getContext("experimental-webgl",e);if(null===Nt)throw"Error creating WebGL context."}catch(t){console.error(t)}Ct=Nt.getExtension("OES_texture_float"),Nt.getExtension("OES_texture_float_linear"),kt=Nt.getExtension("OES_standard_derivatives"),Lt=Nt.getExtension("EXT_texture_filter_anisotropic")||Nt.getExtension("MOZ_EXT_texture_filter_anisotropic")||Nt.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),At=Nt.getExtension("WEBGL_compressed_texture_s3tc")||Nt.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Nt.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc"),Ct||console.log("THREE.WebGLRenderer: Float textures not supported."),kt||console.log("THREE.WebGLRenderer: Standard derivatives not supported."),Lt||console.log("THREE.WebGLRenderer: Anisotropic texture filtering not supported."),At||console.log("THREE.WebGLRenderer: S3TC compressed textures not supported."),void 0===Nt.getShaderPrecisionFormat&&(Nt.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})})(),Nt.clearColor(0,0,0,1),Nt.clearDepth(1),Nt.clearStencil(0),Nt.enable(Nt.DEPTH_TEST),Nt.depthFunc(Nt.LEQUAL),Nt.frontFace(Nt.CCW),Nt.cullFace(Nt.BACK),Nt.enable(Nt.CULL_FACE),Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.SRC_ALPHA,Nt.ONE_MINUS_SRC_ALPHA),Nt.viewport(ct,ht,pt,dt),Nt.clearColor(U.r,U.g,U.b,z),this.context=Nt;var Ot=Nt.getParameter(Nt.MAX_TEXTURE_IMAGE_UNITS),Mt=Nt.getParameter(Nt.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Nt.getParameter(Nt.MAX_TEXTURE_SIZE);var _t=Nt.getParameter(Nt.MAX_CUBE_MAP_TEXTURE_SIZE),Dt=Lt?Nt.getParameter(Lt.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0,Pt=0<Mt,Ht=Pt&&Ct;At&&Nt.getParameter(Nt.COMPRESSED_TEXTURE_FORMATS);var Bt=Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.HIGH_FLOAT),jt=Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.MEDIUM_FLOAT);Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.LOW_FLOAT);var Ft=Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.HIGH_FLOAT),It=Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.MEDIUM_FLOAT);Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.LOW_FLOAT),Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.HIGH_INT),Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.MEDIUM_INT),Nt.getShaderPrecisionFormat(Nt.VERTEX_SHADER,Nt.LOW_INT),Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.HIGH_INT),Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.MEDIUM_INT),Nt.getShaderPrecisionFormat(Nt.FRAGMENT_SHADER,Nt.LOW_INT);var qt=0<Bt.precision&&0<Ft.precision,Rt=0<jt.precision&&0<It.precision;"highp"!==H||qt||(Rt?(H="mediump",console.warn("WebGLRenderer: highp not supported, using mediump")):(H="lowp",console.warn("WebGLRenderer: highp and mediump not supported, using lowp"))),"mediump"!==H||Rt||(H="lowp",console.warn("WebGLRenderer: mediump not supported, using lowp")),this.getContext=function(){return Nt},this.supportsVertexTextures=function(){return Pt},this.supportsFloatTextures=function(){return Ct},this.supportsStandardDerivatives=function(){return kt},this.supportsCompressedTextureS3TC=function(){return At},this.getMaxAnisotropy=function(){return Dt},this.getPrecision=function(){return H},this.setSize=function(e,t,n){D.width=e*this.devicePixelRatio,D.height=t*this.devicePixelRatio,1!==this.devicePixelRatio&&!1!==n&&(D.style.width=e+"px",D.style.height=t+"px"),this.setViewport(0,0,e,t)},this.setViewport=function(e,t,n,r){ct=e*this.devicePixelRatio,ht=t*this.devicePixelRatio,pt=n*this.devicePixelRatio,dt=r*this.devicePixelRatio,Nt.viewport(ct,ht,pt,dt)},this.setScissor=function(e,t,n,r){Nt.scissor(e*this.devicePixelRatio,t*this.devicePixelRatio,n*this.devicePixelRatio,r*this.devicePixelRatio)},this.enableScissorTest=function(e){e?Nt.enable(Nt.SCISSOR_TEST):Nt.disable(Nt.SCISSOR_TEST)},this.setClearColor=function(e,t){U.set(e),z=void 0!==t?t:1,Nt.clearColor(U.r,U.g,U.b,z)},this.setClearColorHex=function(e,t){console.warn("DEPRECATED: .setClearColorHex() is being removed. Use .setClearColor() instead."),this.setClearColor(e,t)},this.getClearColor=function(){return U},this.getClearAlpha=function(){return z},this.clear=function(e,t,n){var r=0;if(void 0===e||e)r|=Nt.COLOR_BUFFER_BIT;if(void 0===t||t)r|=Nt.DEPTH_BUFFER_BIT;if(void 0===n||n)r|=Nt.STENCIL_BUFFER_BIT;Nt.clear(r)},this.clearColor=function(){Nt.clear(Nt.COLOR_BUFFER_BIT)},this.clearDepth=function(){Nt.clear(Nt.DEPTH_BUFFER_BIT)},this.clearStencil=function(){Nt.clear(Nt.STENCIL_BUFFER_BIT)},this.clearTarget=function(e,t,n,r){this.setRenderTarget(e),this.clear(t,n,r)},this.addPostPlugin=function(e){e.init(this),this.renderPluginsPost.push(e)},this.addPrePlugin=function(e){e.init(this),this.renderPluginsPre.push(e)},this.updateShadowMap=function(e,t){$=null,K=Q=ot=st=tt=-1,xt=!0,et=Z=-1,this.shadowMapPlugin.update(e,t)};var Ut=function(e){e=e.target,e.removeEventListener("dispose",Ut),e.__webglInit=void 0;if(e instanceof THREE.BufferGeometry){var t=e.attributes,n;for(n in t)void 0!==t[n].buffer&&Nt.deleteBuffer(t[n].buffer);W.info.memory.geometries--}if(e instanceof THREE.Geometry2)delete B[e.id],W.info.memory.geometries--;else if(void 0!==e.geometryGroups)for(var r in e.geometryGroups){n=e.geometryGroups[r];if(void 0!==n.numMorphTargets)for(var t=0,i=n.numMorphTargets;t<i;t++)Nt.deleteBuffer(n.__webglMorphTargetsBuffers[t]);if(void 0!==n.numMorphNormals)for(t=0,i=n.numMorphNormals;t<i;t++)Nt.deleteBuffer(n.__webglMorphNormalsBuffers[t]);Vt(n)}else Vt(e)},zt=function(e){e=e.target,e.removeEventListener("dispose",zt),e.image&&e.image.__webglTextureCube?Nt.deleteTexture(e.image.__webglTextureCube):e.__webglInit&&(e.__webglInit=!1,Nt.deleteTexture(e.__webglTexture)),W.info.memory.textures--},Wt=function(e){e=e.target,e.removeEventListener("dispose",Wt);if(e&&e.__webglTexture)if(Nt.deleteTexture(e.__webglTexture),e instanceof THREE.WebGLRenderTargetCube)for(var t=0;6>t;t++)Nt.deleteFramebuffer(e.__webglFramebuffer[t]),Nt.deleteRenderbuffer(e.__webglRenderbuffer[t]);else Nt.deleteFramebuffer(e.__webglFramebuffer),Nt.deleteRenderbuffer(e.__webglRenderbuffer);W.info.memory.textures--},Xt=function(e){e=e.target,e.removeEventListener("dispose",Xt),$t(e)},Vt=function(e){void 0!==e.__webglVertexBuffer&&Nt.deleteBuffer(e.__webglVertexBuffer),void 0!==e.__webglNormalBuffer&&Nt.deleteBuffer(e.__webglNormalBuffer),void 0!==e.__webglTangentBuffer&&Nt.deleteBuffer(e.__webglTangentBuffer),void 0!==e.__webglColorBuffer&&Nt.deleteBuffer(e.__webglColorBuffer),void 0!==e.__webglUVBuffer&&Nt.deleteBuffer(e.__webglUVBuffer),void 0!==e.__webglUV2Buffer&&Nt.deleteBuffer(e.__webglUV2Buffer),void 0!==e.__webglSkinIndicesBuffer&&Nt.deleteBuffer(e.__webglSkinIndicesBuffer),void 0!==e.__webglSkinWeightsBuffer&&Nt.deleteBuffer(e.__webglSkinWeightsBuffer),void 0!==e.__webglFaceBuffer&&Nt.deleteBuffer(e.__webglFaceBuffer),void 0!==e.__webglLineBuffer&&Nt.deleteBuffer(e.__webglLineBuffer),void 0!==e.__webglLineDistanceBuffer&&Nt.deleteBuffer(e.__webglLineDistanceBuffer);if(void 0!==e.__webglCustomAttributesList)for(var t in e.__webglCustomAttributesList)Nt.deleteBuffer(e.__webglCustomAttributesList[t].buffer);W.info.memory.geometries--},$t=function(e){var t=e.program;if(void 0!==t){e.program=void 0;var n,r,i=!1;e=0;for(n=X.length;e<n;e++)if(r=X[e],r.program===t){r.usedTimes--,0===r.usedTimes&&(i=!0);break}if(!0===i){i=[],e=0;for(n=X.length;e<n;e++)r=X[e],r.program!==t&&i.push(r);X=i,Nt.deleteProgram(t),W.info.memory.programs--}}};this.renderBufferImmediate=function(e,t,n){e.hasPositions&&!e.__webglVertexBuffer&&(e.__webglVertexBuffer=Nt.createBuffer()),e.hasNormals&&!e.__webglNormalBuffer&&(e.__webglNormalBuffer=Nt.createBuffer()),e.hasUvs&&!e.__webglUvBuffer&&(e.__webglUvBuffer=Nt.createBuffer()),e.hasColors&&!e.__webglColorBuffer&&(e.__webglColorBuffer=Nt.createBuffer()),e.hasPositions&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,e.positionArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(t.attributes.position),Nt.vertexAttribPointer(t.attributes.position,3,Nt.FLOAT,!1,0,0));if(e.hasNormals){Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglNormalBuffer);if(n.shading===THREE.FlatShading){var r,i,s,o,u,a,f,l,c,h,p,d=3*e.count;for(p=0;p<d;p+=9)h=e.normalArray,r=h[p],i=h[p+1],s=h[p+2],o=h[p+3],a=h[p+4],l=h[p+5],u=h[p+6],f=h[p+7],c=h[p+8],r=(r+o+u)/3,i=(i+a+f)/3,s=(s+l+c)/3,h[p]=r,h[p+1]=i,h[p+2]=s,h[p+3]=r,h[p+4]=i,h[p+5]=s,h[p+6]=r,h[p+7]=i,h[p+8]=s}Nt.bufferData(Nt.ARRAY_BUFFER,e.normalArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(t.attributes.normal),Nt.vertexAttribPointer(t.attributes.normal,3,Nt.FLOAT,!1,0,0)}e.hasUvs&&n.map&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglUvBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,e.uvArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(t.attributes.uv),Nt.vertexAttribPointer(t.attributes.uv,2,Nt.FLOAT,!1,0,0)),e.hasColors&&n.vertexColors!==THREE.NoColors&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,e.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,e.colorArray,Nt.DYNAMIC_DRAW),Nt.enableVertexAttribArray(t.attributes.color),Nt.vertexAttribPointer(t.attributes.color,3,Nt.FLOAT,!1,0,0)),Nt.drawArrays(Nt.TRIANGLES,0,e.count),e.count=0},this.renderBufferGeometry2=function(e,t,n,r,i,s){e=E(e,t,n,r,s).attributes,t={position:"vertices",normal:"normals",uv:"uvs"},n={position:3,normal:3,uv:2},r=B[i.id],a();for(var o in e)if(s=e[o],0<=s){var f=i[t[o]];void 0!==f&&0<f.length?(Nt.bindBuffer(Nt.ARRAY_BUFFER,r[t[o]]),u(s),Nt.vertexAttribPointer(s,n[o],Nt.FLOAT,!1,0,0)):3===n[o]?Nt.vertexAttrib3fv(s,[0,0,0]):2===n[o]&&Nt.vertexAttrib2fv(s,[0,0])}Nt.drawArrays(Nt.TRIANGLES,0,i.vertices.length/3)},this.renderBufferDirect=function(e,t,n,r,i,s){if(!1!==r.visible){var f,l,c,h;f=E(e,t,n,r,s),e=f.attributes,t=i.attributes,n=!1,f=16777215*i.id+2*f.id+(r.wireframe?1:0),f!==Q&&(Q=f,n=!0),n&&a();if(s instanceof THREE.Mesh)if(s=t.index){i=i.offsets,1<i.length&&(n=!0);for(var p=0,d=i.length;p<d;p++){var v=i[p].index;if(n){for(l in e)c=e[l],f=t[l],0<=c&&(f?(h=f.itemSize,Nt.bindBuffer(Nt.ARRAY_BUFFER,f.buffer),u(c),Nt.vertexAttribPointer(c,h,Nt.FLOAT,!1,0,v*h*4)):r.defaultAttributeValues&&(2===r.defaultAttributeValues[l].length?Nt.vertexAttrib2fv(c,r.defaultAttributeValues[l]):3===r.defaultAttributeValues[l].length&&Nt.vertexAttrib3fv(c,r.defaultAttributeValues[l])));Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,s.buffer)}Nt.drawElements(Nt.TRIANGLES,i[p].count,Nt.UNSIGNED_SHORT,2*i[p].start),W.info.render.calls++,W.info.render.vertices+=i[p].count,W.info.render.faces+=i[p].count/3}}else{if(n)for(l in e)"index"!==l&&(c=e[l],f=t[l],0<=c&&(f?(h=f.itemSize,Nt.bindBuffer(Nt.ARRAY_BUFFER,f.buffer),u(c),Nt.vertexAttribPointer(c,h,Nt.FLOAT,!1,0,0)):r.defaultAttributeValues&&r.defaultAttributeValues[l]&&(2===r.defaultAttributeValues[l].length?Nt.vertexAttrib2fv(c,r.defaultAttributeValues[l]):3===r.defaultAttributeValues[l].length&&Nt.vertexAttrib3fv(c,r.defaultAttributeValues[l]))));r=i.attributes.position,Nt.drawArrays(Nt.TRIANGLES,0,r.array.length/3),W.info.render.calls++,W.info.render.vertices+=r.array.length/3,W.info.render.faces+=r.array.length/3/3}else if(s instanceof THREE.ParticleSystem){if(n)for(l in e)c=e[l],f=t[l],0<=c&&(f?(h=f.itemSize,Nt.bindBuffer(Nt.ARRAY_BUFFER,f.buffer),u(c),Nt.vertexAttribPointer(c,h,Nt.FLOAT,!1,0,0)):r.defaultAttributeValues&&r.defaultAttributeValues[l]&&(2===r.defaultAttributeValues[l].length?Nt.vertexAttrib2fv(c,r.defaultAttributeValues[l]):3===r.defaultAttributeValues[l].length&&Nt.vertexAttrib3fv(c,r.defaultAttributeValues[l])));r=t.position,Nt.drawArrays(Nt.POINTS,0,r.array.length/3),W.info.render.calls++,W.info.render.points+=r.array.length/3}else if(s instanceof THREE.Line)if(l=s.type===THREE.LineStrip?Nt.LINE_STRIP:Nt.LINES,N(r.linewidth),s=t.index)for(i=i.offsets,1<i.length&&(n=!0),p=0,d=i.length;p<d;p++)v=i[p].index,n&&(o(r,e,t,v),Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,s.buffer)),Nt.drawElements(Nt.LINES,i[p].count,Nt.UNSIGNED_SHORT,2*i[p].start),W.info.render.calls++,W.info.render.vertices+=i[p].count;else n&&o(r,e,t,0),r=t.position,Nt.drawArrays(l,0,r.array.length/3),W.info.render.calls++,W.info.render.points+=r.array.length}},this.renderBuffer=function(e,t,n,r,i,s){if(!1!==r.visible){var o,f;n=E(e,t,n,r,s),e=n.attributes,t=!1,n=16777215*i.id+2*n.id+(r.wireframe?1:0),n!==Q&&(Q=n,t=!0),t&&a();if(!r.morphTargets&&0<=e.position)t&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglVertexBuffer),u(e.position),Nt.vertexAttribPointer(e.position,3,Nt.FLOAT,!1,0,0));else if(s.morphTargetBase){n=r.program.attributes,-1!==s.morphTargetBase&&0<=n.position?(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[s.morphTargetBase]),u(n.position),Nt.vertexAttribPointer(n.position,3,Nt.FLOAT,!1,0,0)):0<=n.position&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglVertexBuffer),u(n.position),Nt.vertexAttribPointer(n.position,3,Nt.FLOAT,!1,0,0));if(s.morphTargetForcedOrder.length){var c=0;f=s.morphTargetForcedOrder;for(o=s.morphTargetInfluences;c<r.numSupportedMorphTargets&&c<f.length;)0<=n["morphTarget"+c]&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[f[c]]),u(n["morphTarget"+c]),Nt.vertexAttribPointer(n["morphTarget"+c],3,Nt.FLOAT,!1,0,0)),0<=n["morphNormal"+c]&&r.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[f[c]]),u(n["morphNormal"+c]),Nt.vertexAttribPointer(n["morphNormal"+c],3,Nt.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[c]=o[f[c]],c++}else{f=[],o=s.morphTargetInfluences;var h,p=o.length;for(h=0;h<p;h++)c=o[h],0<c&&f.push([c,h]);f.length>r.numSupportedMorphTargets?(f.sort(l),f.length=r.numSupportedMorphTargets):f.length>r.numSupportedMorphNormals?f.sort(l):0===f.length&&f.push([0,0]);for(c=0;c<r.numSupportedMorphTargets;)f[c]?(h=f[c][1],0<=n["morphTarget"+c]&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglMorphTargetsBuffers[h]),u(n["morphTarget"+c]),Nt.vertexAttribPointer(n["morphTarget"+c],3,Nt.FLOAT,!1,0,0)),0<=n["morphNormal"+c]&&r.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglMorphNormalsBuffers[h]),u(n["morphNormal"+c]),Nt.vertexAttribPointer(n["morphNormal"+c],3,Nt.FLOAT,!1,0,0)),s.__webglMorphTargetInfluences[c]=o[h]):s.__webglMorphTargetInfluences[c]=0,c++}null!==r.program.uniforms.morphTargetInfluences&&Nt.uniform1fv(r.program.uniforms.morphTargetInfluences,s.__webglMorphTargetInfluences)}if(t){if(i.__webglCustomAttributesList)for(o=0,f=i.__webglCustomAttributesList.length;o<f;o++)n=i.__webglCustomAttributesList[o],0<=e[n.buffer.belongsToAttribute]&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,n.buffer),u(e[n.buffer.belongsToAttribute]),Nt.vertexAttribPointer(e[n.buffer.belongsToAttribute],n.size,Nt.FLOAT,!1,0,0));0<=e.color&&(0<s.geometry.colors.length||0<s.geometry.faces.length?(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglColorBuffer),u(e.color),Nt.vertexAttribPointer(e.color,3,Nt.FLOAT,!1,0,0)):r.defaultAttributeValues&&Nt.vertexAttrib3fv(e.color,r.defaultAttributeValues.color)),0<=e.normal&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglNormalBuffer),u(e.normal),Nt.vertexAttribPointer(e.normal,3,Nt.FLOAT,!1,0,0)),0<=e.tangent&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglTangentBuffer),u(e.tangent),Nt.vertexAttribPointer(e.tangent,4,Nt.FLOAT,!1,0,0)),0<=e.uv&&(s.geometry.faceVertexUvs[0]?(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglUVBuffer),u(e.uv),Nt.vertexAttribPointer(e.uv,2,Nt.FLOAT,!1,0,0)):r.defaultAttributeValues&&Nt.vertexAttrib2fv(e.uv,r.defaultAttributeValues.uv)),0<=e.uv2&&(s.geometry.faceVertexUvs[1]?(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglUV2Buffer),u(e.uv2),Nt.vertexAttribPointer(e.uv2,2,Nt.FLOAT,!1,0,0)):r.defaultAttributeValues&&Nt.vertexAttrib2fv(e.uv2,r.defaultAttributeValues.uv2)),r.skinning&&0<=e.skinIndex&&0<=e.skinWeight&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglSkinIndicesBuffer),u(e.skinIndex),Nt.vertexAttribPointer(e.skinIndex,4,Nt.FLOAT,!1,0,0),Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglSkinWeightsBuffer),u(e.skinWeight),Nt.vertexAttribPointer(e.skinWeight,4,Nt.FLOAT,!1,0,0)),0<=e.lineDistance&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,i.__webglLineDistanceBuffer),u(e.lineDistance),Nt.vertexAttribPointer(e.lineDistance,1,Nt.FLOAT,!1,0,0))}s instanceof THREE.Mesh?(r.wireframe?(N(r.wireframeLinewidth),t&&Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,i.__webglLineBuffer),Nt.drawElements(Nt.LINES,i.__webglLineCount,Nt.UNSIGNED_SHORT,0)):(t&&Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,i.__webglFaceBuffer),Nt.drawElements(Nt.TRIANGLES,i.__webglFaceCount,Nt.UNSIGNED_SHORT,0)),W.info.render.calls++,W.info.render.vertices+=i.__webglFaceCount,W.info.render.faces+=i.__webglFaceCount/3):s instanceof THREE.Line?(s=s.type===THREE.LineStrip?Nt.LINE_STRIP:Nt.LINES,N(r.linewidth),Nt.drawArrays(s,0,i.__webglLineCount),W.info.render.calls++):s instanceof THREE.ParticleSystem&&(Nt.drawArrays(Nt.POINTS,0,i.__webglParticleCount),W.info.render.calls++,W.info.render.points+=i.__webglParticleCount)}},this.render=function(e,t,n,r){if(0==t instanceof THREE.Camera)console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");else{var i,s,o,u,a=e.__lights,l=e.fog;K=-1,xt=!0,!0===e.autoUpdate&&e.updateMatrixWorld(),void 0===t.parent&&t.updateMatrixWorld(),t.matrixWorldInverse.getInverse(t.matrixWorld),bt.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),yt.setFromMatrix(bt),this.autoUpdateObjects&&this.initWebGLObjects(e),c(this.renderPluginsPre,e,t),W.info.render.calls=0,W.info.render.vertices=0,W.info.render.faces=0,W.info.render.points=0,this.setRenderTarget(n),(this.autoClear||r)&&this.clear(this.autoClearColor,this.autoClearDepth,this.autoClearStencil),u=e.__webglObjects,r=0;for(i=u.length;r<i;r++)if(s=u[r],o=s.object,s.id=r,s.render=!1,o.visible&&(!(o instanceof THREE.Mesh||o instanceof THREE.ParticleSystem)||!o.frustumCulled||yt.intersectsObject(o))){var d=o;d._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,d.matrixWorld),d._normalMatrix.getNormalMatrix(d._modelViewMatrix);var d=s,v=d.object,m=d.buffer,g=v.geometry,v=v.material;v instanceof THREE.MeshFaceMaterial?(v=v.materials[g instanceof THREE.BufferGeometry?0:m.materialIndex],v.transparent?(d.transparent=v,d.opaque=null):(d.opaque=v,d.transparent=null)):v&&(v.transparent?(d.transparent=v,d.opaque=null):(d.opaque=v,d.transparent=null)),s.render=!0,!0===this.sortObjects&&(null!==o.renderDepth?s.z=o.renderDepth:(Et.setFromMatrixPosition(o.matrixWorld),Et.applyProjection(bt),s.z=Et.z))}this.sortObjects&&u.sort(f),u=e.__webglObjectsImmediate,r=0;for(i=u.length;r<i;r++)s=u[r],o=s.object,o.visible&&(o._modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,o.matrixWorld),o._normalMatrix.getNormalMatrix(o._modelViewMatrix),o=s.object.material,o.transparent?(s.transparent=o,s.opaque=null):(s.opaque=o,s.transparent=null));e.overrideMaterial?(r=e.overrideMaterial,this.setBlending(r.blending,r.blendEquation,r.blendSrc,r.blendDst),this.setDepthTest(r.depthTest),this.setDepthWrite(r.depthWrite),C(r.polygonOffset,r.polygonOffsetFactor,r.polygonOffsetUnits),h(e.__webglObjects,!1,"",t,a,l,!0,r),p(e.__webglObjectsImmediate,"",t,a,l,!1,r)):(r=null,this.setBlending(THREE.NoBlending),h(e.__webglObjects,!0,"opaque",t,a,l,!1,r),p(e.__webglObjectsImmediate,"opaque",t,a,l,!1,r),h(e.__webglObjects,!1,"transparent",t,a,l,!0,r),p(e.__webglObjectsImmediate,"transparent",t,a,l,!0,r)),c(this.renderPluginsPost,e,t),n&&n.generateMipmaps&&n.minFilter!==THREE.NearestFilter&&n.minFilter!==THREE.LinearFilter&&(n instanceof THREE.WebGLRenderTargetCube?(Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,n.__webglTexture),Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP),Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,null)):(Nt.bindTexture(Nt.TEXTURE_2D,n.__webglTexture),Nt.generateMipmap(Nt.TEXTURE_2D),Nt.bindTexture(Nt.TEXTURE_2D,null))),this.setDepthTest(!0),this.setDepthWrite(!0)}},this.renderImmediateObject=function(e,t,n,r,i){var s=E(e,t,n,r,i);Q=-1,W.setMaterialFaces(r),i.immediateRenderCallback?i.immediateRenderCallback(s,Nt,yt):i.render(function(e){W.renderBufferImmediate(e,s,r)})},this.initWebGLObjects=function(e){e.__webglObjects||(e.__webglObjects=[],e.__webglObjectsImmediate=[],e.__webglSprites=[],e.__webglFlares=[]);for(;e.__objectsAdded.length;)d(e.__objectsAdded[0],e),e.__objectsAdded.splice(0,1);for(;e.__objectsRemoved.length;)y(e.__objectsRemoved[0],e),e.__objectsRemoved.splice(0,1);for(var t=0,o=e.__webglObjects.length;t<o;t++){var u=e.__webglObjects[t].object;void 0===u.__webglInit&&(void 0!==u.__webglActive&&y(u,e),d(u,e));var a=u,f=a.geometry,c=void 0,h=void 0,p=void 0;if(f instanceof THREE.BufferGeometry){var v=Nt.DYNAMIC_DRAW,b=f.attributes,w=void 0,E=void 0;for(w in b)E=b[w],E.needsUpdate&&("index"===w?(Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,E.buffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,E.array,v)):(Nt.bindBuffer(Nt.ARRAY_BUFFER,E.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,E.array,v)),E.needsUpdate=!1)}else if(f instanceof THREE.Geometry2){var S=f,x=Nt.DYNAMIC_DRAW;if(!1!==S.needsUpdate){var T=["vertices","normals","uvs"],N=B[S.id],C=void 0;for(C in T){var k=S[T[C]];Nt.bindBuffer(Nt.ARRAY_BUFFER,N[T[C]]),Nt.bufferData(Nt.ARRAY_BUFFER,k,x)}S.needsUpdate=!1}}else if(a instanceof THREE.Mesh){for(var L=0,A=f.geometryGroupsList.length;L<A;L++)if(c=f.geometryGroupsList[L],p=r(a,c),f.buffersNeedUpdate&&n(c,a),h=p.attributes&&m(p),f.verticesNeedUpdate||f.morphTargetsNeedUpdate||f.elementsNeedUpdate||f.uvsNeedUpdate||f.normalsNeedUpdate||f.colorsNeedUpdate||f.tangentsNeedUpdate||h){var O=c,M=a,_=Nt.DYNAMIC_DRAW,D=!f.dynamic,P=p;if(O.__inittedArrays){var H=i(P),j=P.vertexColors?P.vertexColors:!1,F=s(P),I=H===THREE.SmoothShading,q=void 0,R=void 0,U=void 0,z=void 0,W=void 0,X=void 0,V=void 0,$=void 0,J=void 0,K=void 0,Q=void 0,G=void 0,Y=void 0,Z=void 0,et=void 0,tt=void 0,nt=void 0,rt=void 0,it=void 0,st=void 0,ot=void 0,ut=void 0,at=void 0,ft=void 0,lt=void 0,ct=void 0,ht=void 0,pt=void 0,dt=void 0,vt=void 0,mt=void 0,gt=void 0,yt=void 0,St=void 0,xt=void 0,Tt=void 0,Ct=void 0,kt=void 0,Lt=void 0,At=void 0,Ot=0,Mt=0,_t=0,Dt=0,Pt=0,Ht=0,Bt=0,jt=0,Ft=0,It=0,qt=0,Rt=0,Ut=void 0,zt=O.__vertexArray,Wt=O.__uvArray,Xt=O.__uv2Array,Vt=O.__normalArray,$t=O.__tangentArray,Jt=O.__colorArray,Kt=O.__skinIndexArray,Qt=O.__skinWeightArray,Gt=O.__morphTargetsArrays,Yt=O.__morphNormalsArrays,Zt=O.__webglCustomAttributesList,en=void 0,tn=O.__faceArray,nn=O.__lineArray,rn=M.geometry,sn=rn.elementsNeedUpdate,on=rn.uvsNeedUpdate,un=rn.normalsNeedUpdate,an=rn.tangentsNeedUpdate,fn=rn.colorsNeedUpdate,ln=rn.morphTargetsNeedUpdate,cn=rn.vertices,hn=O.faces3,pn=rn.faces,dn=rn.faceVertexUvs[0],vn=rn.faceVertexUvs[1],mn=rn.skinIndices,gn=rn.skinWeights,yn=rn.morphTargets,bn=rn.morphNormals;if(rn.verticesNeedUpdate){q=0;for(R=hn.length;q<R;q++)z=pn[hn[q]],G=cn[z.a],Y=cn[z.b],Z=cn[z.c],zt[Mt]=G.x,zt[Mt+1]=G.y,zt[Mt+2]=G.z,zt[Mt+3]=Y.x,zt[Mt+4]=Y.y,zt[Mt+5]=Y.z,zt[Mt+6]=Z.x,zt[Mt+7]=Z.y,zt[Mt+8]=Z.z,Mt+=9;Nt.bindBuffer(Nt.ARRAY_BUFFER,O.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,zt,_)}if(ln)for(xt=0,Tt=yn.length;xt<Tt;xt++){q=qt=0;for(R=hn.length;q<R;q++)Lt=hn[q],z=pn[Lt],G=yn[xt].vertices[z.a],Y=yn[xt].vertices[z.b],Z=yn[xt].vertices[z.c],Ct=Gt[xt],Ct[qt]=G.x,Ct[qt+1]=G.y,Ct[qt+2]=G.z,Ct[qt+3]=Y.x,Ct[qt+4]=Y.y,Ct[qt+5]=Y.z,Ct[qt+6]=Z.x,Ct[qt+7]=Z.y,Ct[qt+8]=Z.z,P.morphNormals&&(I?(At=bn[xt].vertexNormals[Lt],rt=At.a,it=At.b,st=At.c):st=it=rt=bn[xt].faceNormals[Lt],kt=Yt[xt],kt[qt]=rt.x,kt[qt+1]=rt.y,kt[qt+2]=rt.z,kt[qt+3]=it.x,kt[qt+4]=it.y,kt[qt+5]=it.z,kt[qt+6]=st.x,kt[qt+7]=st.y,kt[qt+8]=st.z),qt+=9;Nt.bindBuffer(Nt.ARRAY_BUFFER,O.__webglMorphTargetsBuffers[xt]),Nt.bufferData(Nt.ARRAY_BUFFER,Gt[xt],_),P.morphNormals&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,O.__webglMorphNormalsBuffers[xt]),Nt.bufferData(Nt.ARRAY_BUFFER,Yt[xt],_))}if(gn.length){q=0;for(R=hn.length;q<R;q++)z=pn[hn[q]],ft=gn[z.a],lt=gn[z.b],ct=gn[z.c],Qt[It]=ft.x,Qt[It+1]=ft.y,Qt[It+2]=ft.z,Qt[It+3]=ft.w,Qt[It+4]=lt.x,Qt[It+5]=lt.y,Qt[It+6]=lt.z,Qt[It+7]=lt.w,Qt[It+8]=ct.x,Qt[It+9]=ct.y,Qt[It+10]=ct.z,Qt[It+11]=ct.w,ht=mn[z.a],pt=mn[z.b],dt=mn[z.c],Kt[It]=ht.x,Kt[It+1]=ht.y,Kt[It+2]=ht.z,Kt[It+3]=ht.w,Kt[It+4]=pt.x,Kt[It+5]=pt.y,Kt[It+6]=pt.z,Kt[It+7]=pt.w,Kt[It+8]=dt.x,Kt[It+9]=dt.y,Kt[It+10]=dt.z,Kt[It+11]=dt.w,It+=12;0<It&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,O.__webglSkinIndicesBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Kt,_),Nt.bindBuffer(Nt.ARRAY_BUFFER,O.__webglSkinWeightsBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Qt,_))}if(fn&&j){q=0;for(R=hn.length;q<R;q++)z=pn[hn[q]],V=z.vertexColors,$=z.color,3===V.length&&j===THREE.VertexColors?(ot=V[0],ut=V[1],at=V[2]):at=ut=ot=$,Jt[Ft]=ot.r,Jt[Ft+1]=ot.g,Jt[Ft+2]=ot.b,Jt[Ft+3]=ut.r,Jt[Ft+4]=ut.g,Jt[Ft+5]=ut.b,Jt[Ft+6]=at.r,Jt[Ft+7]=at.g,Jt[Ft+8]=at.b,Ft+=9;0<Ft&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,O.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Jt,_))}if(an&&rn.hasTangents){q=0;for(R=hn.length;q<R;q++)z=pn[hn[q]],J=z.vertexTangents,et=J[0],tt=J[1],nt=J[2],$t[Bt]=et.x,$t[Bt+1]=et.y,$t[Bt+2]=et.z,$t[Bt+3]=et.w,$t[Bt+4]=tt.x,$t[Bt+5]=tt.y,$t[Bt+6]=tt.z,$t[Bt+7]=tt.w,$t[Bt+8]=nt.x,$t[Bt+9]=nt.y,$t[Bt+10]=nt.z,$t[Bt+11]=nt.w,Bt+=12;Nt.bindBuffer(Nt.ARRAY_BUFFER,O.__webglTangentBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,$t,_)}if(un&&H){q=0;for(R=hn.length;q<R;q++)if(z=pn[hn[q]],W=z.vertexNormals,X=z.normal,3===W.length&&I)for(vt=0;3>vt;vt++)gt=W[vt],Vt[Ht]=gt.x,Vt[Ht+1]=gt.y,Vt[Ht+2]=gt.z,Ht+=3;else for(vt=0;3>vt;vt++)Vt[Ht]=X.x,Vt[Ht+1]=X.y,Vt[Ht+2]=X.z,Ht+=3;Nt.bindBuffer(Nt.ARRAY_BUFFER,O.__webglNormalBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Vt,_)}if(on&&dn&&F){q=0;for(R=hn.length;q<R;q++)if(U=hn[q],K=dn[U],void 0!==K)for(vt=0;3>vt;vt++)yt=K[vt],Wt[_t]=yt.x,Wt[_t+1]=yt.y,_t+=2;0<_t&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,O.__webglUVBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Wt,_))}if(on&&vn&&F){q=0;for(R=hn.length;q<R;q++)if(U=hn[q],Q=vn[U],void 0!==Q)for(vt=0;3>vt;vt++)St=Q[vt],Xt[Dt]=St.x,Xt[Dt+1]=St.y,Dt+=2;0<Dt&&(Nt.bindBuffer(Nt.ARRAY_BUFFER,O.__webglUV2Buffer),Nt.bufferData(Nt.ARRAY_BUFFER,Xt,_))}if(sn){q=0;for(R=hn.length;q<R;q++)tn[Pt]=Ot,tn[Pt+1]=Ot+1,tn[Pt+2]=Ot+2,Pt+=3,nn[jt]=Ot,nn[jt+1]=Ot+1,nn[jt+2]=Ot,nn[jt+3]=Ot+2,nn[jt+4]=Ot+1,nn[jt+5]=Ot+2,jt+=6,Ot+=3;Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,O.__webglFaceBuffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,tn,_),Nt.bindBuffer(Nt.ELEMENT_ARRAY_BUFFER,O.__webglLineBuffer),Nt.bufferData(Nt.ELEMENT_ARRAY_BUFFER,nn,_)}if(Zt)for(vt=0,mt=Zt.length;vt<mt;vt++)if(en=Zt[vt],en.__original.needsUpdate){Rt=0;if(1===en.size){if(void 0===en.boundTo||"vertices"===en.boundTo)for(q=0,R=hn.length;q<R;q++)z=pn[hn[q]],en.array[Rt]=en.value[z.a],en.array[Rt+1]=en.value[z.b],en.array[Rt+2]=en.value[z.c],Rt+=3;else if("faces"===en.boundTo)for(q=0,R=hn.length;q<R;q++)Ut=en.value[hn[q]],en.array[Rt]=Ut,en.array[Rt+1]=Ut,en.array[Rt+2]=Ut,Rt+=3}else if(2===en.size){if(void 0===en.boundTo||"vertices"===en.boundTo)for(q=0,R=hn.length;q<R;q++)z=pn[hn[q]],G=en.value[z.a],Y=en.value[z.b],Z=en.value[z.c],en.array[Rt]=G.x,en.array[Rt+1]=G.y,en.array[Rt+2]=Y.x,en.array[Rt+3]=Y.y,en.array[Rt+4]=Z.x,en.array[Rt+5]=Z.y,Rt+=6;else if("faces"===en.boundTo)for(q=0,R=hn.length;q<R;q++)Z=Y=G=Ut=en.value[hn[q]],en.array[Rt]=G.x,en.array[Rt+1]=G.y,en.array[Rt+2]=Y.x,en.array[Rt+3]=Y.y,en.array[Rt+4]=Z.x,en.array[Rt+5]=Z.y,Rt+=6}else if(3===en.size){var wn;wn="c"===en.type?["r","g","b"]:["x","y","z"];if(void 0===en.boundTo||"vertices"===en.boundTo)for(q=0,R=hn.length;q<R;q++)z=pn[hn[q]],G=en.value[z.a],Y=en.value[z.b],Z=en.value[z.c],en.array[Rt]=G[wn[0]],en.array[Rt+1]=G[wn[1]],en.array[Rt+2]=G[wn[2]],en.array[Rt+3]=Y[wn[0]],en.array[Rt+4]=Y[wn[1]],en.array[Rt+5]=Y[wn[2]],en.array[Rt+6]=Z[wn[0]],en.array[Rt+7]=Z[wn[1]],en.array[Rt+8]=Z[wn[2]],Rt+=9;else if("faces"===en.boundTo)for(q=0,R=hn.length;q<R;q++)Z=Y=G=Ut=en.value[hn[q]],en.array[Rt]=G[wn[0]],en.array[Rt+1]=G[wn[1]],en.array[Rt+2]=G[wn[2]],en.array[Rt+3]=Y[wn[0]],en.array[Rt+4]=Y[wn[1]],en.array[Rt+5]=Y[wn[2]],en.array[Rt+6]=Z[wn[0]],en.array[Rt+7]=Z[wn[1]],en.array[Rt+8]=Z[wn[2]],Rt+=9;else if("faceVertices"===en.boundTo)for(q=0,R=hn.length;q<R;q++)Ut=en.value[hn[q]],G=Ut[0],Y=Ut[1],Z=Ut[2],en.array[Rt]=G[wn[0]],en.array[Rt+1]=G[wn[1]],en.array[Rt+2]=G[wn[2]],en.array[Rt+3]=Y[wn[0]],en.array[Rt+4]=Y[wn[1]],en.array[Rt+5]=Y[wn[2]],en.array[Rt+6]=Z[wn[0]],en.array[Rt+7]=Z[wn[1]],en.array[Rt+8]=Z[wn[2]],Rt+=9}else if(4===en.size)if(void 0===en.boundTo||"vertices"===en.boundTo)for(q=0,R=hn.length;q<R;q++)z=pn[hn[q]],G=en.value[z.a],Y=en.value[z.b],Z=en.value[z.c],en.array[Rt]=G.x,en.array[Rt+1]=G.y,en.array[Rt+2]=G.z,en.array[Rt+3]=G.w,en.array[Rt+4]=Y.x,en.array[Rt+5]=Y.y,en.array[Rt+6]=Y.z,en.array[Rt+7]=Y.w,en.array[Rt+8]=Z.x,en.array[Rt+9]=Z.y,en.array[Rt+10]=Z.z,en.array[Rt+11]=Z.w,Rt+=12;else if("faces"===en.boundTo)for(q=0,R=hn.length;q<R;q++)Z=Y=G=Ut=en.value[hn[q]],en.array[Rt]=G.x,en.array[Rt+1]=G.y,en.array[Rt+2]=G.z,en.array[Rt+3]=G.w,en.array[Rt+4]=Y.x,en.array[Rt+5]=Y.y,en.array[Rt+6]=Y.z,en.array[Rt+7]=Y.w,en.array[Rt+8]=Z.x,en.array[Rt+9]=Z.y,en.array[Rt+10]=Z.z,en.array[Rt+11]=Z.w,Rt+=12;else if("faceVertices"===en.boundTo)for(q=0,R=hn.length;q<R;q++)Ut=en.value[hn[q]],G=Ut[0],Y=Ut[1],Z=Ut[2],en.array[Rt]=G.x,en.array[Rt+1]=G.y,en.array[Rt+2]=G.z,en.array[Rt+3]=G.w,en.array[Rt+4]=Y.x,en.array[Rt+5]=Y.y,en.array[Rt+6]=Y.z,en.array[Rt+7]=Y.w,en.array[Rt+8]=Z.x,en.array[Rt+9]=Z.y,en.array[Rt+10]=Z.z,en.array[Rt+11]=Z.w,Rt+=12;Nt.bindBuffer(Nt.ARRAY_BUFFER,en.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,en.array,_)}D&&(delete O.__inittedArrays,delete O.__colorArray,delete O.__normalArray,delete O.__tangentArray,delete O.__uvArray,delete O.__uv2Array,delete O.__faceArray,delete O.__vertexArray,delete O.__lineArray,delete O.__skinIndexArray,delete O.__skinWeightArray)}}f.verticesNeedUpdate=!1,f.morphTargetsNeedUpdate=!1,f.elementsNeedUpdate=!1,f.uvsNeedUpdate=!1,f.normalsNeedUpdate=!1,f.colorsNeedUpdate=!1,f.tangentsNeedUpdate=!1,f.buffersNeedUpdate=!1,p.attributes&&g(p)}else if(a instanceof THREE.Line){p=r(a,f),h=p.attributes&&m(p);if(f.verticesNeedUpdate||f.colorsNeedUpdate||f.lineDistancesNeedUpdate||h){var En=f,Sn=Nt.DYNAMIC_DRAW,xn=void 0,Tn=void 0,Nn=void 0,Cn=void 0,kn=void 0,Ln=void 0,An=En.vertices,On=En.colors,Mn=En.lineDistances,_n=An.length,Dn=On.length,Pn=Mn.length,Hn=En.__vertexArray,Bn=En.__colorArray,jn=En.__lineDistanceArray,Fn=En.colorsNeedUpdate,In=En.lineDistancesNeedUpdate,qn=En.__webglCustomAttributesList,Rn=void 0,Un=void 0,zn=void 0,Wn=void 0,Xn=void 0,Vn=void 0;if(En.verticesNeedUpdate){for(xn=0;xn<_n;xn++)Cn=An[xn],kn=3*xn,Hn[kn]=Cn.x,Hn[kn+1]=Cn.y,Hn[kn+2]=Cn.z;Nt.bindBuffer(Nt.ARRAY_BUFFER,En.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Hn,Sn)}if(Fn){for(Tn=0;Tn<Dn;Tn++)Ln=On[Tn],kn=3*Tn,Bn[kn]=Ln.r,Bn[kn+1]=Ln.g,Bn[kn+2]=Ln.b;Nt.bindBuffer(Nt.ARRAY_BUFFER,En.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,Bn,Sn)}if(In){for(Nn=0;Nn<Pn;Nn++)jn[Nn]=Mn[Nn];Nt.bindBuffer(Nt.ARRAY_BUFFER,En.__webglLineDistanceBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,jn,Sn)}if(qn)for(Rn=0,Un=qn.length;Rn<Un;Rn++)if(Vn=qn[Rn],Vn.needsUpdate&&(void 0===Vn.boundTo||"vertices"===Vn.boundTo)){kn=0,Wn=Vn.value.length;if(1===Vn.size)for(zn=0;zn<Wn;zn++)Vn.array[zn]=Vn.value[zn];else if(2===Vn.size)for(zn=0;zn<Wn;zn++)Xn=Vn.value[zn],Vn.array[kn]=Xn.x,Vn.array[kn+1]=Xn.y,kn+=2;else if(3===Vn.size)if("c"===Vn.type)for(zn=0;zn<Wn;zn++)Xn=Vn.value[zn],Vn.array[kn]=Xn.r,Vn.array[kn+1]=Xn.g,Vn.array[kn+2]=Xn.b,kn+=3;else for(zn=0;zn<Wn;zn++)Xn=Vn.value[zn],Vn.array[kn]=Xn.x,Vn.array[kn+1]=Xn.y,Vn.array[kn+2]=Xn.z,kn+=3;else if(4===Vn.size)for(zn=0;zn<Wn;zn++)Xn=Vn.value[zn],Vn.array[kn]=Xn.x,Vn.array[kn+1]=Xn.y,Vn.array[kn+2]=Xn.z,Vn.array[kn+3]=Xn.w,kn+=4;Nt.bindBuffer(Nt.ARRAY_BUFFER,Vn.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,Vn.array,Sn)}}f.verticesNeedUpdate=!1,f.colorsNeedUpdate=!1,f.lineDistancesNeedUpdate=!1,p.attributes&&g(p)}else if(a instanceof THREE.ParticleSystem){p=r(a,f),h=p.attributes&&m(p);if(f.verticesNeedUpdate||f.colorsNeedUpdate||a.sortParticles||h){var $n=f,Jn=Nt.DYNAMIC_DRAW,Kn=a,Qn=void 0,Gn=void 0,Yn=void 0,Zn=void 0,er=void 0,tr=void 0,nr=$n.vertices,rr=nr.length,ir=$n.colors,sr=ir.length,or=$n.__vertexArray,ur=$n.__colorArray,ar=$n.__sortArray,fr=$n.verticesNeedUpdate,lr=$n.colorsNeedUpdate,cr=$n.__webglCustomAttributesList,hr=void 0,pr=void 0,dr=void 0,vr=void 0,mr=void 0,gr=void 0;if(Kn.sortParticles){wt.copy(bt),wt.multiply(Kn.matrixWorld);for(Qn=0;Qn<rr;Qn++)Yn=nr[Qn],Et.copy(Yn),Et.applyProjection(wt),ar[Qn]=[Et.z,Qn];ar.sort(l);for(Qn=0;Qn<rr;Qn++)Yn=nr[ar[Qn][1]],Zn=3*Qn,or[Zn]=Yn.x,or[Zn+1]=Yn.y,or[Zn+2]=Yn.z;for(Gn=0;Gn<sr;Gn++)Zn=3*Gn,tr=ir[ar[Gn][1]],ur[Zn]=tr.r,ur[Zn+1]=tr.g,ur[Zn+2]=tr.b;if(cr)for(hr=0,pr=cr.length;hr<pr;hr++)if(gr=cr[hr],void 0===gr.boundTo||"vertices"===gr.boundTo)if(Zn=0,vr=gr.value.length,1===gr.size)for(dr=0;dr<vr;dr++)er=ar[dr][1],gr.array[dr]=gr.value[er];else if(2===gr.size)for(dr=0;dr<vr;dr++)er=ar[dr][1],mr=gr.value[er],gr.array[Zn]=mr.x,gr.array[Zn+1]=mr.y,Zn+=2;else if(3===gr.size)if("c"===gr.type)for(dr=0;dr<vr;dr++)er=ar[dr][1],mr=gr.value[er],gr.array[Zn]=mr.r,gr.array[Zn+1]=mr.g,gr.array[Zn+2]=mr.b,Zn+=3;else for(dr=0;dr<vr;dr++)er=ar[dr][1],mr=gr.value[er],gr.array[Zn]=mr.x,gr.array[Zn+1]=mr.y,gr.array[Zn+2]=mr.z,Zn+=3;else if(4===gr.size)for(dr=0;dr<vr;dr++)er=ar[dr][1],mr=gr.value[er],gr.array[Zn]=mr.x,gr.array[Zn+1]=mr.y,gr.array[Zn+2]=mr.z,gr.array[Zn+3]=mr.w,Zn+=4}else{if(fr)for(Qn=0;Qn<rr;Qn++)Yn=nr[Qn],Zn=3*Qn,or[Zn]=Yn.x,or[Zn+1]=Yn.y,or[Zn+2]=Yn.z;if(lr)for(Gn=0;Gn<sr;Gn++)tr=ir[Gn],Zn=3*Gn,ur[Zn]=tr.r,ur[Zn+1]=tr.g,ur[Zn+2]=tr.b;if(cr)for(hr=0,pr=cr.length;hr<pr;hr++)if(gr=cr[hr],gr.needsUpdate&&(void 0===gr.boundTo||"vertices"===gr.boundTo))if(vr=gr.value.length,Zn=0,1===gr.size)for(dr=0;dr<vr;dr++)gr.array[dr]=gr.value[dr];else if(2===gr.size)for(dr=0;dr<vr;dr++)mr=gr.value[dr],gr.array[Zn]=mr.x,gr.array[Zn+1]=mr.y,Zn+=2;else if(3===gr.size)if("c"===gr.type)for(dr=0;dr<vr;dr++)mr=gr.value[dr],gr.array[Zn]=mr.r,gr.array[Zn+1]=mr.g,gr.array[Zn+2]=mr.b,Zn+=3;else for(dr=0;dr<vr;dr++)mr=gr.value[dr],gr.array[Zn]=mr.x,gr.array[Zn+1]=mr.y,gr.array[Zn+2]=mr.z,Zn+=3;else if(4===gr.size)for(dr=0;dr<vr;dr++)mr=gr.value[dr],gr.array[Zn]=mr.x,gr.array[Zn+1]=mr.y,gr.array[Zn+2]=mr.z,gr.array[Zn+3]=mr.w,Zn+=4}if(fr||Kn.sortParticles)Nt.bindBuffer(Nt.ARRAY_BUFFER,$n.__webglVertexBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,or,Jn);if(lr||Kn.sortParticles)Nt.bindBuffer(Nt.ARRAY_BUFFER,$n.__webglColorBuffer),Nt.bufferData(Nt.ARRAY_BUFFER,ur,Jn);if(cr)for(hr=0,pr=cr.length;hr<pr;hr++)if(gr=cr[hr],gr.needsUpdate||Kn.sortParticles)Nt.bindBuffer(Nt.ARRAY_BUFFER,gr.buffer),Nt.bufferData(Nt.ARRAY_BUFFER,gr.array,Jn)}f.verticesNeedUpdate=!1,f.colorsNeedUpdate=!1,p.attributes&&g(p)}}},this.initMaterial=function(e,t,n,r){var i,s,o,u;e.addEventListener("dispose",Xt);var a,f,l,c,h;e instanceof THREE.MeshDepthMaterial?h="depth":e instanceof THREE.MeshNormalMaterial?h="normal":e instanceof THREE.MeshBasicMaterial?h="basic":e instanceof THREE.MeshLambertMaterial?h="lambert":e instanceof THREE.MeshPhongMaterial?h="phong":e instanceof THREE.LineBasicMaterial?h="basic":e instanceof THREE.LineDashedMaterial?h="dashed":e instanceof THREE.ParticleSystemMaterial&&(h="particle_basic");if(h){var p=THREE.ShaderLib[h];e.uniforms=THREE.UniformsUtils.clone(p.uniforms),e.vertexShader=p.vertexShader,e.fragmentShader=p.fragmentShader}var d=i=0,v=0,m=p=0;for(s=t.length;m<s;m++)o=t[m],o.onlyShadow||(o instanceof THREE.DirectionalLight&&i++,o instanceof THREE.PointLight&&d++,o instanceof THREE.SpotLight&&v++,o instanceof THREE.HemisphereLight&&p++);s=d,o=v,u=p,v=p=0;for(d=t.length;v<d;v++)m=t[v],m.castShadow&&(m instanceof THREE.SpotLight&&p++,m instanceof THREE.DirectionalLight&&!m.shadowCascade&&p++);c=p,Ht&&r&&r.useVertexTexture?l=1024:(t=Nt.getParameter(Nt.MAX_VERTEX_UNIFORM_VECTORS),t=Math.floor((t-20)/4),void 0!==r&&r instanceof THREE.SkinnedMesh&&(t=Math.min(r.bones.length,t),t<r.bones.length&&console.warn("WebGLRenderer: too many bones - "+r.bones.length+", this GPU supports just "+t+" (try OpenGL instead of ANGLE)")),l=t);e:{v=e.fragmentShader,d=e.vertexShader,p=e.uniforms,t=e.attributes,m=e.defines,n={map:!!e.map,envMap:!!e.envMap,lightMap:!!e.lightMap,bumpMap:!!e.bumpMap,normalMap:!!e.normalMap,specularMap:!!e.specularMap,vertexColors:e.vertexColors,fog:n,useFog:e.fog,fogExp:n instanceof THREE.FogExp2,sizeAttenuation:e.sizeAttenuation,skinning:e.skinning,maxBones:l,useVertexTexture:Ht&&r&&r.useVertexTexture,morphTargets:e.morphTargets,morphNormals:e.morphNormals,maxMorphTargets:this.maxMorphTargets,maxMorphNormals:this.maxMorphNormals,maxDirLights:i,maxPointLights:s,maxSpotLights:o,maxHemiLights:u,maxShadows:c,shadowMapEnabled:this.shadowMapEnabled&&r.receiveShadow,shadowMapType:this.shadowMapType,shadowMapDebug:this.shadowMapDebug,shadowMapCascade:this.shadowMapCascade,alphaTest:e.alphaTest,metal:e.metal,wrapAround:e.wrapAround,doubleSided:e.side===THREE.DoubleSide,flipSided:e.side===THREE.BackSide},r=e.index0AttributeName;var g,y,b;i=[],h?i.push(h):(i.push(v),i.push(d));for(y in m)i.push(y),i.push(m[y]);for(g in n)i.push(g),i.push(n[g]);h=i.join(),g=0;for(y=X.length;g<y;g++)if(i=X[g],i.code===h){i.usedTimes++,f=i.program;break e}g="SHADOWMAP_TYPE_BASIC",n.shadowMapType===THREE.PCFShadowMap?g="SHADOWMAP_TYPE_PCF":n.shadowMapType===THREE.PCFSoftShadowMap&&(g="SHADOWMAP_TYPE_PCF_SOFT"),y=[];for(b in m)i=m[b],!1!==i&&(i="#define "+b+" "+i,y.push(i));i=y.join("\n"),b=Nt.createProgram(),y=["precision "+H+" float;","precision "+H+" int;",i,Pt?"#define VERTEX_TEXTURES":"",W.gammaInput?"#define GAMMA_INPUT":"",W.gammaOutput?"#define GAMMA_OUTPUT":"","#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,"#define MAX_BONES "+n.maxBones,n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.skinning?"#define USE_SKINNING":"",n.useVertexTexture?"#define BONE_TEXTURE":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals?"#define USE_MORPHNORMALS":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+g:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"","uniform mat4 modelMatrix;\nuniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform mat4 viewMatrix;\nuniform mat3 normalMatrix;\nuniform vec3 cameraPosition;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 uv;\nattribute vec2 uv2;\n#ifdef USE_COLOR\nattribute vec3 color;\n#endif\n#ifdef USE_MORPHTARGETS\nattribute vec3 morphTarget0;\nattribute vec3 morphTarget1;\nattribute vec3 morphTarget2;\nattribute vec3 morphTarget3;\n#ifdef USE_MORPHNORMALS\nattribute vec3 morphNormal0;\nattribute vec3 morphNormal1;\nattribute vec3 morphNormal2;\nattribute vec3 morphNormal3;\n#else\nattribute vec3 morphTarget4;\nattribute vec3 morphTarget5;\nattribute vec3 morphTarget6;\nattribute vec3 morphTarget7;\n#endif\n#endif\n#ifdef USE_SKINNING\nattribute vec4 skinIndex;\nattribute vec4 skinWeight;\n#endif\n"].join("\n"),g=["precision "+H+" float;","precision "+H+" int;",n.bumpMap||n.normalMap?"#extension GL_OES_standard_derivatives : enable":"",i,"#define MAX_DIR_LIGHTS "+n.maxDirLights,"#define MAX_POINT_LIGHTS "+n.maxPointLights,"#define MAX_SPOT_LIGHTS "+n.maxSpotLights,"#define MAX_HEMI_LIGHTS "+n.maxHemiLights,"#define MAX_SHADOWS "+n.maxShadows,n.alphaTest?"#define ALPHATEST "+n.alphaTest:"",W.gammaInput?"#define GAMMA_INPUT":"",W.gammaOutput?"#define GAMMA_OUTPUT":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.lightMap?"#define USE_LIGHTMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.vertexColors?"#define USE_COLOR":"",n.metal?"#define METAL":"",n.wrapAround?"#define WRAP_AROUND":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+g:"",n.shadowMapDebug?"#define SHADOWMAP_DEBUG":"",n.shadowMapCascade?"#define SHADOWMAP_CASCADE":"","uniform mat4 viewMatrix;\nuniform vec3 cameraPosition;\n"].join("\n"),y=L("vertex",y+d),g=L("fragment",g+v),Nt.attachShader(b,y),Nt.attachShader(b,g),void 0!==r?Nt.bindAttribLocation(b,0,r):Nt.bindAttribLocation(b,0,"position"),Nt.linkProgram(b),Nt.getProgramParameter(b,Nt.LINK_STATUS)||(console.error("Could not initialise shader\nVALIDATE_STATUS: "+Nt.getProgramParameter(b,Nt.VALIDATE_STATUS)+", gl error ["+Nt.getError()+"]"),console.error("Program Info Log: "+Nt.getProgramInfoLog(b))),Nt.deleteShader(g),Nt.deleteShader(y),b.uniforms={},b.attributes={};var w;g="viewMatrix modelViewMatrix projectionMatrix normalMatrix modelMatrix cameraPosition morphTargetInfluences".split(" "),n.useVertexTexture?(g.push("boneTexture"),g.push("boneTextureWidth"),g.push("boneTextureHeight")):g.push("boneGlobalMatrices");for(w in p)g.push(w);w=g,g=0;for(y=w.length;g<y;g++)p=w[g],b.uniforms[p]=Nt.getUniformLocation(b,p);g="position normal uv uv2 tangent color skinIndex skinWeight lineDistance".split(" ");for(w=0;w<n.maxMorphTargets;w++)g.push("morphTarget"+w);for(w=0;w<n.maxMorphNormals;w++)g.push("morphNormal"+w);for(f in t)g.push(f);f=g,w=0;for(t=f.length;w<t;w++)g=f[w],b.attributes[g]=Nt.getAttribLocation(b,g);b.id=V++,X.push({program:b,code:h,usedTimes:1}),W.info.memory.programs=X.length,f=b}e.program=f,w=e.program.attributes;if(e.morphTargets)for(e.numSupportedMorphTargets=0,t="morphTarget",f=0;f<this.maxMorphTargets;f++)b=t+f,0<=w[b]&&e.numSupportedMorphTargets++;if(e.morphNormals)for(e.numSupportedMorphNormals=0,t="morphNormal",f=0;f<this.maxMorphNormals;f++)b=t+f,0<=w[b]&&e.numSupportedMorphNormals++;e.uniformsList=[];for(a in e.uniforms)e.uniformsList.push([e.uniforms[a],a])},this.setFaceCulling=function(e,t){e===THREE.CullFaceNone?Nt.disable(Nt.CULL_FACE):(t===THREE.FrontFaceDirectionCW?Nt.frontFace(Nt.CW):Nt.frontFace(Nt.CCW),e===THREE.CullFaceBack?Nt.cullFace(Nt.BACK):e===THREE.CullFaceFront?Nt.cullFace(Nt.FRONT):Nt.cullFace(Nt.FRONT_AND_BACK),Nt.enable(Nt.CULL_FACE))},this.setMaterialFaces=function(e){var t=e.side===THREE.DoubleSide;e=e.side===THREE.BackSide,Z!==t&&(t?Nt.disable(Nt.CULL_FACE):Nt.enable(Nt.CULL_FACE),Z=t),et!==e&&(e?Nt.frontFace(Nt.CW):Nt.frontFace(Nt.CCW),et=e)},this.setDepthTest=function(e){st!==e&&(e?Nt.enable(Nt.DEPTH_TEST):Nt.disable(Nt.DEPTH_TEST),st=e)},this.setDepthWrite=function(e){ot!==e&&(Nt.depthMask(e),ot=e)},this.setBlending=function(e,t,n,r){e!==tt&&(e===THREE.NoBlending?Nt.disable(Nt.BLEND):e===THREE.AdditiveBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.SRC_ALPHA,Nt.ONE)):e===THREE.SubtractiveBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.ZERO,Nt.ONE_MINUS_SRC_COLOR)):e===THREE.MultiplyBlending?(Nt.enable(Nt.BLEND),Nt.blendEquation(Nt.FUNC_ADD),Nt.blendFunc(Nt.ZERO,Nt.SRC_COLOR)):e===THREE.CustomBlending?Nt.enable(Nt.BLEND):(Nt.enable(Nt.BLEND),Nt.blendEquationSeparate(Nt.FUNC_ADD,Nt.FUNC_ADD),Nt.blendFuncSeparate(Nt.SRC_ALPHA,Nt.ONE_MINUS_SRC_ALPHA,Nt.ONE,Nt.ONE_MINUS_SRC_ALPHA)),tt=e);if(e===THREE.CustomBlending){if(t!==nt&&(Nt.blendEquation(_(t)),nt=t),n!==rt||r!==it)Nt.blendFunc(_(n),_(r)),rt=n,it=r}else it=rt=nt=null},this.setTexture=function(e,t){if(e.needsUpdate){e.__webglInit||(e.__webglInit=!0,e.addEventListener("dispose",zt),e.__webglTexture=Nt.createTexture(),W.info.memory.textures++),Nt.activeTexture(Nt.TEXTURE0+t),Nt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture),Nt.pixelStorei(Nt.UNPACK_FLIP_Y_WEBGL,e.flipY),Nt.pixelStorei(Nt.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e.premultiplyAlpha),Nt.pixelStorei(Nt.UNPACK_ALIGNMENT,e.unpackAlignment);var n=e.image,r=THREE.Math.isPowerOfTwo(n.width)&&THREE.Math.isPowerOfTwo(n.height),i=_(e.format),s=_(e.type);A(Nt.TEXTURE_2D,e,r);var o=e.mipmaps;if(e instanceof THREE.DataTexture)if(0<o.length&&r){for(var u=0,a=o.length;u<a;u++)n=o[u],Nt.texImage2D(Nt.TEXTURE_2D,u,i,n.width,n.height,0,i,s,n.data);e.generateMipmaps=!1}else Nt.texImage2D(Nt.TEXTURE_2D,0,i,n.width,n.height,0,i,s,n.data);else if(e instanceof THREE.CompressedTexture)for(u=0,a=o.length;u<a;u++)n=o[u],e.format!==THREE.RGBAFormat?Nt.compressedTexImage2D(Nt.TEXTURE_2D,u,i,n.width,n.height,0,n.data):Nt.texImage2D(Nt.TEXTURE_2D,u,i,n.width,n.height,0,i,s,n.data);else if(0<o.length&&r){u=0;for(a=o.length;u<a;u++)n=o[u],Nt.texImage2D(Nt.TEXTURE_2D,u,i,i,s,n);e.generateMipmaps=!1}else Nt.texImage2D(Nt.TEXTURE_2D,0,i,i,s,e.image);e.generateMipmaps&&r&&Nt.generateMipmap(Nt.TEXTURE_2D),e.needsUpdate=!1,e.onUpdate&&e.onUpdate()}else Nt.activeTexture(Nt.TEXTURE0+t),Nt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture)},this.setRenderTarget=function(e){var t=e instanceof THREE.WebGLRenderTargetCube;if(e&&!e.__webglFramebuffer){void 0===e.depthBuffer&&(e.depthBuffer=!0),void 0===e.stencilBuffer&&(e.stencilBuffer=!0),e.addEventListener("dispose",Wt),e.__webglTexture=Nt.createTexture(),W.info.memory.textures++;var n=THREE.Math.isPowerOfTwo(e.width)&&THREE.Math.isPowerOfTwo(e.height),r=_(e.format),i=_(e.type);if(t){e.__webglFramebuffer=[],e.__webglRenderbuffer=[],Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,e.__webglTexture),A(Nt.TEXTURE_CUBE_MAP,e,n);for(var s=0;6>s;s++){e.__webglFramebuffer[s]=Nt.createFramebuffer(),e.__webglRenderbuffer[s]=Nt.createRenderbuffer(),Nt.texImage2D(Nt.TEXTURE_CUBE_MAP_POSITIVE_X+s,0,r,e.width,e.height,0,r,i,null);var o=e,u=Nt.TEXTURE_CUBE_MAP_POSITIVE_X+s;Nt.bindFramebuffer(Nt.FRAMEBUFFER,e.__webglFramebuffer[s]),Nt.framebufferTexture2D(Nt.FRAMEBUFFER,Nt.COLOR_ATTACHMENT0,u,o.__webglTexture,0),O(e.__webglRenderbuffer[s],e)}n&&Nt.generateMipmap(Nt.TEXTURE_CUBE_MAP)}else e.__webglFramebuffer=Nt.createFramebuffer(),e.__webglRenderbuffer=e.shareDepthFrom?e.shareDepthFrom.__webglRenderbuffer:Nt.createRenderbuffer(),Nt.bindTexture(Nt.TEXTURE_2D,e.__webglTexture),A(Nt.TEXTURE_2D,e,n),Nt.texImage2D(Nt.TEXTURE_2D,0,r,e.width,e.height,0,r,i,null),r=Nt.TEXTURE_2D,Nt.bindFramebuffer(Nt.FRAMEBUFFER,e.__webglFramebuffer),Nt.framebufferTexture2D(Nt.FRAMEBUFFER,Nt.COLOR_ATTACHMENT0,r,e.__webglTexture,0),e.shareDepthFrom?e.depthBuffer&&!e.stencilBuffer?Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_ATTACHMENT,Nt.RENDERBUFFER,e.__webglRenderbuffer):e.depthBuffer&&e.stencilBuffer&&Nt.framebufferRenderbuffer(Nt.FRAMEBUFFER,Nt.DEPTH_STENCIL_ATTACHMENT,Nt.RENDERBUFFER,e.__webglRenderbuffer):O(e.__webglRenderbuffer,e),n&&Nt.generateMipmap(Nt.TEXTURE_2D);t?Nt.bindTexture(Nt.TEXTURE_CUBE_MAP,null):Nt.bindTexture(Nt.TEXTURE_2D,null),Nt.bindRenderbuffer(Nt.RENDERBUFFER,null),Nt.bindFramebuffer(Nt.FRAMEBUFFER,null)}e?(t=t?e.__webglFramebuffer[e.activeCubeFace]:e.__webglFramebuffer,n=e.width,e=e.height,i=r=0):(t=null,n=pt,e=dt,r=ct,i=ht),t!==J&&(Nt.bindFramebuffer(Nt.FRAMEBUFFER,t),Nt.viewport(r,i,n,e),J=t),vt=n,mt=e},this.shadowMapPlugin=new THREE.ShadowMapPlugin,this.addPrePlugin(this.shadowMapPlugin),this.addPostPlugin(new THREE.SpritePlugin),this.addPostPlugin(new THREE.LensFlarePlugin)},THREE.WebGLRenderTarget=function(e,t,n){this.width=e,this.height=t,n=n||{},this.wrapS=void 0!==n.wrapS?n.wrapS:THREE.ClampToEdgeWrapping,this.wrapT=void 0!==n.wrapT?n.wrapT:THREE.ClampToEdgeWrapping,this.magFilter=void 0!==n.magFilter?n.magFilter:THREE.LinearFilter,this.minFilter=void 0!==n.minFilter?n.minFilter:THREE.LinearMipMapLinearFilter,this.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,this.offset=new THREE.Vector2(0,0),this.repeat=new THREE.Vector2(1,1),this.format=void 0!==n.format?n.format:THREE.RGBAFormat,this.type=void 0!==n.type?n.type:THREE.UnsignedByteType,this.depthBuffer=void 0!==n.depthBuffer?n.depthBuffer:!0,this.stencilBuffer=void 0!==n.stencilBuffer?n.stencilBuffer:!0,this.generateMipmaps=!0,this.shareDepthFrom=null},THREE.WebGLRenderTarget.prototype={constructor:THREE.WebGLRenderTarget,clone:function(){var e=new THREE.WebGLRenderTarget(this.width,this.height);return e.wrapS=this.wrapS,e.wrapT=this.wrapT,e.magFilter=this.magFilter,e.minFilter=this.minFilter,e.anisotropy=this.anisotropy,e.offset.copy(this.offset),e.repeat.copy(this.repeat),e.format=this.format,e.type=this.type,e.depthBuffer=this.depthBuffer,e.stencilBuffer=this.stencilBuffer,e.generateMipmaps=this.generateMipmaps,e.shareDepthFrom=this.shareDepthFrom,e},dispose:function(){this.dispatchEvent({type:"dispose"})}},THREE.EventDispatcher.prototype.apply(THREE.WebGLRenderTarget.prototype),THREE.WebGLRenderTargetCube=function(e,t,n){THREE.WebGLRenderTarget.call(this,e,t,n),this.activeCubeFace=0},THREE.WebGLRenderTargetCube.prototype=Object.create(THREE.WebGLRenderTarget.prototype),THREE.RenderableVertex=function(){this.position=new THREE.Vector3,this.positionWorld=new THREE.Vector3,this.positionScreen=new THREE.Vector4,this.visible=!0},THREE.RenderableVertex.prototype.copy=function(e){this.positionWorld.copy(e.positionWorld),this.positionScreen.copy(e.positionScreen)},THREE.RenderableFace=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.v3=new THREE.RenderableVertex,this.centroidModel=new THREE.Vector3,this.normalModel=new THREE.Vector3,this.vertexNormalsModel=[new THREE.Vector3,new THREE.Vector3,new THREE.Vector3],this.vertexNormalsLength=0,this.material=this.color=null,this.uvs=[[]],this.z=0},THREE.RenderableObject=function(){this.id=0,this.object=null,this.z=0},THREE.RenderableSprite=function(){this.id=0,this.object=null,this.rotation=this.z=this.y=this.x=0,this.scale=new THREE.Vector2,this.material=null},THREE.RenderableLine=function(){this.id=0,this.v1=new THREE.RenderableVertex,this.v2=new THREE.RenderableVertex,this.vertexColors=[new THREE.Color,new THREE.Color],this.material=null,this.z=0},THREE.GeometryUtils={merge:function(e,t,n){var r,i,s=e.vertices.length,o=t instanceof THREE.Mesh?t.geometry:t,u=e.vertices,a=o.vertices,f=e.faces,l=o.faces;e=e.faceVertexUvs[0],o=o.faceVertexUvs[0],void 0===n&&(n=0),t instanceof THREE.Mesh&&(t.matrixAutoUpdate&&t.updateMatrix(),r=t.matrix,i=(new THREE.Matrix3).getNormalMatrix(r)),t=0;for(var c=a.length;t<c;t++){var h=a[t].clone();r&&h.applyMatrix4(r),u.push(h)}t=0;for(c=l.length;t<c;t++){var h=l[t],p,d,v=h.vertexNormals,m=h.vertexColors;p=new THREE.Face3(h.a+s,h.b+s,h.c+s),p.normal.copy(h.normal),i&&p.normal.applyMatrix3(i).normalize(),u=0;for(a=v.length;u<a;u++)d=v[u].clone(),i&&d.applyMatrix3(i).normalize(),p.vertexNormals.push(d);p.color.copy(h.color),u=0;for(a=m.length;u<a;u++)d=m[u],p.vertexColors.push(d.clone());p.materialIndex=h.materialIndex+n,p.centroid.copy(h.centroid),r&&p.centroid.applyMatrix4(r),f.push(p)}t=0;for(c=o.length;t<c;t++){n=o[t],r=[],u=0;for(a=n.length;u<a;u++)r.push(new THREE.Vector2(n[u].x,n[u].y));e.push(r)}},randomPointInTriangle:function(){var e=new THREE.Vector3;return function(t,n,r){var i=new THREE.Vector3,s=THREE.Math.random16(),o=THREE.Math.random16();1<s+o&&(s=1-s,o=1-o);var u=1-s-o;return i.copy(t),i.multiplyScalar(s),e.copy(n),e.multiplyScalar(o),i.add(e),e.copy(r),e.multiplyScalar(u),i.add(e),i}}(),randomPointInFace:function(e,t,n){return THREE.GeometryUtils.randomPointInTriangle(t.vertices[e.a],t.vertices[e.b],t.vertices[e.c])},randomPointsInGeometry:function(e,t){function n(e){function t(n,r){if(r<n)return n;var i=n+Math.floor((r-n)/2);return f[i]>e?t(n,i-1):f[i]<e?t(i+1,r):i}return t(0,f.length-1)}var r,i,s=e.faces,o=e.vertices,u=s.length,a=0,f=[],l,c,h;for(i=0;i<u;i++)r=s[i],l=o[r.a],c=o[r.b],h=o[r.c],r._area=THREE.GeometryUtils.triangleArea(l,c,h),a+=r._area,f[i]=a;r=[];for(i=0;i<t;i++)o=THREE.Math.random16()*a,o=n(o),r[i]=THREE.GeometryUtils.randomPointInFace(s[o],e,!0);return r},triangleArea:function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(n,r,i){return e.subVectors(r,n),t.subVectors(i,n),e.cross(t),.5*e.length()}}(),center:function(e){e.computeBoundingBox();var t=e.boundingBox,n=new THREE.Vector3;return n.addVectors(t.min,t.max),n.multiplyScalar(-0.5),e.applyMatrix((new THREE.Matrix4).makeTranslation(n.x,n.y,n.z)),e.computeBoundingBox(),n},triangulateQuads:function(e){var t,n,r,i,s=[],o=[];t=0;for(n=e.faceVertexUvs.length;t<n;t++)o[t]=[];t=0;for(n=e.faces.length;t<n;t++)for(s.push(e.faces[t]),r=0,i=e.faceVertexUvs.length;r<i;r++)o[r].push(e.faceVertexUvs[r][t]);e.faces=s,e.faceVertexUvs=o,e.computeCentroids(),e.computeFaceNormals(),e.computeVertexNormals(),e.hasTangents&&e.computeTangents()}},THREE.ImageUtils={crossOrigin:void 0,loadTexture:function(e,t,n,r){r=new THREE.ImageLoader,r.crossOrigin=this.crossOrigin;var i=new THREE.Texture(void 0,t);return t=r.load(e,function(){i.needsUpdate=!0,n&&n(i)}),i.image=t,i.sourceFile=e,i},loadCompressedTexture:function(e,t,n,r){var i=new THREE.CompressedTexture;i.mapping=t;var s=new XMLHttpRequest;return s.onload=function(){var e=THREE.ImageUtils.parseDDS(s.response,!0);i.format=e.format,i.mipmaps=e.mipmaps,i.image.width=e.width,i.image.height=e.height,i.generateMipmaps=!1,i.needsUpdate=!0,n&&n(i)},s.onerror=r,s.open("GET",e,!0),s.responseType="arraybuffer",s.send(null),i},loadTextureCube:function(e,t,n,r){var i=[];i.loadCount=0;var s=new THREE.Texture;s.image=i,void 0!==t&&(s.mapping=t),s.flipY=!1,t=0;for(var o=e.length;t<o;++t){var u=new Image;i[t]=u,u.onload=function(){i.loadCount+=1,6===i.loadCount&&(s.needsUpdate=!0,n&&n(s))},u.onerror=r,u.crossOrigin=this.crossOrigin,u.src=e[t]}return s},loadCompressedTextureCube:function(e,t,n,r){var i=[];i.loadCount=0;var s=new THREE.CompressedTexture;s.image=i,void 0!==t&&(s.mapping=t),s.flipY=!1,s.generateMipmaps=!1,t=function(e,t){return function(){var r=THREE.ImageUtils.parseDDS(e.response,!0);t.format=r.format,t.mipmaps=r.mipmaps,t.width=r.width,t.height=r.height,i.loadCount+=1,6===i.loadCount&&(s.format=r.format,s.needsUpdate=!0,n&&n(s))}};if(e instanceof Array)for(var o=0,u=e.length;o<u;++o){var a={};i[o]=a;var f=new XMLHttpRequest;f.onload=t(f,a),f.onerror=r,a=e[o],f.open("GET",a,!0),f.responseType="arraybuffer",f.send(null)}else f=new XMLHttpRequest,f.onload=function(){var e=THREE.ImageUtils.parseDDS(f.response,!0);if(e.isCubemap){for(var t=e.mipmaps.length/e.mipmapCount,r=0;r<t;r++){i[r]={mipmaps:[]};for(var o=0;o<e.mipmapCount;o++)i[r].mipmaps.push(e.mipmaps[r*e.mipmapCount+o]),i[r].format=e.format,i[r].width=e.width,i[r].height=e.height}s.format=e.format,s.needsUpdate=!0,n&&n(s)}},f.onerror=r,f.open("GET",e,!0),f.responseType="arraybuffer",f.send(null);return s},loadDDSTexture:function(e,t,n,r){var i=[];i.loadCount=0;var s=new THREE.CompressedTexture;s.image=i,void 0!==t&&(s.mapping=t),s.flipY=!1,s.generateMipmaps=!1;var o=new XMLHttpRequest;return o.onload=function(){var e=THREE.ImageUtils.parseDDS(o.response,!0);if(e.isCubemap)for(var t=e.mipmaps.length/e.mipmapCount,r=0;r<t;r++){i[r]={mipmaps:[]};for(var u=0;u<e.mipmapCount;u++)i[r].mipmaps.push(e.mipmaps[r*e.mipmapCount+u]),i[r].format=e.format,i[r].width=e.width,i[r].height=e.height}else s.image.width=e.width,s.image.height=e.height,s.mipmaps=e.mipmaps;s.format=e.format,s.needsUpdate=!0,n&&n(s)},o.onerror=r,o.open("GET",e,!0),o.responseType="arraybuffer",o.send(null),s},parseDDS:function(e,t){function n(e){return e.charCodeAt(0)+(e.charCodeAt(1)<<8)+(e.charCodeAt(2)<<16)+(e.charCodeAt(3)<<24)}function r(e,t,n,r){var i=n*r*4;e=new Uint8Array(e,t,i);for(var i=new Uint8Array(i),s=t=0,o=0;o<r;o++)for(var u=0;u<n;u++){var a=e[s];s++;var f=e[s];s++;var l=e[s];s++;var c=e[s];s++,i[t]=l,t++,i[t]=f,t++,i[t]=a,t++,i[t]=c,t++}return i}var i={mipmaps:[],width:0,height:0,format:null,mipmapCount:1},s=n("DXT1"),o=n("DXT3"),u=n("DXT5"),a=new Int32Array(e,0,31);if(542327876!==a[0])return console.error("ImageUtils.parseDDS(): Invalid magic number in DDS header"),i;if(!a[20]&4)return console.error("ImageUtils.parseDDS(): Unsupported format, must contain a FourCC code"),i;var f=a[21],l=!1;switch(f){case s:s=8,i.format=THREE.RGB_S3TC_DXT1_Format;break;case o:s=16,i.format=THREE.RGBA_S3TC_DXT3_Format;break;case u:s=16,i.format=THREE.RGBA_S3TC_DXT5_Format;break;default:if(!(32==a[22]&&a[23]&16711680&&a[24]&65280&&a[25]&255&&a[26]&4278190080))return console.error("ImageUtils.parseDDS(): Unsupported FourCC code: ",String.fromCharCode(f&255,f>>8&255,f>>16&255,f>>24&255)),i;l=!0,s=64,i.format=THREE.RGBAFormat}i.mipmapCount=1,a[2]&131072&&!1!==t&&(i.mipmapCount=Math.max(1,a[7])),i.isCubemap=a[28]&512?!0:!1,i.width=a[4],i.height=a[3];for(var a=a[1]+4,o=i.width,u=i.height,f=i.isCubemap?6:1,c=0;c<f;c++){for(var h=0;h<i.mipmapCount;h++){if(l)var p=r(e,a,o,u),d=p.length;else d=Math.max(4,o)/4*Math.max(4,u)/4*s,p=new Uint8Array(e,a,d);i.mipmaps.push({data:p,width:o,height:u}),a+=d,o=Math.max(.5*o,1),u=Math.max(.5*u,1)}o=i.width,u=i.height}return i},getNormalMap:function(e,t){var n=function(e){var t=Math.sqrt(e[0]*e[0]+e[1]*e[1]+e[2]*e[2]);return[e[0]/t,e[1]/t,e[2]/t]};t|=1;var r=e.width,i=e.height,s=document.createElement("canvas");s.width=r,s.height=i;var o=s.getContext("2d");o.drawImage(e,0,0);for(var u=o.getImageData(0,0,r,i).data,a=o.createImageData(r,i),f=a.data,l=0;l<r;l++)for(var c=0;c<i;c++){var h=0>c-1?0:c-1,p=c+1>i-1?i-1:c+1,d=0>l-1?0:l-1,v=l+1>r-1?r-1:l+1,m=[],g=[0,0,u[4*(c*r+l)]/255*t];m.push([-1,0,u[4*(c*r+d)]/255*t]),m.push([-1,-1,u[4*(h*r+d)]/255*t]),m.push([0,-1,u[4*(h*r+l)]/255*t]),m.push([1,-1,u[4*(h*r+v)]/255*t]),m.push([1,0,u[4*(c*r+v)]/255*t]),m.push([1,1,u[4*(p*r+v)]/255*t]),m.push([0,1,u[4*(p*r+l)]/255*t]),m.push([-1,1,u[4*(p*r+d)]/255*t]),h=[],d=m.length;for(p=0;p<d;p++){var v=m[p],y=m[(p+1)%d],v=[v[0]-g[0],v[1]-g[1],v[2]-g[2]],y=[y[0]-g[0],y[1]-g[1],y[2]-g[2]];h.push(n([v[1]*y[2]-v[2]*y[1],v[2]*y[0]-v[0]*y[2],v[0]*y[1]-v[1]*y[0]]))}m=[0,0,0];for(p=0;p<h.length;p++)m[0]+=h[p][0],m[1]+=h[p][1],m[2]+=h[p][2];m[0]/=h.length,m[1]/=h.length,m[2]/=h.length,g=4*(c*r+l),f[g]=(m[0]+1)/2*255|0,f[g+1]=(m[1]+1)/2*255|0,f[g+2]=255*m[2]|0,f[g+3]=255}return o.putImageData(a,0,0),s},generateDataTexture:function(e,t,n){var r=e*t,i=new Uint8Array(3*r),s=Math.floor(255*n.r),o=Math.floor(255*n.g);n=Math.floor(255*n.b);for(var u=0;u<r;u++)i[3*u]=s,i[3*u+1]=o,i[3*u+2]=n;return e=new THREE.DataTexture(i,e,t,THREE.RGBFormat),e.needsUpdate=!0,e}},THREE.SceneUtils={createMultiMaterialObject:function(e,t){for(var n=new THREE.Object3D,r=0,i=t.length;r<i;r++)n.add(new THREE.Mesh(e,t[r]));return n},detach:function(e,t,n){e.applyMatrix(t.matrixWorld),t.remove(e),n.add(e)},attach:function(e,t,n){var r=new THREE.Matrix4;r.getInverse(n.matrixWorld),e.applyMatrix(r),t.remove(e),n.add(e)}},THREE.FontUtils={faces:{},face:"helvetiker",weight:"normal",style:"normal",size:150,divisions:10,getFace:function(){return this.faces[this.face][this.weight][this.style]},loadFace:function(e){var t=e.familyName.toLowerCase();return this.faces[t]=this.faces[t]||{},this.faces[t][e.cssFontWeight]=this.faces[t][e.cssFontWeight]||{},this.faces[t][e.cssFontWeight][e.cssFontStyle]=e,this.faces[t][e.cssFontWeight][e.cssFontStyle]=e},drawText:function(e){var t=this.getFace(),n=this.size/t.resolution,r=0,i=String(e).split(""),s=i.length,o=[];for(e=0;e<s;e++){var u=new THREE.Path,u=this.extractGlyphPoints(i[e],t,n,r,u),r=r+u.offset;o.push(u.path)}return{paths:o,offset:r/2}},extractGlyphPoints:function(e,t,n,r,i){var s=[],o,u,a,f,l,c,h,p,d,v,m,g=t.glyphs[e]||t.glyphs["?"];if(g){if(g.o)for(t=g._cachedOutline||(g._cachedOutline=g.o.split(" ")),f=t.length,e=0;e<f;)switch(a=t[e++],a){case"m":a=t[e++]*n+r,l=t[e++]*n,i.moveTo(a,l);break;case"l":a=t[e++]*n+r,l=t[e++]*n,i.lineTo(a,l);break;case"q":a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*n,i.quadraticCurveTo(p,d,a,l);if(o=s[s.length-1])for(c=o.x,h=o.y,o=1,u=this.divisions;o<=u;o++){var y=o/u;THREE.Shape.Utils.b2(y,c,p,a),THREE.Shape.Utils.b2(y,h,d,l)}break;case"b":if(a=t[e++]*n+r,l=t[e++]*n,p=t[e++]*n+r,d=t[e++]*-n,v=t[e++]*n+r,m=t[e++]*-n,i.bezierCurveTo(a,l,p,d,v,m),o=s[s.length-1])for(c=o.x,h=o.y,o=1,u=this.divisions;o<=u;o++)y=o/u,THREE.Shape.Utils.b3(y,c,p,v,a),THREE.Shape.Utils.b3(y,h,d,m,l)}return{offset:g.ha*n,path:i}}}},THREE.FontUtils.generateShapes=function(e,t){t=t||{};var n=void 0!==t.curveSegments?t.curveSegments:4,r=void 0!==t.font?t.font:"helvetiker",i=void 0!==t.weight?t.weight:"normal",s=void 0!==t.style?t.style:"normal";THREE.FontUtils.size=void 0!==t.size?t.size:100,THREE.FontUtils.divisions=n,THREE.FontUtils.face=r,THREE.FontUtils.weight=i,THREE.FontUtils.style=s,n=THREE.FontUtils.drawText(e).paths,r=[],i=0;for(s=n.length;i<s;i++)Array.prototype.push.apply(r,n[i].toShapes());return r},function(e){var t=function(e){for(var t=e.length,n=0,r=t-1,i=0;i<t;r=i++)n+=e[r].x*e[i].y-e[i].x*e[r].y;return.5*n};return e.Triangulate=function(e,n){var r=e.length;if(3>r)return null;var i=[],s=[],o=[],u,a,f;if(0<t(e))for(a=0;a<r;a++)s[a]=a;else for(a=0;a<r;a++)s[a]=r-1-a;var l=2*r;for(a=r-1;2<r;){if(0>=l--){console.log("Warning, unable to triangulate polygon!");break}u=a,r<=u&&(u=0),a=u+1,r<=a&&(a=0),f=a+1,r<=f&&(f=0);var c;e:{var h=c=void 0,p=void 0,d=void 0,v=void 0,m=void 0,g=void 0,y=void 0,w=void 0,h=e[s[u]].x,p=e[s[u]].y,d=e[s[a]].x,v=e[s[a]].y,m=e[s[f]].x,g=e[s[f]].y;if(1e-10>(d-h)*(g-p)-(v-p)*(m-h))c=!1;else{var E=void 0,S=void 0,x=void 0,T=void 0,N=void 0,C=void 0,k=void 0,L=void 0,A=void 0,O=void 0,A=L=k=w=y=void 0,E=m-d,S=g-v,x=h-m,T=p-g,N=d-h,C=v-p;for(c=0;c<r;c++)if(y=e[s[c]].x,w=e[s[c]].y,!(y===h&&w===p||y===d&&w===v||y===m&&w===g)&&(k=y-h,L=w-p,A=y-d,O=w-v,y-=m,w-=g,A=E*O-S*A,k=N*L-C*k,L=x*w-T*y,-1e-10<=A&&-1e-10<=L&&-1e-10<=k)){c=!1;break e}c=!0}}if(c){i.push([e[s[u]],e[s[a]],e[s[f]]]),o.push([s[u],s[a],s[f]]),u=a;for(f=a+1;f<r;u++,f++)s[u]=s[f];r--,l=2*r}}return n?o:i},e.Triangulate.area=t,e}(THREE.FontUtils),self._typeface_js={faces:THREE.FontUtils.faces,loadFace:THREE.FontUtils.loadFace},THREE.typeface_js=self._typeface_js,THREE.Curve=function(){},THREE.Curve.prototype.getPoint=function(e){return console.log("Warning, getPoint() not implemented!"),null},THREE.Curve.prototype.getPointAt=function(e){return e=this.getUtoTmapping(e),this.getPoint(e)},THREE.Curve.prototype.getPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPoint(t/e));return n},THREE.Curve.prototype.getSpacedPoints=function(e){e||(e=5);var t,n=[];for(t=0;t<=e;t++)n.push(this.getPointAt(t/e));return n},THREE.Curve.prototype.getLength=function(){var e=this.getLengths();return e[e.length-1]},THREE.Curve.prototype.getLengths=function(e){e||(e=this.__arcLengthDivisions?this.__arcLengthDivisions:200);if(this.cacheArcLengths&&this.cacheArcLengths.length==e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t=[],n,r=this.getPoint(0),i,s=0;t.push(0);for(i=1;i<=e;i++)n=this.getPoint(i/e),s+=n.distanceTo(r),t.push(s),r=n;return this.cacheArcLengths=t},THREE.Curve.prototype.updateArcLengths=function(){this.needsUpdate=!0,this.getLengths()},THREE.Curve.prototype.getUtoTmapping=function(e,t){var n=this.getLengths(),r=0,i=n.length,s;s=t?t:e*n[i-1];for(var o=0,u=i-1,a;o<=u;)if(r=Math.floor(o+(u-o)/2),a=n[r]-s,0>a)o=r+1;else{if(!(0<a)){u=r;break}u=r-1}return r=u,n[r]==s?r/(i-1):(o=n[r],n=(r+(s-o)/(n[r+1]-o))/(i-1))},THREE.Curve.prototype.getTangent=function(e){var t=e-1e-4;return e+=1e-4,0>t&&(t=0),1<e&&(e=1),t=this.getPoint(t),this.getPoint(e).clone().sub(t).normalize()},THREE.Curve.prototype.getTangentAt=function(e){return e=this.getUtoTmapping(e),this.getTangent(e)},THREE.Curve.Utils={tangentQuadraticBezier:function(e,t,n,r){return 2*(1-e)*(n-t)+2*e*(r-n)},tangentCubicBezier:function(e,t,n,r,i){return-3*t*(1-e)*(1-e)+3*n*(1-e)*(1-e)-6*e*n*(1-e)+6*e*r*(1-e)-3*e*e*r+3*e*e*i},tangentSpline:function(e,t,n,r,i){return 6*e*e-6*e+(3*e*e-4*e+1)+(-6*e*e+6*e)+(3*e*e-2*e)},interpolate:function(e,t,n,r,i){e=.5*(n-e),r=.5*(r-t);var s=i*i;return(2*t-2*n+e+r)*i*s+(-3*t+3*n-2*e-r)*s+e*i+t}},THREE.Curve.create=function(e,t){return e.prototype=Object.create(THREE.Curve.prototype),e.prototype.getPoint=t,e},THREE.CurvePath=function(){this.curves=[],this.bends=[],this.autoClose=!1},THREE.CurvePath.prototype=Object.create(THREE.Curve.prototype),THREE.CurvePath.prototype.add=function(e){this.curves.push(e)},THREE.CurvePath.prototype.checkConnection=function(){},THREE.CurvePath.prototype.closePath=function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new THREE.LineCurve(t,e))},THREE.CurvePath.prototype.getPoint=function(e){var t=e*this.getLength(),n=this.getCurveLengths();for(e=0;e<n.length;){if(n[e]>=t)return t=n[e]-t,e=this.curves[e],t=1-t/e.getLength(),e.getPointAt(t);e++}return null},THREE.CurvePath.prototype.getLength=function(){var e=this.getCurveLengths();return e[e.length-1]},THREE.CurvePath.prototype.getCurveLengths=function(){if(this.cacheLengths&&this.cacheLengths.length==this.curves.length)return this.cacheLengths;var e=[],t=0,n,r=this.curves.length;for(n=0;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e},THREE.CurvePath.prototype.getBoundingBox=function(){var e=this.getPoints(),t,n,r,i,s,o;t=n=Number.NEGATIVE_INFINITY,i=s=Number.POSITIVE_INFINITY;var u,a,f,l,c=e[0]instanceof THREE.Vector3;l=c?new THREE.Vector3:new THREE.Vector2,a=0;for(f=e.length;a<f;a++)u=e[a],u.x>t?t=u.x:u.x<i&&(i=u.x),u.y>n?n=u.y:u.y<s&&(s=u.y),c&&(u.z>r?r=u.z:u.z<o&&(o=u.z)),l.add(u);return e={minX:i,minY:s,maxX:t,maxY:n,centroid:l.divideScalar(f)},c&&(e.maxZ=r,e.minZ=o),e},THREE.CurvePath.prototype.createPointsGeometry=function(e){return e=this.getPoints(e,!0),this.createGeometry(e)},THREE.CurvePath.prototype.createSpacedPointsGeometry=function(e){return e=this.getSpacedPoints(e,!0),this.createGeometry(e)},THREE.CurvePath.prototype.createGeometry=function(e){for(var t=new THREE.Geometry,n=0;n<e.length;n++)t.vertices.push(new THREE.Vector3(e[n].x,e[n].y,e[n].z||0));return t},THREE.CurvePath.prototype.addWrapPath=function(e){this.bends.push(e)},THREE.CurvePath.prototype.getTransformedPoints=function(e,t){var n=this.getPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getTransformedSpacedPoints=function(e,t){var n=this.getSpacedPoints(e),r,i;t||(t=this.bends),r=0;for(i=t.length;r<i;r++)n=this.getWrapPoints(n,t[r]);return n},THREE.CurvePath.prototype.getWrapPoints=function(e,t){var n=this.getBoundingBox(),r,i,s,o,u,a;r=0;for(i=e.length;r<i;r++)s=e[r],o=s.x,u=s.y,a=o/n.maxX,a=t.getUtoTmapping(a,o),o=t.getPoint(a),a=t.getTangent(a),a.set(-a.y,a.x).multiplyScalar(u),s.x=o.x+a.x,s.y=o.y+a.y;return e},THREE.Gyroscope=function(){THREE.Object3D.call(this)},THREE.Gyroscope.prototype=Object.create(THREE.Object3D.prototype),THREE.Gyroscope.prototype.updateMatrixWorld=function(e){this.matrixAutoUpdate&&this.updateMatrix();if(this.matrixWorldNeedsUpdate||e)this.parent?(this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorld.decompose(this.translationWorld,this.quaternionWorld,this.scaleWorld),this.matrix.decompose(this.translationObject,this.quaternionObject,this.scaleObject),this.matrixWorld.compose(this.translationWorld,this.quaternionObject,this.scaleWorld)):this.matrixWorld.copy(this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0;for(var t=0,n=this.children.length;t<n;t++)this.children[t].updateMatrixWorld(e)},THREE.Gyroscope.prototype.translationWorld=new THREE.Vector3,THREE.Gyroscope.prototype.translationObject=new THREE.Vector3,THREE.Gyroscope.prototype.quaternionWorld=new THREE.Quaternion,THREE.Gyroscope.prototype.quaternionObject=new THREE.Quaternion,THREE.Gyroscope.prototype.scaleWorld=new THREE.Vector3,THREE.Gyroscope.prototype.scaleObject=new THREE.Vector3,THREE.Path=function(e){THREE.CurvePath.call(this),this.actions=[],e&&this.fromPoints(e)},THREE.Path.prototype=Object.create(THREE.CurvePath.prototype),THREE.PathActions={MOVE_TO:"moveTo",LINE_TO:"lineTo",QUADRATIC_CURVE_TO:"quadraticCurveTo",BEZIER_CURVE_TO:"bezierCurveTo",CSPLINE_THRU:"splineThru",ARC:"arc",ELLIPSE:"ellipse"},THREE.Path.prototype.fromPoints=function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y)},THREE.Path.prototype.moveTo=function(e,t){var n=Array.prototype.slice.call(arguments);this.actions.push({action:THREE.PathActions.MOVE_TO,args:n})},THREE.Path.prototype.lineTo=function(e,t){var n=Array.prototype.slice.call(arguments),r=this.actions[this.actions.length-1].args,r=new THREE.LineCurve(new THREE.Vector2(r[r.length-2],r[r.length-1]),new THREE.Vector2(e,t));this.curves.push(r),this.actions.push({action:THREE.PathActions.LINE_TO,args:n})},THREE.Path.prototype.quadraticCurveTo=function(e,t,n,r){var i=Array.prototype.slice.call(arguments),s=this.actions[this.actions.length-1].args,s=new THREE.QuadraticBezierCurve(new THREE.Vector2(s[s.length-2],s[s.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r));this.curves.push(s),this.actions.push({action:THREE.PathActions.QUADRATIC_CURVE_TO,args:i})},THREE.Path.prototype.bezierCurveTo=function(e,t,n,r,i,s){var o=Array.prototype.slice.call(arguments),u=this.actions[this.actions.length-1].args,u=new THREE.CubicBezierCurve(new THREE.Vector2(u[u.length-2],u[u.length-1]),new THREE.Vector2(e,t),new THREE.Vector2(n,r),new THREE.Vector2(i,s));this.curves.push(u),this.actions.push({action:THREE.PathActions.BEZIER_CURVE_TO,args:o})},THREE.Path.prototype.splineThru=function(e){var t=Array.prototype.slice.call(arguments),n=this.actions[this.actions.length-1].args,n=[new THREE.Vector2(n[n.length-2],n[n.length-1])];Array.prototype.push.apply(n,e),n=new THREE.SplineCurve(n),this.curves.push(n),this.actions.push({action:THREE.PathActions.CSPLINE_THRU,args:t})},THREE.Path.prototype.arc=function(e,t,n,r,i,s){var o=this.actions[this.actions.length-1].args;this.absarc(e+o[o.length-2],t+o[o.length-1],n,r,i,s)},THREE.Path.prototype.absarc=function(e,t,n,r,i,s){this.absellipse(e,t,n,n,r,i,s)},THREE.Path.prototype.ellipse=function(e,t,n,r,i,s,o){var u=this.actions[this.actions.length-1].args;this.absellipse(e+u[u.length-2],t+u[u.length-1],n,r,i,s,o)},THREE.Path.prototype.absellipse=function(e,t,n,r,i,s,o){var u=Array.prototype.slice.call(arguments),a=new THREE.EllipseCurve(e,t,n,r,i,s,o);this.curves.push(a),a=a.getPoint(1),u.push(a.x),u.push(a.y),this.actions.push({action:THREE.PathActions.ELLIPSE,args:u})},THREE.Path.prototype.getSpacedPoints=function(e,t){e||(e=40);for(var n=[],r=0;r<e;r++)n.push(this.getPoint(r/e));return n},THREE.Path.prototype.getPoints=function(e,t){if(this.useSpacedPoints)return console.log("tata"),this.getSpacedPoints(e,t);e=e||12;var n=[],r,i,s,o,u,a,f,l,c,h,p,d,v;r=0;for(i=this.actions.length;r<i;r++)switch(s=this.actions[r],o=s.action,s=s.args,o){case THREE.PathActions.MOVE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.LINE_TO:n.push(new THREE.Vector2(s[0],s[1]));break;case THREE.PathActions.QUADRATIC_CURVE_TO:u=s[2],a=s[3],c=s[0],h=s[1],0<n.length?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(s=1;s<=e;s++)v=s/e,o=THREE.Shape.Utils.b2(v,p,c,u),v=THREE.Shape.Utils.b2(v,d,h,a),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.BEZIER_CURVE_TO:u=s[4],a=s[5],c=s[0],h=s[1],f=s[2],l=s[3],0<n.length?(o=n[n.length-1],p=o.x,d=o.y):(o=this.actions[r-1].args,p=o[o.length-2],d=o[o.length-1]);for(s=1;s<=e;s++)v=s/e,o=THREE.Shape.Utils.b3(v,p,c,f,u),v=THREE.Shape.Utils.b3(v,d,h,l,a),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.CSPLINE_THRU:o=this.actions[r-1].args,v=[new THREE.Vector2(o[o.length-2],o[o.length-1])],o=e*s[0].length,v=v.concat(s[0]),v=new THREE.SplineCurve(v);for(s=1;s<=o;s++)n.push(v.getPointAt(s/o));break;case THREE.PathActions.ARC:u=s[0],a=s[1],h=s[2],f=s[3],o=s[4],c=!!s[5],p=o-f,d=2*e;for(s=1;s<=d;s++)v=s/d,c||(v=1-v),v=f+v*p,o=u+h*Math.cos(v),v=a+h*Math.sin(v),n.push(new THREE.Vector2(o,v));break;case THREE.PathActions.ELLIPSE:for(u=s[0],a=s[1],h=s[2],l=s[3],f=s[4],o=s[5],c=!!s[6],p=o-f,d=2*e,s=1;s<=d;s++)v=s/d,c||(v=1-v),v=f+v*p,o=u+h*Math.cos(v),v=a+l*Math.sin(v),n.push(new THREE.Vector2(o,v))}return r=n[n.length-1],1e-10>Math.abs(r.x-n[0].x)&&1e-10>Math.abs(r.y-n[0].y)&&n.splice(n.length-1,1),t&&n.push(n[0]),n},THREE.Path.prototype.toShapes=function(e){function t(e,t){for(var n=t.length,r=!1,i=n-1,s=0;s<n;i=s++){var o=t[i],u=t[s],a=u.x-o.x,f=u.y-o.y;if(1e-10<Math.abs(f)){if(0>f&&(o=t[s],a=-a,u=t[i],f=-f),!(e.y<o.y||e.y>u.y))if(e.y==o.y){if(e.x==o.x)return!0}else{i=f*(e.x-o.x)-a*(e.y-o.y);if(0==i)return!0;0>i||(r=!r)}}else if(e.y==o.y&&(u.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=u.x))return!0}return r}var n,r,i,s,o=[],u=new THREE.Path;n=0;for(r=this.actions.length;n<r;n++)i=this.actions[n],s=i.args,i=i.action,i==THREE.PathActions.MOVE_TO&&0!=u.actions.length&&(o.push(u),u=new THREE.Path),u[i].apply(u,s);0!=u.actions.length&&o.push(u);if(0==o.length)return[];var a,f,l;s=[];if(1==o.length)return f=o[0],l=new THREE.Shape,l.actions=f.actions,l.curves=f.curves,s.push(l),s;var c=!THREE.Shape.Utils.isClockWise(o[0].getPoints()),c=e?!c:c;l=[],u=[],i=[];var h=0,p;u[h]=void 0,i[h]=[],n=0;for(r=o.length;n<r;n++)f=o[n],p=f.getPoints(),a=THREE.Shape.Utils.isClockWise(p),(a=e?!a:a)?(!c&&u[h]&&h++,u[h]={s:new THREE.Shape,p:p},u[h].s.actions=f.actions,u[h].s.curves=f.curves,c&&h++,i[h]=[]):i[h].push({h:f,p:p[0]});if(1<u.length){n=!1,r=[],e=0;for(o=u.length;e<o;e++)l[e]=[];e=0;for(o=u.length;e<o;e++)for(f=i[e],a=0;a<f.length;a++){c=f[a],h=!0;for(p=0;p<u.length;p++)t(c.p,u[p].p)&&(e!=p&&r.push({froms:e,tos:p,hole:a}),h?(h=!1,l[p].push(c)):n=!0);h&&l[e].push(c)}0<r.length&&(n||(i=l))}n=0;for(r=u.length;n<r;n++)for(l=u[n].s,s.push(l),e=i[n],o=0,f=e.length;o<f;o++)l.holes.push(e[o].h);return s},THREE.Shape=function(){THREE.Path.apply(this,arguments),this.holes=[]},THREE.Shape.prototype=Object.create(THREE.Path.prototype),THREE.Shape.prototype.extrude=function(e){return new THREE.ExtrudeGeometry(this,e)},THREE.Shape.prototype.makeGeometry=function(e){return new THREE.ShapeGeometry(this,e)},THREE.Shape.prototype.getPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedPoints(e,this.bends);return r},THREE.Shape.prototype.getSpacedPointsHoles=function(e){var t,n=this.holes.length,r=[];for(t=0;t<n;t++)r[t]=this.holes[t].getTransformedSpacedPoints(e,this.bends);return r},THREE.Shape.prototype.extractAllPoints=function(e){return{shape:this.getTransformedPoints(e),holes:this.getPointsHoles(e)}},THREE.Shape.prototype.extractPoints=function(e){return this.useSpacedPoints?this.extractAllSpacedPoints(e):this.extractAllPoints(e)},THREE.Shape.prototype.extractAllSpacedPoints=function(e){return{shape:this.getTransformedSpacedPoints(e),holes:this.getSpacedPointsHoles(e)}},THREE.Shape.Utils={triangulateShape:function(e,t){function n(e,t,n){return e.x!=t.x?e.x<t.x?e.x<=n.x&&n.x<=t.x:t.x<=n.x&&n.x<=e.x:e.y<t.y?e.y<=n.y&&n.y<=t.y:t.y<=n.y&&n.y<=e.y}function r(e,t,r,i,s){var o=t.x-e.x,u=t.y-e.y,a=i.x-r.x,f=i.y-r.y,l=e.x-r.x,c=e.y-r.y,h=u*a-o*f,p=u*l-o*c;if(1e-10<Math.abs(h)){if(0<h){if(0>p||p>h)return[];a=f*l-a*c;if(0>a||a>h)return[]}else{if(0<p||p<h)return[];a=f*l-a*c;if(0<a||a<h)return[]}return 0==a?!s||0!=p&&p!=h?[e]:[]:a==h?!s||0!=p&&p!=h?[t]:[]:0==p?[r]:p==h?[i]:(s=a/h,[{x:e.x+s*o,y:e.y+s*u}])}return 0!=p||f*l!=a*c?[]:(u=0==o&&0==u,a=0==a&&0==f,u&&a?e.x!=r.x||e.y!=r.y?[]:[e]:u?n(r,i,e)?[e]:[]:a?n(e,t,r)?[r]:[]:(0!=o?(e.x<t.x?(o=e,a=e.x,u=t,e=t.x):(o=t,a=t.x,u=e,e=e.x),r.x<i.x?(t=r,h=r.x,f=i,r=i.x):(t=i,h=i.x,f=r,r=r.x)):(e.y<t.y?(o=e,a=e.y,u=t,e=t.y):(o=t,a=t.y,u=e,e=e.y),r.y<i.y?(t=r,h=r.y,f=i,r=i.y):(t=i,h=i.y,f=r,r=r.y)),a<=h?e<h?[]:e==h?s?[]:[t]:e<=r?[t,u]:[t,f]:a>r?[]:a==r?s?[]:[o]:e<=r?[o,u]:[o,f]))}function i(e,t,n,r){var i=t.x-e.x,s=t.y-e.y;t=n.x-e.x,n=n.y-e.y;var o=r.x-e.x;return r=r.y-e.y,e=i*n-s*t,i=i*r-s*o,1e-10<Math.abs(e)?(t=o*n-r*t,0<e?0<=i&&0<=t:0<=i||0<=t):0<i}var s,o,u,a,f,l={};u=e.concat();for(s in t)Array.prototype.push.apply(u,t[s]);s=0;for(o=u.length;s<o;s++)f=u[s].x+":"+u[s].y,void 0!==l[f]&&console.log("Duplicate point",f),l[f]=s;s=function(e,t){function n(e,t){var n=u.length-1,r=e-1;0>r&&(r=n);var s=e+1;return s>n&&(s=0),n=i(u[e],u[r],u[s],a[t]),n?(n=a.length-1,r=t-1,0>r&&(r=n),s=t+1,s>n&&(s=0),(n=i(a[t],a[r],a[s],u[e]))?!0:!1):!1}function s(e,t){var n,i;for(n=0;n<u.length;n++)if(i=n+1,i%=u.length,i=r(e,t,u[n],u[i],!0),0<i.length)return!0;return!1}function o(e,n){var i,s,o,u;for(i=0;i<f.length;i++)for(s=t[f[i]],o=0;o<s.length;o++)if(u=o+1,u%=s.length,u=r(e,n,s[o],s[u],!0),0<u.length)return!0;return!1}var u=e.concat(),a,f=[],l,c,h,p,v,m,g,y=[],b,w;for(p in t)f.push(p);for(var E=2*f.length;0<f.length;){E--;if(0>E){console.log("Infinite Loop! Holes left:"+f.length+", Probably Hole outside Shape!");break}for(c=0;c<u.length;c++){h=u[c],l=-1;for(p=0;p<f.length;p++)if(v=f[p],g=h.x+":"+h.y+":"+v,void 0===y[g]){a=t[v];for(v=0;v<a.length;v++)if(m=a[v],n(c,v)&&!s(h,m)&&!o(h,m)){l=v,f.splice(p,1),v=u.slice(0,c+1),m=u.slice(c),b=a.slice(l),w=a.slice(0,l+1),u=v.concat(b).concat(w).concat(m);break}if(0<=l)break;y[g]=!0}if(0<=l)break}}return u}(e,t);var c=THREE.FontUtils.Triangulate(s,!1);s=0;for(o=c.length;s<o;s++)for(a=c[s],u=0;3>u;u++)f=a[u].x+":"+a[u].y,f=l[f],void 0!==f&&(a[u]=f);return c.concat()},isClockWise:function(e){return 0>THREE.FontUtils.Triangulate.area(e)},b2p0:function(e,t){var n=1-e;return n*n*t},b2p1:function(e,t){return 2*(1-e)*e*t},b2p2:function(e,t){return e*e*t},b2:function(e,t,n,r){return this.b2p0(e,t)+this.b2p1(e,n)+this.b2p2(e,r)},b3p0:function(e,t){var n=1-e;return n*n*n*t},b3p1:function(e,t){var n=1-e;return 3*n*n*e*t},b3p2:function(e,t){return 3*(1-e)*e*e*t},b3p3:function(e,t){return e*e*e*t},b3:function(e,t,n,r,i){return this.b3p0(e,t)+this.b3p1(e,n)+this.b3p2(e,r)+this.b3p3(e,i)}},THREE.LineCurve=function(e,t){this.v1=e,this.v2=t},THREE.LineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.LineCurve.prototype.getPoint=function(e){var t=this.v2.clone().sub(this.v1);return t.multiplyScalar(e).add(this.v1),t},THREE.LineCurve.prototype.getPointAt=function(e){return this.getPoint(e)},THREE.LineCurve.prototype.getTangent=function(e){return this.v2.clone().sub(this.v1).normalize()},THREE.QuadraticBezierCurve=function(e,t,n){this.v0=e,this.v1=t,this.v2=n},THREE.QuadraticBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.QuadraticBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),new THREE.Vector2(t,e)},THREE.QuadraticBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.x,this.v1.x,this.v2.x),e=THREE.Curve.Utils.tangentQuadraticBezier(e,this.v0.y,this.v1.y,this.v2.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.CubicBezierCurve=function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},THREE.CubicBezierCurve.prototype=Object.create(THREE.Curve.prototype),THREE.CubicBezierCurve.prototype.getPoint=function(e){var t;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),new THREE.Vector2(t,e)},THREE.CubicBezierCurve.prototype.getTangent=function(e){var t;return t=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),e=THREE.Curve.Utils.tangentCubicBezier(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),t=new THREE.Vector2(t,e),t.normalize(),t},THREE.SplineCurve=function(e){this.points=void 0==e?[]:e},THREE.SplineCurve.prototype=Object.create(THREE.Curve.prototype),THREE.SplineCurve.prototype.getPoint=function(e){var t=new THREE.Vector2,n=[],r=this.points,i;return i=(r.length-1)*e,e=Math.floor(i),i-=e,n[0]=0==e?e:e-1,n[1]=e,n[2]=e>r.length-2?r.length-1:e+1,n[3]=e>r.length-3?r.length-1:e+2,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t},THREE.EllipseCurve=function(e,t,n,r,i,s,o){this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=r,this.aStartAngle=i,this.aEndAngle=s,this.aClockwise=o},THREE.EllipseCurve.prototype=Object.create(THREE.Curve.prototype),THREE.EllipseCurve.prototype.getPoint=function(e){var t;return t=this.aEndAngle-this.aStartAngle,0>t&&(t+=2*Math.PI),t>2*Math.PI&&(t-=2*Math.PI),t=!0===this.aClockwise?this.aEndAngle+(1-e)*(2*Math.PI-t):this.aStartAngle+e*t,e=this.aX+this.xRadius*Math.cos(t),t=this.aY+this.yRadius*Math.sin(t),new THREE.Vector2(e,t)},THREE.ArcCurve=function(e,t,n,r,i,s){THREE.EllipseCurve.call(this,e,t,n,n,r,i,s)},THREE.ArcCurve.prototype=Object.create(THREE.EllipseCurve.prototype),THREE.LineCurve3=THREE.Curve.create(function(e,t){this.v1=e,this.v2=t},function(e){var t=new THREE.Vector3;return t.subVectors(this.v2,this.v1),t.multiplyScalar(e),t.add(this.v1),t}),THREE.QuadraticBezierCurve3=THREE.Curve.create(function(e,t,n){this.v0=e,this.v1=t,this.v2=n},function(e){var t,n;return t=THREE.Shape.Utils.b2(e,this.v0.x,this.v1.x,this.v2.x),n=THREE.Shape.Utils.b2(e,this.v0.y,this.v1.y,this.v2.y),e=THREE.Shape.Utils.b2(e,this.v0.z,this.v1.z,this.v2.z),new THREE.Vector3(t,n,e)}),THREE.CubicBezierCurve3=THREE.Curve.create(function(e,t,n,r){this.v0=e,this.v1=t,this.v2=n,this.v3=r},function(e){var t,n;return t=THREE.Shape.Utils.b3(e,this.v0.x,this.v1.x,this.v2.x,this.v3.x),n=THREE.Shape.Utils.b3(e,this.v0.y,this.v1.y,this.v2.y,this.v3.y),e=THREE.Shape.Utils.b3(e,this.v0.z,this.v1.z,this.v2.z,this.v3.z),new THREE.Vector3(t,n,e)}),THREE.SplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i;e*=r.length-1,i=Math.floor(e),e-=i,n[0]=0==i?i:i-1,n[1]=i,n[2]=i>r.length-2?r.length-1:i+1,n[3]=i>r.length-3?r.length-1:i+2,i=r[n[0]];var s=r[n[1]],o=r[n[2]],n=r[n[3]];return t.x=THREE.Curve.Utils.interpolate(i.x,s.x,o.x,n.x,e),t.y=THREE.Curve.Utils.interpolate(i.y,s.y,o.y,n.y,e),t.z=THREE.Curve.Utils.interpolate(i.z,s.z,o.z,n.z,e),t}),THREE.ClosedSplineCurve3=THREE.Curve.create(function(e){this.points=void 0==e?[]:e},function(e){var t=new THREE.Vector3,n=[],r=this.points,i;return i=(r.length-0)*e,e=Math.floor(i),i-=e,e+=0<e?0:(Math.floor(Math.abs(e)/r.length)+1)*r.length,n[0]=(e-1)%r.length,n[1]=e%r.length,n[2]=(e+1)%r.length,n[3]=(e+2)%r.length,t.x=THREE.Curve.Utils.interpolate(r[n[0]].x,r[n[1]].x,r[n[2]].x,r[n[3]].x,i),t.y=THREE.Curve.Utils.interpolate(r[n[0]].y,r[n[1]].y,r[n[2]].y,r[n[3]].y,i),t.z=THREE.Curve.Utils.interpolate(r[n[0]].z,r[n[1]].z,r[n[2]].z,r[n[3]].z,i),t}),THREE.AnimationHandler=function(){var e=[],t={},n={update:function(t){for(var n=0;n<e.length;n++)e[n].update(t)},addToUpdate:function(t){-1===e.indexOf(t)&&e.push(t)},removeFromUpdate:function(t){t=e.indexOf(t),-1!==t&&e.splice(t,1)},add:function(e){void 0!==t[e.name]&&console.log("THREE.AnimationHandler.add: Warning! "+e.name+" already exists in library. Overwriting."),t[e.name]=e;if(!0!==e.initialized){for(var n=0;n<e.hierarchy.length;n++){for(var r=0;r<e.hierarchy[n].keys.length;r++)if(0>e.hierarchy[n].keys[r].time&&(e.hierarchy[n].keys[r].time=0),void 0!==e.hierarchy[n].keys[r].rot&&!(e.hierarchy[n].keys[r].rot instanceof THREE.Quaternion)){var i=e.hierarchy[n].keys[r].rot;e.hierarchy[n].keys[r].rot=new THREE.Quaternion(i[0],i[1],i[2],i[3])}if(e.hierarchy[n].keys.length&&void 0!==e.hierarchy[n].keys[0].morphTargets){i={};for(r=0;r<e.hierarchy[n].keys.length;r++)for(var s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++){var o=e.hierarchy[n].keys[r].morphTargets[s];i[o]=-1}e.hierarchy[n].usedMorphTargets=i;for(r=0;r<e.hierarchy[n].keys.length;r++){var u={};for(o in i){for(s=0;s<e.hierarchy[n].keys[r].morphTargets.length;s++)if(e.hierarchy[n].keys[r].morphTargets[s]===o){u[o]=e.hierarchy[n].keys[r].morphTargetsInfluences[s];break}s===e.hierarchy[n].keys[r].morphTargets.length&&(u[o]=0)}e.hierarchy[n].keys[r].morphTargetsInfluences=u}}for(r=1;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].time===e.hierarchy[n].keys[r-1].time&&(e.hierarchy[n].keys.splice(r,1),r--);for(r=0;r<e.hierarchy[n].keys.length;r++)e.hierarchy[n].keys[r].index=r}e.initialized=!0}},get:function(e){if("string"==typeof e)return t[e]?t[e]:(console.log("THREE.AnimationHandler.get: Couldn't find animation "+e),null)},parse:function(e){var t=[];if(e instanceof THREE.SkinnedMesh)for(var n=0;n<e.bones.length;n++)t.push(e.bones[n]);else r(e,t);return t}},r=function(e,t){t.push(e);for(var n=0;n<e.children.length;n++)r(e.children[n],t)};return n.LINEAR=0,n.CATMULLROM=1,n.CATMULLROM_FORWARD=2,n}(),THREE.Animation=function(e,t){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=1,this.isPlaying=!1,this.loop=this.isPaused=!0,this.interpolationType=THREE.AnimationHandler.LINEAR,this.points=[],this.target=new THREE.Vector3},THREE.Animation.prototype.play=function(e){this.currentTime=void 0!==e?e:0,!1===this.isPlaying&&(this.isPlaying=!0,this.reset(),this.update(0)),this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.Animation.prototype.pause=function(){!0===this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.Animation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this)},THREE.Animation.prototype.reset=function(){for(var e=0,t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e];n.matrixAutoUpdate=!0,void 0===n.animationCache&&(n.animationCache={},n.animationCache.prevKey={pos:0,rot:0,scl:0},n.animationCache.nextKey={pos:0,rot:0,scl:0},n.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix);var r=n.animationCache.prevKey,n=n.animationCache.nextKey;r.pos=this.data.hierarchy[e].keys[0],r.rot=this.data.hierarchy[e].keys[0],r.scl=this.data.hierarchy[e].keys[0],n.pos=this.getNextKeyWith("pos",e,1),n.rot=this.getNextKeyWith("rot",e,1),n.scl=this.getNextKeyWith("scl",e,1)}},THREE.Animation.prototype.update=function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale;var t;e=["pos","rot","scl"];var n=this.data.length;!0===this.loop&&this.currentTime>n&&(this.currentTime%=n,this.reset()),this.currentTime=Math.min(this.currentTime,n);for(var r=0,i=this.hierarchy.length;r<i;r++)for(var s=this.hierarchy[r],o=s.animationCache,u=0;3>u;u++){t=e[u];var a=o.prevKey[t],f=o.nextKey[t];if(f.time<=this.currentTime){a=this.data.hierarchy[r].keys[0];for(f=this.getNextKeyWith(t,r,1);f.time<this.currentTime&&f.index>a.index;)a=f,f=this.getNextKeyWith(t,r,f.index+1);o.prevKey[t]=a,o.nextKey[t]=f}s.matrixAutoUpdate=!0,s.matrixWorldNeedsUpdate=!0;var l=(this.currentTime-a.time)/(f.time-a.time),c=a[t],h=f[t];0>l&&(l=0),1<l&&(l=1);if("pos"===t){if(t=s.position,this.interpolationType===THREE.AnimationHandler.LINEAR)t.x=c[0]+(h[0]-c[0])*l,t.y=c[1]+(h[1]-c[1])*l,t.z=c[2]+(h[2]-c[2])*l;else if(this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD)this.points[0]=this.getPrevKeyWith("pos",r,a.index-1).pos,this.points[1]=c,this.points[2]=h,this.points[3]=this.getNextKeyWith("pos",r,f.index+1).pos,l=.33*l+.33,a=this.interpolateCatmullRom(this.points,l),t.x=a[0],t.y=a[1],t.z=a[2],this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD&&(l=this.interpolateCatmullRom(this.points,1.01*l),this.target.set(l[0],l[1],l[2]),this.target.sub(t),this.target.y=0,this.target.normalize(),t=Math.atan2(this.target.x,this.target.z),s.rotation.set(0,t,0))}else"rot"===t?THREE.Quaternion.slerp(c,h,s.quaternion,l):"scl"===t&&(t=s.scale,t.x=c[0]+(h[0]-c[0])*l,t.y=c[1]+(h[1]-c[1])*l,t.z=c[2]+(h[2]-c[2])*l)}!1===this.loop&&this.currentTime>n&&this.stop()}},THREE.Animation.prototype.interpolateCatmullRom=function(e,t){var n=[],r=[],i,s,o,u,a,f;return i=(e.length-1)*t,s=Math.floor(i),i-=s,n[0]=0===s?s:s-1,n[1]=s,n[2]=s>e.length-2?s:s+1,n[3]=s>e.length-3?s:s+2,s=e[n[0]],u=e[n[1]],a=e[n[2]],f=e[n[3]],n=i*i,o=i*n,r[0]=this.interpolate(s[0],u[0],a[0],f[0],i,n,o),r[1]=this.interpolate(s[1],u[1],a[1],f[1],i,n,o),r[2]=this.interpolate(s[2],u[2],a[2],f[2],i,n,o),r},THREE.Animation.prototype.interpolate=function(e,t,n,r,i,s,o){return e=.5*(n-e),r=.5*(r-t),(2*(t-n)+e+r)*o+(-3*(t-n)-2*e-r)*s+e*i+t},THREE.Animation.prototype.getNextKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;for(n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?n<r.length-1?n:r.length-1:n%r.length;n<r.length;n++)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[0]},THREE.Animation.prototype.getPrevKeyWith=function(e,t,n){var r=this.data.hierarchy[t].keys;for(n=this.interpolationType===THREE.AnimationHandler.CATMULLROM||this.interpolationType===THREE.AnimationHandler.CATMULLROM_FORWARD?0<n?n:0:0<=n?n:n+r.length;0<=n;n--)if(void 0!==r[n][e])return r[n];return this.data.hierarchy[t].keys[r.length-1]},THREE.KeyFrameAnimation=function(e,t){this.root=e,this.data=THREE.AnimationHandler.get(t),this.hierarchy=THREE.AnimationHandler.parse(e),this.currentTime=0,this.timeScale=.001,this.isPlaying=!1,this.loop=this.isPaused=!0;for(var n=0,r=this.hierarchy.length;n<r;n++){var i=this.data.hierarchy[n].sids,s=this.hierarchy[n];if(this.data.hierarchy[n].keys.length&&i){for(var o=0;o<i.length;o++){var u=i[o],a=this.getNextKeyWith(u,n,0);a&&a.apply(u)}s.matrixAutoUpdate=!1,this.data.hierarchy[n].node.updateMatrix(),s.matrixWorldNeedsUpdate=!0}}},THREE.KeyFrameAnimation.prototype.play=function(e){this.currentTime=void 0!==e?e:0;if(!1===this.isPlaying){this.isPlaying=!0;var t=this.hierarchy.length,n,r;for(e=0;e<t;e++)n=this.hierarchy[e],r=this.data.hierarchy[e],void 0===r.animationCache&&(r.animationCache={},r.animationCache.prevKey=null,r.animationCache.nextKey=null,r.animationCache.originalMatrix=n instanceof THREE.Bone?n.skinMatrix:n.matrix),n=this.data.hierarchy[e].keys,n.length&&(r.animationCache.prevKey=n[0],r.animationCache.nextKey=n[1],this.startTime=Math.min(n[0].time,this.startTime),this.endTime=Math.max(n[n.length-1].time,this.endTime));this.update(0)}this.isPaused=!1,THREE.AnimationHandler.addToUpdate(this)},THREE.KeyFrameAnimation.prototype.pause=function(){this.isPaused?THREE.AnimationHandler.addToUpdate(this):THREE.AnimationHandler.removeFromUpdate(this),this.isPaused=!this.isPaused},THREE.KeyFrameAnimation.prototype.stop=function(){this.isPaused=this.isPlaying=!1,THREE.AnimationHandler.removeFromUpdate(this);for(var e=0;e<this.data.hierarchy.length;e++){var t=this.hierarchy[e],n=this.data.hierarchy[e];if(void 0!==n.animationCache){var r=n.animationCache.originalMatrix;t instanceof THREE.Bone?(r.copy(t.skinMatrix),t.skinMatrix=r):(r.copy(t.matrix),t.matrix=r),delete n.animationCache}}},THREE.KeyFrameAnimation.prototype.update=function(e){if(!1!==this.isPlaying){this.currentTime+=e*this.timeScale,e=this.data.length,!0===this.loop&&this.currentTime>e&&(this.currentTime%=e),this.currentTime=Math.min(this.currentTime,e),e=0;for(var t=this.hierarchy.length;e<t;e++){var n=this.hierarchy[e],r=this.data.hierarchy[e],i=r.keys,r=r.animationCache;if(i.length){var s=r.prevKey,o=r.nextKey;if(o.time<=this.currentTime){for(;o.time<this.currentTime&&o.index>s.index;)s=o,o=i[s.index+1];r.prevKey=s,r.nextKey=o}o.time>=this.currentTime?s.interpolate(o,this.currentTime):s.interpolate(o,o.time),this.data.hierarchy[e].node.updateMatrix(),n.matrixWorldNeedsUpdate=!0}}}},THREE.KeyFrameAnimation.prototype.getNextKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n%=t.length;n<t.length;n++)if(t[n].hasTarget(e))return t[n];return t[0]},THREE.KeyFrameAnimation.prototype.getPrevKeyWith=function(e,t,n){t=this.data.hierarchy[t].keys;for(n=0<=n?n:n+t.length;0<=n;n--)if(t[n].hasTarget(e))return t[n];return t[t.length-1]},THREE.MorphAnimation=function(e){this.mesh=e,this.frames=e.morphTargetInfluences.length,this.currentTime=0,this.duration=1e3,this.loop=!0,this.isPlaying=!1},THREE.MorphAnimation.prototype={play:function(){this.isPlaying=!0},pause:function(){this.isPlaying=!1},update:function(){var e=0,t=0;return function(n){if(!1!==this.isPlaying){this.currentTime+=n,!0===this.loop&&this.currentTime>this.duration&&(this.currentTime%=this.duration),this.currentTime=Math.min(this.currentTime,this.duration),n=this.duration/this.frames;var r=Math.floor(this.currentTime/n);r!=t&&(this.mesh.morphTargetInfluences[e]=0,this.mesh.morphTargetInfluences[t]=1,this.mesh.morphTargetInfluences[r]=0,e=t,t=r),this.mesh.morphTargetInfluences[r]=this.currentTime%n/n,this.mesh.morphTargetInfluences[e]=1-this.mesh.morphTargetInfluences[r]}}}()},THREE.CubeCamera=function(e,t,n){THREE.Object3D.call(this);var r=new THREE.PerspectiveCamera(90,1,e,t);r.up.set(0,-1,0),r.lookAt(new THREE.Vector3(1,0,0)),this.add(r);var i=new THREE.PerspectiveCamera(90,1,e,t);i.up.set(0,-1,0),i.lookAt(new THREE.Vector3(-1,0,0)),this.add(i);var s=new THREE.PerspectiveCamera(90,1,e,t);s.up.set(0,0,1),s.lookAt(new THREE.Vector3(0,1,0)),this.add(s);var o=new THREE.PerspectiveCamera(90,1,e,t);o.up.set(0,0,-1),o.lookAt(new THREE.Vector3(0,-1,0)),this.add(o);var u=new THREE.PerspectiveCamera(90,1,e,t);u.up.set(0,-1,0),u.lookAt(new THREE.Vector3(0,0,1)),this.add(u);var a=new THREE.PerspectiveCamera(90,1,e,t);a.up.set(0,-1,0),a.lookAt(new THREE.Vector3(0,0,-1)),this.add(a),this.renderTarget=new THREE.WebGLRenderTargetCube(n,n,{format:THREE.RGBFormat,magFilter:THREE.LinearFilter,minFilter:THREE.LinearFilter}),this.updateCubeMap=function(e,t){var n=this.renderTarget,l=n.generateMipmaps;n.generateMipmaps=!1,n.activeCubeFace=0,e.render(t,r,n),n.activeCubeFace=1,e.render(t,i,n),n.activeCubeFace=2,e.render(t,s,n),n.activeCubeFace=3,e.render(t,o,n),n.activeCubeFace=4,e.render(t,u,n),n.generateMipmaps=l,n.activeCubeFace=5,e.render(t,a,n)}},THREE.CubeCamera.prototype=Object.create(THREE.Object3D.prototype),THREE.CombinedCamera=function(e,t,n,r,i,s,o){THREE.Camera.call(this),this.fov=n,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2,this.cameraO=new THREE.OrthographicCamera(e/-2,e/2,t/2,t/-2,s,o),this.cameraP=new THREE.PerspectiveCamera(n,e/t,r,i),this.zoom=1,this.toPerspective()},THREE.CombinedCamera.prototype=Object.create(THREE.Camera.prototype),THREE.CombinedCamera.prototype.toPerspective=function(){this.near=this.cameraP.near,this.far=this.cameraP.far,this.cameraP.fov=this.fov/this.zoom,this.cameraP.updateProjectionMatrix(),this.projectionMatrix=this.cameraP.projectionMatrix,this.inPerspectiveMode=!0,this.inOrthographicMode=!1},THREE.CombinedCamera.prototype.toOrthographic=function(){var e=this.cameraP.aspect,t=(this.cameraP.near+this.cameraP.far)/2,t=Math.tan(this.fov/2)*t,e=2*t*e/2,t=t/this.zoom,e=e/this.zoom;this.cameraO.left=-e,this.cameraO.right=e,this.cameraO.top=t,this.cameraO.bottom=-t,this.cameraO.updateProjectionMatrix(),this.near=this.cameraO.near,this.far=this.cameraO.far,this.projectionMatrix=this.cameraO.projectionMatrix,this.inPerspectiveMode=!1,this.inOrthographicMode=!0},THREE.CombinedCamera.prototype.setSize=function(e,t){this.cameraP.aspect=e/t,this.left=-e/2,this.right=e/2,this.top=t/2,this.bottom=-t/2},THREE.CombinedCamera.prototype.setFov=function(e){this.fov=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.updateProjectionMatrix=function(){this.inPerspectiveMode?this.toPerspective():(this.toPerspective(),this.toOrthographic())},THREE.CombinedCamera.prototype.setLens=function(e,t){void 0===t&&(t=24);var n=2*THREE.Math.radToDeg(Math.atan(t/(2*e)));return this.setFov(n),n},THREE.CombinedCamera.prototype.setZoom=function(e){this.zoom=e,this.inPerspectiveMode?this.toPerspective():this.toOrthographic()},THREE.CombinedCamera.prototype.toFrontView=function(){this.rotation.x=0,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBackView=function(){this.rotation.x=0,this.rotation.y=Math.PI,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toLeftView=function(){this.rotation.x=0,this.rotation.y=-Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toRightView=function(){this.rotation.x=0,this.rotation.y=Math.PI/2,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toTopView=function(){this.rotation.x=-Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.CombinedCamera.prototype.toBottomView=function(){this.rotation.x=Math.PI/2,this.rotation.y=0,this.rotation.z=0,this.rotationAutoUpdate=!1},THREE.BoxGeometry=function(e,t,n,r,i,s){function o(e,t,n,r,i,s,o,a){var f,l=u.widthSegments,c=u.heightSegments,p=i/2,d=s/2,v=u.vertices.length;if("x"===e&&"y"===t||"y"===e&&"x"===t)f="z";else if("x"===e&&"z"===t||"z"===e&&"x"===t)f="y",c=u.depthSegments;else if("z"===e&&"y"===t||"y"===e&&"z"===t)f="x",l=u.depthSegments;var m=l+1,g=c+1,y=i/l,b=s/c,w=new THREE.Vector3;w[f]=0<o?1:-1;for(i=0;i<g;i++)for(s=0;s<m;s++){var E=new THREE.Vector3;E[e]=(s*y-p)*n,E[t]=(i*b-d)*r,E[f]=o,u.vertices.push(E)}for(i=0;i<c;i++)for(s=0;s<l;s++)d=s+m*i,e=s+m*(i+1),t=s+1+m*(i+1),n=s+1+m*i,r=new THREE.Vector2(s/l,1-i/c),o=new THREE.Vector2(s/l,1-(i+1)/c),f=new THREE.Vector2((s+1)/l,1-(i+1)/c),p=new THREE.Vector2((s+1)/l,1-i/c),d=new THREE.Face3(d+v,e+v,n+v),d.normal.copy(w),d.vertexNormals.push(w.clone(),w.clone(),w.clone()),d.materialIndex=a,u.faces.push(d),u.faceVertexUvs[0].push([r,o,p]),d=new THREE.Face3(e+v,t+v,n+v),d.normal.copy(w),d.vertexNormals.push(w.clone(),w.clone(),w.clone()),d.materialIndex=a,u.faces.push(d),u.faceVertexUvs[0].push([o.clone(),f,p.clone()])}THREE.Geometry.call(this);var u=this;this.width=e,this.height=t,this.depth=n,this.widthSegments=r||1,this.heightSegments=i||1,this.depthSegments=s||1,e=this.width/2,t=this.height/2,n=this.depth/2,o("z","y",-1,-1,this.depth,this.height,e,0),o("z","y",1,-1,this.depth,this.height,-e,1),o("x","z",1,1,this.width,this.depth,t,2),o("x","z",1,-1,this.width,this.depth,-t,3),o("x","y",1,-1,this.width,this.height,n,4),o("x","y",-1,-1,this.width,this.height,-n,5),this.computeCentroids(),this.mergeVertices()},THREE.BoxGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CircleGeometry=function(e,t,n,r){THREE.Geometry.call(this),this.radius=e=e||50,this.segments=t=void 0!==t?Math.max(3,t):8,this.thetaStart=n=void 0!==n?n:0,this.thetaLength=r=void 0!==r?r:2*Math.PI;var i,s=[];i=new THREE.Vector3;var o=new THREE.Vector2(.5,.5);this.vertices.push(i),s.push(o);for(i=0;i<=t;i++){var u=new THREE.Vector3,a=n+i/t*r;u.x=e*Math.cos(a),u.y=e*Math.sin(a),this.vertices.push(u),s.push(new THREE.Vector2((u.x/e+1)/2,(u.y/e+1)/2))}n=new THREE.Vector3(0,0,1);for(i=1;i<=t;i++)this.faces.push(new THREE.Face3(i,i+1,0,[n.clone(),n.clone(),n.clone()])),this.faceVertexUvs[0].push([s[i].clone(),s[i+1].clone(),o.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.CircleGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.CubeGeometry=THREE.BoxGeometry,THREE.CylinderGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this),this.radiusTop=e=void 0!==e?e:20,this.radiusBottom=t=void 0!==t?t:20,this.height=n=void 0!==n?n:100,this.radialSegments=r=r||8,this.heightSegments=i=i||1,this.openEnded=s=void 0!==s?s:!1;var o=n/2,u,a,f=[],l=[];for(a=0;a<=i;a++){var c=[],h=[],p=a/i,d=p*(t-e)+e;for(u=0;u<=r;u++){var v=u/r,m=new THREE.Vector3;m.x=d*Math.sin(v*Math.PI*2),m.y=-p*n+o,m.z=d*Math.cos(v*Math.PI*2),this.vertices.push(m),c.push(this.vertices.length-1),h.push(new THREE.Vector2(v,1-p))}f.push(c),l.push(h)}n=(t-e)/n;for(u=0;u<r;u++)for(0!==e?(c=this.vertices[f[0][u]].clone(),h=this.vertices[f[0][u+1]].clone()):(c=this.vertices[f[1][u]].clone(),h=this.vertices[f[1][u+1]].clone()),c.setY(Math.sqrt(c.x*c.x+c.z*c.z)*n).normalize(),h.setY(Math.sqrt(h.x*h.x+h.z*h.z)*n).normalize(),a=0;a<i;a++){var p=f[a][u],d=f[a+1][u],v=f[a+1][u+1],m=f[a][u+1],g=c.clone(),y=c.clone(),b=h.clone(),w=h.clone(),E=l[a][u].clone(),S=l[a+1][u].clone(),x=l[a+1][u+1].clone(),T=l[a][u+1].clone();this.faces.push(new THREE.Face3(p,d,m,[g,y,w])),this.faceVertexUvs[0].push([E,S,T]),this.faces.push(new THREE.Face3(d,v,m,[y.clone(),b,w.clone()])),this.faceVertexUvs[0].push([S.clone(),x,T.clone()])}if(!1===s&&0<e)for(this.vertices.push(new THREE.Vector3(0,o,0)),u=0;u<r;u++)p=f[0][u],d=f[0][u+1],v=this.vertices.length-1,g=new THREE.Vector3(0,1,0),y=new THREE.Vector3(0,1,0),b=new THREE.Vector3(0,1,0),E=l[0][u].clone(),S=l[0][u+1].clone(),x=new THREE.Vector2(S.x,0),this.faces.push(new THREE.Face3(p,d,v,[g,y,b])),this.faceVertexUvs[0].push([E,S,x]);if(!1===s&&0<t)for(this.vertices.push(new THREE.Vector3(0,-o,0)),u=0;u<r;u++)p=f[a][u+1],d=f[a][u],v=this.vertices.length-1,g=new THREE.Vector3(0,-1,0),y=new THREE.Vector3(0,-1,0),b=new THREE.Vector3(0,-1,0),E=l[a][u+1].clone(),S=l[a][u].clone(),x=new THREE.Vector2(S.x,1),this.faces.push(new THREE.Face3(p,d,v,[g,y,b])),this.faceVertexUvs[0].push([E,S,x]);this.computeCentroids(),this.computeFaceNormals()},THREE.CylinderGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry=function(e,t){"undefined"!=typeof e&&(THREE.Geometry.call(this),e=e instanceof Array?e:[e],this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals())},THREE.ExtrudeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ExtrudeGeometry.prototype.addShapeList=function(e,t){for(var n=e.length,r=0;r<n;r++)this.addShape(e[r],t)},THREE.ExtrudeGeometry.prototype.addShape=function(e,t){function n(e,t,n){return t||console.log("die"),t.clone().multiplyScalar(n).add(e)}function r(e,t,n){var r=THREE.Math.sign,i=1,i=e.x-t.x,s=e.y-t.y,o=n.x-e.x,u=n.y-e.y,a=i*i+s*s;if(1e-10<Math.abs(i*u-s*o)){var f=Math.sqrt(a),r=Math.sqrt(o*o+u*u),a=t.x-s/f;t=t.y+i/f,o=((n.x-u/r-a)*u-(n.y+o/r-t)*o)/(i*u-s*o),n=a+i*o-e.x,e=t+s*o-e.y,i=n*n+e*e;if(2>=i)return new THREE.Vector2(n,e);i=Math.sqrt(i/2)}else e=!1,1e-10<i?1e-10<o&&(e=!0):-1e-10>i?-1e-10>o&&(e=!0):r(s)==r(u)&&(e=!0),e?(n=-s,e=i,i=Math.sqrt(a)):(n=i,e=s,i=Math.sqrt(a/2));return new THREE.Vector2(n/i,e/i)}function i(n,r){var i,s;for(q=n.length;0<=--q;){i=q,s=q-1,0>s&&(s=n.length-1);for(var o=0,u=p+2*l,o=0;o<u;o++){var a=j*o,f=j*(o+1),c=r+i+a,a=r+s+a,h=r+s+f,f=r+i+f,d=n,v=o,m=u,g=i,w=s,c=c+L,a=a+L,h=h+L,f=f+L;k.faces.push(new THREE.Face3(c,a,f,null,null,y)),k.faces.push(new THREE.Face3(a,h,f,null,null,y)),c=b.generateSideWallUV(k,e,d,t,c,a,h,f,v,m,g,w),k.faceVertexUvs[0].push([c[0],c[1],c[3]]),k.faceVertexUvs[0].push([c[1],c[2],c[3]])}}}function s(e,t,n){k.vertices.push(new THREE.Vector3(e,t,n))}function o(n,r,i,s){n+=L,r+=L,i+=L,k.faces.push(new THREE.Face3(n,r,i,null,null,g)),n=s?b.generateBottomUV(k,e,t,n,r,i):b.generateTopUV(k,e,t,n,r,i),k.faceVertexUvs[0].push(n)}var u=void 0!==t.amount?t.amount:100,a=void 0!==t.bevelThickness?t.bevelThickness:6,f=void 0!==t.bevelSize?t.bevelSize:a-2,l=void 0!==t.bevelSegments?t.bevelSegments:3,c=void 0!==t.bevelEnabled?t.bevelEnabled:!0,h=void 0!==t.curveSegments?t.curveSegments:12,p=void 0!==t.steps?t.steps:1,d=t.extrudePath,v,m=!1,g=t.material,y=t.extrudeMaterial,b=void 0!==t.UVGenerator?t.UVGenerator:THREE.ExtrudeGeometry.WorldUVGenerator,w,E,S,x;d&&(v=d.getSpacedPoints(p),m=!0,c=!1,w=void 0!==t.frames?t.frames:new THREE.TubeGeometry.FrenetFrames(d,p,!1),E=new THREE.Vector3,S=new THREE.Vector3,x=new THREE.Vector3),c||(f=a=l=0);var T,N,C,k=this,L=this.vertices.length,d=e.extractPoints(h),h=d.shape,A=d.holes;if(d=!THREE.Shape.Utils.isClockWise(h)){h=h.reverse(),N=0;for(C=A.length;N<C;N++)T=A[N],THREE.Shape.Utils.isClockWise(T)&&(A[N]=T.reverse());d=!1}var O=THREE.Shape.Utils.triangulateShape(h,A),M=h;N=0;for(C=A.length;N<C;N++)T=A[N],h=h.concat(T);var _,D,P,H,B,j=h.length,F,I=O.length,d=[],q=0;P=M.length,_=P-1;for(D=q+1;q<P;q++,_++,D++)_===P&&(_=0),D===P&&(D=0),d[q]=r(M[q],M[_],M[D]);var R=[],U,z=d.concat();N=0;for(C=A.length;N<C;N++){T=A[N],U=[],q=0,P=T.length,_=P-1;for(D=q+1;q<P;q++,_++,D++)_===P&&(_=0),D===P&&(D=0),U[q]=r(T[q],T[_],T[D]);R.push(U),z=z.concat(U)}for(_=0;_<l;_++){P=_/l,H=a*(1-P),D=f*Math.sin(P*Math.PI/2),q=0;for(P=M.length;q<P;q++)B=n(M[q],d[q],D),s(B.x,B.y,-H);N=0;for(C=A.length;N<C;N++)for(T=A[N],U=R[N],q=0,P=T.length;q<P;q++)B=n(T[q],U[q],D),s(B.x,B.y,-H)}D=f;for(q=0;q<j;q++)B=c?n(h[q],z[q],D):h[q],m?(S.copy(w.normals[0]).multiplyScalar(B.x),E.copy(w.binormals[0]).multiplyScalar(B.y),x.copy(v[0]).add(S).add(E),s(x.x,x.y,x.z)):s(B.x,B.y,0);for(P=1;P<=p;P++)for(q=0;q<j;q++)B=c?n(h[q],z[q],D):h[q],m?(S.copy(w.normals[P]).multiplyScalar(B.x),E.copy(w.binormals[P]).multiplyScalar(B.y),x.copy(v[P]).add(S).add(E),s(x.x,x.y,x.z)):s(B.x,B.y,u/p*P);for(_=l-1;0<=_;_--){P=_/l,H=a*(1-P),D=f*Math.sin(P*Math.PI/2),q=0;for(P=M.length;q<P;q++)B=n(M[q],d[q],D),s(B.x,B.y,u+H);N=0;for(C=A.length;N<C;N++)for(T=A[N],U=R[N],q=0,P=T.length;q<P;q++)B=n(T[q],U[q],D),m?s(B.x,B.y+v[p-1].y,v[p-1].x+H):s(B.x,B.y,u+H)}(function(){if(c){var e;e=0*j;for(q=0;q<I;q++)F=O[q],o(F[2]+e,F[1]+e,F[0]+e,!0);e=p+2*l,e*=j;for(q=0;q<I;q++)F=O[q],o(F[0]+e,F[1]+e,F[2]+e,!1)}else{for(q=0;q<I;q++)F=O[q],o(F[2],F[1],F[0],!0);for(q=0;q<I;q++)F=O[q],o(F[0]+j*p,F[1]+j*p,F[2]+j*p,!1)}})(),function(){var e=0;i(M,e),e+=M.length,N=0;for(C=A.length;N<C;N++)T=A[N],i(T,e),e+=T.length}()},THREE.ExtrudeGeometry.WorldUVGenerator={generateTopUV:function(e,t,n,r,i,s){return t=e.vertices[i].x,i=e.vertices[i].y,n=e.vertices[s].x,s=e.vertices[s].y,[new THREE.Vector2(e.vertices[r].x,e.vertices[r].y),new THREE.Vector2(t,i),new THREE.Vector2(n,s)]},generateBottomUV:function(e,t,n,r,i,s){return this.generateTopUV(e,t,n,r,i,s)},generateSideWallUV:function(e,t,n,r,i,s,o,u,a,f,l,c){t=e.vertices[i].x,n=e.vertices[i].y,i=e.vertices[i].z,r=e.vertices[s].x,a=e.vertices[s].y,s=e.vertices[s].z,f=e.vertices[o].x,l=e.vertices[o].y,o=e.vertices[o].z,c=e.vertices[u].x;var h=e.vertices[u].y;return e=e.vertices[u].z,.01>Math.abs(n-a)?[new THREE.Vector2(t,1-i),new THREE.Vector2(r,1-s),new THREE.Vector2(f,1-o),new THREE.Vector2(c,1-e)]:[new THREE.Vector2(n,1-i),new THREE.Vector2(a,1-s),new THREE.Vector2(l,1-o),new THREE.Vector2(h,1-e)]}},THREE.ExtrudeGeometry.__v1=new THREE.Vector2,THREE.ExtrudeGeometry.__v2=new THREE.Vector2,THREE.ExtrudeGeometry.__v3=new THREE.Vector2,THREE.ExtrudeGeometry.__v4=new THREE.Vector2,THREE.ExtrudeGeometry.__v5=new THREE.Vector2,THREE.ExtrudeGeometry.__v6=new THREE.Vector2,THREE.ShapeGeometry=function(e,t){THREE.Geometry.call(this),0==e instanceof Array&&(e=[e]),this.shapebb=e[e.length-1].getBoundingBox(),this.addShapeList(e,t),this.computeCentroids(),this.computeFaceNormals()},THREE.ShapeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ShapeGeometry.prototype.addShapeList=function(e,t){for(var n=0,r=e.length;n<r;n++)this.addShape(e[n],t);return this},THREE.ShapeGeometry.prototype.addShape=function(e,t){void 0===t&&(t={});var n=t.material,r=void 0===t.UVGenerator?THREE.ExtrudeGeometry.WorldUVGenerator:t.UVGenerator,i,s,o,u=this.vertices.length;i=e.extractPoints(void 0!==t.curveSegments?t.curveSegments:12);var a=i.shape,f=i.holes;if(!THREE.Shape.Utils.isClockWise(a))for(a=a.reverse(),i=0,s=f.length;i<s;i++)o=f[i],THREE.Shape.Utils.isClockWise(o)&&(f[i]=o.reverse());var l=THREE.Shape.Utils.triangulateShape(a,f);i=0;for(s=f.length;i<s;i++)o=f[i],a=a.concat(o);f=a.length,s=l.length;for(i=0;i<f;i++)o=a[i],this.vertices.push(new THREE.Vector3(o.x,o.y,0));for(i=0;i<s;i++)f=l[i],a=f[0]+u,o=f[1]+u,f=f[2]+u,this.faces.push(new THREE.Face3(a,o,f,null,null,n)),this.faceVertexUvs[0].push(r.generateBottomUV(this,e,t,a,o,f))},THREE.LatheGeometry=function(e,t,n,r){THREE.Geometry.call(this),t=t||12,n=n||0,r=r||2*Math.PI;for(var i=1/(e.length-1),s=1/t,o=0,u=t;o<=u;o++)for(var a=n+o*s*r,f=Math.cos(a),l=Math.sin(a),a=0,c=e.length;a<c;a++){var h=e[a],p=new THREE.Vector3;p.x=f*h.x-l*h.y,p.y=l*h.x+f*h.y,p.z=h.z,this.vertices.push(p)}n=e.length,o=0;for(u=t;o<u;o++)for(a=0,c=e.length-1;a<c;a++){t=l=a+n*o,r=l+n;var f=l+1+n,l=l+1,h=o*s,p=a*i,d=h+s,v=p+i;this.faces.push(new THREE.Face3(t,r,l)),this.faceVertexUvs[0].push([new THREE.Vector2(h,p),new THREE.Vector2(d,p),new THREE.Vector2(h,v)]),this.faces.push(new THREE.Face3(r,f,l)),this.faceVertexUvs[0].push([new THREE.Vector2(d,p),new THREE.Vector2(d,v),new THREE.Vector2(h,v)])}this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.LatheGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.PlaneGeometry=function(e,t,n,r){THREE.Geometry.call(this),this.width=e,this.height=t,this.widthSegments=n||1,this.heightSegments=r||1;var i=e/2,s=t/2;n=this.widthSegments,r=this.heightSegments;var o=n+1,u=r+1,a=this.width/n,f=this.height/r,l=new THREE.Vector3(0,0,1);for(e=0;e<u;e++)for(t=0;t<o;t++)this.vertices.push(new THREE.Vector3(t*a-i,-(e*f-s),0));for(e=0;e<r;e++)for(t=0;t<n;t++){var c=t+o*e,i=t+o*(e+1),s=t+1+o*(e+1),u=t+1+o*e,a=new THREE.Vector2(t/n,1-e/r),f=new THREE.Vector2(t/n,1-(e+1)/r),h=new THREE.Vector2((t+1)/n,1-(e+1)/r),p=new THREE.Vector2((t+1)/n,1-e/r),c=new THREE.Face3(c,i,u);c.normal.copy(l),c.vertexNormals.push(l.clone(),l.clone(),l.clone()),this.faces.push(c),this.faceVertexUvs[0].push([a,f,p]),c=new THREE.Face3(i,s,u),c.normal.copy(l),c.vertexNormals.push(l.clone(),l.clone(),l.clone()),this.faces.push(c),this.faceVertexUvs[0].push([f.clone(),h,p.clone()])}this.computeCentroids()},THREE.PlaneGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.RingGeometry=function(e,t,n,r,i,s){THREE.Geometry.call(this),e=e||0,t=t||50,i=void 0!==i?i:0,s=void 0!==s?s:2*Math.PI,n=void 0!==n?Math.max(3,n):8,r=void 0!==r?Math.max(3,r):8;var o,u=[],a=e,f=(t-e)/r;for(e=0;e<=r;e++){for(o=0;o<=n;o++){var l=new THREE.Vector3,c=i+o/n*s;l.x=a*Math.cos(c),l.y=a*Math.sin(c),this.vertices.push(l),u.push(new THREE.Vector2((l.x/t+1)/2,(l.y/t+1)/2))}a+=f}t=new THREE.Vector3(0,0,1);for(e=0;e<r;e++)for(i=e*n,o=0;o<=n;o++)c=o+i,s=c+e,f=c+n+e,l=c+n+1+e,this.faces.push(new THREE.Face3(s,f,l,[t.clone(),t.clone(),t.clone()])),this.faceVertexUvs[0].push([u[s].clone(),u[f].clone(),u[l].clone()]),s=c+e,f=c+n+1+e,l=c+1+e,this.faces.push(new THREE.Face3(s,f,l,[t.clone(),t.clone(),t.clone()])),this.faceVertexUvs[0].push([u[s].clone(),u[f].clone(),u[l].clone()]);this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,a)},THREE.RingGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.SphereGeometry=function(e,t,n,r,i,s,o){THREE.Geometry.call(this),this.radius=e=e||50,this.widthSegments=t=Math.max(3,Math.floor(t)||8),this.heightSegments=n=Math.max(2,Math.floor(n)||6),this.phiStart=r=void 0!==r?r:0,this.phiLength=i=void 0!==i?i:2*Math.PI,this.thetaStart=s=void 0!==s?s:0,this.thetaLength=o=void 0!==o?o:Math.PI;var u,a,f=[],l=[];for(a=0;a<=n;a++){var c=[],h=[];for(u=0;u<=t;u++){var p=u/t,d=a/n,v=new THREE.Vector3;v.x=-e*Math.cos(r+p*i)*Math.sin(s+d*o),v.y=e*Math.cos(s+d*o),v.z=e*Math.sin(r+p*i)*Math.sin(s+d*o),this.vertices.push(v),c.push(this.vertices.length-1),h.push(new THREE.Vector2(p,1-d))}f.push(c),l.push(h)}for(a=0;a<this.heightSegments;a++)for(u=0;u<this.widthSegments;u++){t=f[a][u+1],n=f[a][u],r=f[a+1][u],i=f[a+1][u+1],s=this.vertices[t].clone().normalize(),o=this.vertices[n].clone().normalize();var c=this.vertices[r].clone().normalize(),h=this.vertices[i].clone().normalize(),p=l[a][u+1].clone(),d=l[a][u].clone(),v=l[a+1][u].clone(),m=l[a+1][u+1].clone();Math.abs(this.vertices[t].y)===this.radius?(p.x=(p.x+d.x)/2,this.faces.push(new THREE.Face3(t,r,i,[s,c,h])),this.faceVertexUvs[0].push([p,v,m])):Math.abs(this.vertices[r].y)===this.radius?(v.x=(v.x+m.x)/2,this.faces.push(new THREE.Face3(t,n,r,[s,o,c])),this.faceVertexUvs[0].push([p,d,v])):(this.faces.push(new THREE.Face3(t,n,i,[s,o,h])),this.faceVertexUvs[0].push([p,d,m]),this.faces.push(new THREE.Face3(n,r,i,[o.clone(),c,h.clone()])),this.faceVertexUvs[0].push([d.clone(),v,m.clone()]))}this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,e)},THREE.SphereGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TextGeometry=function(e,t){t=t||{};var n=THREE.FontUtils.generateShapes(e,t);t.amount=void 0!==t.height?t.height:50,void 0===t.bevelThickness&&(t.bevelThickness=10),void 0===t.bevelSize&&(t.bevelSize=8),void 0===t.bevelEnabled&&(t.bevelEnabled=!1),THREE.ExtrudeGeometry.call(this,n,t)},THREE.TextGeometry.prototype=Object.create(THREE.ExtrudeGeometry.prototype),THREE.TorusGeometry=function(e,t,n,r,i){THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.radialSegments=n||8,this.tubularSegments=r||6,this.arc=i||2*Math.PI,i=new THREE.Vector3,e=[],t=[];for(n=0;n<=this.radialSegments;n++)for(r=0;r<=this.tubularSegments;r++){var s=r/this.tubularSegments*this.arc,o=n/this.radialSegments*Math.PI*2;i.x=this.radius*Math.cos(s),i.y=this.radius*Math.sin(s);var u=new THREE.Vector3;u.x=(this.radius+this.tube*Math.cos(o))*Math.cos(s),u.y=(this.radius+this.tube*Math.cos(o))*Math.sin(s),u.z=this.tube*Math.sin(o),this.vertices.push(u),e.push(new THREE.Vector2(r/this.tubularSegments,n/this.radialSegments)),t.push(u.clone().sub(i).normalize())}for(n=1;n<=this.radialSegments;n++)for(r=1;r<=this.tubularSegments;r++){i=(this.tubularSegments+1)*n+r-1;var s=(this.tubularSegments+1)*(n-1)+r-1,o=(this.tubularSegments+1)*(n-1)+r,u=(this.tubularSegments+1)*n+r,a=new THREE.Face3(i,s,u,[t[i].clone(),t[s].clone(),t[u].clone()]);this.faces.push(a),this.faceVertexUvs[0].push([e[i].clone(),e[s].clone(),e[u].clone()]),a=new THREE.Face3(s,o,u,[t[s].clone(),t[o].clone(),t[u].clone()]),this.faces.push(a),this.faceVertexUvs[0].push([e[s].clone(),e[o].clone(),e[u].clone()])}this.computeCentroids(),this.computeFaceNormals()},THREE.TorusGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TorusKnotGeometry=function(e,t,n,r,i,s,o){function u(e,t,n,r,i){var s=Math.cos(e),o=Math.sin(e);return e*=t/n,t=Math.cos(e),s*=r*(2+t)*.5,o=r*(2+t)*o*.5,r=i*r*Math.sin(e)*.5,new THREE.Vector3(s,o,r)}THREE.Geometry.call(this),this.radius=e||100,this.tube=t||40,this.radialSegments=n||64,this.tubularSegments=r||8,this.p=i||2,this.q=s||3,this.heightScale=o||1,this.grid=Array(this.radialSegments),n=new THREE.Vector3,r=new THREE.Vector3,i=new THREE.Vector3;for(e=0;e<this.radialSegments;++e)for(this.grid[e]=Array(this.tubularSegments),t=e/this.radialSegments*2*this.p*Math.PI,s=u(t,this.q,this.p,this.radius,this.heightScale),t=u(t+.01,this.q,this.p,this.radius,this.heightScale),n.subVectors(t,s),r.addVectors(t,s),i.crossVectors(n,r),r.crossVectors(i,n),i.normalize(),r.normalize(),t=0;t<this.tubularSegments;++t){var a=t/this.tubularSegments*2*Math.PI;o=-this.tube*Math.cos(a);var a=this.tube*Math.sin(a),f=new THREE.Vector3;f.x=s.x+o*r.x+a*i.x,f.y=s.y+o*r.y+a*i.y,f.z=s.z+o*r.z+a*i.z,this.grid[e][t]=this.vertices.push(f)-1}for(e=0;e<this.radialSegments;++e)for(t=0;t<this.tubularSegments;++t){i=(e+1)%this.radialSegments,s=(t+1)%this.tubularSegments,n=this.grid[e][t],r=this.grid[i][t],i=this.grid[i][s],s=this.grid[e][s],o=new THREE.Vector2(e/this.radialSegments,t/this.tubularSegments);var a=new THREE.Vector2((e+1)/this.radialSegments,t/this.tubularSegments),f=new THREE.Vector2((e+1)/this.radialSegments,(t+1)/this.tubularSegments),l=new THREE.Vector2(e/this.radialSegments,(t+1)/this.tubularSegments);this.faces.push(new THREE.Face3(n,r,s)),this.faceVertexUvs[0].push([o,a,l]),this.faces.push(new THREE.Face3(r,i,s)),this.faceVertexUvs[0].push([a.clone(),f,l.clone()])}this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TorusKnotGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry=function(e,t,n,r,i){THREE.Geometry.call(this),this.path=e,this.segments=t||64,this.radius=n||1,this.radialSegments=r||8,this.closed=i||!1,this.grid=[];var s,o;r=this.segments+1;var u,a,f;i=new THREE.Vector3;var l,c;t=new THREE.TubeGeometry.FrenetFrames(this.path,this.segments,this.closed),l=t.normals,c=t.binormals,this.tangents=t.tangents,this.normals=l,this.binormals=c;for(t=0;t<r;t++)for(this.grid[t]=[],n=t/(r-1),f=e.getPointAt(n),s=l[t],o=c[t],n=0;n<this.radialSegments;n++)u=n/this.radialSegments*2*Math.PI,a=-this.radius*Math.cos(u),u=this.radius*Math.sin(u),i.copy(f),i.x+=a*s.x+u*o.x,i.y+=a*s.y+u*o.y,i.z+=a*s.z+u*o.z,this.grid[t][n]=this.vertices.push(new THREE.Vector3(i.x,i.y,i.z))-1;for(t=0;t<this.segments;t++)for(n=0;n<this.radialSegments;n++)i=this.closed?(t+1)%this.segments:t+1,l=(n+1)%this.radialSegments,e=this.grid[t][n],r=this.grid[i][n],i=this.grid[i][l],l=this.grid[t][l],c=new THREE.Vector2(t/this.segments,n/this.radialSegments),s=new THREE.Vector2((t+1)/this.segments,n/this.radialSegments),o=new THREE.Vector2((t+1)/this.segments,(n+1)/this.radialSegments),a=new THREE.Vector2(t/this.segments,(n+1)/this.radialSegments),this.faces.push(new THREE.Face3(e,r,l)),this.faceVertexUvs[0].push([c,s,a]),this.faces.push(new THREE.Face3(r,i,l)),this.faceVertexUvs[0].push([s.clone(),o,a.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.TubeGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TubeGeometry.FrenetFrames=function(e,t,n){new THREE.Vector3;var r=new THREE.Vector3;new THREE.Vector3;var i=[],s=[],o=[],u=new THREE.Vector3,a=new THREE.Matrix4;t+=1;var f,l,c;this.tangents=i,this.normals=s,this.binormals=o;for(f=0;f<t;f++)l=f/(t-1),i[f]=e.getTangentAt(l),i[f].normalize();s[0]=new THREE.Vector3,o[0]=new THREE.Vector3,e=Number.MAX_VALUE,f=Math.abs(i[0].x),l=Math.abs(i[0].y),c=Math.abs(i[0].z),f<=e&&(e=f,r.set(1,0,0)),l<=e&&(e=l,r.set(0,1,0)),c<=e&&r.set(0,0,1),u.crossVectors(i[0],r).normalize(),s[0].crossVectors(i[0],u),o[0].crossVectors(i[0],s[0]);for(f=1;f<t;f++)s[f]=s[f-1].clone(),o[f]=o[f-1].clone(),u.crossVectors(i[f-1],i[f]),1e-4<u.length()&&(u.normalize(),r=Math.acos(THREE.Math.clamp(i[f-1].dot(i[f]),-1,1)),s[f].applyMatrix4(a.makeRotationAxis(u,r))),o[f].crossVectors(i[f],s[f]);if(n)for(r=Math.acos(THREE.Math.clamp(s[0].dot(s[t-1]),-1,1)),r/=t-1,0<i[0].dot(u.crossVectors(s[0],s[t-1]))&&(r=-r),f=1;f<t;f++)s[f].applyMatrix4(a.makeRotationAxis(i[f],r*f)),o[f].crossVectors(i[f],s[f])},THREE.PolyhedronGeometry=function(e,t,n,r){function i(e){var t=e.normalize().clone();t.index=a.vertices.push(t)-1;var n=Math.atan2(e.z,-e.x)/2/Math.PI+.5;return e=Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))/Math.PI+.5,t.uv=new THREE.Vector2(n,1-e),t}function s(e,t,n){var r=new THREE.Face3(e.index,t.index,n.index,[e.clone(),t.clone(),n.clone()]);r.centroid.add(e).add(t).add(n).divideScalar(3),a.faces.push(r),r=r.centroid,r=Math.atan2(r.z,-r.x),a.faceVertexUvs[0].push([u(e.uv,e,r),u(t.uv,t,r),u(n.uv,n,r)])}function o(e,t){var n=Math.pow(2,t);Math.pow(4,t);for(var r=i(a.vertices[e.a]),o=i(a.vertices[e.b]),u=i(a.vertices[e.c]),f=[],l=0;l<=n;l++){f[l]=[];for(var c=i(r.clone().lerp(u,l/n)),h=i(o.clone().lerp(u,l/n)),p=n-l,d=0;d<=p;d++)f[l][d]=0==d&&l==n?c:i(c.clone().lerp(h,d/p))}for(l=0;l<n;l++)for(d=0;d<2*(n-l)-1;d++)r=Math.floor(d/2),0==d%2?s(f[l][r+1],f[l+1][r],f[l][r]):s(f[l][r+1],f[l+1][r+1],f[l+1][r])}function u(e,t,n){return 0>n&&1===e.x&&(e=new THREE.Vector2(e.x-1,e.y)),0===t.x&&0===t.z&&(e=new THREE.Vector2(n/2/Math.PI+.5,e.y)),e.clone()}THREE.Geometry.call(this),n=n||1,r=r||0;for(var a=this,f=0,l=e.length;f<l;f++)i(new THREE.Vector3(e[f][0],e[f][1],e[f][2]));e=this.vertices;for(var c=[],f=0,l=t.length;f<l;f++){var h=e[t[f][0]],p=e[t[f][1]],d=e[t[f][2]];c[f]=new THREE.Face3(h.index,p.index,d.index,[h.clone(),p.clone(),d.clone()])}f=0;for(l=c.length;f<l;f++)o(c[f],r);f=0;for(l=this.faceVertexUvs[0].length;f<l;f++)t=this.faceVertexUvs[0][f],r=t[0].x,e=t[1].x,c=t[2].x,h=Math.max(r,Math.max(e,c)),p=Math.min(r,Math.min(e,c)),.9<h&&.1>p&&(.2>r&&(t[0].x+=1),.2>e&&(t[1].x+=1),.2>c&&(t[2].x+=1));f=0;for(l=this.vertices.length;f<l;f++)this.vertices[f].multiplyScalar(n);this.mergeVertices(),this.computeCentroids(),this.computeFaceNormals(),this.boundingSphere=new THREE.Sphere(new THREE.Vector3,n)},THREE.PolyhedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.IcosahedronGeometry=function(e,t){this.radius=e,this.detail=t;var n=(1+Math.sqrt(5))/2;THREE.PolyhedronGeometry.call(this,[[-1,n,0],[1,n,0],[-1,-n,0],[1,-n,0],[0,-1,n],[0,1,n],[0,-1,-n],[0,1,-n],[n,0,-1],[n,0,1],[-n,0,-1],[-n,0,1]],[[0,11,5],[0,5,1],[0,1,7],[0,7,10],[0,10,11],[1,5,9],[5,11,4],[11,10,2],[10,7,6],[7,1,8],[3,9,4],[3,4,2],[3,2,6],[3,6,8],[3,8,9],[4,9,5],[2,4,11],[6,2,10],[8,6,7],[9,8,1]],e,t)},THREE.IcosahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.OctahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,0,0],[-1,0,0],[0,1,0],[0,-1,0],[0,0,1],[0,0,-1]],[[0,2,4],[0,4,3],[0,3,5],[0,5,2],[1,2,5],[1,5,3],[1,3,4],[1,4,2]],e,t)},THREE.OctahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.TetrahedronGeometry=function(e,t){THREE.PolyhedronGeometry.call(this,[[1,1,1],[-1,-1,1],[-1,1,-1],[1,-1,-1]],[[2,1,0],[0,3,2],[1,3,0],[2,3,1]],e,t)},THREE.TetrahedronGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.ParametricGeometry=function(e,t,n){THREE.Geometry.call(this);var r=this.vertices,i=this.faces,s=this.faceVertexUvs[0],o,u,a,f,l=t+1;for(o=0;o<=n;o++)for(f=o/n,u=0;u<=t;u++)a=u/t,a=e(a,f),r.push(a);var c,h,p,d;for(o=0;o<n;o++)for(u=0;u<t;u++)e=o*l+u,r=o*l+u+1,f=(o+1)*l+u+1,a=(o+1)*l+u,c=new THREE.Vector2(u/t,o/n),h=new THREE.Vector2((u+1)/t,o/n),p=new THREE.Vector2((u+1)/t,(o+1)/n),d=new THREE.Vector2(u/t,(o+1)/n),i.push(new THREE.Face3(e,r,a)),s.push([c,h,d]),i.push(new THREE.Face3(r,f,a)),s.push([h.clone(),p,d.clone()]);this.computeCentroids(),this.computeFaceNormals(),this.computeVertexNormals()},THREE.ParametricGeometry.prototype=Object.create(THREE.Geometry.prototype),THREE.AxisHelper=function(e){e=e||1;var t=new THREE.Geometry;t.vertices.push(new THREE.Vector3,new THREE.Vector3(e,0,0),new THREE.Vector3,new THREE.Vector3(0,e,0),new THREE.Vector3,new THREE.Vector3(0,0,e)),t.colors.push(new THREE.Color(16711680),new THREE.Color(16755200),new THREE.Color(65280),new THREE.Color(11206400),new THREE.Color(255),new THREE.Color(43775)),e=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors}),THREE.Line.call(this,t,e,THREE.LinePieces)},THREE.AxisHelper.prototype=Object.create(THREE.Line.prototype),THREE.ArrowHelper=function(e,t,n,r,i,s){THREE.Object3D.call(this),void 0===r&&(r=16776960),void 0===n&&(n=1),void 0===i&&(i=.2*n),void 0===s&&(s=.2*i),this.position=t,t=new THREE.Geometry,t.vertices.push(new THREE.Vector3(0,0,0)),t.vertices.push(new THREE.Vector3(0,1,0)),this.line=new THREE.Line(t,new THREE.LineBasicMaterial({color:r})),this.line.matrixAutoUpdate=!1,this.add(this.line),t=new THREE.CylinderGeometry(0,.5,1,5,1),t.applyMatrix((new THREE.Matrix4).makeTranslation(0,-0.5,0)),this.cone=new THREE.Mesh(t,new THREE.MeshBasicMaterial({color:r})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,i,s)},THREE.ArrowHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.ArrowHelper.prototype.setDirection=function(){var e=new THREE.Vector3,t;return function(n){.99999<n.y?this.quaternion.set(0,0,0,1):-0.99999>n.y?this.quaternion.set(1,0,0,0):(e.set(n.z,0,-n.x).normalize(),t=Math.acos(n.y),this.quaternion.setFromAxisAngle(e,t))}}(),THREE.ArrowHelper.prototype.setLength=function(e,t,n){void 0===t&&(t=.2*e),void 0===n&&(n=.2*t),this.line.scale.set(1,e,1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()},THREE.ArrowHelper.prototype.setColor=function(e){this.line.material.color.setHex(e),this.cone.material.color.setHex(e)},THREE.BoxHelper=function(e){var t=[new THREE.Vector3(1,1,1),new THREE.Vector3(-1,1,1),new THREE.Vector3(-1,-1,1),new THREE.Vector3(1,-1,1),new THREE.Vector3(1,1,-1),new THREE.Vector3(-1,1,-1),new THREE.Vector3(-1,-1,-1),new THREE.Vector3(1,-1,-1)];this.vertices=t;var n=new THREE.Geometry;n.vertices.push(t[0],t[1],t[1],t[2],t[2],t[3],t[3],t[0],t[4],t[5],t[5],t[6],t[6],t[7],t[7],t[4],t[0],t[4],t[1],t[5],t[2],t[6],t[3],t[7]),THREE.Line.call(this,n,new THREE.LineBasicMaterial({color:16776960}),THREE.LinePieces),void 0!==e&&this.update(e)},THREE.BoxHelper.prototype=Object.create(THREE.Line.prototype),THREE.BoxHelper.prototype.update=function(e){var t=e.geometry;null===t.boundingBox&&t.computeBoundingBox();var n=t.boundingBox.min,t=t.boundingBox.max,r=this.vertices;r[0].set(t.x,t.y,t.z),r[1].set(n.x,t.y,t.z),r[2].set(n.x,n.y,t.z),r[3].set(t.x,n.y,t.z),r[4].set(t.x,t.y,n.z),r[5].set(n.x,t.y,n.z),r[6].set(n.x,n.y,n.z),r[7].set(t.x,n.y,n.z),this.geometry.computeBoundingSphere(),this.geometry.verticesNeedUpdate=!0,this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.BoundingBoxHelper=function(e,t){var n=void 0!==t?t:8947848;this.object=e,this.box=new THREE.Box3,THREE.Mesh.call(this,new THREE.BoxGeometry(1,1,1),new THREE.MeshBasicMaterial({color:n,wireframe:!0}))},THREE.BoundingBoxHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.BoundingBoxHelper.prototype.update=function(){this.box.setFromObject(this.object),this.box.size(this.scale),this.box.center(this.position)},THREE.CameraHelper=function(e){function t(e,t,r){n(e,r),n(t,r)}function n(e,t){r.vertices.push(new THREE.Vector3),r.colors.push(new THREE.Color(t)),void 0===s[e]&&(s[e]=[]),s[e].push(r.vertices.length-1)}var r=new THREE.Geometry,i=new THREE.LineBasicMaterial({color:16777215,vertexColors:THREE.FaceColors}),s={};t("n1","n2",16755200),t("n2","n4",16755200),t("n4","n3",16755200),t("n3","n1",16755200),t("f1","f2",16755200),t("f2","f4",16755200),t("f4","f3",16755200),t("f3","f1",16755200),t("n1","f1",16755200),t("n2","f2",16755200),t("n3","f3",16755200),t("n4","f4",16755200),t("p","n1",16711680),t("p","n2",16711680),t("p","n3",16711680),t("p","n4",16711680),t("u1","u2",43775),t("u2","u3",43775),t("u3","u1",43775),t("c","t",16777215),t("p","c",3355443),t("cn1","cn2",3355443),t("cn3","cn4",3355443),t("cf1","cf2",3355443),t("cf3","cf4",3355443),THREE.Line.call(this,r,i,THREE.LinePieces),this.camera=e,this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=s,this.update()},THREE.CameraHelper.prototype=Object.create(THREE.Line.prototype),THREE.CameraHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Camera,n=new THREE.Projector;return function(){function r(r,s,o,u){e.set(s,o,u),n.unprojectVector(e,t),r=i.pointMap[r];if(void 0!==r)for(s=0,o=r.length;s<o;s++)i.geometry.vertices[r[s]].copy(e)}var i=this;t.projectionMatrix.copy(this.camera.projectionMatrix),r("c",0,0,-1),r("t",0,0,1),r("n1",-1,-1,-1),r("n2",1,-1,-1),r("n3",-1,1,-1),r("n4",1,1,-1),r("f1",-1,-1,1),r("f2",1,-1,1),r("f3",-1,1,1),r("f4",1,1,1),r("u1",.7,1.1,-1),r("u2",-0.7,1.1,-1),r("u3",0,2,-1),r("cf1",-1,0,1),r("cf2",1,0,1),r("cf3",0,-1,1),r("cf4",0,1,1),r("cn1",-1,0,-1),r("cn2",1,0,-1),r("cn3",0,-1,-1),r("cn4",0,1,-1),this.geometry.verticesNeedUpdate=!0}}(),THREE.DirectionalLightHelper=function(e,t){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,t=t||1;var n=new THREE.PlaneGeometry(t,t),r=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.lightPlane=new THREE.Mesh(n,r),this.add(this.lightPlane),n=new THREE.Geometry,n.vertices.push(new THREE.Vector3),n.vertices.push(new THREE.Vector3),r=new THREE.LineBasicMaterial({fog:!1}),r.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine=new THREE.Line(n,r),this.add(this.targetLine),this.update()},THREE.DirectionalLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.DirectionalLightHelper.prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},THREE.DirectionalLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3,n=new THREE.Vector3;return function(){e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),n.subVectors(t,e),this.lightPlane.lookAt(n),this.lightPlane.material.color.copy(this.light.color).multiplyScalar(this.light.intensity),this.targetLine.geometry.vertices[1].copy(n),this.targetLine.geometry.verticesNeedUpdate=!0,this.targetLine.material.color.copy(this.lightPlane.material.color)}}(),THREE.EdgesHelper=function(e,t){var n=void 0!==t?t:16777215,r=[0,0],i={},s=function(e,t){return e-t},o=["a","b","c"],u=new THREE.BufferGeometry,a=e.geometry.clone();a.mergeVertices(),a.computeFaceNormals();for(var f=a.vertices,a=a.faces,l=0,c=0,h=a.length;c<h;c++)for(var p=a[c],d=0;3>d;d++){r[0]=p[o[d]],r[1]=p[o[(d+1)%3]],r.sort(s);var v=r.toString();void 0===i[v]?(i[v]={vert1:r[0],vert2:r[1],face1:c,face2:void 0},l++):i[v].face2=c}u.addAttribute("position",Float32Array,2*l,3),r=u.attributes.position.array,s=0;for(v in i)if(o=i[v],void 0===o.face2||.9999>a[o.face1].normal.dot(a[o.face2].normal))l=f[o.vert1],r[s++]=l.x,r[s++]=l.y,r[s++]=l.z,l=f[o.vert2],r[s++]=l.x,r[s++]=l.y,r[s++]=l.z;THREE.Line.call(this,u,new THREE.LineBasicMaterial({color:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.EdgesHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1,e=void 0!==n?n:16776960,r=void 0!==r?r:1,t=new THREE.Geometry,n=0;for(var i=this.object.geometry.faces.length;n<i;n++)t.vertices.push(new THREE.Vector3),t.vertices.push(new THREE.Vector3);THREE.Line.call(this,t,new THREE.LineBasicMaterial({color:e,linewidth:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.FaceNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.FaceNormalsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld),e=this.geometry.vertices;for(var n=this.object.geometry.faces,r=this.object.matrixWorld,i=0,s=n.length;i<s;i++){var o=n[i];t.copy(o.normal).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size);var u=2*i;e[u].copy(o.centroid).applyMatrix4(r),e[u+1].addVectors(e[u],t)}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.GridHelper=function(e,t){var n=new THREE.Geometry,r=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors});this.color1=new THREE.Color(4473924),this.color2=new THREE.Color(8947848);for(var i=-e;i<=e;i+=t){n.vertices.push(new THREE.Vector3(-e,0,i),new THREE.Vector3(e,0,i),new THREE.Vector3(i,0,-e),new THREE.Vector3(i,0,e));var s=0===i?this.color1:this.color2;n.colors.push(s,s,s,s)}THREE.Line.call(this,n,r,THREE.LinePieces)},THREE.GridHelper.prototype=Object.create(THREE.Line.prototype),THREE.GridHelper.prototype.setColors=function(e,t){this.color1.set(e),this.color2.set(t),this.geometry.colorsNeedUpdate=!0},THREE.HemisphereLightHelper=function(e,t,n,r){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,this.colors=[new THREE.Color,new THREE.Color],e=new THREE.SphereGeometry(t,4,2),e.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));for(t=0;8>t;t++)e.faces[t].color=this.colors[4>t?0:1];t=new THREE.MeshBasicMaterial({vertexColors:THREE.FaceColors,wireframe:!0}),this.lightSphere=new THREE.Mesh(e,t),this.add(this.lightSphere),this.update()},THREE.HemisphereLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.HemisphereLightHelper.prototype.dispose=function(){this.lightSphere.geometry.dispose(),this.lightSphere.material.dispose()},THREE.HemisphereLightHelper.prototype.update=function(){var e=new THREE.Vector3;return function(){this.colors[0].copy(this.light.color).multiplyScalar(this.light.intensity),this.colors[1].copy(this.light.groundColor).multiplyScalar(this.light.intensity),this.lightSphere.lookAt(e.setFromMatrixPosition(this.light.matrixWorld).negate()),this.lightSphere.geometry.colorsNeedUpdate=!0}}(),THREE.PointLightHelper=function(e,t){this.light=e,this.light.updateMatrixWorld();var n=new THREE.SphereGeometry(t,4,2),r=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});r.color.copy(this.light.color).multiplyScalar(this.light.intensity),THREE.Mesh.call(this,n,r),this.matrixWorld=this.light.matrixWorld,this.matrixAutoUpdate=!1},THREE.PointLightHelper.prototype=Object.create(THREE.Mesh.prototype),THREE.PointLightHelper.prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},THREE.PointLightHelper.prototype.update=function(){this.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)},THREE.SpotLightHelper=function(e){THREE.Object3D.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrixWorld=e.matrixWorld,this.matrixAutoUpdate=!1,e=new THREE.CylinderGeometry(0,1,1,8,1,!0),e.applyMatrix((new THREE.Matrix4).makeTranslation(0,-0.5,0)),e.applyMatrix((new THREE.Matrix4).makeRotationX(-Math.PI/2));var t=new THREE.MeshBasicMaterial({wireframe:!0,fog:!1});this.cone=new THREE.Mesh(e,t),this.add(this.cone),this.update()},THREE.SpotLightHelper.prototype=Object.create(THREE.Object3D.prototype),THREE.SpotLightHelper.prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},THREE.SpotLightHelper.prototype.update=function(){var e=new THREE.Vector3,t=new THREE.Vector3;return function(){var n=this.light.distance?this.light.distance:1e4,r=n*Math.tan(this.light.angle);this.cone.scale.set(r,r,n),e.setFromMatrixPosition(this.light.matrixWorld),t.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(t.sub(e)),this.cone.material.color.copy(this.light.color).multiplyScalar(this.light.intensity)}}(),THREE.VertexNormalsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1,t=void 0!==n?n:16711680,r=void 0!==r?r:1,n=new THREE.Geometry,e=e.geometry.faces;for(var i=0,s=e.length;i<s;i++)for(var o=0,u=e[i].vertexNormals.length;o<u;o++)n.vertices.push(new THREE.Vector3),n.vertices.push(new THREE.Vector3);THREE.Line.call(this,n,new THREE.LineBasicMaterial({color:t,linewidth:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.normalMatrix=new THREE.Matrix3,this.update()},THREE.VertexNormalsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexNormalsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){e=["a","b","c","d"],this.object.updateMatrixWorld(!0),this.normalMatrix.getNormalMatrix(this.object.matrixWorld);for(var n=this.geometry.vertices,r=this.object.geometry.vertices,i=this.object.geometry.faces,s=this.object.matrixWorld,o=0,u=0,a=i.length;u<a;u++)for(var f=i[u],l=0,c=f.vertexNormals.length;l<c;l++){var h=f.vertexNormals[l];n[o].copy(r[f[e[l]]]).applyMatrix4(s),t.copy(h).applyMatrix3(this.normalMatrix).normalize().multiplyScalar(this.size),t.add(n[o]),o+=1,n[o].copy(t),o+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.VertexTangentsHelper=function(e,t,n,r){this.object=e,this.size=void 0!==t?t:1,t=void 0!==n?n:255,r=void 0!==r?r:1,n=new THREE.Geometry,e=e.geometry.faces;for(var i=0,s=e.length;i<s;i++)for(var o=0,u=e[i].vertexTangents.length;o<u;o++)n.vertices.push(new THREE.Vector3),n.vertices.push(new THREE.Vector3);THREE.Line.call(this,n,new THREE.LineBasicMaterial({color:t,linewidth:r}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.update()},THREE.VertexTangentsHelper.prototype=Object.create(THREE.Line.prototype),THREE.VertexTangentsHelper.prototype.update=function(e){var t=new THREE.Vector3;return function(e){e=["a","b","c","d"],this.object.updateMatrixWorld(!0);for(var n=this.geometry.vertices,r=this.object.geometry.vertices,i=this.object.geometry.faces,s=this.object.matrixWorld,o=0,u=0,a=i.length;u<a;u++)for(var f=i[u],l=0,c=f.vertexTangents.length;l<c;l++){var h=f.vertexTangents[l];n[o].copy(r[f[e[l]]]).applyMatrix4(s),t.copy(h).transformDirection(s).multiplyScalar(this.size),t.add(n[o]),o+=1,n[o].copy(t),o+=1}return this.geometry.verticesNeedUpdate=!0,this}}(),THREE.WireframeHelper=function(e,t){var n=void 0!==t?t:16777215,r=[0,0],i={},s=function(e,t){return e-t},o=["a","b","c"],u=new THREE.BufferGeometry;if(e.geometry instanceof THREE.Geometry){for(var a=e.geometry.vertices,f=e.geometry.faces,l=0,c=new Uint32Array(6*f.length),h=0,p=f.length;h<p;h++)for(var d=f[h],v=0;3>v;v++){r[0]=d[o[v]],r[1]=d[o[(v+1)%3]],r.sort(s);var m=r.toString();void 0===i[m]&&(c[2*l]=r[0],c[2*l+1]=r[1],i[m]=!0,l++)}u.addAttribute("position",Float32Array,2*l,3),r=u.attributes.position.array,h=0;for(p=l;h<p;h++)for(v=0;2>v;v++)l=a[c[2*h+v]],o=6*h+3*v,r[o+0]=l.x,r[o+1]=l.y,r[o+2]=l.z}else if(e.geometry instanceof THREE.BufferGeometry&&void 0!==e.geometry.attributes.index){for(var a=e.geometry.attributes.position.array,p=e.geometry.attributes.index.array,f=e.geometry.offsets,l=0,c=new Uint32Array(2*p.length),d=0,g=f.length;d<g;++d)for(var v=f[d].start,m=f[d].count,o=f[d].index,h=v,y=v+m;h<y;h+=3)for(v=0;3>v;v++)r[0]=o+p[h+v],r[1]=o+p[h+(v+1)%3],r.sort(s),m=r.toString(),void 0===i[m]&&(c[2*l]=r[0],c[2*l+1]=r[1],i[m]=!0,l++);u.addAttribute("position",Float32Array,2*l,3),r=u.attributes.position.array,h=0;for(p=l;h<p;h++)for(v=0;2>v;v++)o=6*h+3*v,l=3*c[2*h+v],r[o+0]=a[l],r[o+1]=a[l+1],r[o+2]=a[l+2]}else if(e.geometry instanceof THREE.BufferGeometry)for(a=e.geometry.attributes.position.array,l=a.length/3,c=l/3,u.addAttribute("position",Float32Array,2*l,3),r=u.attributes.position.array,h=0,p=c;h<p;h++)for(v=0;3>v;v++)o=18*h+6*v,c=9*h+3*v,r[o+0]=a[c],r[o+1]=a[c+1],r[o+2]=a[c+2],l=9*h+(v+1)%3*3,r[o+3]=a[l],r[o+4]=a[l+1],r[o+5]=a[l+2];THREE.Line.call(this,u,new THREE.LineBasicMaterial({color:n}),THREE.LinePieces),this.matrixAutoUpdate=!1,this.matrixWorld=e.matrixWorld},THREE.WireframeHelper.prototype=Object.create(THREE.Line.prototype),THREE.ImmediateRenderObject=function(){THREE.Object3D.call(this),this.render=function(e){}},THREE.ImmediateRenderObject.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare=function(e,t,n,r,i){THREE.Object3D.call(this),this.lensFlares=[],this.positionScreen=new THREE.Vector3,this.customUpdateCallback=void 0,void 0!==e&&this.add(e,t,n,r,i)},THREE.LensFlare.prototype=Object.create(THREE.Object3D.prototype),THREE.LensFlare.prototype.add=function(e,t,n,r,i,s){void 0===t&&(t=-1),void 0===n&&(n=0),void 0===s&&(s=1),void 0===i&&(i=new THREE.Color(16777215)),void 0===r&&(r=THREE.NormalBlending),n=Math.min(n,Math.max(0,n)),this.lensFlares.push({texture:e,size:t,distance:n,x:0,y:0,z:0,scale:1,rotation:1,opacity:s,color:i,blending:r})},THREE.LensFlare.prototype.updateLensFlares=function(){var e,t=this.lensFlares.length,n,r=2*-this.positionScreen.x,i=2*-this.positionScreen.y;for(e=0;e<t;e++)n=this.lensFlares[e],n.x=this.positionScreen.x+r*n.distance,n.y=this.positionScreen.y+i*n.distance,n.wantedRotation=n.x*Math.PI*.25,n.rotation+=.25*(n.wantedRotation-n.rotation)},THREE.MorphBlendMesh=function(e,t){THREE.Mesh.call(this,e,t),this.animationsMap={},this.animationsList=[];var n=this.geometry.morphTargets.length;this.createAnimation("__default",0,n-1,n/1),this.setAnimationWeight("__default",1)},THREE.MorphBlendMesh.prototype=Object.create(THREE.Mesh.prototype),THREE.MorphBlendMesh.prototype.createAnimation=function(e,t,n,r){t={startFrame:t,endFrame:n,length:n-t+1,fps:r,duration:(n-t)/r,lastFrame:0,currentFrame:0,active:!1,time:0,direction:1,weight:1,directionBackwards:!1,mirroredLoop:!1},this.animationsMap[e]=t,this.animationsList.push(t)},THREE.MorphBlendMesh.prototype.autoCreateAnimations=function(e){for(var t=/([a-z]+)(\d+)/,n,r={},i=this.geometry,s=0,o=i.morphTargets.length;s<o;s++){var u=i.morphTargets[s].name.match(t);if(u&&1<u.length){var a=u[1];r[a]||(r[a]={start:Infinity,end:-Infinity}),u=r[a],s<u.start&&(u.start=s),s>u.end&&(u.end=s),n||(n=a)}}for(a in r)u=r[a],this.createAnimation(a,u.start,u.end,e);this.firstAnimation=n},THREE.MorphBlendMesh.prototype.setAnimationDirectionForward=function(e){if(e=this.animationsMap[e])e.direction=1,e.directionBackwards=!1},THREE.MorphBlendMesh.prototype.setAnimationDirectionBackward=function(e){if(e=this.animationsMap[e])e.direction=-1,e.directionBackwards=!0},THREE.MorphBlendMesh.prototype.setAnimationFPS=function(e,t){var n=this.animationsMap[e];n&&(n.fps=t,n.duration=(n.end-n.start)/n.fps)},THREE.MorphBlendMesh.prototype.setAnimationDuration=function(e,t){var n=this.animationsMap[e];n&&(n.duration=t,n.fps=(n.end-n.start)/n.duration)},THREE.MorphBlendMesh.prototype.setAnimationWeight=function(e,t){var n=this.animationsMap[e];n&&(n.weight=t)},THREE.MorphBlendMesh.prototype.setAnimationTime=function(e,t){var n=this.animationsMap[e];n&&(n.time=t)},THREE.MorphBlendMesh.prototype.getAnimationTime=function(e){var t=0;if(e=this.animationsMap[e])t=e.time;return t},THREE.MorphBlendMesh.prototype.getAnimationDuration=function(e){var t=-1;if(e=this.animationsMap[e])t=e.duration;return t},THREE.MorphBlendMesh.prototype.playAnimation=function(e){var t=this.animationsMap[e];t?(t.time=0,t.active=!0):console.warn("animation["+e+"] undefined")},THREE.MorphBlendMesh.prototype.stopAnimation=function(e){if(e=this.animationsMap[e])e.active=!1},THREE.MorphBlendMesh.prototype.update=function(e){for(var t=0,n=this.animationsList.length;t<n;t++){var r=this.animationsList[t];if(r.active){var i=r.duration/r.length;r.time+=r.direction*e;if(r.mirroredLoop){if(r.time>r.duration||0>r.time)r.direction*=-1,r.time>r.duration&&(r.time=r.duration,r.directionBackwards=!0),0>r.time&&(r.time=0,r.directionBackwards=!1)}else r.time%=r.duration,0>r.time&&(r.time+=r.duration);var s=r.startFrame+THREE.Math.clamp(Math.floor(r.time/i),0,r.length-1),o=r.weight;s!==r.currentFrame&&(this.morphTargetInfluences[r.lastFrame]=0,this.morphTargetInfluences[r.currentFrame]=1*o,this.morphTargetInfluences[s]=0,r.lastFrame=r.currentFrame,r.currentFrame=s),i=r.time%i/i,r.directionBackwards&&(i=1-i),this.morphTargetInfluences[r.currentFrame]=i*o,this.morphTargetInfluences[r.lastFrame]=(1-i)*o}}},THREE.LensFlarePlugin=function(){function e(e,n){var r=t.createProgram(),i=t.createShader(t.FRAGMENT_SHADER),s=t.createShader(t.VERTEX_SHADER),o="precision "+n+" float;\n";return t.shaderSource(i,o+e.fragmentShader),t.shaderSource(s,o+e.vertexShader),t.compileShader(i),t.compileShader(s),t.attachShader(r,i),t.attachShader(r,s),t.linkProgram(r),r}var t,n,r,i,s,o,u,a,f,l,c,h,p;this.init=function(v){t=v.context,n=v,r=v.getPrecision(),i=new Float32Array(16),s=new Uint16Array(6),v=0,i[v++]=-1,i[v++]=-1,i[v++]=0,i[v++]=0,i[v++]=1,i[v++]=-1,i[v++]=1,i[v++]=0,i[v++]=1,i[v++]=1,i[v++]=1,i[v++]=1,i[v++]=-1,i[v++]=1,i[v++]=0,i[v++]=1,v=0,s[v++]=0,s[v++]=1,s[v++]=2,s[v++]=0,s[v++]=2,s[v++]=3,o=t.createBuffer(),u=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,o),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.bufferData(t.ELEMENT_ARRAY_BUFFER,s,t.STATIC_DRAW),a=t.createTexture(),f=t.createTexture(),t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGB,16,16,0,t.RGB,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),t.bindTexture(t.TEXTURE_2D,f),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,16,16,0,t.RGBA,t.UNSIGNED_BYTE,null),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.NEAREST),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.NEAREST),0>=t.getParameter(t.MAX_VERTEX_TEXTURE_IMAGE_UNITS)?(l=!1,c=e(THREE.ShaderFlares.lensFlare,r)):(l=!0,c=e(THREE.ShaderFlares.lensFlareVertexTexture,r)),h={},p={},h.vertex=t.getAttribLocation(c,"position"),h.uv=t.getAttribLocation(c,"uv"),p.renderType=t.getUniformLocation(c,"renderType"),p.map=t.getUniformLocation(c,"map"),p.occlusionMap=t.getUniformLocation(c,"occlusionMap"),p.opacity=t.getUniformLocation(c,"opacity"),p.color=t.getUniformLocation(c,"color"),p.scale=t.getUniformLocation(c,"scale"),p.rotation=t.getUniformLocation(c,"rotation"),p.screenPosition=t.getUniformLocation(c,"screenPosition")},this.render=function(e,r,i,s){e=e.__webglFlares;var d=e.length;if(d){var v=new THREE.Vector3,m=s/i,y=.5*i,w=.5*s,E=16/s,S=new THREE.Vector2(E*m,E),x=new THREE.Vector3(1,1,0),T=new THREE.Vector2(1,1),N=p,E=h;t.useProgram(c),t.enableVertexAttribArray(h.vertex),t.enableVertexAttribArray(h.uv),t.uniform1i(N.occlusionMap,0),t.uniform1i(N.map,1),t.bindBuffer(t.ARRAY_BUFFER,o),t.vertexAttribPointer(E.vertex,2,t.FLOAT,!1,16,0),t.vertexAttribPointer(E.uv,2,t.FLOAT,!1,16,8),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,u),t.disable(t.CULL_FACE),t.depthMask(!1);var C,L,A,O,M;for(C=0;C<d;C++)if(E=16/s,S.set(E*m,E),O=e[C],v.set(O.matrixWorld.elements[12],O.matrixWorld.elements[13],O.matrixWorld.elements[14]),v.applyMatrix4(r.matrixWorldInverse),v.applyProjection(r.projectionMatrix),x.copy(v),T.x=x.x*y+y,T.y=x.y*w+w,l||0<T.x&&T.x<i&&0<T.y&&T.y<s)for(t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,a),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGB,T.x-8,T.y-8,16,16,0),t.uniform1i(N.renderType,0),t.uniform2f(N.scale,S.x,S.y),t.uniform3f(N.screenPosition,x.x,x.y,x.z),t.disable(t.BLEND),t.enable(t.DEPTH_TEST),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),t.activeTexture(t.TEXTURE0),t.bindTexture(t.TEXTURE_2D,f),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,T.x-8,T.y-8,16,16,0),t.uniform1i(N.renderType,1),t.disable(t.DEPTH_TEST),t.activeTexture(t.TEXTURE1),t.bindTexture(t.TEXTURE_2D,a),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0),O.positionScreen.copy(x),O.customUpdateCallback?O.customUpdateCallback(O):O.updateLensFlares(),t.uniform1i(N.renderType,2),t.enable(t.BLEND),L=0,A=O.lensFlares.length;L<A;L++)M=O.lensFlares[L],.001<M.opacity&&.001<M.scale&&(x.x=M.x,x.y=M.y,x.z=M.z,E=M.size*M.scale/s,S.x=E*m,S.y=E,t.uniform3f(N.screenPosition,x.x,x.y,x.z),t.uniform2f(N.scale,S.x,S.y),t.uniform1f(N.rotation,M.rotation),t.uniform1f(N.opacity,M.opacity),t.uniform3f(N.color,M.color.r,M.color.g,M.color.b),n.setBlending(M.blending,M.blendEquation,M.blendSrc,M.blendDst),n.setTexture(M.texture,1),t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0));t.enable(t.CULL_FACE),t.enable(t.DEPTH_TEST),t.depthMask(!0)}}},THREE.ShadowMapPlugin=function(){var e,t,n,r,i,s,o=new THREE.Frustum,u=new THREE.Matrix4,a=new THREE.Vector3,f=new THREE.Vector3,l=new THREE.Vector3;this.init=function(o){e=o.context,t=o,o=THREE.ShaderLib.depthRGBA;var u=THREE.UniformsUtils.clone(o.uniforms);n=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u}),r=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0}),i=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,skinning:!0}),s=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0},this.render=function(e,n){t.shadowMapEnabled&&t.shadowMapAutoUpdate&&this.update(e,n)},this.update=function(p,v){var m,y,w,E,S,x,T,N,C,L=[];E=0,e.clearColor(1,1,1,1),e.disable(e.BLEND),e.enable(e.CULL_FACE),e.frontFace(e.CCW),t.shadowMapCullFace===THREE.CullFaceFront?e.cullFace(e.FRONT):e.cullFace(e.BACK),t.setDepthTest(!0),m=0;for(y=p.__lights.length;m<y;m++)if(w=p.__lights[m],w.castShadow)if(w instanceof THREE.DirectionalLight&&w.shadowCascade)for(S=0;S<w.shadowCascadeCount;S++){var A;if(w.shadowCascadeArray[S])A=w.shadowCascadeArray[S];else{C=w,T=S,A=new THREE.DirectionalLight,A.isVirtual=!0,A.onlyShadow=!0,A.castShadow=!0,A.shadowCameraNear=C.shadowCameraNear,A.shadowCameraFar=C.shadowCameraFar,A.shadowCameraLeft=C.shadowCameraLeft,A.shadowCameraRight=C.shadowCameraRight,A.shadowCameraBottom=C.shadowCameraBottom,A.shadowCameraTop=C.shadowCameraTop,A.shadowCameraVisible=C.shadowCameraVisible,A.shadowDarkness=C.shadowDarkness,A.shadowBias=C.shadowCascadeBias[T],A.shadowMapWidth=C.shadowCascadeWidth[T],A.shadowMapHeight=C.shadowCascadeHeight[T],A.pointsWorld=[],A.pointsFrustum=[],N=A.pointsWorld,x=A.pointsFrustum;for(var O=0;8>O;O++)N[O]=new THREE.Vector3,x[O]=new THREE.Vector3;N=C.shadowCascadeNearZ[T],C=C.shadowCascadeFarZ[T],x[0].set(-1,-1,N),x[1].set(1,-1,N),x[2].set(-1,1,N),x[3].set(1,1,N),x[4].set(-1,-1,C),x[5].set(1,-1,C),x[6].set(-1,1,C),x[7].set(1,1,C),A.originalCamera=v,x=new THREE.Gyroscope,x.position=w.shadowCascadeOffset,x.add(A),x.add(A.target),v.add(x),w.shadowCascadeArray[S]=A,console.log("Created virtualLight",A)}T=w,N=S,C=T.shadowCascadeArray[N],C.position.copy(T.position),C.target.position.copy(T.target.position),C.lookAt(C.target),C.shadowCameraVisible=T.shadowCameraVisible,C.shadowDarkness=T.shadowDarkness,C.shadowBias=T.shadowCascadeBias[N],x=T.shadowCascadeNearZ[N],T=T.shadowCascadeFarZ[N],C=C.pointsFrustum,C[0].z=x,C[1].z=x,C[2].z=x,C[3].z=x,C[4].z=T,C[5].z=T,C[6].z=T,C[7].z=T,L[E]=A,E++}else L[E]=w,E++;m=0;for(y=L.length;m<y;m++){w=L[m],w.shadowMap||(S=THREE.LinearFilter,t.shadowMapType===THREE.PCFSoftShadowMap&&(S=THREE.NearestFilter),w.shadowMap=new THREE.WebGLRenderTarget(w.shadowMapWidth,w.shadowMapHeight,{minFilter:S,magFilter:S,format:THREE.RGBAFormat}),w.shadowMapSize=new THREE.Vector2(w.shadowMapWidth,w.shadowMapHeight),w.shadowMatrix=new THREE.Matrix4);if(!w.shadowCamera){if(w instanceof THREE.SpotLight)w.shadowCamera=new THREE.PerspectiveCamera(w.shadowCameraFov,w.shadowMapWidth/w.shadowMapHeight,w.shadowCameraNear,w.shadowCameraFar);else{if(!(w instanceof THREE.DirectionalLight)){console.error("Unsupported light type for shadow");continue}w.shadowCamera=new THREE.OrthographicCamera(w.shadowCameraLeft,w.shadowCameraRight,w.shadowCameraTop,w.shadowCameraBottom,w.shadowCameraNear,w.shadowCameraFar)}p.add(w.shadowCamera),!0===p.autoUpdate&&p.updateMatrixWorld()}w.shadowCameraVisible&&!w.cameraHelper&&(w.cameraHelper=new THREE.CameraHelper(w.shadowCamera),w.shadowCamera.add(w.cameraHelper));if(w.isVirtual&&A.originalCamera==v){S=v,E=w.shadowCamera,x=w.pointsFrustum,C=w.pointsWorld,a.set(Infinity,Infinity,Infinity),f.set(-Infinity,-Infinity,-Infinity);for(T=0;8>T;T++)N=C[T],N.copy(x[T]),THREE.ShadowMapPlugin.__projector.unprojectVector(N,S),N.applyMatrix4(E.matrixWorldInverse),N.x<a.x&&(a.x=N.x),N.x>f.x&&(f.x=N.x),N.y<a.y&&(a.y=N.y),N.y>f.y&&(f.y=N.y),N.z<a.z&&(a.z=N.z),N.z>f.z&&(f.z=N.z);E.left=a.x,E.right=f.x,E.top=f.y,E.bottom=a.y,E.updateProjectionMatrix()}E=w.shadowMap,x=w.shadowMatrix,S=w.shadowCamera,S.position.setFromMatrixPosition(w.matrixWorld),l.setFromMatrixPosition(w.target.matrixWorld),S.lookAt(l),S.updateMatrixWorld(),S.matrixWorldInverse.getInverse(S.matrixWorld),w.cameraHelper&&(w.cameraHelper.visible=w.shadowCameraVisible),w.shadowCameraVisible&&w.cameraHelper.update(),x.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),x.multiply(S.projectionMatrix),x.multiply(S.matrixWorldInverse),u.multiplyMatrices(S.projectionMatrix,S.matrixWorldInverse),o.setFromMatrix(u),t.setRenderTarget(E),t.clear(),C=p.__webglObjects,w=0;for(E=C.length;w<E;w++)T=C[w],x=T.object,T.render=!1,!x.visible||!x.castShadow||(x instanceof THREE.Mesh||x instanceof THREE.ParticleSystem)&&x.frustumCulled&&!o.intersectsObject(x)||(x._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,x.matrixWorld),T.render=!0);w=0;for(E=C.length;w<E;w++)T=C[w],T.render&&(x=T.object,T=T.buffer,O=x.material instanceof THREE.MeshFaceMaterial?x.material.materials[0]:x.material,N=void 0!==x.geometry.morphTargets&&0<x.geometry.morphTargets.length&&O.morphTargets,O=x instanceof THREE.SkinnedMesh&&O.skinning,N=x.customDepthMaterial?x.customDepthMaterial:O?N?s:i:N?r:n,T instanceof THREE.BufferGeometry?t.renderBufferDirect(S,p.__lights,null,N,T,x):t.renderBuffer(S,p.__lights,null,N,T,x));C=p.__webglObjectsImmediate,w=0;for(E=C.length;w<E;w++)T=C[w],x=T.object,x.visible&&x.castShadow&&(x._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,x.matrixWorld),t.renderImmediateObject(S,p.__lights,null,n,x))}m=t.getClearColor(),y=t.getClearAlpha(),e.clearColor(m.r,m.g,m.b,y),e.enable(e.BLEND),t.shadowMapCullFace===THREE.CullFaceFront&&e.cullFace(e.BACK)}},THREE.ShadowMapPlugin.__projector=new THREE.Projector,THREE.SpritePlugin=function(){function g(e,t){return e.z!==t.z?t.z-e.z:t.id-e.id}var e,t,n,r,i,s,o,u,a,f,l,c,h,p,d,v,m,y,b,w,E,S,x,T,N;this.init=function(g){y=g.context,b=g,E=new Float32Array([-0.5,-0.5,0,0,.5,-0.5,1,0,.5,.5,1,1,-0.5,.5,0,1]),S=new Uint16Array([0,1,2,0,2,3]),x=y.createBuffer(),T=y.createBuffer(),y.bindBuffer(y.ARRAY_BUFFER,x),y.bufferData(y.ARRAY_BUFFER,E,y.STATIC_DRAW),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,T),y.bufferData(y.ELEMENT_ARRAY_BUFFER,S,y.STATIC_DRAW),g=y.createProgram();var L=y.createShader(y.VERTEX_SHADER),O=y.createShader(y.FRAGMENT_SHADER);y.shaderSource(L,["precision "+b.getPrecision()+" float;","uniform mat4 modelViewMatrix;\nuniform mat4 projectionMatrix;\nuniform float rotation;\nuniform vec2 scale;\nuniform vec2 uvOffset;\nuniform vec2 uvScale;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uvOffset + uv * uvScale;\nvec2 alignedPosition = position * scale;\nvec2 rotatedPosition;\nrotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\nrotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\nvec4 finalPosition;\nfinalPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\nfinalPosition.xy += rotatedPosition;\nfinalPosition = projectionMatrix * finalPosition;\ngl_Position = finalPosition;\n}"].join("\n")),y.shaderSource(O,["precision "+b.getPrecision()+" float;","uniform vec3 color;\nuniform sampler2D map;\nuniform float opacity;\nuniform int fogType;\nuniform vec3 fogColor;\nuniform float fogDensity;\nuniform float fogNear;\nuniform float fogFar;\nuniform float alphaTest;\nvarying vec2 vUV;\nvoid main() {\nvec4 texture = texture2D( map, vUV );\nif ( texture.a < alphaTest ) discard;\ngl_FragColor = vec4( color * texture.xyz, texture.a * opacity );\nif ( fogType > 0 ) {\nfloat depth = gl_FragCoord.z / gl_FragCoord.w;\nfloat fogFactor = 0.0;\nif ( fogType == 1 ) {\nfogFactor = smoothstep( fogNear, fogFar, depth );\n} else {\nconst float LOG2 = 1.442695;\nfloat fogFactor = exp2( - fogDensity * fogDensity * depth * depth * LOG2 );\nfogFactor = 1.0 - clamp( fogFactor, 0.0, 1.0 );\n}\ngl_FragColor = mix( gl_FragColor, vec4( fogColor, gl_FragColor.w ), fogFactor );\n}\n}"].join("\n")),y.compileShader(L),y.compileShader(O),y.attachShader(g,L),y.attachShader(g,O),y.linkProgram(g),N=g,v=y.getAttribLocation(N,"position"),m=y.getAttribLocation(N,"uv"),e=y.getUniformLocation(N,"uvOffset"),t=y.getUniformLocation(N,"uvScale"),n=y.getUniformLocation(N,"rotation"),r=y.getUniformLocation(N,"scale"),i=y.getUniformLocation(N,"color"),s=y.getUniformLocation(N,"map"),o=y.getUniformLocation(N,"opacity"),u=y.getUniformLocation(N,"modelViewMatrix"),a=y.getUniformLocation(N,"projectionMatrix"),f=y.getUniformLocation(N,"fogType"),l=y.getUniformLocation(N,"fogDensity"),c=y.getUniformLocation(N,"fogNear"),h=y.getUniformLocation(N,"fogFar"),p=y.getUniformLocation(N,"fogColor"),d=y.getUniformLocation(N,"alphaTest"),g=document.createElement("canvas"),g.width=8,g.height=8,L=g.getContext("2d"),L.fillStyle="#ffffff",L.fillRect(0,0,g.width,g.height),w=new THREE.Texture(g),w.needsUpdate=!0},this.render=function(E,S,L,O){L=E.__webglSprites;if(O=L.length){y.useProgram(N),y.enableVertexAttribArray(v),y.enableVertexAttribArray(m),y.disable(y.CULL_FACE),y.enable(y.BLEND),y.bindBuffer(y.ARRAY_BUFFER,x),y.vertexAttribPointer(v,2,y.FLOAT,!1,16,0),y.vertexAttribPointer(m,2,y.FLOAT,!1,16,8),y.bindBuffer(y.ELEMENT_ARRAY_BUFFER,T),y.uniformMatrix4fv(a,!1,S.projectionMatrix.elements),y.activeTexture(y.TEXTURE0),y.uniform1i(s,0);var M=0,_=0,D=E.fog;D?(y.uniform3f(p,D.color.r,D.color.g,D.color.b),D instanceof THREE.Fog?(y.uniform1f(c,D.near),y.uniform1f(h,D.far),y.uniform1i(f,1),_=M=1):D instanceof THREE.FogExp2&&(y.uniform1f(l,D.density),y.uniform1i(f,2),_=M=2)):(y.uniform1i(f,0),_=M=0);for(var P,H=[],D=0;D<O;D++)P=L[D],!1!==P.visible&&(P._modelViewMatrix.multiplyMatrices(S.matrixWorldInverse,P.matrixWorld),P.z=-P._modelViewMatrix.elements[14]);L.sort(g);for(D=0;D<O;D++)P=L[D],!1!==P.visible&&(S=P.material,y.uniform1f(d,S.alphaTest),y.uniformMatrix4fv(u,!1,P._modelViewMatrix.elements),H[0]=P.scale.x,H[1]=P.scale.y,P=E.fog&&S.fog?_:0,M!==P&&(y.uniform1i(f,P),M=P),null!==S.map?(y.uniform2f(e,S.map.offset.x,S.map.offset.y),y.uniform2f(t,S.map.repeat.x,S.map.repeat.y)):(y.uniform2f(e,0,0),y.uniform2f(t,1,1)),y.uniform1f(o,S.opacity),y.uniform3f(i,S.color.r,S.color.g,S.color.b),y.uniform1f(n,S.rotation),y.uniform2fv(r,H),b.setBlending(S.blending,S.blendEquation,S.blendSrc,S.blendDst),b.setDepthTest(S.depthTest),b.setDepthWrite(S.depthWrite),S.map&&S.map.image&&S.map.image.width?b.setTexture(S.map,0):b.setTexture(w,0),y.drawElements(y.TRIANGLES,6,y.UNSIGNED_SHORT,0));y.enable(y.CULL_FACE)}}},THREE.DepthPassPlugin=function(){this.enabled=!1,this.renderTarget=null;var e,t,n,r,i,s,o=new THREE.Frustum,u=new THREE.Matrix4;this.init=function(o){e=o.context,t=o,o=THREE.ShaderLib.depthRGBA;var u=THREE.UniformsUtils.clone(o.uniforms);n=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u}),r=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0}),i=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,skinning:!0}),s=new THREE.ShaderMaterial({fragmentShader:o.fragmentShader,vertexShader:o.vertexShader,uniforms:u,morphTargets:!0,skinning:!0}),n._shadowPass=!0,r._shadowPass=!0,i._shadowPass=!0,s._shadowPass=!0},this.render=function(e,t){this.enabled&&this.update(e,t)},this.update=function(l,p){var v,m,y,w,E,S;e.clearColor(1,1,1,1),e.disable(e.BLEND),t.setDepthTest(!0),!0===l.autoUpdate&&l.updateMatrixWorld(),p.matrixWorldInverse.getInverse(p.matrixWorld),u.multiplyMatrices(p.projectionMatrix,p.matrixWorldInverse),o.setFromMatrix(u),t.setRenderTarget(this.renderTarget),t.clear(),S=l.__webglObjects,v=0;for(m=S.length;v<m;v++)y=S[v],E=y.object,y.render=!1,!E.visible||(E instanceof THREE.Mesh||E instanceof THREE.ParticleSystem)&&E.frustumCulled&&!o.intersectsObject(E)||(E._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,E.matrixWorld),y.render=!0);var x;v=0;for(m=S.length;v<m;v++)y=S[v],y.render&&(E=y.object,y=y.buffer,E instanceof THREE.ParticleSystem&&!E.customDepthMaterial||((x=E.material instanceof THREE.MeshFaceMaterial?E.material.materials[0]:E.material)&&t.setMaterialFaces(E.material),w=0<E.geometry.morphTargets.length&&x.morphTargets,x=E instanceof THREE.SkinnedMesh&&x.skinning,w=E.customDepthMaterial?E.customDepthMaterial:x?w?s:i:w?r:n,y instanceof THREE.BufferGeometry?t.renderBufferDirect(p,l.__lights,null,w,y,E):t.renderBuffer(p,l.__lights,null,w,y,E)));S=l.__webglObjectsImmediate,v=0;for(m=S.length;v<m;v++)y=S[v],E=y.object,E.visible&&(E._modelViewMatrix.multiplyMatrices(p.matrixWorldInverse,E.matrixWorld),t.renderImmediateObject(p,l.__lights,null,n,E));v=t.getClearColor(),m=t.getClearAlpha(),e.clearColor(v.r,v.g,v.b,m),e.enable(e.BLEND)}},THREE.ShaderFlares={lensFlareVertexTexture:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nuniform sampler2D occlusionMap;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\nvec4 visibility = texture2D( occlusionMap, vec2( 0.1, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.1 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.9 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) );\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.5 ) );\nvVisibility =        visibility.r / 9.0;\nvVisibility *= 1.0 - visibility.g / 9.0;\nvVisibility *=       visibility.b / 9.0;\nvVisibility *= 1.0 - visibility.a / 9.0;\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"uniform lowp int renderType;\nuniform sampler2D map;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvarying float vVisibility;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( 1.0, 0.0, 1.0, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * vVisibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"},lensFlare:{vertexShader:"uniform lowp int renderType;\nuniform vec3 screenPosition;\nuniform vec2 scale;\nuniform float rotation;\nattribute vec2 position;\nattribute vec2 uv;\nvarying vec2 vUV;\nvoid main() {\nvUV = uv;\nvec2 pos = position;\nif( renderType == 2 ) {\npos.x = cos( rotation ) * position.x - sin( rotation ) * position.y;\npos.y = sin( rotation ) * position.x + cos( rotation ) * position.y;\n}\ngl_Position = vec4( ( pos * scale + screenPosition.xy ).xy, screenPosition.z, 1.0 );\n}",fragmentShader:"precision mediump float;\nuniform lowp int renderType;\nuniform sampler2D map;\nuniform sampler2D occlusionMap;\nuniform float opacity;\nuniform vec3 color;\nvarying vec2 vUV;\nvoid main() {\nif( renderType == 0 ) {\ngl_FragColor = vec4( texture2D( map, vUV ).rgb, 0.0 );\n} else if( renderType == 1 ) {\ngl_FragColor = texture2D( map, vUV );\n} else {\nfloat visibility = texture2D( occlusionMap, vec2( 0.5, 0.1 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.9, 0.5 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.5, 0.9 ) ).a;\nvisibility += texture2D( occlusionMap, vec2( 0.1, 0.5 ) ).a;\nvisibility = ( 1.0 - visibility / 4.0 );\nvec4 texture = texture2D( map, vUV );\ntexture.a *= opacity * visibility;\ngl_FragColor = texture;\ngl_FragColor.rgb *= color;\n}\n}"}},define("lib/Three",function(){}),define("core/Math",["core/Monogatari","core/Constants","core/Util","lib/Three"],function(){function e(){this._X_ALIGNED_VECTOR=new THREE.Vector3(1,0,0),this._Y_ALIGNED_VECTOR=new THREE.Vector3(0,1,0),this._Z_ALIGNED_VECTOR=new THREE.Vector3(0,0,1),this._ONE=new THREE.Vector3(1,1,1),this._ZERO=new THREE.Vector3(0,0,0)}Monogatari.Math=new e,e.prototype.getXAlignedVector=function(){return this._X_ALIGNED_VECTOR},e.prototype.getYAlignedVector=function(){return this._Y_ALIGNED_VECTOR},e.prototype.getZAlignedVector=function(){return this._Z_ALIGNED_VECTOR},e.prototype.getVectorOne=function(){return this._ONE},e.prototype.getVectorZero=function(){return this._ZERO},e.prototype.toRadians=function(e){return e*Monogatari.Constants.DEGTORAD},e.prototype.toDegrees=function(e){return e*Monogatari.Constants.RADTODEG},e.prototype.decimalToBinary=function(e){return e.toString(2)},e.prototype.decimalToOctal=function(e){return e.toString(8)},e.prototype.decimalToHex=function(e){return e.toString(16)},e.prototype.binaryToDecimal=function(e){return parseInt(e,2)},e.prototype.octalToDecimal=function(e){return parseInt(e,8)},e.prototype.hexToDecimal=function(e){return parseInt(e,16)}}),define("core/collection/Set",["core/Monogatari","core/collection/Iterator"],function(){Monogatari.Set=Class.extend({init:function(){this._values=new Array},put:function(e){this.contains(e)||this._values.push(e)},clear:function(){this._values.length=0},contains:function(e){return this.indexOf(e)>-1},indexOf:function(e){return Monogatari.Array.indexOf(e,this._values)},size:function(){return this._values.length},concat:function(e){return this._values.concat(e.toArray()),this._values.slice(0)},remove:function(e){if(indexOf)return this._values.splice(this._values.indexOf(e),1);for(var t=0,n=this._values.length;t<n;t++)if(t in this._values&&this._values[t]===e)return this._values.splice(t,1)},isEmpty:function(){return this.size()===0},toArray:function(){return this._values.slice(0)},toJSON:function(){return JSON.stringify(this._values)},iterator:function(){return new Monogatari.ListIterator(this._values)}})}),define("engine/render/Camera2D",["core/Monogatari","core/collection/Set","lib/Three"],function(){Monogatari.Camera2D=Class.extend({init:function(e,t,n,r,i,s){this.cam=new THREE.OrthographicCamera(e,t,n,r,i,s),this.cam.position.set(0,0,s),this._sceneIds=new Monogatari.Set,this._sceneIterator=this._sceneIds.iterator()},addScene:function(e){e&&typeof e=="string"&&this._sceneIds.put(e)}})});var Detector={canvas:!!window.CanvasRenderingContext2D,webgl:function(){try{var e=document.createElement("canvas");return!!window.WebGLRenderingContext&&(e.getContext("webgl")||e.getContext("experimental-webgl"))}catch(t){return!1}}(),workers:!!window.Worker,fileapi:window.File&&window.FileReader&&window.FileList&&window.Blob,getWebGLErrorMessage:function(){var e=document.createElement("div");return e.id="webgl-error-message",e.style.fontFamily="monospace",e.style.fontSize="13px",e.style.fontWeight="normal",e.style.textAlign="center",e.style.background="#fff",e.style.color="#000",e.style.padding="1.5em",e.style.width="400px",e.style.margin="5em auto 0",this.webgl||(e.innerHTML=window.WebGLRenderingContext?['Your graphics card does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br />','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n"):['Your browser does not seem to support <a href="http://khronos.org/webgl/wiki/Getting_a_WebGL_Implementation" style="color:#000">WebGL</a>.<br/>','Find out how to get it <a href="http://get.webgl.org/" style="color:#000">here</a>.'].join("\n")),e},addGetWebGLMessage:function(e){var t,n,r;e=e||{},t=e.parent!==undefined?e.parent:document.body,n=e.id!==undefined?e.id:"oldie",r=Detector.getWebGLErrorMessage(),r.id=n,t.appendChild(r)}};define("lib/Detector",function(){}),define("engine/SceneManager",["core/Monogatari","core/Math","core/collection/Map","engine/render/Camera2D","lib/Detector"],function(){function e(){this._cameras=new Monogatari.Map,this._cameraIterator=this._cameras.iterator(),this._scenes=new Monogatari.Map}Monogatari.SceneManager=new e,e.prototype.init=function(e,t,n,r){this._renderer=Detector.webgl?new THREE.WebGLRenderer({antialias:!1}):new THREE.CanvasRenderer,this._renderer.setClearColor(e?e:16777215,1),this._canvasWidth=t?t:window.innerWidth-25,this._canvasHeight=n?n:window.innerHeight-25,this._canvasHalfWidth=this._canvasWidth/2,this._canvasHalfHeight=this._canvasHeight/2,this._z=Monogatari.max(this._canvasWidth,this._canvasHeight),this._renderer.setSize(this._canvasWidth,this._canvasHeight);var i=r?r:document.getElementsByTagName("body")[0];i.appendChild(this._renderer.domElement)},e.prototype.getScenes=function(){return this._scenes},e.prototype.getScene=function(e){return this._scenes.get(e)},e.prototype.getCamera=function(e){return this._cameras.get(e)},e.prototype.createScene=function(e){this._scenes.put(e?e:Monogatari.Constants.DEFAULT_SCENE_ID,new THREE.Scene)},e.prototype.createCamera=function(e,t,n,r){var i=this._scenes.get(t?t:Monogatari.Constants.DEFAULT_SCENE_ID);e||(e=Monogatari.Constants.DEFAULT_CAMERA_ID),n||(n=this._canvasWidth),r||(r=this._canvasHeight);if(!i){console.log("Scene not found:"+t);return}var s=new Monogatari.Camera2D(n/-2,n/2,r/2,r/-2,1,Monogatari.max(n,r));s.addScene(t?t:Monogatari.Constants.DEFAULT_SCENE_ID),this._cameras.put(e,s)},e.prototype.addSceneToCamera=function(e,t){var n=this._cameras.get(e),r=this._scenes.get(t);r&&n&&n.addScene(t)},e.prototype.update=function(){},e.prototype.render=function(){this._cameraIterator.first();var e,t;while(this._cameraIterator.hasNext()){e=this._cameraIterator.next(),e._sceneIterator.first();while(e._sceneIterator.hasNext())t=this._scenes.get(e._sceneIterator.next()),t&&this._renderer.render(t,e.cam)}}}),define("core/collection/Tree",["core/Monogatari","core/collection/Map"],function(){Monogatari.Tree=Monogatari.Map.extend({init:function(){this._depth=1,this._super(),this._keys.push("trunk"),this._values.trunk=new Monogatari.TreeNode(null,"root",1)},put:function(e,t){var n=e||this.size();return this.contains(n)||this._keys.push(n),this._values[n]=new Monogatari.TreeNode(t,"trunk",this._depth),this._values[n]},isEmpty:function(){return this.size()==0},getDepth:function(){return this._depth},remove:function(e){if(e!="trunk"&&this.contains(e)){var t=this.get(e),n=this.get(t.parent);n.id!="trunk"&&this.disconnect(e),typeof t.value.reset=="function"&&t.value.reset();for(var r=0,i=this._keys.length;r<i;r++)this._keys[r]===e&&this._keys.splice(r,1)}},removeFromCache:function(e){if(e!="trunk"&&this.contains(e)){var t=this.get(e),n=this.get(t.parent);n.id!="trunk"&&this.disconnect(e),this._values[e]=null,delete this._values[e];for(var r=0,i=this._keys.length;r<i;r++)this._keys[r]===e&&this._keys.splice(r,1)}},clear:function(){this._values.length=0,this._values={},this._keys.length=0,this._depth=1},connect:function(e,t){if(this.contains(e)&&this.contains(t)){var n=this.get(e),r=this.get(t);r.parent=e,r.order=n.order+1,n.children.push(t),this._depth<r.order&&(this._depth=r.order)}},disconnect:function(e){var t=this.get(e),n=this.get(t.parent),r=n.children.length>0?Monogatari.Array.inArray(n.children,e):-1;r>-1&&Monogatari.Array.remove(n.children,r),t.parent="trunk",t.order=1},listAncestors:function(e,t){var n=new Array,r=this.get(e),i=t||this._depth;for(var s=0;s<i;s++)r.parent&&(n.push(r.parent),r=this.get(r.parent));return n.reverse(),n},listSuccessors:function(e){var t=new Array,n=this.get(e),r=null;if(n)for(var i=0,s=n.children.length;i<s;i++)r=this.get(n.children[i]),r&&(r.children.length>0&&t.concat(this.getSuccessors(n.children[i])),t.push(n.children[i]));return t},hasChildren:function(e){var t=this.get(e);return t&&t.children.length>0?!0:!1},isChildOf:function(e,t){var n=this.get(e);for(var r=0;r<this._depth;r++)if(n.parent){if(n.parent==t)return!0;n=this.get(n.parent)}return!1},listChildrenOf:function(e){var t=new Array,n=this.get(e),r=null;if(n)for(var i=0,s=n.children.length;i<s;i++)r=this.get(n.children[i]),r&&t.push(r);return t},listChildrenValuesOf:function(e){var t=new Array,n=this.get(e),r=null;if(n)for(var i=0,s=n.children.length;i<s;i++)r=this.get(n.children[i]),r&&t.push(r.value);return t},isParentOf:function(e,t){var n=!1,r=this.get(e);if(r)for(var i=0,s=r.children.length;i<s;i++){if(t==r.children[i])return!0;n=this.isParentOf(r.children[i],t)}return n},getParentOf:function(e){var t=this.get(e);return t&&this.get(t.parent)?t.parent:null},iterator:function(){return new Monogatari.TreeIterator(this._keys,this._values)},nodeIterator:function(){return new Monogatari.MapIterator(this._keys,this._values)}}),Monogatari.TreeNode=function(e,t,n){this.value=e?e:null,this.parent=t?t:"trunk",this.children=new Array,this.order=n?n:1}}),define("engine/entity/GameObject",["core/Monogatari","core/Constants","core/Timer","core/Util","lib/Three","engine/SceneManager"],function(){Monogatari.GameObject=Class.extend({init:function(e,t){this._components=new Monogatari.Map,this._componentIterator=this._components.iterator(),this.isVisible=!0,this.isActive=!0,this._isRenderable=!1,this._hasPhysics=!1,this.uid=Monogatari.Util.createUniqueId(),this.id=e||this.uid,this.lastUpdate=0,this.update=t&&typeof t=="function"?t:function(){}},postUpdate:function(){this.lastUpdate=Monogatari.Time.getTime(),this.updateComponents()},addComponent:function(e){return this.checkComponent(e),this._components.put(e.componentType,e)},checkComponent:function(e){e.componentType&&e.componentType===Monogatari.Constants.COMPONENT_RIGID_BODY&&(this._hasPhysics=!0);if(e.componentType===Monogatari.Constants.COMPONENT_THREE_OBJECT||e.componentType===Monogatari.Constants.COMPONENT_SPRITE||e.componentType===Monogatari.Constants.COMPONENT_PARTICLE_EMITTER||e.componentType===Monogatari.Constants.COMPONENT_STATIC_TEXT)this._isRenderable=!0},findComponent:function(e){return this._components.get(e)},removeComponent:function(e){this._components.remove(e)},clearComponents:function(){this._isRenderable=!1,this._hasPhysics=!1,this._components.clear()},findComponentByType:function(e){var t;this._componentIterator.first();while(this._componentIterator.hasNext()){t=this._componentIterator.next();if(t.componentType===e)return t}return null},hasComponent:function(e){return this._components.contains(e)?!0:!1},listComponentsToRender:function(){var e=new Array,t;this._componentIterator.first();while(this._componentIterator.hasNext()){t=this._componentIterator.next();if(t.componentType===Monogatari.Constants.COMPONENT_THREE_OBJECT||t.componentType===Monogatari.Constants.COMPONENT_SPRITE||t.componentType===Monogatari.Constants.COMPONENT_STATIC_TEXT)e[e.length]=t}return e},updateComponents:function(){var e,t=this.findComponent(Monogatari.Constants.COMPONENT_NODE);if(this._hasPhysics){var n=this.findComponentByType(Monogatari.Constants.COMPONENT_RIGID_BODY);t.position.x=n.body.GetPosition().x*n.conversionFactor,t.position.y=n.body.GetPosition().y*n.conversionFactor}this._componentIterator.first();while(this._componentIterator.hasNext())e=this._componentIterator.next(),this._isRenderable&&typeof e.getMesh=="function"&&e.getMesh()&&(e.getMesh().position=t.position,e.getMesh().rotation.z=t.getEulerRotation(),e.getMesh().scale=t.scale),typeof e.update=="function"&&e.update()},equals:function(e){return e.id===this.id?!0:!1},setPosition:function(e,t,n){this.findComponent(Monogatari.Constants.COMPONENT_NODE).position.set(e,t,n)},setRotation:function(e,t,n){this.findComponent(Monogatari.Constants.COMPONENT_NODE).rotation.set(e,t,n)},setScale:function(e,t,n){this.findComponent(Monogatari.Constants.COMPONENT_NODE).scale.set(e,t,n)},toJSON:function(){}})}),define("engine/entity/component/Component",["core/Monogatari","core/Constants"],function(){Monogatari.Component=Class.extend({init:function(){this.componentType=Monogatari.Constants.COMPONENT_BASE}})}),define("engine/entity/component/Node",["core/Monogatari","core/Constants","core/Math","engine/entity/component/Component","lib/Three"],function(){Monogatari.Node=Monogatari.Component.extend({init:function(e,t,n){this.position=e?e:new THREE.Vector3(0,0,0),this.rotation=t?t:new THREE.Vector3(0,1,0),this.scale=n?n:new THREE.Vector3(1,1,1),this.componentType=Monogatari.Constants.COMPONENT_NODE},negate:function(){this.position.negate(),this.rotation.negate(),this.scale.negate()},getEulerRotation:function(e){var t=e?e:Monogatari.Math.getYAlignedVector(),n=this.rotation.angleTo(t);return this.rotation.y*t.x>this.rotation.x*t.y?-n:n},getEulerRotationToTarget:function(e,t){var n=this.clone(),r=t?t:Monogatari.Math.getYAlignedVector(),i=this.rotation.angleTo(r);return n.position.y=-n.position.y,n.rotation=e.sub(n.position),n.rotation.normalize(),n.rotation.y*r.x>n.rotation.x*r.y?-i:i},clone:function(){return new Monogatari.Node(this.position.clone(),this.rotation.clone(),this.scale.clone())}})}),define("engine/ObjectManager",["core/Monogatari","core/collection/Tree","engine/entity/GameObject","engine/entity/component/Node"],function(){function e(){this._objects=new Monogatari.Tree,this._iterator=this._objects.iterator()}Monogatari.ObjectManager=new e,e.prototype.add=function(e){return this._objects.put(e.id,e).value},e.prototype.create=function(e,t){var n=new Monogatari.GameObject(e,t);return n.addComponent(new Monogatari.Node),this._objects.put(e,n).value},e.prototype.get=function(e){return this._objects.contains(e)?this._objects.get(e).value:null},e.prototype.getObjectIterator=function(){return this._objects.iterator()},e.prototype.size=function(){return this._objects.size()},e.prototype.remove=function(e){return this._objects.remove(e).value},e.prototype.hasChildren=function(e){return this._objects.hasChildren(e)},e.prototype.isChildOf=function(e,t){return this._objects.isChildOf(e,t)},e.prototype.listChildrenOf=function(e){return this._objects.listChildrenOf(e)},e.prototype.listChildrenValuesOf=function(e){return this._objects.listChildrenValuesOf(e)},e.prototype.isParentOf=function(e,t){return this._objects.isParentOf(e,t)},e.prototype.connect=function(e,t){this._objects.connect(e,t)},e.prototype.disconnect=function(e){this._objects.disconnect(e)},e.prototype.listAncestors=function(e){return this._objects.listAncestors(e)},e.prototype.listSuccessors=function(e){return this._objects.listSuccessors(e)},e.prototype.listIds=function(){return this._objects.getKeys()},e.prototype.toJSON=function(){},e.prototype.listIdsByComponentType=function(e){var t=new Array,n;this._iterator.first();while(this._iterator.hasNext())n=this._iterator.next(),n&&n.hasComponent(e)&&t.push(n.id);return t},e.prototype.update=function(){var e;this._iterator.first();while(this._iterator.hasNext())e=this._iterator.next(),e&&e.isActive&&(e.update(),e.postUpdate())},e.prototype.getGlobalPosition=function(e){if(this._objects.contains(e)){if(this._objects.get(e).parent==="trunk")return this._objects.get(e).value.findComponent(Monogatari.Constants.COMPONENT_NODE).position;var t=Monogatari.ObjectManager.getGlobalPosition(this._objects.get(e).parent),n=this._objects.get(e).value.findComponent(Monogatari.Constants.COMPONENT_NODE).position.clone();return n.add(t.getX(),t.getY(),t.getZ()),n}return null},e.prototype.getGlobalRotation=function(e){if(this._objects.contains(e)){if(this._objects.get(e).parent==="trunk")return this._objects.get(e).value.findComponent(Monogatari.Constants.COMPONENT_NODE).rotation;var t=Monogatari.ObjectManager.getGlobalRotation(this._objects.get(e).parent),n=this._objects.get(e).value.findComponent(Monogatari.Constants.COMPONENT_NODE).rotation.clone();return n.add(t.getX(),t.getY(),t.getZ()),n}return null},e.prototype.getGlobalScale=function(e){if(this._objects.contains(e)){if(this._objects.get(e).parent==="trunk")return this._objects.get(e).value.findComponent(Monogatari.Constants.COMPONENT_NODE).scale;var t=Monogatari.ObjectManager.getGlobalScale(this._objects.get(e).parent),n=this._objects.get(e).value.findComponent(Monogatari.Constants.COMPONENT_NODE).scale.clone();return n.add(t.getX(),t.getY(),t.getZ()),n}return null},e.prototype.getGlobalNode=function(e){if(this._objects.contains(e)){if(this._objects.get(e).parent==="trunk")return this._objects.get(e).value.findComponent(Monogatari.Constants.COMPONENT_NODE).scale;var t=Monogatari.ObjectManager.getGlobalNode(this._objects.get(e).parent),n=new Node(this._objects.get(e).value.findComponent(Monogatari.Constants.COMPONENT_NODE).position.clone(),this._objects.get(e).value.findComponent(Monogatari.Constants.COMPONENT_NODE).rotation.clone(),this._objects.get(e).value.findComponent(Monogatari.Constants.COMPONENT_NODE).scale.clone());return n.position.add(t.position.getX(),t.position.getY(),t.position.getZ()),n.rotation.add(t.rotation.getX(),t.rotation.getY(),t.rotation.getZ()),n.scale.add(t.scale.getX(),t.scale.getY(),t.scale.getZ()),n}return null}});var b2BoundValues=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BoundValues.prototype.__constructor=function(){this.lowerValues=[],this.lowerValues[0]=0,this.lowerValues[1]=0,this.upperValues=[],this.upperValues[0]=0,this.upperValues[1]=0},b2BoundValues.prototype.__varz=function(){},b2BoundValues.prototype.lowerValues=null,b2BoundValues.prototype.upperValues=null;var b2PairManager=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2PairManager.prototype.__constructor=function(){this.m_pairs=[],this.m_pairBuffer=[],this.m_pairBufferCount=this.m_pairCount=0,this.m_freePair=null},b2PairManager.prototype.__varz=function(){},b2PairManager.prototype.AddPair=function(e,t){var n=e.pairs[t];return n!=null?n:(this.m_freePair==null&&(this.m_freePair=new b2Pair,this.m_pairs.push(this.m_freePair)),n=this.m_freePair,this.m_freePair=n.next,n.proxy1=e,n.proxy2=t,n.status=0,n.userData=null,n.next=null,e.pairs[t]=n,t.pairs[e]=n,++this.m_pairCount,n)},b2PairManager.prototype.RemovePair=function(e,t){var n=e.pairs[t];if(n==null)return null;var r=n.userData;return delete e.pairs[t],delete t.pairs[e],n.next=this.m_freePair,n.proxy1=null,n.proxy2=null,n.userData=null,n.status=0,this.m_freePair=n,--this.m_pairCount,r},b2PairManager.prototype.Find=function(e,t){return e.pairs[t]},b2PairManager.prototype.ValidateBuffer=function(){},b2PairManager.prototype.ValidateTable=function(){},b2PairManager.prototype.Initialize=function(e){this.m_broadPhase=e},b2PairManager.prototype.AddBufferedPair=function(e,t){var n=this.AddPair(e,t);n.IsBuffered()==0&&(n.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount]=n,++this.m_pairBufferCount),n.ClearRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer()},b2PairManager.prototype.RemoveBufferedPair=function(e,t){var n=this.Find(e,t);n!=null&&(n.IsBuffered()==0&&(n.SetBuffered(),this.m_pairBuffer[this.m_pairBufferCount]=n,++this.m_pairBufferCount),n.SetRemoved(),b2BroadPhase.s_validate&&this.ValidateBuffer())},b2PairManager.prototype.Commit=function(e){var t=0;for(t=0;t<this.m_pairBufferCount;++t){var n=this.m_pairBuffer[t];n.ClearBuffered();var r=n.proxy1,i=n.proxy2;n.IsRemoved()||n.IsFinal()==0&&e(r.userData,i.userData)}this.m_pairBufferCount=0,b2BroadPhase.s_validate&&this.ValidateTable()},b2PairManager.prototype.m_broadPhase=null,b2PairManager.prototype.m_pairs=null,b2PairManager.prototype.m_freePair=null,b2PairManager.prototype.m_pairCount=0,b2PairManager.prototype.m_pairBuffer=null,b2PairManager.prototype.m_pairBufferCount=0;var b2TimeStep=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TimeStep.prototype.__constructor=function(){},b2TimeStep.prototype.__varz=function(){},b2TimeStep.prototype.Set=function(e){this.dt=e.dt,this.inv_dt=e.inv_dt,this.positionIterations=e.positionIterations,this.velocityIterations=e.velocityIterations,this.warmStarting=e.warmStarting},b2TimeStep.prototype.dt=null,b2TimeStep.prototype.inv_dt=null,b2TimeStep.prototype.dtRatio=null,b2TimeStep.prototype.velocityIterations=0,b2TimeStep.prototype.positionIterations=0,b2TimeStep.prototype.warmStarting=null;var b2Controller=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Controller.prototype.__constructor=function(){},b2Controller.prototype.__varz=function(){},b2Controller.prototype.Step=function(){},b2Controller.prototype.Draw=function(){},b2Controller.prototype.AddBody=function(e){var t=new b2ControllerEdge;t.controller=this,t.body=e,t.nextBody=m_bodyList,t.prevBody=null,m_bodyList=t,t.nextBody&&(t.nextBody.prevBody=t),m_bodyCount++,t.nextController=e.m_controllerList,t.prevController=null,e.m_controllerList=t,t.nextController&&(t.nextController.prevController=t),e.m_controllerCount++},b2Controller.prototype.RemoveBody=function(e){for(var t=e.m_controllerList;t&&t.controller!=this;)t=t.nextController;t.prevBody&&(t.prevBody.nextBody=t.nextBody),t.nextBody&&(t.nextBody.prevBody=t.prevBody),t.nextController&&(t.nextController.prevController=t.prevController),t.prevController&&(t.prevController.nextController=t.nextController),m_bodyList==t&&(m_bodyList=t.nextBody),e.m_controllerList==t&&(e.m_controllerList=t.nextController),e.m_controllerCount--,m_bodyCount--},b2Controller.prototype.Clear=function(){for(;m_bodyList;)this.RemoveBody(m_bodyList.body)},b2Controller.prototype.GetNext=function(){return this.m_next},b2Controller.prototype.GetWorld=function(){return this.m_world},b2Controller.prototype.GetBodyList=function(){return m_bodyList},b2Controller.prototype.m_next=null,b2Controller.prototype.m_prev=null,b2Controller.prototype.m_world=null;var b2GravityController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GravityController.prototype,b2Controller.prototype),b2GravityController.prototype._super=b2Controller.prototype,b2GravityController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2GravityController.prototype.__varz=function(){},b2GravityController.prototype.Step=function(){var e=null,t=null,n=null,r=0,i=null,s=null,o=null,u=0,a=0,f=0;u=null;if(this.invSqr)for(e=m_bodyList;e;e=e.nextBody){t=e.body,n=t.GetWorldCenter(),r=t.GetMass();for(i=m_bodyList;i!=e;i=i.nextBody)s=i.body,o=s.GetWorldCenter(),u=o.x-n.x,a=o.y-n.y,f=u*u+a*a,f<Number.MIN_VALUE||(u=new b2Vec2(u,a),u.Multiply(this.G/f/Math.sqrt(f)*r*s.GetMass()),t.IsAwake()&&t.ApplyForce(u,n),u.Multiply(-1),s.IsAwake()&&s.ApplyForce(u,o))}else for(e=m_bodyList;e;e=e.nextBody){t=e.body,n=t.GetWorldCenter(),r=t.GetMass();for(i=m_bodyList;i!=e;i=i.nextBody)s=i.body,o=s.GetWorldCenter(),u=o.x-n.x,a=o.y-n.y,f=u*u+a*a,f<Number.MIN_VALUE||(u=new b2Vec2(u,a),u.Multiply(this.G/f*r*s.GetMass()),t.IsAwake()&&t.ApplyForce(u,n),u.Multiply(-1),s.IsAwake()&&s.ApplyForce(u,o))}},b2GravityController.prototype.G=1,b2GravityController.prototype.invSqr=!0;var b2DestructionListener=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DestructionListener.prototype.__constructor=function(){},b2DestructionListener.prototype.__varz=function(){},b2DestructionListener.prototype.SayGoodbyeJoint=function(){},b2DestructionListener.prototype.SayGoodbyeFixture=function(){};var b2ContactEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactEdge.prototype.__constructor=function(){},b2ContactEdge.prototype.__varz=function(){},b2ContactEdge.prototype.other=null,b2ContactEdge.prototype.contact=null,b2ContactEdge.prototype.prev=null,b2ContactEdge.prototype.next=null;var b2EdgeChainDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2EdgeChainDef.prototype.__constructor=function(){this.vertexCount=0,this.isALoop=!0,this.vertices=[]},b2EdgeChainDef.prototype.__varz=function(){},b2EdgeChainDef.prototype.vertices=null,b2EdgeChainDef.prototype.vertexCount=null,b2EdgeChainDef.prototype.isALoop=null;var b2Vec2=function(e,t){arguments.length==2&&(this.x=e,this.y=t)};b2Vec2.Make=function(e,t){return new b2Vec2(e,t)},b2Vec2.prototype.SetZero=function(){this.y=this.x=0},b2Vec2.prototype.Set=function(e,t){this.x=e,this.y=t},b2Vec2.prototype.SetV=function(e){this.x=e.x,this.y=e.y},b2Vec2.prototype.GetNegative=function(){return new b2Vec2(-this.x,-this.y)},b2Vec2.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y},b2Vec2.prototype.Copy=function(){return new b2Vec2(this.x,this.y)},b2Vec2.prototype.Add=function(e){this.x+=e.x,this.y+=e.y},b2Vec2.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y},b2Vec2.prototype.Multiply=function(e){this.x*=e,this.y*=e},b2Vec2.prototype.MulM=function(e){var t=this.x;this.x=e.col1.x*t+e.col2.x*this.y,this.y=e.col1.y*t+e.col2.y*this.y},b2Vec2.prototype.MulTM=function(e){var t=b2Math.Dot(this,e.col1);this.y=b2Math.Dot(this,e.col2),this.x=t},b2Vec2.prototype.CrossVF=function(e){var t=this.x;this.x=e*this.y,this.y=-e*t},b2Vec2.prototype.CrossFV=function(e){var t=this.x;this.x=-e*this.y,this.y=e*t},b2Vec2.prototype.MinV=function(e){this.x=this.x<e.x?this.x:e.x,this.y=this.y<e.y?this.y:e.y},b2Vec2.prototype.MaxV=function(e){this.x=this.x>e.x?this.x:e.x,this.y=this.y>e.y?this.y:e.y},b2Vec2.prototype.Abs=function(){this.x<0&&(this.x=-this.x),this.y<0&&(this.y=-this.y)},b2Vec2.prototype.Length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},b2Vec2.prototype.LengthSquared=function(){return this.x*this.x+this.y*this.y},b2Vec2.prototype.Normalize=function(){var e=Math.sqrt(this.x*this.x+this.y*this.y);if(e<Number.MIN_VALUE)return 0;var t=1/e;return this.x*=t,this.y*=t,e},b2Vec2.prototype.IsValid=function(){return b2Math.IsValid(this.x)&&b2Math.IsValid(this.y)},b2Vec2.prototype.x=0,b2Vec2.prototype.y=0;var b2Vec3=function(e,t,n){arguments.length==3&&(this.x=e,this.y=t,this.z=n)};b2Vec3.prototype.SetZero=function(){this.x=this.y=this.z=0},b2Vec3.prototype.Set=function(e,t,n){this.x=e,this.y=t,this.z=n},b2Vec3.prototype.SetV=function(e){this.x=e.x,this.y=e.y,this.z=e.z},b2Vec3.prototype.GetNegative=function(){return new b2Vec3(-this.x,-this.y,-this.z)},b2Vec3.prototype.NegativeSelf=function(){this.x=-this.x,this.y=-this.y,this.z=-this.z},b2Vec3.prototype.Copy=function(){return new b2Vec3(this.x,this.y,this.z)},b2Vec3.prototype.Add=function(e){this.x+=e.x,this.y+=e.y,this.z+=e.z},b2Vec3.prototype.Subtract=function(e){this.x-=e.x,this.y-=e.y,this.z-=e.z},b2Vec3.prototype.Multiply=function(e){this.x*=e,this.y*=e,this.z*=e},b2Vec3.prototype.x=0,b2Vec3.prototype.y=0,b2Vec3.prototype.z=0;var b2DistanceProxy=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceProxy.prototype.__constructor=function(){},b2DistanceProxy.prototype.__varz=function(){},b2DistanceProxy.prototype.Set=function(e){switch(e.GetType()){case b2Shape.e_circleShape:this.m_vertices=Array(1),this.m_vertices[0]=e.m_p,this.m_count=1,this.m_radius=e.m_radius;break;case b2Shape.e_polygonShape:this.m_vertices=e.m_vertices,this.m_count=e.m_vertexCount,this.m_radius=e.m_radius;break;default:b2Settings.b2Assert(!1)}},b2DistanceProxy.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},b2DistanceProxy.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_count;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},b2DistanceProxy.prototype.GetVertexCount=function(){return this.m_count},b2DistanceProxy.prototype.GetVertex=function(e){return b2Settings.b2Assert(0<=e&&e<this.m_count),this.m_vertices[e]},b2DistanceProxy.prototype.m_vertices=null,b2DistanceProxy.prototype.m_count=0,b2DistanceProxy.prototype.m_radius=null;var b2ContactFactory=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactFactory.prototype.__constructor=function(e){this.m_allocator=e,this.InitializeRegisters()},b2ContactFactory.prototype.__varz=function(){},b2ContactFactory.prototype.AddType=function(e,t,n,r){this.m_registers[n][r].createFcn=e,this.m_registers[n][r].destroyFcn=t,this.m_registers[n][r].primary=!0,n!=r&&(this.m_registers[r][n].createFcn=e,this.m_registers[r][n].destroyFcn=t,this.m_registers[r][n].primary=!1)},b2ContactFactory.prototype.InitializeRegisters=function(){this.m_registers=Array(b2Shape.e_shapeTypeCount);for(var e=0;e<b2Shape.e_shapeTypeCount;e++){this.m_registers[e]=Array(b2Shape.e_shapeTypeCount);for(var t=0;t<b2Shape.e_shapeTypeCount;t++)this.m_registers[e][t]=new b2ContactRegister}this.AddType(b2CircleContact.Create,b2CircleContact.Destroy,b2Shape.e_circleShape,b2Shape.e_circleShape),this.AddType(b2PolyAndCircleContact.Create,b2PolyAndCircleContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_circleShape),this.AddType(b2PolygonContact.Create,b2PolygonContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_polygonShape),this.AddType(b2EdgeAndCircleContact.Create,b2EdgeAndCircleContact.Destroy,b2Shape.e_edgeShape,b2Shape.e_circleShape),this.AddType(b2PolyAndEdgeContact.Create,b2PolyAndEdgeContact.Destroy,b2Shape.e_polygonShape,b2Shape.e_edgeShape)},b2ContactFactory.prototype.Create=function(e,t){var n=e.GetType(),r=t.GetType();return n=this.m_registers[n][r],n.pool?(r=n.pool,n.pool=r.m_next,n.poolCount--,r.Reset(e,t),r):(r=n.createFcn,r!=null?(n.primary?(r=r(this.m_allocator),r.Reset(e,t)):(r=r(this.m_allocator),r.Reset(t,e)),r):null)},b2ContactFactory.prototype.Destroy=function(e){e.m_manifold.m_pointCount>0&&(e.m_fixtureA.m_body.SetAwake(!0),e.m_fixtureB.m_body.SetAwake(!0));var t=e.m_fixtureA.GetType(),n=e.m_fixtureB.GetType();t=this.m_registers[t][n],t.poolCount++,e.m_next=t.pool,t.pool=e,t=t.destroyFcn,t(e,this.m_allocator)},b2ContactFactory.prototype.m_registers=null,b2ContactFactory.prototype.m_allocator=null;var b2ConstantAccelController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2ConstantAccelController.prototype,b2Controller.prototype),b2ConstantAccelController.prototype._super=b2Controller.prototype,b2ConstantAccelController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2ConstantAccelController.prototype.__varz=function(){this.A=new b2Vec2(0,0)},b2ConstantAccelController.prototype.Step=function(e){e=new b2Vec2(this.A.x*e.dt,this.A.y*e.dt);for(var t=m_bodyList;t;t=t.nextBody){var n=t.body;n.IsAwake()&&n.SetLinearVelocity(new b2Vec2(n.GetLinearVelocity().x+e.x,n.GetLinearVelocity().y+e.y))}},b2ConstantAccelController.prototype.A=new b2Vec2(0,0);var b2SeparationFunction=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SeparationFunction.prototype.__constructor=function(){},b2SeparationFunction.prototype.__varz=function(){this.m_localPoint=new b2Vec2,this.m_axis=new b2Vec2},b2SeparationFunction.e_points=1,b2SeparationFunction.e_faceA=2,b2SeparationFunction.e_faceB=4,b2SeparationFunction.prototype.Initialize=function(e,t,n,r,i){this.m_proxyA=t,this.m_proxyB=r,t=e.count,b2Settings.b2Assert(0<t&&t<3);var s,o,u,a;if(t==1)this.m_type=b2SeparationFunction.e_points,s=this.m_proxyA.GetVertex(e.indexA[0]),o=this.m_proxyB.GetVertex(e.indexB[0]),a=s,u=n.R,s=n.position.x+(u.col1.x*a.x+u.col2.x*a.y),n=n.position.y+(u.col1.y*a.x+u.col2.y*a.y),a=o,u=i.R,o=i.position.x+(u.col1.x*a.x+u.col2.x*a.y),i=i.position.y+(u.col1.y*a.x+u.col2.y*a.y),this.m_axis.x=o-s,this.m_axis.y=i-n,this.m_axis.Normalize();else{if(e.indexB[0]==e.indexB[1])this.m_type=b2SeparationFunction.e_faceA,t=this.m_proxyA.GetVertex(e.indexA[0]),r=this.m_proxyA.GetVertex(e.indexA[1]),o=this.m_proxyB.GetVertex(e.indexB[0]),this.m_localPoint.x=.5*(t.x+r.x),this.m_localPoint.y=.5*(t.y+r.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(r,t),1),this.m_axis.Normalize(),a=this.m_axis,u=n.R,t=u.col1.x*a.x+u.col2.x*a.y,r=u.col1.y*a.x+u.col2.y*a.y,a=this.m_localPoint,u=n.R,s=n.position.x+(u.col1.x*a.x+u.col2.x*a.y),n=n.position.y+(u.col1.y*a.x+u.col2.y*a.y),a=o,u=i.R,o=i.position.x+(u.col1.x*a.x+u.col2.x*a.y),i=i.position.y+(u.col1.y*a.x+u.col2.y*a.y),e=(o-s)*t+(i-n)*r;else if(e.indexA[0]==e.indexA[0])this.m_type=b2SeparationFunction.e_faceB,u=this.m_proxyB.GetVertex(e.indexB[0]),a=this.m_proxyB.GetVertex(e.indexB[1]),s=this.m_proxyA.GetVertex(e.indexA[0]),this.m_localPoint.x=.5*(u.x+a.x),this.m_localPoint.y=.5*(u.y+a.y),this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(a,u),1),this.m_axis.Normalize(),a=this.m_axis,u=i.R,t=u.col1.x*a.x+u.col2.x*a.y,r=u.col1.y*a.x+u.col2.y*a.y,a=this.m_localPoint,u=i.R,o=i.position.x+(u.col1.x*a.x+u.col2.x*a.y),i=i.position.y+(u.col1.y*a.x+u.col2.y*a.y),a=s,u=n.R,s=n.position.x+(u.col1.x*a.x+u.col2.x*a.y),n=n.position.y+(u.col1.y*a.x+u.col2.y*a.y),e=(s-o)*t+(n-i)*r;else{t=this.m_proxyA.GetVertex(e.indexA[0]),r=this.m_proxyA.GetVertex(e.indexA[1]),u=this.m_proxyB.GetVertex(e.indexB[0]),a=this.m_proxyB.GetVertex(e.indexB[1]),b2Math.MulX(n,s),s=b2Math.MulMV(n.R,b2Math.SubtractVV(r,t)),b2Math.MulX(i,o),e=b2Math.MulMV(i.R,b2Math.SubtractVV(a,u)),i=s.x*s.x+s.y*s.y,o=e.x*e.x+e.y*e.y;var f=b2Math.SubtractVV(e,s);n=s.x*f.x+s.y*f.y,f=e.x*f.x+e.y*f.y,s=s.x*e.x+s.y*e.y;var l=i*o-s*s;e=0,l!=0&&(e=b2Math.Clamp((s*f-n*o)/l,0,1)),(s*e+f)/o<0&&(e=b2Math.Clamp((s-n)/i,0,1)),s=new b2Vec2,s.x=t.x+e*(r.x-t.x),s.y=t.y+e*(r.y-t.y),o=new b2Vec2,o.x=u.x+e*(a.x-u.x),o.y=u.y+e*(a.y-u.y),e==0||e==1?(this.m_type=b2SeparationFunction.e_faceB,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(a,u),1),this.m_axis.Normalize(),this.m_localPoint=o):(this.m_type=b2SeparationFunction.e_faceA,this.m_axis=b2Math.CrossVF(b2Math.SubtractVV(r,t),1),this.m_localPoint=s)}e<0&&this.m_axis.NegativeSelf()}},b2SeparationFunction.prototype.Evaluate=function(e,t){var n,r,i;switch(this.m_type){case b2SeparationFunction.e_points:return n=b2Math.MulTMV(e.R,this.m_axis),r=b2Math.MulTMV(t.R,this.m_axis.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),r=this.m_proxyB.GetSupportVertex(r),n=b2Math.MulX(e,n),r=b2Math.MulX(t,r),i=(r.x-n.x)*this.m_axis.x+(r.y-n.y)*this.m_axis.y;case b2SeparationFunction.e_faceA:return i=b2Math.MulMV(e.R,this.m_axis),n=b2Math.MulX(e,this.m_localPoint),r=b2Math.MulTMV(t.R,i.GetNegative()),r=this.m_proxyB.GetSupportVertex(r),r=b2Math.MulX(t,r),i=(r.x-n.x)*i.x+(r.y-n.y)*i.y;case b2SeparationFunction.e_faceB:return i=b2Math.MulMV(t.R,this.m_axis),r=b2Math.MulX(t,this.m_localPoint),n=b2Math.MulTMV(e.R,i.GetNegative()),n=this.m_proxyA.GetSupportVertex(n),n=b2Math.MulX(e,n),i=(n.x-r.x)*i.x+(n.y-r.y)*i.y;default:return b2Settings.b2Assert(!1),0}},b2SeparationFunction.prototype.m_proxyA=null,b2SeparationFunction.prototype.m_proxyB=null,b2SeparationFunction.prototype.m_type=0,b2SeparationFunction.prototype.m_localPoint=new b2Vec2,b2SeparationFunction.prototype.m_axis=new b2Vec2;var b2DynamicTreePair=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreePair.prototype.__constructor=function(){},b2DynamicTreePair.prototype.__varz=function(){},b2DynamicTreePair.prototype.proxyA=null,b2DynamicTreePair.prototype.proxyB=null;var b2ContactConstraintPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactConstraintPoint.prototype.__constructor=function(){},b2ContactConstraintPoint.prototype.__varz=function(){this.localPoint=new b2Vec2,this.rA=new b2Vec2,this.rB=new b2Vec2},b2ContactConstraintPoint.prototype.localPoint=new b2Vec2,b2ContactConstraintPoint.prototype.rA=new b2Vec2,b2ContactConstraintPoint.prototype.rB=new b2Vec2,b2ContactConstraintPoint.prototype.normalImpulse=null,b2ContactConstraintPoint.prototype.tangentImpulse=null,b2ContactConstraintPoint.prototype.normalMass=null,b2ContactConstraintPoint.prototype.tangentMass=null,b2ContactConstraintPoint.prototype.equalizedMass=null,b2ContactConstraintPoint.prototype.velocityBias=null;var b2ControllerEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ControllerEdge.prototype.__constructor=function(){},b2ControllerEdge.prototype.__varz=function(){},b2ControllerEdge.prototype.controller=null,b2ControllerEdge.prototype.body=null,b2ControllerEdge.prototype.prevBody=null,b2ControllerEdge.prototype.nextBody=null,b2ControllerEdge.prototype.prevController=null,b2ControllerEdge.prototype.nextController=null;var b2DistanceInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceInput.prototype.__constructor=function(){},b2DistanceInput.prototype.__varz=function(){},b2DistanceInput.prototype.proxyA=null,b2DistanceInput.prototype.proxyB=null,b2DistanceInput.prototype.transformA=null,b2DistanceInput.prototype.transformB=null,b2DistanceInput.prototype.useRadii=null;var b2Settings=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Settings.prototype.__constructor=function(){},b2Settings.prototype.__varz=function(){},b2Settings.b2MixFriction=function(e,t){return Math.sqrt(e*t)},b2Settings.b2MixRestitution=function(e,t){return e>t?e:t},b2Settings.b2Assert=function(e){if(!e)throw"Assertion Failed"},b2Settings.VERSION="2.1alpha",b2Settings.USHRT_MAX=65535,b2Settings.b2_pi=Math.PI,b2Settings.b2_maxManifoldPoints=2,b2Settings.b2_aabbExtension=.1,b2Settings.b2_aabbMultiplier=2,b2Settings.b2_polygonRadius=2*b2Settings.b2_linearSlop,b2Settings.b2_linearSlop=.005,b2Settings.b2_angularSlop=2/180*b2Settings.b2_pi,b2Settings.b2_toiSlop=8*b2Settings.b2_linearSlop,b2Settings.b2_maxTOIContactsPerIsland=32,b2Settings.b2_maxTOIJointsPerIsland=32,b2Settings.b2_velocityThreshold=1,b2Settings.b2_maxLinearCorrection=.2,b2Settings.b2_maxAngularCorrection=8/180*b2Settings.b2_pi,b2Settings.b2_maxTranslation=2,b2Settings.b2_maxTranslationSquared=b2Settings.b2_maxTranslation*b2Settings.b2_maxTranslation,b2Settings.b2_maxRotation=.5*b2Settings.b2_pi,b2Settings.b2_maxRotationSquared=b2Settings.b2_maxRotation*b2Settings.b2_maxRotation,b2Settings.b2_contactBaumgarte=.2,b2Settings.b2_timeToSleep=.5,b2Settings.b2_linearSleepTolerance=.01,b2Settings.b2_angularSleepTolerance=2/180*b2Settings.b2_pi;var b2Proxy=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Proxy.prototype.__constructor=function(){},b2Proxy.prototype.__varz=function(){this.lowerBounds=Array(2),this.upperBounds=Array(2),this.pairs={}},b2Proxy.prototype.IsValid=function(){return this.overlapCount!=b2BroadPhase.b2_invalid},b2Proxy.prototype.lowerBounds=Array(2),b2Proxy.prototype.upperBounds=Array(2),b2Proxy.prototype.overlapCount=0,b2Proxy.prototype.timeStamp=0,b2Proxy.prototype.pairs={},b2Proxy.prototype.next=null,b2Proxy.prototype.userData=null;var b2Point=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Point.prototype.__constructor=function(){},b2Point.prototype.__varz=function(){this.p=new b2Vec2},b2Point.prototype.Support=function(){return this.p},b2Point.prototype.GetFirstVertex=function(){return this.p},b2Point.prototype.p=new b2Vec2;var b2WorldManifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2WorldManifold.prototype.__constructor=function(){this.m_points=Array(b2Settings.b2_maxManifoldPoints);for(var e=0;e<b2Settings.b2_maxManifoldPoints;e++)this.m_points[e]=new b2Vec2},b2WorldManifold.prototype.__varz=function(){this.m_normal=new b2Vec2},b2WorldManifold.prototype.Initialize=function(e,t,n,r,i){if(e.m_pointCount!=0){var s=0,o,u,a,f,l,c,h;switch(e.m_type){case b2Manifold.e_circles:u=t.R,o=e.m_localPoint,s=t.position.x+u.col1.x*o.x+u.col2.x*o.y,t=t.position.y+u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_points[0].m_localPoint,e=r.position.x+u.col1.x*o.x+u.col2.x*o.y,r=r.position.y+u.col1.y*o.x+u.col2.y*o.y,o=e-s,u=r-t,a=o*o+u*u,a>Number.MIN_VALUE*Number.MIN_VALUE?(a=Math.sqrt(a),this.m_normal.x=o/a,this.m_normal.y=u/a):(this.m_normal.x=1,this.m_normal.y=0),o=t+n*this.m_normal.y,r-=i*this.m_normal.y,this.m_points[0].x=.5*(s+n*this.m_normal.x+(e-i*this.m_normal.x)),this.m_points[0].y=.5*(o+r);break;case b2Manifold.e_faceA:u=t.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=t.R,o=e.m_localPoint,l=t.position.x+u.col1.x*o.x+u.col2.x*o.y,c=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=a,this.m_normal.y=f;for(s=0;s<e.m_pointCount;s++)u=r.R,o=e.m_points[s].m_localPoint,h=r.position.x+u.col1.x*o.x+u.col2.x*o.y,o=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(n-(h-l)*a-(o-c)*f-i)*a,this.m_points[s].y=o+.5*(n-(h-l)*a-(o-c)*f-i)*f;break;case b2Manifold.e_faceB:u=r.R,o=e.m_localPlaneNormal,a=u.col1.x*o.x+u.col2.x*o.y,f=u.col1.y*o.x+u.col2.y*o.y,u=r.R,o=e.m_localPoint,l=r.position.x+u.col1.x*o.x+u.col2.x*o.y,c=r.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_normal.x=-a,this.m_normal.y=-f;for(s=0;s<e.m_pointCount;s++)u=t.R,o=e.m_points[s].m_localPoint,h=t.position.x+u.col1.x*o.x+u.col2.x*o.y,o=t.position.y+u.col1.y*o.x+u.col2.y*o.y,this.m_points[s].x=h+.5*(i-(h-l)*a-(o-c)*f-n)*a,this.m_points[s].y=o+.5*(i-(h-l)*a-(o-c)*f-n)*f}}},b2WorldManifold.prototype.m_normal=new b2Vec2,b2WorldManifold.prototype.m_points=null;var b2RayCastOutput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2RayCastOutput.prototype.__constructor=function(){},b2RayCastOutput.prototype.__varz=function(){this.normal=new b2Vec2},b2RayCastOutput.prototype.normal=new b2Vec2,b2RayCastOutput.prototype.fraction=null;var b2ConstantForceController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2ConstantForceController.prototype,b2Controller.prototype),b2ConstantForceController.prototype._super=b2Controller.prototype,b2ConstantForceController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2ConstantForceController.prototype.__varz=function(){this.F=new b2Vec2(0,0)},b2ConstantForceController.prototype.Step=function(){for(var e=m_bodyList;e;e=e.nextBody){var t=e.body;t.IsAwake()&&t.ApplyForce(this.F,t.GetWorldCenter())}},b2ConstantForceController.prototype.F=new b2Vec2(0,0);var b2MassData=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2MassData.prototype.__constructor=function(){},b2MassData.prototype.__varz=function(){this.center=new b2Vec2(0,0)},b2MassData.prototype.mass=0,b2MassData.prototype.center=new b2Vec2(0,0),b2MassData.prototype.I=0;var b2DynamicTree=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTree.prototype.__constructor=function(){this.m_freeList=this.m_root=null,this.m_insertionCount=this.m_path=0},b2DynamicTree.prototype.__varz=function(){},b2DynamicTree.prototype.AllocateNode=function(){if(this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e}return new b2DynamicTreeNode},b2DynamicTree.prototype.FreeNode=function(e){e.parent=this.m_freeList,this.m_freeList=e},b2DynamicTree.prototype.InsertLeaf=function(e){++this.m_insertionCount;if(this.m_root==null)this.m_root=e,this.m_root.parent=null;else{var t=e.aabb.GetCenter(),n=this.m_root;if(n.IsLeaf()==0)do{var r=n.child1;n=n.child2,n=Math.abs((r.aabb.lowerBound.x+r.aabb.upperBound.x)/2-t.x)+Math.abs((r.aabb.lowerBound.y+r.aabb.upperBound.y)/2-t.y)<Math.abs((n.aabb.lowerBound.x+n.aabb.upperBound.x)/2-t.x)+Math.abs((n.aabb.lowerBound.y+n.aabb.upperBound.y)/2-t.y)?r:n}while(n.IsLeaf()==0);t=n.parent,r=this.AllocateNode(),r.parent=t,r.userData=null,r.aabb.Combine(e.aabb,n.aabb);if(t){n.parent.child1==n?t.child1=r:t.child2=r,r.child1=n,r.child2=e,n.parent=r,e.parent=r;do{if(t.aabb.Contains(r.aabb))break;t.aabb.Combine(t.child1.aabb,t.child2.aabb),r=t,t=t.parent}while(t)}else r.child1=n,r.child2=e,n.parent=r,this.m_root=e.parent=r}},b2DynamicTree.prototype.RemoveLeaf=function(e){if(e==this.m_root)this.m_root=null;else{var t=e.parent,n=t.parent;e=t.child1==e?t.child2:t.child1;if(n){n.child1==t?n.child1=e:n.child2=e,e.parent=n;for(this.FreeNode(t);n;){t=n.aabb,n.aabb=b2AABB.Combine(n.child1.aabb,n.child2.aabb);if(t.Contains(n.aabb))break;n=n.parent}}else this.m_root=e,e.parent=null,this.FreeNode(t)}},b2DynamicTree.prototype.CreateProxy=function(e,t){var n=this.AllocateNode(),r=b2Settings.b2_aabbExtension,i=b2Settings.b2_aabbExtension;return n.aabb.lowerBound.x=e.lowerBound.x-r,n.aabb.lowerBound.y=e.lowerBound.y-i,n.aabb.upperBound.x=e.upperBound.x+r,n.aabb.upperBound.y=e.upperBound.y+i,n.userData=t,this.InsertLeaf(n),n},b2DynamicTree.prototype.DestroyProxy=function(e){this.RemoveLeaf(e),this.FreeNode(e)},b2DynamicTree.prototype.MoveProxy=function(e,t,n){b2Settings.b2Assert(e.IsLeaf());if(e.aabb.Contains(t))return!1;this.RemoveLeaf(e);var r=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(n.x>0?n.x:-n.x);return n=b2Settings.b2_aabbExtension+b2Settings.b2_aabbMultiplier*(n.y>0?n.y:-n.y),e.aabb.lowerBound.x=t.lowerBound.x-r,e.aabb.lowerBound.y=t.lowerBound.y-n,e.aabb.upperBound.x=t.upperBound.x+r,e.aabb.upperBound.y=t.upperBound.y+n,this.InsertLeaf(e),!0},b2DynamicTree.prototype.Rebalance=function(e){if(this.m_root!=null)for(var t=0;t<e;t++){for(var n=this.m_root,r=0;n.IsLeaf()==0;)n=this.m_path>>r&1?n.child2:n.child1,r=r+1&31;++this.m_path,this.RemoveLeaf(n),this.InsertLeaf(n)}},b2DynamicTree.prototype.GetFatAABB=function(e){return e.aabb},b2DynamicTree.prototype.GetUserData=function(e){return e.userData},b2DynamicTree.prototype.Query=function(e,t){if(this.m_root!=null){var n=[],r=0;for(n[r++]=this.m_root;r>0;){var i=n[--r];if(i.aabb.TestOverlap(t))if(i.IsLeaf()){if(!e(i))break}else n[r++]=i.child1,n[r++]=i.child2}}},b2DynamicTree.prototype.RayCast=function(e,t){if(this.m_root!=null){var n=t.p1,r=t.p2,i=b2Math.SubtractVV(n,r);i.Normalize(),i=b2Math.CrossFV(1,i);var s=b2Math.AbsV(i),o=t.maxFraction,u=new b2AABB,a;a=n.x+o*(r.x-n.x),o=n.y+o*(r.y-n.y),u.lowerBound.x=Math.min(n.x,a),u.lowerBound.y=Math.min(n.y,o),u.upperBound.x=Math.max(n.x,a),u.upperBound.y=Math.max(n.y,o);var f=[],l=0;for(f[l++]=this.m_root;l>0;){a=f[--l];if(a.aabb.TestOverlap(u)!=0){o=a.aabb.GetCenter();var c=a.aabb.GetExtents();if(!(Math.abs(i.x*(n.x-o.x)+i.y*(n.y-o.y))-s.x*c.x-s.y*c.y>0))if(a.IsLeaf()){o=new b2RayCastInput,o.p1=t.p1,o.p2=t.p2,o.maxFraction=t.maxFraction,o=e(o,a);if(o==0)break;a=n.x+o*(r.x-n.x),o=n.y+o*(r.y-n.y),u.lowerBound.x=Math.min(n.x,a),u.lowerBound.y=Math.min(n.y,o),u.upperBound.x=Math.max(n.x,a),u.upperBound.y=Math.max(n.y,o)}else f[l++]=a.child1,f[l++]=a.child2}}}},b2DynamicTree.prototype.m_root=null,b2DynamicTree.prototype.m_freeList=null,b2DynamicTree.prototype.m_path=0,b2DynamicTree.prototype.m_insertionCount=0;var b2JointEdge=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2JointEdge.prototype.__constructor=function(){},b2JointEdge.prototype.__varz=function(){},b2JointEdge.prototype.other=null,b2JointEdge.prototype.joint=null,b2JointEdge.prototype.prev=null,b2JointEdge.prototype.next=null;var b2RayCastInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2RayCastInput.prototype.__constructor=function(e,t,n){e&&this.p1.SetV(e),t&&this.p2.SetV(t),n&&(this.maxFraction=n)},b2RayCastInput.prototype.__varz=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2RayCastInput.prototype.p1=new b2Vec2,b2RayCastInput.prototype.p2=new b2Vec2,b2RayCastInput.prototype.maxFraction=null;var Features=function(){this.__varz(),this.__constructor.apply(this,arguments)};Features.prototype.__constructor=function(){},Features.prototype.__varz=function(){},Features.prototype.__defineGetter__("referenceEdge",function(){return this._referenceEdge}),Features.prototype.__defineSetter__("referenceEdge",function(e){this._referenceEdge=e,this._m_id._key=this._m_id._key&4294967040|this._referenceEdge&255}),Features.prototype.__defineGetter__("incidentEdge",function(){return this._incidentEdge}),Features.prototype.__defineSetter__("incidentEdge",function(e){this._incidentEdge=e,this._m_id._key=this._m_id._key&4294902015|this._incidentEdge<<8&65280}),Features.prototype.__defineGetter__("incidentVertex",function(){return this._incidentVertex}),Features.prototype.__defineSetter__("incidentVertex",function(e){this._incidentVertex=e,this._m_id._key=this._m_id._key&4278255615|this._incidentVertex<<16&16711680}),Features.prototype.__defineGetter__("flip",function(){return this._flip}),Features.prototype.__defineSetter__("flip",function(e){this._flip=e,this._m_id._key=this._m_id._key&16777215|this._flip<<24&4278190080}),Features.prototype._referenceEdge=0,Features.prototype._incidentEdge=0,Features.prototype._incidentVertex=0,Features.prototype._flip=0,Features.prototype._m_id=null;var b2FilterData=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2FilterData.prototype.__constructor=function(){},b2FilterData.prototype.__varz=function(){this.categoryBits=1,this.maskBits=65535},b2FilterData.prototype.Copy=function(){var e=new b2FilterData;return e.categoryBits=this.categoryBits,e.maskBits=this.maskBits,e.groupIndex=this.groupIndex,e},b2FilterData.prototype.categoryBits=1,b2FilterData.prototype.maskBits=65535,b2FilterData.prototype.groupIndex=0;var b2AABB=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2AABB.prototype.__constructor=function(){},b2AABB.prototype.__varz=function(){this.lowerBound=new b2Vec2,this.upperBound=new b2Vec2},b2AABB.Combine=function(e,t){var n=new b2AABB;return n.Combine(e,t),n},b2AABB.prototype.IsValid=function(){var e=this.upperBound.y-this.lowerBound.y;return e=(e=this.upperBound.x-this.lowerBound.x>=0&&e>=0)&&this.lowerBound.IsValid()&&this.upperBound.IsValid()},b2AABB.prototype.GetCenter=function(){return new b2Vec2((this.lowerBound.x+this.upperBound.x)/2,(this.lowerBound.y+this.upperBound.y)/2)},b2AABB.prototype.GetExtents=function(){return new b2Vec2((this.upperBound.x-this.lowerBound.x)/2,(this.upperBound.y-this.lowerBound.y)/2)},b2AABB.prototype.Contains=function(e){return this.lowerBound.x<=e.lowerBound.x&&this.lowerBound.y<=e.lowerBound.y&&e.upperBound.x<=this.upperBound.x&&e.upperBound.y<=this.upperBound.y},b2AABB.prototype.RayCast=function(e,t){var n=-Number.MAX_VALUE,r=Number.MAX_VALUE,i=t.p1.x,s=t.p1.y,o=t.p2.x-t.p1.x,u=t.p2.y-t.p1.y,a=Math.abs(u),f=e.normal,l;if(Math.abs(o)<Number.MIN_VALUE){if(i<this.lowerBound.x||this.upperBound.x<i)return!1}else{l=1/o,o=(this.lowerBound.x-i)*l,i=(this.upperBound.x-i)*l,l=-1,o>i&&(l=o,o=i,i=l,l=1),o>n&&(f.x=l,f.y=0,n=o),r=Math.min(r,i);if(n>r)return!1}if(a<Number.MIN_VALUE){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{l=1/u,o=(this.lowerBound.y-s)*l,i=(this.upperBound.y-s)*l,l=-1,o>i&&(l=o,o=i,i=l,l=1),o>n&&(f.y=l,f.x=0,n=o),r=Math.min(r,i);if(n>r)return!1}return e.fraction=n,!0},b2AABB.prototype.TestOverlap=function(e){var t=e.lowerBound.y-this.upperBound.y,n=this.lowerBound.y-e.upperBound.y;return e.lowerBound.x-this.upperBound.x>0||t>0?!1:this.lowerBound.x-e.upperBound.x>0||n>0?!1:!0},b2AABB.prototype.Combine=function(e,t){this.lowerBound.x=Math.min(e.lowerBound.x,t.lowerBound.x),this.lowerBound.y=Math.min(e.lowerBound.y,t.lowerBound.y),this.upperBound.x=Math.max(e.upperBound.x,t.upperBound.x),this.upperBound.y=Math.max(e.upperBound.y,t.upperBound.y)},b2AABB.prototype.lowerBound=new b2Vec2,b2AABB.prototype.upperBound=new b2Vec2;var b2Jacobian=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Jacobian.prototype.__constructor=function(){},b2Jacobian.prototype.__varz=function(){this.linearA=new b2Vec2,this.linearB=new b2Vec2},b2Jacobian.prototype.SetZero=function(){this.linearA.SetZero(),this.angularA=0,this.linearB.SetZero(),this.angularB=0},b2Jacobian.prototype.Set=function(e,t,n,r){this.linearA.SetV(e),this.angularA=t,this.linearB.SetV(n),this.angularB=r},b2Jacobian.prototype.Compute=function(e,t,n,r){return this.linearA.x*e.x+this.linearA.y*e.y+this.angularA*t+(this.linearB.x*n.x+this.linearB.y*n.y)+this.angularB*r},b2Jacobian.prototype.linearA=new b2Vec2,b2Jacobian.prototype.angularA=null,b2Jacobian.prototype.linearB=new b2Vec2,b2Jacobian.prototype.angularB=null;var b2Bound=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Bound.prototype.__constructor=function(){},b2Bound.prototype.__varz=function(){},b2Bound.prototype.IsLower=function(){return(this.value&1)==0},b2Bound.prototype.IsUpper=function(){return(this.value&1)==1},b2Bound.prototype.Swap=function(e){var t=this.value,n=this.proxy,r=this.stabbingCount;this.value=e.value,this.proxy=e.proxy,this.stabbingCount=e.stabbingCount,e.value=t,e.proxy=n,e.stabbingCount=r},b2Bound.prototype.value=0,b2Bound.prototype.proxy=null,b2Bound.prototype.stabbingCount=0;var b2SimplexVertex=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SimplexVertex.prototype.__constructor=function(){},b2SimplexVertex.prototype.__varz=function(){},b2SimplexVertex.prototype.Set=function(e){this.wA.SetV(e.wA),this.wB.SetV(e.wB),this.w.SetV(e.w),this.a=e.a,this.indexA=e.indexA,this.indexB=e.indexB},b2SimplexVertex.prototype.wA=null,b2SimplexVertex.prototype.wB=null,b2SimplexVertex.prototype.w=null,b2SimplexVertex.prototype.a=null,b2SimplexVertex.prototype.indexA=0,b2SimplexVertex.prototype.indexB=0;var b2Mat22=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Mat22.prototype.__constructor=function(){this.col1.x=this.col2.y=1},b2Mat22.prototype.__varz=function(){this.col1=new b2Vec2,this.col2=new b2Vec2},b2Mat22.FromAngle=function(e){var t=new b2Mat22;return t.Set(e),t},b2Mat22.FromVV=function(e,t){var n=new b2Mat22;return n.SetVV(e,t),n},b2Mat22.prototype.Set=function(e){var t=Math.cos(e);e=Math.sin(e),this.col1.x=t,this.col2.x=-e,this.col1.y=e,this.col2.y=t},b2Mat22.prototype.SetVV=function(e,t){this.col1.SetV(e),this.col2.SetV(t)},b2Mat22.prototype.Copy=function(){var e=new b2Mat22;return e.SetM(this),e},b2Mat22.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2)},b2Mat22.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y},b2Mat22.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col1.y=0,this.col2.y=1},b2Mat22.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col1.y=0,this.col2.y=0},b2Mat22.prototype.GetAngle=function(){return Math.atan2(this.col1.y,this.col1.x)},b2Mat22.prototype.GetInverse=function(e){var t=this.col1.x,n=this.col2.x,r=this.col1.y,i=this.col2.y,s=t*i-n*r;return s!=0&&(s=1/s),e.col1.x=s*i,e.col2.x=-s*n,e.col1.y=-s*r,e.col2.y=s*t,e},b2Mat22.prototype.Solve=function(e,t,n){var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},b2Mat22.prototype.Abs=function(){this.col1.Abs(),this.col2.Abs()},b2Mat22.prototype.col1=new b2Vec2,b2Mat22.prototype.col2=new b2Vec2;var b2SimplexCache=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2SimplexCache.prototype.__constructor=function(){},b2SimplexCache.prototype.__varz=function(){this.indexA=Array(3),this.indexB=Array(3)},b2SimplexCache.prototype.metric=null,b2SimplexCache.prototype.count=0,b2SimplexCache.prototype.indexA=Array(3),b2SimplexCache.prototype.indexB=Array(3);var b2Shape=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Shape.prototype.__constructor=function(){this.m_type=b2Shape.e_unknownShape,this.m_radius=b2Settings.b2_linearSlop},b2Shape.prototype.__varz=function(){},b2Shape.TestOverlap=function(e,t,n,r){var i=new b2DistanceInput;return i.proxyA=new b2DistanceProxy,i.proxyA.Set(e),i.proxyB=new b2DistanceProxy,i.proxyB.Set(n),i.transformA=t,i.transformB=r,i.useRadii=!0,e=new b2SimplexCache,e.count=0,t=new b2DistanceOutput,b2Distance.Distance(t,e,i),t.distance<10*Number.MIN_VALUE},b2Shape.e_hitCollide=1,b2Shape.e_missCollide=0,b2Shape.e_startsInsideCollide=-1,b2Shape.e_unknownShape=-1,b2Shape.e_circleShape=0,b2Shape.e_polygonShape=1,b2Shape.e_edgeShape=2,b2Shape.e_shapeTypeCount=3,b2Shape.prototype.Copy=function(){return null},b2Shape.prototype.Set=function(e){this.m_radius=e.m_radius},b2Shape.prototype.GetType=function(){return this.m_type},b2Shape.prototype.TestPoint=function(){return!1},b2Shape.prototype.RayCast=function(){return!1},b2Shape.prototype.ComputeAABB=function(){},b2Shape.prototype.ComputeMass=function(){},b2Shape.prototype.ComputeSubmergedArea=function(){return 0},b2Shape.prototype.m_type=0,b2Shape.prototype.m_radius=null;var b2Segment=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Segment.prototype.__constructor=function(){},b2Segment.prototype.__varz=function(){this.p1=new b2Vec2,this.p2=new b2Vec2},b2Segment.prototype.TestSegment=function(e,t,n,r){var i=n.p1,s=n.p2.x-i.x,o=n.p2.y-i.y;n=this.p2.y-this.p1.y;var u=-(this.p2.x-this.p1.x),a=100*Number.MIN_VALUE,f=-(s*n+o*u);if(f>a){var l=i.x-this.p1.x,c=i.y-this.p1.y;i=l*n+c*u;if(0<=i&&i<=r*f){r=-s*c+o*l;if(-a*f<=r&&r<=f*(1+a))return i/=f,r=Math.sqrt(n*n+u*u),n/=r,u/=r,e[0]=i,t.Set(n,u),!0}}return!1},b2Segment.prototype.Extend=function(e){this.ExtendForward(e),this.ExtendBackward(e)},b2Segment.prototype.ExtendForward=function(e){var t=this.p2.x-this.p1.x,n=this.p2.y-this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p1.x)/t:t<0?(e.lowerBound.x-this.p1.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p1.y)/n:n<0?(e.lowerBound.y-this.p1.y)/n:Number.POSITIVE_INFINITY),this.p2.x=this.p1.x+t*e,this.p2.y=this.p1.y+n*e},b2Segment.prototype.ExtendBackward=function(e){var t=-this.p2.x+this.p1.x,n=-this.p2.y+this.p1.y;e=Math.min(t>0?(e.upperBound.x-this.p2.x)/t:t<0?(e.lowerBound.x-this.p2.x)/t:Number.POSITIVE_INFINITY,n>0?(e.upperBound.y-this.p2.y)/n:n<0?(e.lowerBound.y-this.p2.y)/n:Number.POSITIVE_INFINITY),this.p1.x=this.p2.x+t*e,this.p1.y=this.p2.y+n*e},b2Segment.prototype.p1=new b2Vec2,b2Segment.prototype.p2=new b2Vec2;var b2ContactRegister=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactRegister.prototype.__constructor=function(){},b2ContactRegister.prototype.__varz=function(){},b2ContactRegister.prototype.createFcn=null,b2ContactRegister.prototype.destroyFcn=null,b2ContactRegister.prototype.primary=null,b2ContactRegister.prototype.pool=null,b2ContactRegister.prototype.poolCount=0;var b2DebugDraw=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DebugDraw.prototype.__constructor=function(){this.m_drawFlags=0},b2DebugDraw.prototype.__varz=function(){},b2DebugDraw.e_shapeBit=1,b2DebugDraw.e_jointBit=2,b2DebugDraw.e_aabbBit=4,b2DebugDraw.e_pairBit=8,b2DebugDraw.e_centerOfMassBit=16,b2DebugDraw.e_controllerBit=32,b2DebugDraw.prototype.SetFlags=function(e){this.m_drawFlags=e},b2DebugDraw.prototype.GetFlags=function(){return this.m_drawFlags},b2DebugDraw.prototype.AppendFlags=function(e){this.m_drawFlags|=e},b2DebugDraw.prototype.ClearFlags=function(e){this.m_drawFlags&=~e},b2DebugDraw.prototype.SetSprite=function(e){this.m_sprite=e},b2DebugDraw.prototype.GetSprite=function(){return this.m_sprite},b2DebugDraw.prototype.SetDrawScale=function(e){this.m_drawScale=e},b2DebugDraw.prototype.GetDrawScale=function(){return this.m_drawScale},b2DebugDraw.prototype.SetLineThickness=function(e){this.m_lineThickness=e},b2DebugDraw.prototype.GetLineThickness=function(){return this.m_lineThickness},b2DebugDraw.prototype.SetAlpha=function(e){this.m_alpha=e},b2DebugDraw.prototype.GetAlpha=function(){return this.m_alpha},b2DebugDraw.prototype.SetFillAlpha=function(e){this.m_fillAlpha=e},b2DebugDraw.prototype.GetFillAlpha=function(){return this.m_fillAlpha},b2DebugDraw.prototype.SetXFormScale=function(e){this.m_xformScale=e},b2DebugDraw.prototype.GetXFormScale=function(){return this.m_xformScale},b2DebugDraw.prototype.Clear=function(){this.m_sprite.clearRect(0,0,this.m_sprite.canvas.width,this.m_sprite.canvas.height)},b2DebugDraw.prototype.Y=function(e){return this.m_sprite.canvas.height-e},b2DebugDraw.prototype.ToWorldPoint=function(e){return new b2Vec2(e.x/this.m_drawScale,this.Y(e.y)/this.m_drawScale)},b2DebugDraw.prototype.ColorStyle=function(e,t){return"rgba("+e.r+", "+e.g+", "+e.b+", "+t+")"},b2DebugDraw.prototype.DrawPolygon=function(e,t,n){this.m_sprite.graphics.lineStyle(this.m_lineThickness,n.color,this.m_alpha),this.m_sprite.graphics.moveTo(e[0].x*this.m_drawScale,e[0].y*this.m_drawScale);for(n=1;n<t;n++)this.m_sprite.graphics.lineTo(e[n].x*this.m_drawScale,e[n].y*this.m_drawScale);this.m_sprite.graphics.lineTo(e[0].x*this.m_drawScale,e[0].y*this.m_drawScale)},b2DebugDraw.prototype.DrawSolidPolygon=function(e,t,n){this.m_sprite.strokeSyle=this.ColorStyle(n,this.m_alpha),this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.fillStyle=this.ColorStyle(n,this.m_fillAlpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(e[0].x*this.m_drawScale,this.Y(e[0].y*this.m_drawScale));for(n=1;n<t;n++)this.m_sprite.lineTo(e[n].x*this.m_drawScale,this.Y(e[n].y*this.m_drawScale));this.m_sprite.lineTo(e[0].x*this.m_drawScale,this.Y(e[0].y*this.m_drawScale)),this.m_sprite.fill(),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawCircle=function(e,t,n){this.m_sprite.graphics.lineStyle(this.m_lineThickness,n.color,this.m_alpha),this.m_sprite.graphics.drawCircle(e.x*this.m_drawScale,e.y*this.m_drawScale,t*this.m_drawScale)},b2DebugDraw.prototype.DrawSolidCircle=function(e,t,n,r){this.m_sprite.strokeSyle=this.ColorStyle(r,this.m_alpha),this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.fillStyle=this.ColorStyle(r,this.m_fillAlpha),this.m_sprite.beginPath(),this.m_sprite.arc(e.x*this.m_drawScale,this.Y(e.y*this.m_drawScale),t*this.m_drawScale,0,Math.PI*2,!0),this.m_sprite.fill(),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawSegment=function(e,t,n){this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.strokeSyle=this.ColorStyle(n,this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(e.x*this.m_drawScale,this.Y(e.y*this.m_drawScale)),this.m_sprite.lineTo(t.x*this.m_drawScale,this.Y(t.y*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.DrawTransform=function(e){this.m_sprite.lineWidth=this.m_lineThickness,this.m_sprite.strokeSyle=this.ColorStyle(new b2Color(255,0,0),this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(e.position.x*this.m_drawScale,this.Y(e.position.y*this.m_drawScale)),this.m_sprite.lineTo((e.position.x+this.m_xformScale*e.R.col1.x)*this.m_drawScale,this.Y((e.position.y+this.m_xformScale*e.R.col1.y)*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath(),this.m_sprite.strokeSyle=this.ColorStyle(new b2Color(0,255,0),this.m_alpha),this.m_sprite.beginPath(),this.m_sprite.moveTo(e.position.x*this.m_drawScale,this.Y(e.position.y*this.m_drawScale)),this.m_sprite.lineTo((e.position.x+this.m_xformScale*e.R.col2.x)*this.m_drawScale,this.Y((e.position.y+this.m_xformScale*e.R.col2.y)*this.m_drawScale)),this.m_sprite.stroke(),this.m_sprite.closePath()},b2DebugDraw.prototype.m_drawFlags=0,b2DebugDraw.prototype.m_sprite=null,b2DebugDraw.prototype.m_drawScale=1,b2DebugDraw.prototype.m_lineThickness=1,b2DebugDraw.prototype.m_alpha=1,b2DebugDraw.prototype.m_fillAlpha=1,b2DebugDraw.prototype.m_xformScale=1;var b2Sweep=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Sweep.prototype.__constructor=function(){},b2Sweep.prototype.__varz=function(){this.localCenter=new b2Vec2,this.c0=new b2Vec2,this.c=new b2Vec2},b2Sweep.prototype.Set=function(e){this.localCenter.SetV(e.localCenter),this.c0.SetV(e.c0),this.c.SetV(e.c),this.a0=e.a0,this.a=e.a,this.t0=e.t0},b2Sweep.prototype.Copy=function(){var e=new b2Sweep;return e.localCenter.SetV(this.localCenter),e.c0.SetV(this.c0),e.c.SetV(this.c),e.a0=this.a0,e.a=this.a,e.t0=this.t0,e},b2Sweep.prototype.GetTransform=function(e,t){e.position.x=(1-t)*this.c0.x+t*this.c.x,e.position.y=(1-t)*this.c0.y+t*this.c.y,e.R.Set((1-t)*this.a0+t*this.a);var n=e.R;e.position.x-=n.col1.x*this.localCenter.x+n.col2.x*this.localCenter.y,e.position.y-=n.col1.y*this.localCenter.x+n.col2.y*this.localCenter.y},b2Sweep.prototype.Advance=function(e){if(this.t0<e&&1-this.t0>Number.MIN_VALUE){var t=(e-this.t0)/(1-this.t0);this.c0.x=(1-t)*this.c0.x+t*this.c.x,this.c0.y=(1-t)*this.c0.y+t*this.c.y,this.a0=(1-t)*this.a0+t*this.a,this.t0=e}},b2Sweep.prototype.localCenter=new b2Vec2,b2Sweep.prototype.c0=new b2Vec2,b2Sweep.prototype.c=new b2Vec2,b2Sweep.prototype.a0=null,b2Sweep.prototype.a=null,b2Sweep.prototype.t0=null;var b2DistanceOutput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DistanceOutput.prototype.__constructor=function(){},b2DistanceOutput.prototype.__varz=function(){this.pointA=new b2Vec2,this.pointB=new b2Vec2},b2DistanceOutput.prototype.pointA=new b2Vec2,b2DistanceOutput.prototype.pointB=new b2Vec2,b2DistanceOutput.prototype.distance=null,b2DistanceOutput.prototype.iterations=0;var b2Mat33=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Mat33.prototype.__constructor=function(e,t,n){!e&&!t&&!n?(this.col1.SetZero(),this.col2.SetZero(),this.col3.SetZero()):(this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n))},b2Mat33.prototype.__varz=function(){this.col1=new b2Vec3,this.col2=new b2Vec3,this.col3=new b2Vec3},b2Mat33.prototype.SetVVV=function(e,t,n){this.col1.SetV(e),this.col2.SetV(t),this.col3.SetV(n)},b2Mat33.prototype.Copy=function(){return new b2Mat33(this.col1,this.col2,this.col3)},b2Mat33.prototype.SetM=function(e){this.col1.SetV(e.col1),this.col2.SetV(e.col2),this.col3.SetV(e.col3)},b2Mat33.prototype.AddM=function(e){this.col1.x+=e.col1.x,this.col1.y+=e.col1.y,this.col1.z+=e.col1.z,this.col2.x+=e.col2.x,this.col2.y+=e.col2.y,this.col2.z+=e.col2.z,this.col3.x+=e.col3.x,this.col3.y+=e.col3.y,this.col3.z+=e.col3.z},b2Mat33.prototype.SetIdentity=function(){this.col1.x=1,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=1,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=1},b2Mat33.prototype.SetZero=function(){this.col1.x=0,this.col2.x=0,this.col3.x=0,this.col1.y=0,this.col2.y=0,this.col3.y=0,this.col1.z=0,this.col2.z=0,this.col3.z=0},b2Mat33.prototype.Solve22=function(e,t,n){var r=this.col1.x,i=this.col2.x,s=this.col1.y,o=this.col2.y,u=r*o-i*s;return u!=0&&(u=1/u),e.x=u*(o*t-i*n),e.y=u*(r*n-s*t),e},b2Mat33.prototype.Solve33=function(e,t,n,r){var i=this.col1.x,s=this.col1.y,o=this.col1.z,u=this.col2.x,a=this.col2.y,f=this.col2.z,l=this.col3.x,c=this.col3.y,h=this.col3.z,p=i*(a*h-f*c)+s*(f*l-u*h)+o*(u*c-a*l);return p!=0&&(p=1/p),e.x=p*(t*(a*h-f*c)+n*(f*l-u*h)+r*(u*c-a*l)),e.y=p*(i*(n*h-r*c)+s*(r*l-t*h)+o*(t*c-n*l)),e.z=p*(i*(a*r-f*n)+s*(f*t-u*r)+o*(u*n-a*t)),e},b2Mat33.prototype.col1=new b2Vec3,b2Mat33.prototype.col2=new b2Vec3,b2Mat33.prototype.col3=new b2Vec3;var b2PositionSolverManifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2PositionSolverManifold.prototype.__constructor=function(){this.m_normal=new b2Vec2,this.m_separations=Array(b2Settings.b2_maxManifoldPoints),this.m_points=Array(b2Settings.b2_maxManifoldPoints);for(var e=0;e<b2Settings.b2_maxManifoldPoints;e++)this.m_points[e]=new b2Vec2},b2PositionSolverManifold.prototype.__varz=function(){},b2PositionSolverManifold.circlePointA=new b2Vec2,b2PositionSolverManifold.circlePointB=new b2Vec2,b2PositionSolverManifold.prototype.Initialize=function(e){b2Settings.b2Assert(e.pointCount>0);var t=0,n,r,i,s,o;switch(e.type){case b2Manifold.e_circles:i=e.bodyA.m_xf.R,r=e.localPoint,t=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),n=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyB.m_xf.R,r=e.points[0].localPoint,s=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),i=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),r=s-t,o=i-n;var u=r*r+o*o;u>Number.MIN_VALUE*Number.MIN_VALUE?(u=Math.sqrt(u),this.m_normal.x=r/u,this.m_normal.y=o/u):(this.m_normal.x=1,this.m_normal.y=0),this.m_points[0].x=.5*(t+s),this.m_points[0].y=.5*(n+i),this.m_separations[0]=r*this.m_normal.x+o*this.m_normal.y-e.radius;break;case b2Manifold.e_faceA:i=e.bodyA.m_xf.R,r=e.localPlaneNormal,this.m_normal.x=i.col1.x*r.x+i.col2.x*r.y,this.m_normal.y=i.col1.y*r.x+i.col2.y*r.y,i=e.bodyA.m_xf.R,r=e.localPoint,s=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyB.m_xf.R;for(t=0;t<e.pointCount;++t)r=e.points[t].localPoint,n=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),r=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),this.m_separations[t]=(n-s)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius,this.m_points[t].x=n,this.m_points[t].y=r;break;case b2Manifold.e_faceB:i=e.bodyB.m_xf.R,r=e.localPlaneNormal,this.m_normal.x=i.col1.x*r.x+i.col2.x*r.y,this.m_normal.y=i.col1.y*r.x+i.col2.y*r.y,i=e.bodyB.m_xf.R,r=e.localPoint,s=e.bodyB.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),o=e.bodyB.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),i=e.bodyA.m_xf.R;for(t=0;t<e.pointCount;++t)r=e.points[t].localPoint,n=e.bodyA.m_xf.position.x+(i.col1.x*r.x+i.col2.x*r.y),r=e.bodyA.m_xf.position.y+(i.col1.y*r.x+i.col2.y*r.y),this.m_separations[t]=(n-s)*this.m_normal.x+(r-o)*this.m_normal.y-e.radius,this.m_points[t].Set(n,r);this.m_normal.x*=-1,this.m_normal.y*=-1}},b2PositionSolverManifold.prototype.m_normal=null,b2PositionSolverManifold.prototype.m_points=null,b2PositionSolverManifold.prototype.m_separations=null;var b2OBB=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2OBB.prototype.__constructor=function(){},b2OBB.prototype.__varz=function(){this.R=new b2Mat22,this.center=new b2Vec2,this.extents=new b2Vec2},b2OBB.prototype.R=new b2Mat22,b2OBB.prototype.center=new b2Vec2,b2OBB.prototype.extents=new b2Vec2;var b2Pair=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Pair.prototype.__constructor=function(){},b2Pair.prototype.__varz=function(){},b2Pair.b2_nullProxy=b2Settings.USHRT_MAX,b2Pair.e_pairBuffered=1,b2Pair.e_pairRemoved=2,b2Pair.e_pairFinal=4,b2Pair.prototype.SetBuffered=function(){this.status|=b2Pair.e_pairBuffered},b2Pair.prototype.ClearBuffered=function(){this.status&=~b2Pair.e_pairBuffered},b2Pair.prototype.IsBuffered=function(){return(this.status&b2Pair.e_pairBuffered)==b2Pair.e_pairBuffered},b2Pair.prototype.SetRemoved=function(){this.status|=b2Pair.e_pairRemoved},b2Pair.prototype.ClearRemoved=function(){this.status&=~b2Pair.e_pairRemoved},b2Pair.prototype.IsRemoved=function(){return(this.status&b2Pair.e_pairRemoved)==b2Pair.e_pairRemoved},b2Pair.prototype.SetFinal=function(){this.status|=b2Pair.e_pairFinal},b2Pair.prototype.IsFinal=function(){return(this.status&b2Pair.e_pairFinal)==b2Pair.e_pairFinal},b2Pair.prototype.userData=null,b2Pair.prototype.proxy1=null,b2Pair.prototype.proxy2=null,b2Pair.prototype.next=null,b2Pair.prototype.status=0;var b2FixtureDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2FixtureDef.prototype.__constructor=function(){this.userData=this.shape=null,this.friction=.2,this.density=this.restitution=0,this.filter.categoryBits=1,this.filter.maskBits=65535,this.filter.groupIndex=0,this.isSensor=!1},b2FixtureDef.prototype.__varz=function(){this.filter=new b2FilterData},b2FixtureDef.prototype.shape=null,b2FixtureDef.prototype.userData=null,b2FixtureDef.prototype.friction=null,b2FixtureDef.prototype.restitution=null,b2FixtureDef.prototype.density=null,b2FixtureDef.prototype.isSensor=null,b2FixtureDef.prototype.filter=new b2FilterData;var b2ContactID=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactID.prototype.__constructor=function(){this.features._m_id=this},b2ContactID.prototype.__varz=function(){this.features=new Features},b2ContactID.prototype.Set=function(e){key=e._key},b2ContactID.prototype.Copy=function(){var e=new b2ContactID;return e.key=key,e},b2ContactID.prototype.__defineSetter__("key",function(){return this._key}),b2ContactID.prototype.__defineSetter__("key",function(e){this._key=e,this.features._referenceEdge=this._key&255,this.features._incidentEdge=(this._key&65280)>>8&255,this.features._incidentVertex=(this._key&16711680)>>16&255,this.features._flip=(this._key&4278190080)>>24&255}),b2ContactID.prototype._key=0,b2ContactID.prototype.features=new Features;var b2Transform=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Transform.prototype.__constructor=function(e,t){e&&(this.position.SetV(e),this.R.SetM(t))},b2Transform.prototype.__varz=function(){this.position=new b2Vec2,this.R=new b2Mat22},b2Transform.prototype.Initialize=function(e,t){this.position.SetV(e),this.R.SetM(t)},b2Transform.prototype.SetIdentity=function(){this.position.SetZero(),this.R.SetIdentity()},b2Transform.prototype.Set=function(e){this.position.SetV(e.position),this.R.SetM(e.R)},b2Transform.prototype.GetAngle=function(){return Math.atan2(this.R.col1.y,this.R.col1.x)},b2Transform.prototype.position=new b2Vec2,b2Transform.prototype.R=new b2Mat22;var b2EdgeShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2EdgeShape.prototype,b2Shape.prototype),b2EdgeShape.prototype._super=b2Shape.prototype,b2EdgeShape.prototype.__constructor=function(e,t){this._super.__constructor.apply(this,[]),this.m_type=b2Shape.e_edgeShape,this.m_nextEdge=this.m_prevEdge=null,this.m_v1=e,this.m_v2=t,this.m_direction.Set(this.m_v2.x-this.m_v1.x,this.m_v2.y-this.m_v1.y),this.m_length=this.m_direction.Normalize(),this.m_normal.Set(this.m_direction.y,-this.m_direction.x),this.m_coreV1.Set(-b2Settings.b2_toiSlop*(this.m_normal.x-this.m_direction.x)+this.m_v1.x,-b2Settings.b2_toiSlop*(this.m_normal.y-this.m_direction.y)+this.m_v1.y),this.m_coreV2.Set(-b2Settings.b2_toiSlop*(this.m_normal.x+this.m_direction.x)+this.m_v2.x,-b2Settings.b2_toiSlop*(this.m_normal.y+this.m_direction.y)+this.m_v2.y),this.m_cornerDir1=this.m_normal,this.m_cornerDir2.Set(-this.m_normal.x,-this.m_normal.y)},b2EdgeShape.prototype.__varz=function(){this.s_supportVec=new b2Vec2,this.m_v1=new b2Vec2,this.m_v2=new b2Vec2,this.m_coreV1=new b2Vec2,this.m_coreV2=new b2Vec2,this.m_normal=new b2Vec2,this.m_direction=new b2Vec2,this.m_cornerDir1=new b2Vec2,this.m_cornerDir2=new b2Vec2},b2EdgeShape.prototype.SetPrevEdge=function(e,t,n,r){this.m_prevEdge=e,this.m_coreV1=t,this.m_cornerDir1=n,this.m_cornerConvex1=r},b2EdgeShape.prototype.SetNextEdge=function(e,t,n,r){this.m_nextEdge=e,this.m_coreV2=t,this.m_cornerDir2=n,this.m_cornerConvex2=r},b2EdgeShape.prototype.TestPoint=function(){return!1},b2EdgeShape.prototype.RayCast=function(e,t,n){var r,i=t.p2.x-t.p1.x,s=t.p2.y-t.p1.y;r=n.R;var o=n.position.x+(r.col1.x*this.m_v1.x+r.col2.x*this.m_v1.y),u=n.position.y+(r.col1.y*this.m_v1.x+r.col2.y*this.m_v1.y),a=n.position.y+(r.col1.y*this.m_v2.x+r.col2.y*this.m_v2.y)-u;n=-(n.position.x+(r.col1.x*this.m_v2.x+r.col2.x*this.m_v2.y)-o),r=100*Number.MIN_VALUE;var f=-(i*a+s*n);if(f>r){o=t.p1.x-o;var l=t.p1.y-u;u=o*a+l*n;if(0<=u&&u<=t.maxFraction*f){t=-i*l+s*o;if(-r*f<=t&&t<=f*(1+r))return u/=f,e.fraction=u,t=Math.sqrt(a*a+n*n),e.normal.x=a/t,e.normal.y=n/t,!0}}return!1},b2EdgeShape.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_v1.x+n.col2.x*this.m_v1.y),i=t.position.y+(n.col1.y*this.m_v1.x+n.col2.y*this.m_v1.y),s=t.position.x+(n.col1.x*this.m_v2.x+n.col2.x*this.m_v2.y);n=t.position.y+(n.col1.y*this.m_v2.x+n.col2.y*this.m_v2.y),r<s?(e.lowerBound.x=r,e.upperBound.x=s):(e.lowerBound.x=s,e.upperBound.x=r),i<n?(e.lowerBound.y=i,e.upperBound.y=n):(e.lowerBound.y=n,e.upperBound.y=i)},b2EdgeShape.prototype.ComputeMass=function(e){e.mass=0,e.center.SetV(this.m_v1),e.I=0},b2EdgeShape.prototype.ComputeSubmergedArea=function(e,t,n,r){var i=new b2Vec2(e.x*t,e.y*t),s=b2Math.MulX(n,this.m_v1);n=b2Math.MulX(n,this.m_v2);var o=b2Math.Dot(e,s)-t;e=b2Math.Dot(e,n)-t;if(o>0){if(e>0)return 0;s.x=-e/(o-e)*s.x+o/(o-e)*n.x,s.y=-e/(o-e)*s.y+o/(o-e)*n.y}else e>0&&(n.x=-e/(o-e)*s.x+o/(o-e)*n.x,n.y=-e/(o-e)*s.y+o/(o-e)*n.y);return r.x=(i.x+s.x+n.x)/3,r.y=(i.y+s.y+n.y)/3,.5*((s.x-i.x)*(n.y-i.y)-(s.y-i.y)*(n.x-i.x))},b2EdgeShape.prototype.GetLength=function(){return this.m_length},b2EdgeShape.prototype.GetVertex1=function(){return this.m_v1},b2EdgeShape.prototype.GetVertex2=function(){return this.m_v2},b2EdgeShape.prototype.GetCoreVertex1=function(){return this.m_coreV1},b2EdgeShape.prototype.GetCoreVertex2=function(){return this.m_coreV2},b2EdgeShape.prototype.GetNormalVector=function(){return this.m_normal},b2EdgeShape.prototype.GetDirectionVector=function(){return this.m_direction},b2EdgeShape.prototype.GetCorner1Vector=function(){return this.m_cornerDir1},b2EdgeShape.prototype.GetCorner2Vector=function(){return this.m_cornerDir2},b2EdgeShape.prototype.Corner1IsConvex=function(){return this.m_cornerConvex1},b2EdgeShape.prototype.Corner2IsConvex=function(){return this.m_cornerConvex2},b2EdgeShape.prototype.GetFirstVertex=function(e){var t=e.R;return new b2Vec2(e.position.x+(t.col1.x*this.m_coreV1.x+t.col2.x*this.m_coreV1.y),e.position.y+(t.col1.y*this.m_coreV1.x+t.col2.y*this.m_coreV1.y))},b2EdgeShape.prototype.GetNextEdge=function(){return this.m_nextEdge},b2EdgeShape.prototype.GetPrevEdge=function(){return this.m_prevEdge},b2EdgeShape.prototype.Support=function(e,t,n){var r=e.R,i=e.position.x+(r.col1.x*this.m_coreV1.x+r.col2.x*this.m_coreV1.y),s=e.position.y+(r.col1.y*this.m_coreV1.x+r.col2.y*this.m_coreV1.y),o=e.position.x+(r.col1.x*this.m_coreV2.x+r.col2.x*this.m_coreV2.y);return e=e.position.y+(r.col1.y*this.m_coreV2.x+r.col2.y*this.m_coreV2.y),i*t+s*n>o*t+e*n?(this.s_supportVec.x=i,this.s_supportVec.y=s):(this.s_supportVec.x=o,this.s_supportVec.y=e),this.s_supportVec},b2EdgeShape.prototype.s_supportVec=new b2Vec2,b2EdgeShape.prototype.m_v1=new b2Vec2,b2EdgeShape.prototype.m_v2=new b2Vec2,b2EdgeShape.prototype.m_coreV1=new b2Vec2,b2EdgeShape.prototype.m_coreV2=new b2Vec2,b2EdgeShape.prototype.m_length=null,b2EdgeShape.prototype.m_normal=new b2Vec2,b2EdgeShape.prototype.m_direction=new b2Vec2,b2EdgeShape.prototype.m_cornerDir1=new b2Vec2,b2EdgeShape.prototype.m_cornerDir2=new b2Vec2,b2EdgeShape.prototype.m_cornerConvex1=null,b2EdgeShape.prototype.m_cornerConvex2=null,b2EdgeShape.prototype.m_nextEdge=null,b2EdgeShape.prototype.m_prevEdge=null;var b2BuoyancyController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2BuoyancyController.prototype,b2Controller.prototype),b2BuoyancyController.prototype._super=b2Controller.prototype,b2BuoyancyController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2BuoyancyController.prototype.__varz=function(){this.normal=new b2Vec2(0,-1),this.velocity=new b2Vec2(0,0)},b2BuoyancyController.prototype.Step=function(){if(m_bodyList){this.useWorldGravity&&(this.gravity=this.GetWorld().GetGravity().Copy());for(var e=m_bodyList;e;e=e.nextBody){var t=e.body;if(t.IsAwake()!=0){for(var n=new b2Vec2,r=new b2Vec2,i=0,s=0,o=t.GetFixtureList();o;o=o.GetNext()){var u=new b2Vec2,a=o.GetShape().ComputeSubmergedArea(this.normal,this.offset,t.GetTransform(),u);i+=a,n.x+=a*u.x,n.y+=a*u.y,s+=a*1,r.x+=a*u.x*1,r.y+=a*u.y*1}n.x/=i,n.y/=i,r.x/=s,r.y/=s,i<Number.MIN_VALUE||(s=this.gravity.GetNegative(),s.Multiply(this.density*i),t.ApplyForce(s,r),r=t.GetLinearVelocityFromWorldPoint(n),r.Subtract(this.velocity),r.Multiply(-this.linearDrag*i),t.ApplyForce(r,n),t.ApplyTorque(-t.GetInertia()/t.GetMass()*i*t.GetAngularVelocity()*this.angularDrag))}}}},b2BuoyancyController.prototype.Draw=function(e){var t=new b2Vec2,n=new b2Vec2;t.x=this.normal.x*this.offset+this.normal.y*1e3,t.y=this.normal.y*this.offset-this.normal.x*1e3,n.x=this.normal.x*this.offset-this.normal.y*1e3,n.y=this.normal.y*this.offset+this.normal.x*1e3;var r=new b2Color(0,0,1);e.DrawSegment(t,n,r)},b2BuoyancyController.prototype.normal=new b2Vec2(0,-1),b2BuoyancyController.prototype.offset=0,b2BuoyancyController.prototype.density=0,b2BuoyancyController.prototype.velocity=new b2Vec2(0,0),b2BuoyancyController.prototype.linearDrag=2,b2BuoyancyController.prototype.angularDrag=1,b2BuoyancyController.prototype.useDensity=!1,b2BuoyancyController.prototype.useWorldGravity=!0,b2BuoyancyController.prototype.gravity=null;var b2Body=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Body.prototype.__constructor=function(e,t){this.m_flags=0,e.bullet&&(this.m_flags|=b2Body.e_bulletFlag),e.fixedRotation&&(this.m_flags|=b2Body.e_fixedRotationFlag),e.allowSleep&&(this.m_flags|=b2Body.e_allowSleepFlag),e.awake&&(this.m_flags|=b2Body.e_awakeFlag),e.active&&(this.m_flags|=b2Body.e_activeFlag),this.m_world=t,this.m_xf.position.SetV(e.position),this.m_xf.R.Set(e.angle),this.m_sweep.localCenter.SetZero(),this.m_sweep.t0=1,this.m_sweep.a0=this.m_sweep.a=e.angle;var n=this.m_xf.R,r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_contactList=this.m_controllerList=this.m_jointList=null,this.m_controllerCount=0,this.m_next=this.m_prev=null,this.m_linearVelocity.SetV(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_force.Set(0,0),this.m_sleepTime=this.m_torque=0,this.m_type=e.type,this.m_type==b2Body.b2_dynamicBody?this.m_invMass=this.m_mass=1:this.m_invMass=this.m_mass=0,this.m_invI=this.m_I=0,this.m_inertiaScale=e.inertiaScale,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0},b2Body.prototype.__varz=function(){this.m_xf=new b2Transform,this.m_sweep=new b2Sweep,this.m_linearVelocity=new b2Vec2,this.m_force=new b2Vec2},b2Body.b2_staticBody=0,b2Body.b2_kinematicBody=1,b2Body.b2_dynamicBody=2,b2Body.s_xf1=new b2Transform,b2Body.e_islandFlag=1,b2Body.e_awakeFlag=2,b2Body.e_allowSleepFlag=4,b2Body.e_bulletFlag=8,b2Body.e_fixedRotationFlag=16,b2Body.e_activeFlag=32,b2Body.prototype.connectEdges=function(e,t,n){var r=Math.atan2(t.GetDirectionVector().y,t.GetDirectionVector().x);n=b2Math.MulFV(Math.tan((r-n)*.5),t.GetDirectionVector()),n=b2Math.SubtractVV(n,t.GetNormalVector()),n=b2Math.MulFV(b2Settings.b2_toiSlop,n),n=b2Math.AddVV(n,t.GetVertex1());var i=b2Math.AddVV(e.GetDirectionVector(),t.GetDirectionVector());i.Normalize();var s=b2Math.Dot(e.GetDirectionVector(),t.GetNormalVector())>0;return e.SetNextEdge(t,n,i,s),t.SetPrevEdge(e,n,i,s),r},b2Body.prototype.SynchronizeFixtures=function(){var e=b2Body.s_xf1;e.R.Set(this.m_sweep.a0);var t=e.R,n=this.m_sweep.localCenter;e.position.x=this.m_sweep.c0.x-(t.col1.x*n.x+t.col2.x*n.y),e.position.y=this.m_sweep.c0.y-(t.col1.y*n.x+t.col2.y*n.y),n=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.Synchronize(n,e,this.m_xf)},b2Body.prototype.SynchronizeTransform=function(){this.m_xf.R.Set(this.m_sweep.a);var e=this.m_xf.R,t=this.m_sweep.localCenter;this.m_xf.position.x=this.m_sweep.c.x-(e.col1.x*t.x+e.col2.x*t.y),this.m_xf.position.y=this.m_sweep.c.y-(e.col1.y*t.x+e.col2.y*t.y)},b2Body.prototype.ShouldCollide=function(e){if(this.m_type!=b2Body.b2_dynamicBody&&e.m_type!=b2Body.b2_dynamicBody)return!1;for(var t=this.m_jointList;t;t=t.next)if(t.other==e&&t.joint.m_collideConnected==0)return!1;return!0},b2Body.prototype.Advance=function(e){this.m_sweep.Advance(e),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.SynchronizeTransform()},b2Body.prototype.CreateFixture=function(e){if(this.m_world.IsLocked()==1)return null;var t=new b2Fixture;return t.Create(this,this.m_xf,e),this.m_flags&b2Body.e_activeFlag&&t.CreateProxy(this.m_world.m_contactManager.m_broadPhase,this.m_xf),t.m_next=this.m_fixtureList,this.m_fixtureList=t,++this.m_fixtureCount,t.m_body=this,t.m_density>0&&this.ResetMassData(),this.m_world.m_flags|=b2World.e_newFixture,t},b2Body.prototype.CreateFixture2=function(e,t){var n=new b2FixtureDef;return n.shape=e,n.density=t,this.CreateFixture(n)},b2Body.prototype.DestroyFixture=function(e){if(this.m_world.IsLocked()!=1){for(var t=this.m_fixtureList,n=null;t!=null;){if(t==e){n?n.m_next=e.m_next:this.m_fixtureList=e.m_next;break}n=t,t=t.m_next}for(t=this.m_contactList;t;){n=t.contact,t=t.next;var r=n.GetFixtureA(),i=n.GetFixtureB();(e==r||e==i)&&this.m_world.m_contactManager.Destroy(n)}this.m_flags&b2Body.e_activeFlag&&e.DestroyProxy(this.m_world.m_contactManager.m_broadPhase),e.Destroy(),e.m_body=null,e.m_next=null,--this.m_fixtureCount,this.ResetMassData()}},b2Body.prototype.SetPositionAndAngle=function(e,t){var n;if(this.m_world.IsLocked()!=1){this.m_xf.R.Set(t),this.m_xf.position.SetV(e),n=this.m_xf.R;var r=this.m_sweep.localCenter;this.m_sweep.c.x=n.col1.x*r.x+n.col2.x*r.y,this.m_sweep.c.y=n.col1.y*r.x+n.col2.y*r.y,this.m_sweep.c.x+=this.m_xf.position.x,this.m_sweep.c.y+=this.m_xf.position.y,this.m_sweep.c0.SetV(this.m_sweep.c),this.m_sweep.a0=this.m_sweep.a=t,r=this.m_world.m_contactManager.m_broadPhase;for(n=this.m_fixtureList;n;n=n.m_next)n.Synchronize(r,this.m_xf,this.m_xf);this.m_world.m_contactManager.FindNewContacts()}},b2Body.prototype.SetTransform=function(e){this.SetPositionAndAngle(e.position,e.GetAngle())},b2Body.prototype.GetTransform=function(){return this.m_xf},b2Body.prototype.GetPosition=function(){return this.m_xf.position},b2Body.prototype.SetPosition=function(e){this.SetPositionAndAngle(e,this.GetAngle())},b2Body.prototype.GetAngle=function(){return this.m_sweep.a},b2Body.prototype.SetAngle=function(e){this.SetPositionAndAngle(this.GetPosition(),e)},b2Body.prototype.GetWorldCenter=function(){return this.m_sweep.c},b2Body.prototype.GetLocalCenter=function(){return this.m_sweep.localCenter},b2Body.prototype.SetLinearVelocity=function(e){this.m_type!=b2Body.b2_staticBody&&this.m_linearVelocity.SetV(e)},b2Body.prototype.GetLinearVelocity=function(){return this.m_linearVelocity},b2Body.prototype.SetAngularVelocity=function(e){this.m_type!=b2Body.b2_staticBody&&(this.m_angularVelocity=e)},b2Body.prototype.GetAngularVelocity=function(){return this.m_angularVelocity},b2Body.prototype.GetDefinition=function(){var e=new b2BodyDef;return e.type=this.GetType(),e.allowSleep=(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag,e.angle=this.GetAngle(),e.angularDamping=this.m_angularDamping,e.angularVelocity=this.m_angularVelocity,e.fixedRotation=(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag,e.bullet=(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag,e.awake=(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag,e.linearDamping=this.m_linearDamping,e.linearVelocity.SetV(this.GetLinearVelocity()),e.position=this.GetPosition(),e.userData=this.GetUserData(),e},b2Body.prototype.ApplyForce=function(e,t){this.m_type==b2Body.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x)},b2Body.prototype.ApplyTorque=function(e){this.m_type==b2Body.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_torque+=e)},b2Body.prototype.ApplyImpulse=function(e,t){this.m_type==b2Body.b2_dynamicBody&&(this.IsAwake()==0&&this.SetAwake(!0),this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((t.x-this.m_sweep.c.x)*e.y-(t.y-this.m_sweep.c.y)*e.x))},b2Body.prototype.Split=function(e){for(var t=this.GetLinearVelocity().Copy(),n=this.GetAngularVelocity(),r=this.GetWorldCenter(),i=this.m_world.CreateBody(this.GetDefinition()),s,o=this.m_fixtureList;o;)if(e(o)){var u=o.m_next;s?s.m_next=u:this.m_fixtureList=u,this.m_fixtureCount--,o.m_next=i.m_fixtureList,i.m_fixtureList=o,i.m_fixtureCount++,o.m_body=i,o=u}else s=o,o=o.m_next;return this.ResetMassData(),i.ResetMassData(),s=this.GetWorldCenter(),e=i.GetWorldCenter(),s=b2Math.AddVV(t,b2Math.CrossFV(n,b2Math.SubtractVV(s,r))),t=b2Math.AddVV(t,b2Math.CrossFV(n,b2Math.SubtractVV(e,r))),this.SetLinearVelocity(s),i.SetLinearVelocity(t),this.SetAngularVelocity(n),i.SetAngularVelocity(n),this.SynchronizeFixtures(),i.SynchronizeFixtures(),i},b2Body.prototype.Merge=function(e){var t;for(t=e.m_fixtureList;t;){var n=t.m_next;e.m_fixtureCount--,t.m_next=this.m_fixtureList,this.m_fixtureList=t,this.m_fixtureCount++,t.m_body=i,t=n}r.m_fixtureCount=0;var r=this,i=e;r.GetWorldCenter(),i.GetWorldCenter(),r.GetLinearVelocity().Copy(),i.GetLinearVelocity().Copy(),r.GetAngularVelocity(),i.GetAngularVelocity(),r.ResetMassData(),this.SynchronizeFixtures()},b2Body.prototype.GetMass=function(){return this.m_mass},b2Body.prototype.GetInertia=function(){return this.m_I},b2Body.prototype.GetMassData=function(e){e.mass=this.m_mass,e.I=this.m_I,e.center.SetV(this.m_sweep.localCenter)},b2Body.prototype.SetMassData=function(e){b2Settings.b2Assert(this.m_world.IsLocked()==0);if(this.m_world.IsLocked()!=1&&this.m_type==b2Body.b2_dynamicBody){this.m_invI=this.m_I=this.m_invMass=0,this.m_mass=e.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,e.I>0&&(this.m_flags&b2Body.e_fixedRotationFlag)==0&&(this.m_I=e.I-this.m_mass*(e.center.x*e.center.x+e.center.y*e.center.y),this.m_invI=1/this.m_I);var t=this.m_sweep.c.Copy();this.m_sweep.localCenter.SetV(e.center),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-t.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-t.x)}},b2Body.prototype.ResetMassData=function(){this.m_invI=this.m_I=this.m_invMass=this.m_mass=0,this.m_sweep.localCenter.SetZero();if(this.m_type!=b2Body.b2_staticBody&&this.m_type!=b2Body.b2_kinematicBody){for(var e=b2Vec2.Make(0,0),t=this.m_fixtureList;t;t=t.m_next)if(t.m_density!=0){var n=t.GetMassData();this.m_mass+=n.mass,e.x+=n.center.x*n.mass,e.y+=n.center.y*n.mass,this.m_I+=n.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,e.x*=this.m_invMass,e.y*=this.m_invMass):this.m_invMass=this.m_mass=1,this.m_I>0&&(this.m_flags&b2Body.e_fixedRotationFlag)==0?(this.m_I-=this.m_mass*(e.x*e.x+e.y*e.y),this.m_I*=this.m_inertiaScale,b2Settings.b2Assert(this.m_I>0),this.m_invI=1/this.m_I):this.m_invI=this.m_I=0,t=this.m_sweep.c.Copy(),this.m_sweep.localCenter.SetV(e),this.m_sweep.c0.SetV(b2Math.MulX(this.m_xf,this.m_sweep.localCenter)),this.m_sweep.c.SetV(this.m_sweep.c0),this.m_linearVelocity.x+=this.m_angularVelocity*-(this.m_sweep.c.y-t.y),this.m_linearVelocity.y+=this.m_angularVelocity*+(this.m_sweep.c.x-t.x)}},b2Body.prototype.GetWorldPoint=function(e){var t=this.m_xf.R;return e=new b2Vec2(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y),e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,e},b2Body.prototype.GetWorldVector=function(e){return b2Math.MulMV(this.m_xf.R,e)},b2Body.prototype.GetLocalPoint=function(e){return b2Math.MulXT(this.m_xf,e)},b2Body.prototype.GetLocalVector=function(e){return b2Math.MulTMV(this.m_xf.R,e)},b2Body.prototype.GetLinearVelocityFromWorldPoint=function(e){return new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearVelocityFromLocalPoint=function(e){var t=this.m_xf.R;return e=new b2Vec2(t.col1.x*e.x+t.col2.x*e.y,t.col1.y*e.x+t.col2.y*e.y),e.x+=this.m_xf.position.x,e.y+=this.m_xf.position.y,new b2Vec2(this.m_linearVelocity.x-this.m_angularVelocity*(e.y-this.m_sweep.c.y),this.m_linearVelocity.y+this.m_angularVelocity*(e.x-this.m_sweep.c.x))},b2Body.prototype.GetLinearDamping=function(){return this.m_linearDamping},b2Body.prototype.SetLinearDamping=function(e){this.m_linearDamping=e},b2Body.prototype.GetAngularDamping=function(){return this.m_angularDamping},b2Body.prototype.SetAngularDamping=function(e){this.m_angularDamping=e},b2Body.prototype.SetType=function(e){if(this.m_type!=e){this.m_type=e,this.ResetMassData(),this.m_type==b2Body.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(e=this.m_contactList;e;e=e.next)e.contact.FlagForFiltering()}},b2Body.prototype.GetType=function(){return this.m_type},b2Body.prototype.SetBullet=function(e){e?this.m_flags|=b2Body.e_bulletFlag:this.m_flags&=~b2Body.e_bulletFlag},b2Body.prototype.IsBullet=function(){return(this.m_flags&b2Body.e_bulletFlag)==b2Body.e_bulletFlag},b2Body.prototype.SetSleepingAllowed=function(e){e?this.m_flags|=b2Body.e_allowSleepFlag:(this.m_flags&=~b2Body.e_allowSleepFlag,this.SetAwake(!0))},b2Body.prototype.SetAwake=function(e){e?(this.m_flags|=b2Body.e_awakeFlag,this.m_sleepTime=0):(this.m_flags&=~b2Body.e_awakeFlag,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},b2Body.prototype.IsAwake=function(){return(this.m_flags&b2Body.e_awakeFlag)==b2Body.e_awakeFlag},b2Body.prototype.SetFixedRotation=function(e){e?this.m_flags|=b2Body.e_fixedRotationFlag:this.m_flags&=~b2Body.e_fixedRotationFlag,this.ResetMassData()},b2Body.prototype.IsFixedRotation=function(){return(this.m_flags&b2Body.e_fixedRotationFlag)==b2Body.e_fixedRotationFlag},b2Body.prototype.SetActive=function(e){if(e!=this.IsActive()){var t;if(e){this.m_flags|=b2Body.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.CreateProxy(e,this.m_xf)}else{this.m_flags&=~b2Body.e_activeFlag,e=this.m_world.m_contactManager.m_broadPhase;for(t=this.m_fixtureList;t;t=t.m_next)t.DestroyProxy(e);for(e=this.m_contactList;e;)t=e,e=e.next,this.m_world.m_contactManager.Destroy(t.contact);this.m_contactList=null}}},b2Body.prototype.IsActive=function(){return(this.m_flags&b2Body.e_activeFlag)==b2Body.e_activeFlag},b2Body.prototype.IsSleepingAllowed=function(){return(this.m_flags&b2Body.e_allowSleepFlag)==b2Body.e_allowSleepFlag},b2Body.prototype.GetFixtureList=function(){return this.m_fixtureList},b2Body.prototype.GetJointList=function(){return this.m_jointList},b2Body.prototype.GetControllerList=function(){return this.m_controllerList},b2Body.prototype.GetContactList=function(){return this.m_contactList},b2Body.prototype.GetNext=function(){return this.m_next},b2Body.prototype.GetUserData=function(){return this.m_userData},b2Body.prototype.SetUserData=function(e){this.m_userData=e},b2Body.prototype.GetWorld=function(){return this.m_world},b2Body.prototype.m_flags=0,b2Body.prototype.m_type=0,b2Body.prototype.m_islandIndex=0,b2Body.prototype.m_xf=new b2Transform,b2Body.prototype.m_sweep=new b2Sweep,b2Body.prototype.m_linearVelocity=new b2Vec2,b2Body.prototype.m_angularVelocity=null,b2Body.prototype.m_force=new b2Vec2,b2Body.prototype.m_torque=null,b2Body.prototype.m_world=null,b2Body.prototype.m_prev=null,b2Body.prototype.m_next=null,b2Body.prototype.m_fixtureList=null,b2Body.prototype.m_fixtureCount=0,b2Body.prototype.m_controllerList=null,b2Body.prototype.m_controllerCount=0,b2Body.prototype.m_jointList=null,b2Body.prototype.m_contactList=null,b2Body.prototype.m_mass=null,b2Body.prototype.m_invMass=null,b2Body.prototype.m_I=null,b2Body.prototype.m_invI=null,b2Body.prototype.m_inertiaScale=null,b2Body.prototype.m_linearDamping=null,b2Body.prototype.m_angularDamping=null,b2Body.prototype.m_sleepTime=null,b2Body.prototype.m_userData=null;var b2ContactImpulse=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactImpulse.prototype.__constructor=function(){},b2ContactImpulse.prototype.__varz=function(){this.normalImpulses=Array(b2Settings.b2_maxManifoldPoints),this.tangentImpulses=Array(b2Settings.b2_maxManifoldPoints)},b2ContactImpulse.prototype.normalImpulses=Array(b2Settings.b2_maxManifoldPoints),b2ContactImpulse.prototype.tangentImpulses=Array(b2Settings.b2_maxManifoldPoints);var b2TensorDampingController=function(){b2Controller.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2TensorDampingController.prototype,b2Controller.prototype),b2TensorDampingController.prototype._super=b2Controller.prototype,b2TensorDampingController.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2TensorDampingController.prototype.__varz=function(){this.T=new b2Mat22},b2TensorDampingController.prototype.SetAxisAligned=function(e,t){this.T.col1.x=-e,this.T.col1.y=0,this.T.col2.x=0,this.T.col2.y=-t,this.maxTimestep=e>0||t>0?1/Math.max(e,t):0},b2TensorDampingController.prototype.Step=function(e){e=e.dt;if(!(e<=Number.MIN_VALUE)){e>this.maxTimestep&&this.maxTimestep>0&&(e=this.maxTimestep);for(var t=m_bodyList;t;t=t.nextBody){var n=t.body;if(n.IsAwake()){var r=n.GetWorldVector(b2Math.MulMV(this.T,n.GetLocalVector(n.GetLinearVelocity())));n.SetLinearVelocity(new b2Vec2(n.GetLinearVelocity().x+r.x*e,n.GetLinearVelocity().y+r.y*e))}}}},b2TensorDampingController.prototype.T=new b2Mat22,b2TensorDampingController.prototype.maxTimestep=0;var b2ManifoldPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ManifoldPoint.prototype.__constructor=function(){this.Reset()},b2ManifoldPoint.prototype.__varz=function(){this.m_localPoint=new b2Vec2,this.m_id=new b2ContactID},b2ManifoldPoint.prototype.Reset=function(){this.m_localPoint.SetZero(),this.m_tangentImpulse=this.m_normalImpulse=0,this.m_id.key=0},b2ManifoldPoint.prototype.Set=function(e){this.m_localPoint.SetV(e.m_localPoint),this.m_normalImpulse=e.m_normalImpulse,this.m_tangentImpulse=e.m_tangentImpulse,this.m_id.Set(e.m_id)},b2ManifoldPoint.prototype.m_localPoint=new b2Vec2,b2ManifoldPoint.prototype.m_normalImpulse=null,b2ManifoldPoint.prototype.m_tangentImpulse=null,b2ManifoldPoint.prototype.m_id=new b2ContactID;var b2PolygonShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolygonShape.prototype,b2Shape.prototype),b2PolygonShape.prototype._super=b2Shape.prototype,b2PolygonShape.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.m_type=b2Shape.e_polygonShape,this.m_centroid=new b2Vec2,this.m_vertices=[],this.m_normals=[]},b2PolygonShape.prototype.__varz=function(){},b2PolygonShape.AsArray=function(e,t){var n=new b2PolygonShape;return n.SetAsArray(e,t),n},b2PolygonShape.AsVector=function(e,t){var n=new b2PolygonShape;return n.SetAsVector(e,t),n},b2PolygonShape.AsBox=function(e,t){var n=new b2PolygonShape;return n.SetAsBox(e,t),n},b2PolygonShape.AsOrientedBox=function(e,t,n,r){var i=new b2PolygonShape;return i.SetAsOrientedBox(e,t,n,r),i},b2PolygonShape.AsEdge=function(e,t){var n=new b2PolygonShape;return n.SetAsEdge(e,t),n},b2PolygonShape.ComputeCentroid=function(e,t){for(var n=new b2Vec2,r=0,i=1/3,s=0;s<t;++s){var o=e[s],u=s+1<t?e[parseInt(s+1)]:e[0],a=.5*((o.x-0)*(u.y-0)-(o.y-0)*(u.x-0));r+=a,n.x+=a*i*(0+o.x+u.x),n.y+=a*i*(0+o.y+u.y)}return n.x*=1/r,n.y*=1/r,n},b2PolygonShape.ComputeOBB=function(e,t,n){var r=0,i=Array(n+1);for(r=0;r<n;++r)i[r]=t[r];i[n]=i[0],t=Number.MAX_VALUE;for(r=1;r<=n;++r){var s=i[parseInt(r-1)],o=i[r].x-s.x,u=i[r].y-s.y,a=Math.sqrt(o*o+u*u);o/=a,u/=a;for(var f=-u,l=o,c=a=Number.MAX_VALUE,h=-Number.MAX_VALUE,p=-Number.MAX_VALUE,d=0;d<n;++d){var v=i[d].x-s.x,m=i[d].y-s.y,g=o*v+u*m;v=f*v+l*m,g<a&&(a=g),v<c&&(c=v),g>h&&(h=g),v>p&&(p=v)}d=(h-a)*(p-c),d<.95*t&&(t=d,e.R.col1.x=o,e.R.col1.y=u,e.R.col2.x=f,e.R.col2.y=l,o=.5*(a+h),u=.5*(c+p),f=e.R,e.center.x=s.x+(f.col1.x*o+f.col2.x*u),e.center.y=s.y+(f.col1.y*o+f.col2.y*u),e.extents.x=.5*(h-a),e.extents.y=.5*(p-c))}},b2PolygonShape.s_mat=new b2Mat22,b2PolygonShape.prototype.Validate=function(){return!1},b2PolygonShape.prototype.Reserve=function(e){for(var t=this.m_vertices.length;t<e;t++)this.m_vertices[t]=new b2Vec2,this.m_normals[t]=new b2Vec2},b2PolygonShape.prototype.Copy=function(){var e=new b2PolygonShape;return e.Set(this),e},b2PolygonShape.prototype.Set=function(e){this._super.Set.apply(this,[e]);if(isInstanceOf(e,b2PolygonShape)){this.m_centroid.SetV(e.m_centroid),this.m_vertexCount=e.m_vertexCount,this.Reserve(this.m_vertexCount);for(var t=0;t<this.m_vertexCount;t++)this.m_vertices[t].SetV(e.m_vertices[t]),this.m_normals[t].SetV(e.m_normals[t])}},b2PolygonShape.prototype.SetAsArray=function(e,t){for(var n=[],r=0,i=null;i=e[r];r++)n.push(i);this.SetAsVector(n,t)},b2PolygonShape.prototype.SetAsVector=function(e,t){typeof t=="undefined"&&(t=e.length),b2Settings.b2Assert(2<=t),this.m_vertexCount=t,this.Reserve(t);var n=0;for(n=0;n<this.m_vertexCount;n++)this.m_vertices[n].SetV(e[n]);for(n=0;n<this.m_vertexCount;++n){var r=b2Math.SubtractVV(this.m_vertices[n+1<this.m_vertexCount?n+1:0],this.m_vertices[n]);b2Settings.b2Assert(r.LengthSquared()>Number.MIN_VALUE),this.m_normals[n].SetV(b2Math.CrossVF(r,1)),this.m_normals[n].Normalize()}this.m_centroid=b2PolygonShape.ComputeCentroid(this.m_vertices,this.m_vertexCount)},b2PolygonShape.prototype.SetAsBox=function(e,t){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero()},b2PolygonShape.prototype.SetAsOrientedBox=function(e,t,n,r){this.m_vertexCount=4,this.Reserve(4),this.m_vertices[0].Set(-e,-t),this.m_vertices[1].Set(e,-t),this.m_vertices[2].Set(e,t),this.m_vertices[3].Set(-e,t),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid=n,e=new b2Transform,e.position=n,e.R.Set(r);for(n=0;n<this.m_vertexCount;++n)this.m_vertices[n]=b2Math.MulX(e,this.m_vertices[n]),this.m_normals[n]=b2Math.MulMV(e.R,this.m_normals[n])},b2PolygonShape.prototype.SetAsEdge=function(e,t){this.m_vertexCount=2,this.Reserve(2),this.m_vertices[0].SetV(e),this.m_vertices[1].SetV(t),this.m_centroid.x=.5*(e.x+t.x),this.m_centroid.y=.5*(e.y+t.y),this.m_normals[0]=b2Math.CrossVF(b2Math.SubtractVV(t,e),1),this.m_normals[0].Normalize(),this.m_normals[1].x=-this.m_normals[0].x,this.m_normals[1].y=-this.m_normals[0].y},b2PolygonShape.prototype.TestPoint=function(e,t){var n;n=e.R;for(var r=t.x-e.position.x,i=t.y-e.position.y,s=r*n.col1.x+i*n.col1.y,o=r*n.col2.x+i*n.col2.y,u=0;u<this.m_vertexCount;++u){n=this.m_vertices[u],r=s-n.x,i=o-n.y,n=this.m_normals[u];if(n.x*r+n.y*i>0)return!1}return!0},b2PolygonShape.prototype.RayCast=function(e,t,n){var r=0,i=t.maxFraction,s,o,u,a;s=t.p1.x-n.position.x,o=t.p1.y-n.position.y,u=n.R;var f=s*u.col1.x+o*u.col1.y,l=s*u.col2.x+o*u.col2.y;s=t.p2.x-n.position.x,o=t.p2.y-n.position.y,u=n.R,t=s*u.col1.x+o*u.col1.y-f,u=s*u.col2.x+o*u.col2.y-l;for(var c=-1,h=0;h<this.m_vertexCount;++h){a=this.m_vertices[h],s=a.x-f,o=a.y-l,a=this.m_normals[h],s=a.x*s+a.y*o,o=a.x*t+a.y*u;if(o==0){if(s<0)return!1}else o<0&&s<r*o?(r=s/o,c=h):o>0&&s<i*o&&(i=s/o);if(i<r-Number.MIN_VALUE)return!1}return c>=0?(e.fraction=r,u=n.R,a=this.m_normals[c],e.normal.x=u.col1.x*a.x+u.col2.x*a.y,e.normal.y=u.col1.y*a.x+u.col2.y*a.y,!0):!1},b2PolygonShape.prototype.ComputeAABB=function(e,t){for(var n=t.R,r=this.m_vertices[0],i=t.position.x+(n.col1.x*r.x+n.col2.x*r.y),s=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),o=i,u=s,a=1;a<this.m_vertexCount;++a){r=this.m_vertices[a];var f=t.position.x+(n.col1.x*r.x+n.col2.x*r.y);r=t.position.y+(n.col1.y*r.x+n.col2.y*r.y),i=i<f?i:f,s=s<r?s:r,o=o>f?o:f,u=u>r?u:r}e.lowerBound.x=i-this.m_radius,e.lowerBound.y=s-this.m_radius,e.upperBound.x=o+this.m_radius,e.upperBound.y=u+this.m_radius},b2PolygonShape.prototype.ComputeMass=function(e,t){if(this.m_vertexCount==2)e.center.x=.5*(this.m_vertices[0].x+this.m_vertices[1].x),e.center.y=.5*(this.m_vertices[0].y+this.m_vertices[1].y),e.mass=0,e.I=0;else{for(var n=0,r=0,i=0,s=0,o=1/3,u=0;u<this.m_vertexCount;++u){var a=this.m_vertices[u],f=u+1<this.m_vertexCount?this.m_vertices[parseInt(u+1)]:this.m_vertices[0],l=a.x-0,c=a.y-0,h=f.x-0,p=f.y-0,d=l*p-c*h,v=.5*d;i+=v,n+=v*o*(0+a.x+f.x),r+=v*o*(0+a.y+f.y),a=l,c=c,h=h,p=p,s+=d*(o*(.25*(a*a+h*a+h*h)+(0*a+0*h))+0+(o*(.25*(c*c+p*c+p*p)+(0*c+0*p))+0))}e.mass=t*i,n*=1/i,r*=1/i,e.center.Set(n,r),e.I=t*s}},b2PolygonShape.prototype.ComputeSubmergedArea=function(e,t,n,r){var i=b2Math.MulTMV(n.R,e),s=t-b2Math.Dot(e,n.position),o=[],u=0,a=-1;t=-1;var f=!1;for(e=e=0;e<this.m_vertexCount;++e){o[e]=b2Math.Dot(i,this.m_vertices[e])-s;var l=o[e]<-Number.MIN_VALUE;e>0&&(l?f||(a=e-1,u++):f&&(t=e-1,u++)),f=l}switch(u){case 0:return f?(e=new b2MassData,this.ComputeMass(e,1),r.SetV(b2Math.MulX(n,e.center)),e.mass):0;case 1:a==-1?a=this.m_vertexCount-1:t=this.m_vertexCount-1}e=(a+1)%this.m_vertexCount,i=(t+1)%this.m_vertexCount,s=(0-o[a])/(o[e]-o[a]),o=(0-o[t])/(o[i]-o[t]),a=new b2Vec2(this.m_vertices[a].x*(1-s)+this.m_vertices[e].x*s,this.m_vertices[a].y*(1-s)+this.m_vertices[e].y*s),t=new b2Vec2(this.m_vertices[t].x*(1-o)+this.m_vertices[i].x*o,this.m_vertices[t].y*(1-o)+this.m_vertices[i].y*o),o=0,s=new b2Vec2,u=this.m_vertices[e];for(e=e;e!=i;)e=(e+1)%this.m_vertexCount,f=e==i?t:this.m_vertices[e],l=.5*((u.x-a.x)*(f.y-a.y)-(u.y-a.y)*(f.x-a.x)),o+=l,s.x+=l*(a.x+u.x+f.x)/3,s.y+=l*(a.y+u.y+f.y)/3,u=f;return s.Multiply(1/o),r.SetV(b2Math.MulX(n,s)),o},b2PolygonShape.prototype.GetVertexCount=function(){return this.m_vertexCount},b2PolygonShape.prototype.GetVertices=function(){return this.m_vertices},b2PolygonShape.prototype.GetNormals=function(){return this.m_normals},b2PolygonShape.prototype.GetSupport=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return t},b2PolygonShape.prototype.GetSupportVertex=function(e){for(var t=0,n=this.m_vertices[0].x*e.x+this.m_vertices[0].y*e.y,r=1;r<this.m_vertexCount;++r){var i=this.m_vertices[r].x*e.x+this.m_vertices[r].y*e.y;i>n&&(t=r,n=i)}return this.m_vertices[t]},b2PolygonShape.prototype.m_centroid=null,b2PolygonShape.prototype.m_vertices=null,b2PolygonShape.prototype.m_normals=null,b2PolygonShape.prototype.m_vertexCount=0;var b2Fixture=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Fixture.prototype.__constructor=function(){this.m_aabb=new b2AABB,this.m_shape=this.m_next=this.m_body=this.m_userData=null,this.m_restitution=this.m_friction=this.m_density=0},b2Fixture.prototype.__varz=function(){this.m_filter=new b2FilterData},b2Fixture.prototype.Create=function(e,t,n){this.m_userData=n.userData,this.m_friction=n.friction,this.m_restitution=n.restitution,this.m_body=e,this.m_next=null,this.m_filter=n.filter.Copy(),this.m_isSensor=n.isSensor,this.m_shape=n.shape.Copy(),this.m_density=n.density},b2Fixture.prototype.Destroy=function(){this.m_shape=null},b2Fixture.prototype.CreateProxy=function(e,t){this.m_shape.ComputeAABB(this.m_aabb,t),this.m_proxy=e.CreateProxy(this.m_aabb,this)},b2Fixture.prototype.DestroyProxy=function(e){this.m_proxy!=null&&(e.DestroyProxy(this.m_proxy),this.m_proxy=null)},b2Fixture.prototype.Synchronize=function(e,t,n){if(this.m_proxy){var r=new b2AABB,i=new b2AABB;this.m_shape.ComputeAABB(r,t),this.m_shape.ComputeAABB(i,n),this.m_aabb.Combine(r,i),t=b2Math.SubtractVV(n.position,t.position),e.MoveProxy(this.m_proxy,this.m_aabb,t)}},b2Fixture.prototype.GetType=function(){return this.m_shape.GetType()},b2Fixture.prototype.GetShape=function(){return this.m_shape},b2Fixture.prototype.SetSensor=function(e){if(this.m_isSensor!=e){this.m_isSensor=e;if(this.m_body!=null)for(e=this.m_body.GetContactList();e;){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.SetSensor(n.IsSensor()||r.IsSensor()),e=e.next}}},b2Fixture.prototype.IsSensor=function(){return this.m_isSensor},b2Fixture.prototype.SetFilterData=function(e){this.m_filter=e.Copy();if(!this.m_body)for(e=this.m_body.GetContactList();e;){var t=e.contact,n=t.GetFixtureA(),r=t.GetFixtureB();(n==this||r==this)&&t.FlagForFiltering(),e=e.next}},b2Fixture.prototype.GetFilterData=function(){return this.m_filter.Copy()},b2Fixture.prototype.GetBody=function(){return this.m_body},b2Fixture.prototype.GetNext=function(){return this.m_next},b2Fixture.prototype.GetUserData=function(){return this.m_userData},b2Fixture.prototype.SetUserData=function(e){this.m_userData=e},b2Fixture.prototype.TestPoint=function(e){return this.m_shape.TestPoint(this.m_body.GetTransform(),e)},b2Fixture.prototype.RayCast=function(e,t){return this.m_shape.RayCast(e,t,this.m_body.GetTransform())},b2Fixture.prototype.GetMassData=function(e){return e==null&&(e=new b2MassData),this.m_shape.ComputeMass(e,this.m_density),e},b2Fixture.prototype.SetDensity=function(e){this.m_density=e},b2Fixture.prototype.GetDensity=function(){return this.m_density},b2Fixture.prototype.GetFriction=function(){return this.m_friction},b2Fixture.prototype.SetFriction=function(e){this.m_friction=e},b2Fixture.prototype.GetRestitution=function(){return this.m_restitution},b2Fixture.prototype.SetRestitution=function(e){this.m_restitution=e},b2Fixture.prototype.GetAABB=function(){return this.m_aabb},b2Fixture.prototype.m_massData=null,b2Fixture.prototype.m_aabb=null,b2Fixture.prototype.m_density=null,b2Fixture.prototype.m_next=null,b2Fixture.prototype.m_body=null,b2Fixture.prototype.m_shape=null,b2Fixture.prototype.m_friction=null,b2Fixture.prototype.m_restitution=null,b2Fixture.prototype.m_proxy=null,b2Fixture.prototype.m_filter=new b2FilterData,b2Fixture.prototype.m_isSensor=null,b2Fixture.prototype.m_userData=null;var b2DynamicTreeNode=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreeNode.prototype.__constructor=function(){},b2DynamicTreeNode.prototype.__varz=function(){this.aabb=new b2AABB},b2DynamicTreeNode.prototype.IsLeaf=function(){return this.child1==null},b2DynamicTreeNode.prototype.userData=null,b2DynamicTreeNode.prototype.aabb=new b2AABB,b2DynamicTreeNode.prototype.parent=null,b2DynamicTreeNode.prototype.child1=null,b2DynamicTreeNode.prototype.child2=null;var b2BodyDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BodyDef.prototype.__constructor=function(){this.userData=null,this.position.Set(0,0),this.angle=0,this.linearVelocity.Set(0,0),this.angularDamping=this.linearDamping=this.angularVelocity=0,this.awake=this.allowSleep=!0,this.bullet=this.fixedRotation=!1,this.type=b2Body.b2_staticBody,this.active=!0,this.inertiaScale=1},b2BodyDef.prototype.__varz=function(){this.position=new b2Vec2,this.linearVelocity=new b2Vec2},b2BodyDef.prototype.type=0,b2BodyDef.prototype.position=new b2Vec2,b2BodyDef.prototype.angle=null,b2BodyDef.prototype.linearVelocity=new b2Vec2,b2BodyDef.prototype.angularVelocity=null,b2BodyDef.prototype.linearDamping=null,b2BodyDef.prototype.angularDamping=null,b2BodyDef.prototype.allowSleep=null,b2BodyDef.prototype.awake=null,b2BodyDef.prototype.fixedRotation=null,b2BodyDef.prototype.bullet=null,b2BodyDef.prototype.active=null,b2BodyDef.prototype.userData=null,b2BodyDef.prototype.inertiaScale=null;var b2DynamicTreeBroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2DynamicTreeBroadPhase.prototype.__constructor=function(){},b2DynamicTreeBroadPhase.prototype.__varz=function(){this.m_tree=new b2DynamicTree,this.m_moveBuffer=[],this.m_pairBuffer=[]},b2DynamicTreeBroadPhase.prototype.BufferMove=function(e){this.m_moveBuffer[this.m_moveBuffer.length]=e},b2DynamicTreeBroadPhase.prototype.UnBufferMove=function(e){this.m_moveBuffer.splice(this.m_moveBuffer.indexOf(e),1)},b2DynamicTreeBroadPhase.prototype.ComparePairs=function(){return 0},b2DynamicTreeBroadPhase.prototype.CreateProxy=function(e,t){var n=this.m_tree.CreateProxy(e,t);return++this.m_proxyCount,this.BufferMove(n),n},b2DynamicTreeBroadPhase.prototype.DestroyProxy=function(e){this.UnBufferMove(e),--this.m_proxyCount,this.m_tree.DestroyProxy(e)},b2DynamicTreeBroadPhase.prototype.MoveProxy=function(e,t,n){this.m_tree.MoveProxy(e,t,n)&&this.BufferMove(e)},b2DynamicTreeBroadPhase.prototype.TestOverlap=function(e,t){var n=this.m_tree.GetFatAABB(e),r=this.m_tree.GetFatAABB(t);return n.TestOverlap(r)},b2DynamicTreeBroadPhase.prototype.GetUserData=function(e){return this.m_tree.GetUserData(e)},b2DynamicTreeBroadPhase.prototype.GetFatAABB=function(e){return this.m_tree.GetFatAABB(e)},b2DynamicTreeBroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2DynamicTreeBroadPhase.prototype.UpdatePairs=function(e){for(var t=this.m_pairCount=0,n=null;n=this.m_moveBuffer[t];t++){var r=this;this.m_tree.Query(function(e){if(e==n)return!0;r.m_pairCount==r.m_pairBuffer.length&&(r.m_pairBuffer[r.m_pairCount]=new b2DynamicTreePair);var t=r.m_pairBuffer[r.m_pairCount];return t.proxyA=e<n?e:n,t.proxyB=e>=n?e:n,++r.m_pairCount,!0},this.m_tree.GetFatAABB(n))}for(t=this.m_moveBuffer.length=0;t<this.m_pairCount;){var i=this.m_pairBuffer[t],s=this.m_tree.GetUserData(i.proxyA),o=this.m_tree.GetUserData(i.proxyB);e(s,o);for(++t;t<this.m_pairCount;){s=this.m_pairBuffer[t];if(s.proxyA!=i.proxyA||s.proxyB!=i.proxyB)break;++t}}},b2DynamicTreeBroadPhase.prototype.Query=function(e,t){this.m_tree.Query(e,t)},b2DynamicTreeBroadPhase.prototype.RayCast=function(e,t){this.m_tree.RayCast(e,t)},b2DynamicTreeBroadPhase.prototype.Validate=function(){},b2DynamicTreeBroadPhase.prototype.Rebalance=function(e){this.m_tree.Rebalance(e)},b2DynamicTreeBroadPhase.prototype.m_tree=new b2DynamicTree,b2DynamicTreeBroadPhase.prototype.m_proxyCount=0,b2DynamicTreeBroadPhase.prototype.m_moveBuffer=[],b2DynamicTreeBroadPhase.prototype.m_pairBuffer=[],b2DynamicTreeBroadPhase.prototype.m_pairCount=0;var b2BroadPhase=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2BroadPhase.prototype.__constructor=function(e){var t=0;this.m_pairManager.Initialize(this),this.m_worldAABB=e,this.m_proxyCount=0,this.m_bounds=[];for(t=0;t<2;t++)this.m_bounds[t]=[];t=e.upperBound.y-e.lowerBound.y,this.m_quantizationFactor.x=b2Settings.USHRT_MAX/(e.upperBound.x-e.lowerBound.x),this.m_quantizationFactor.y=b2Settings.USHRT_MAX/t,this.m_timeStamp=1,this.m_queryResultCount=0},b2BroadPhase.prototype.__varz=function(){this.m_pairManager=new b2PairManager,this.m_proxyPool=[],this.m_querySortKeys=[],this.m_queryResults=[],this.m_quantizationFactor=new b2Vec2},b2BroadPhase.BinarySearch=function(e,t,n){var r=0;for(t-=1;r<=t;){var i=Math.round((r+t)/2),s=e[i];if(s.value>n)t=i-1;else{if(!(s.value<n))return parseInt(i);r=i+1}}return parseInt(r)},b2BroadPhase.s_validate=!1,b2BroadPhase.b2_invalid=b2Settings.USHRT_MAX,b2BroadPhase.b2_nullEdge=b2Settings.USHRT_MAX,b2BroadPhase.prototype.ComputeBounds=function(e,t,n){var r=n.lowerBound.x,i=n.lowerBound.y;r=b2Math.Min(r,this.m_worldAABB.upperBound.x),i=b2Math.Min(i,this.m_worldAABB.upperBound.y),r=b2Math.Max(r,this.m_worldAABB.lowerBound.x),i=b2Math.Max(i,this.m_worldAABB.lowerBound.y);var s=n.upperBound.x;n=n.upperBound.y,s=b2Math.Min(s,this.m_worldAABB.upperBound.x),n=b2Math.Min(n,this.m_worldAABB.upperBound.y),s=b2Math.Max(s,this.m_worldAABB.lowerBound.x),n=b2Math.Max(n,this.m_worldAABB.lowerBound.y),e[0]=parseInt(this.m_quantizationFactor.x*(r-this.m_worldAABB.lowerBound.x))&b2Settings.USHRT_MAX-1,t[0]=parseInt(this.m_quantizationFactor.x*(s-this.m_worldAABB.lowerBound.x))%65535|1,e[1]=parseInt(this.m_quantizationFactor.y*(i-this.m_worldAABB.lowerBound.y))&b2Settings.USHRT_MAX-1,t[1]=parseInt(this.m_quantizationFactor.y*(n-this.m_worldAABB.lowerBound.y))%65535|1},b2BroadPhase.prototype.TestOverlapValidate=function(e,t){for(var n=0;n<2;++n){var r=this.m_bounds[n],i=r[e.lowerBounds[n]],s=r[t.upperBounds[n]];if(i.value>s.value)return!1;i=r[e.upperBounds[n]],s=r[t.lowerBounds[n]];if(i.value<s.value)return!1}return!0},b2BroadPhase.prototype.QueryAxis=function(e,t,n,r,i,s,o){n=b2BroadPhase.BinarySearch(i,s,n),r=b2BroadPhase.BinarySearch(i,s,r);for(var u=n;u<r;++u)s=i[u],s.IsLower()&&this.IncrementOverlapCount(s.proxy);if(n>0){u=n-1,s=i[u];for(var a=s.stabbingCount;a;)s=i[u],s.IsLower()&&n<=s.proxy.upperBounds[o]&&(this.IncrementOverlapCount(s.proxy),--a),--u}e[0]=n,t[0]=r},b2BroadPhase.prototype.IncrementOverlapCount=function(e){e.timeStamp<this.m_timeStamp?(e.timeStamp=this.m_timeStamp,e.overlapCount=1):(e.overlapCount=2,this.m_queryResults[this.m_queryResultCount]=e,++this.m_queryResultCount)},b2BroadPhase.prototype.IncrementTimeStamp=function(){if(this.m_timeStamp==b2Settings.USHRT_MAX){for(var e=0;e<this.m_proxyPool.length;++e)this.m_proxyPool[e].timeStamp=0;this.m_timeStamp=1}else++this.m_timeStamp},b2BroadPhase.prototype.InRange=function(e){var t,n,r,i;return t=e.lowerBound.x,n=e.lowerBound.y,t-=this.m_worldAABB.upperBound.x,n-=this.m_worldAABB.upperBound.y,r=this.m_worldAABB.lowerBound.x,i=this.m_worldAABB.lowerBound.y,r-=e.upperBound.x,i-=e.upperBound.y,t=b2Math.Max(t,r),n=b2Math.Max(n,i),b2Math.Max(t,n)<0},b2BroadPhase.prototype.CreateProxy=function(e,t){var n=0,r,i=0;r=0;if(!this.m_freeProxy){this.m_freeProxy=this.m_proxyPool[this.m_proxyCount]=new b2Proxy,this.m_freeProxy.next=null,this.m_freeProxy.timeStamp=0,this.m_freeProxy.overlapCount=b2BroadPhase.b2_invalid,this.m_freeProxy.userData=null;for(i=0;i<2;i++)r=this.m_proxyCount*2,this.m_bounds[i][r++]=new b2Bound,this.m_bounds[i][r]=new b2Bound}r=this.m_freeProxy,this.m_freeProxy=r.next,r.overlapCount=0,r.userData=t,i=2*this.m_proxyCount;var s=[],o=[];this.ComputeBounds(s,o,e);for(var u=0;u<2;++u){var a=this.m_bounds[u],f=0,l=0,c=[];c.push(f),n=[],n.push(l),this.QueryAxis(c,n,s[u],o[u],a,i,u),f=c[0],l=n[0],a.splice(l,0,a[a.length-1]),a.length--,a.splice(f,0,a[a.length-1]),a.length--,++l,c=a[f],n=a[l],c.value=s[u],c.proxy=r,n.value=o[u],n.proxy=r;var h=a[parseInt(f-1)];c.stabbingCount=f==0?0:h.stabbingCount,h=a[parseInt(l-1)],n.stabbingCount=h.stabbingCount;for(n=f;n<l;++n)h=a[n],h.stabbingCount++;for(n=f;n<i+2;++n)c=a[n],f=c.proxy,c.IsLower()?f.lowerBounds[u]=n:f.upperBounds[u]=n}++this.m_proxyCount;for(i=0;i<this.m_queryResultCount;++i)this.m_pairManager.AddBufferedPair(r,this.m_queryResults[i]);return this.m_queryResultCount=0,this.IncrementTimeStamp(),r},b2BroadPhase.prototype.DestroyProxy=function(e){for(var t,n,r=2*this.m_proxyCount,i=0;i<2;++i){var s=this.m_bounds[i],o=e.lowerBounds[i],u=e.upperBounds[i];t=s[o];var a=t.value;n=s[u];var f=n.value;s.splice(u,1),s.splice(o,1),s.push(t),s.push(n),n=r-2;for(var l=o;l<n;++l){t=s[l];var c=t.proxy;t.IsLower()?c.lowerBounds[i]=l:c.upperBounds[i]=l}n=u-1;for(o=o;o<n;++o)t=s[o],t.stabbingCount--;t=[],this.QueryAxis(t,t,a,f,s,r-2,i)}for(r=0;r<this.m_queryResultCount;++r)this.m_pairManager.RemoveBufferedPair(e,this.m_queryResults[r]);this.m_queryResultCount=0,this.IncrementTimeStamp(),e.userData=null,e.overlapCount=b2BroadPhase.b2_invalid,e.lowerBounds[0]=b2BroadPhase.b2_invalid,e.lowerBounds[1]=b2BroadPhase.b2_invalid,e.upperBounds[0]=b2BroadPhase.b2_invalid,e.upperBounds[1]=b2BroadPhase.b2_invalid,e.next=this.m_freeProxy,this.m_freeProxy=e,--this.m_proxyCount},b2BroadPhase.prototype.MoveProxy=function(e,t){var n,r=0,i=0,s=0,o,u;if(e!=null&&t.IsValid()!=0){var a=2*this.m_proxyCount,f=new b2BoundValues;this.ComputeBounds(f.lowerValues,f.upperValues,t);var l=new b2BoundValues;for(i=0;i<2;++i)o=this.m_bounds[i][e.lowerBounds[i]],l.lowerValues[i]=o.value,o=this.m_bounds[i][e.upperBounds[i]],l.upperValues[i]=o.value;for(i=0;i<2;++i){var c=this.m_bounds[i],h=e.lowerBounds[i],p=e.upperBounds[i],d=f.lowerValues[i],v=f.upperValues[i];o=c[h];var m=d-o.value;o.value=d,o=c[p];var g=v-o.value;o.value=v;if(m<0)for(s=h;s>0&&d<c[parseInt(s-1)].value;)o=c[s],u=c[parseInt(s-1)],n=u.proxy,u.stabbingCount++,u.IsUpper()==1?(this.TestOverlapBound(f,n)&&this.m_pairManager.AddBufferedPair(e,n),n=n.upperBounds,r=n[i],r++,n[i]=r,o.stabbingCount++):(n=n.lowerBounds,r=n[i],r++,n[i]=r,o.stabbingCount--),n=e.lowerBounds,r=n[i],r--,n[i]=r,o.Swap(u),--s;if(g>0)for(s=p;s<a-1&&c[parseInt(s+1)].value<=v;)o=c[s],u=c[parseInt(s+1)],n=u.proxy,u.stabbingCount++,u.IsLower()==1?(this.TestOverlapBound(f,n)&&this.m_pairManager.AddBufferedPair(e,n),n=n.lowerBounds,r=n[i],r--,n[i]=r,o.stabbingCount++):(n=n.upperBounds,r=n[i],r--,n[i]=r,o.stabbingCount--),n=e.upperBounds,r=n[i],r++,n[i]=r,o.Swap(u),s++;if(m>0)for(s=h;s<a-1&&c[parseInt(s+1)].value<=d;)o=c[s],u=c[parseInt(s+1)],n=u.proxy,u.stabbingCount--,u.IsUpper()?(this.TestOverlapBound(l,n)&&this.m_pairManager.RemoveBufferedPair(e,n),n=n.upperBounds,r=n[i],r--,n[i]=r,o.stabbingCount--):(n=n.lowerBounds,r=n[i],r--,n[i]=r,o.stabbingCount++),n=e.lowerBounds,r=n[i],r++,n[i]=r,o.Swap(u),s++;if(g<0)for(s=p;s>0&&v<c[parseInt(s-1)].value;)o=c[s],u=c[parseInt(s-1)],n=u.proxy,u.stabbingCount--,u.IsLower()==1?(this.TestOverlapBound(l,n)&&this.m_pairManager.RemoveBufferedPair(e,n),n=n.lowerBounds,r=n[i],r++,n[i]=r,o.stabbingCount--):(n=n.upperBounds,r=n[i],r++,n[i]=r,o.stabbingCount++),n=e.upperBounds,r=n[i],r--,n[i]=r,o.Swap(u),s--}}},b2BroadPhase.prototype.UpdatePairs=function(e){this.m_pairManager.Commit(e)},b2BroadPhase.prototype.TestOverlap=function(e,t){return e.lowerBounds[0]>t.upperBounds[0]?!1:t.lowerBounds[0]>e.upperBounds[0]?!1:e.lowerBounds[1]>t.upperBounds[1]?!1:t.lowerBounds[1]>e.upperBounds[1]?!1:!0},b2BroadPhase.prototype.GetUserData=function(e){return e.userData},b2BroadPhase.prototype.GetFatAABB=function(e){var t=new b2AABB;return t.lowerBound.x=this.m_worldAABB.lowerBound.x+this.m_bounds[0][e.lowerBounds[0]].value/this.m_quantizationFactor.x,t.lowerBound.y=this.m_worldAABB.lowerBound.y+this.m_bounds[1][e.lowerBounds[1]].value/this.m_quantizationFactor.y,t.upperBound.x=this.m_worldAABB.lowerBound.x+this.m_bounds[0][e.upperBounds[0]].value/this.m_quantizationFactor.x,t.upperBound.y=this.m_worldAABB.lowerBound.y+this.m_bounds[1][e.upperBounds[1]].value/this.m_quantizationFactor.y,t},b2BroadPhase.prototype.GetProxyCount=function(){return this.m_proxyCount},b2BroadPhase.prototype.Query=function(e,t){var n=[],r=[];this.ComputeBounds(n,r,t);var i=[];i.push(0);var s=[];s.push(0),this.QueryAxis(i,s,n[0],r[0],this.m_bounds[0],2*this.m_proxyCount,0),this.QueryAxis(i,s,n[1],r[1],this.m_bounds[1],2*this.m_proxyCount,1);for(n=0;n<this.m_queryResultCount;++n)if(!e(this.m_queryResults[n]))break;this.m_queryResultCount=0,this.IncrementTimeStamp()},b2BroadPhase.prototype.Validate=function(){for(var e=0;e<2;++e)for(var t=this.m_bounds[e],n=2*this.m_proxyCount,r=0,i=0;i<n;++i)t[i].IsLower()==1?r++:r--},b2BroadPhase.prototype.Rebalance=function(){},b2BroadPhase.prototype.RayCast=function(e,t){var n=new b2RayCastInput;n.p1.SetV(t.p1),n.p2.SetV(t.p2),n.maxFraction=t.maxFraction;var r=(t.p2.x-t.p1.x)*this.m_quantizationFactor.x,i=(t.p2.y-t.p1.y)*this.m_quantizationFactor.y,s=r<-Number.MIN_VALUE?-1:r>Number.MIN_VALUE?1:0,o=i<-Number.MIN_VALUE?-1:i>Number.MIN_VALUE?1:0,u=this.m_quantizationFactor.x*(t.p1.x-this.m_worldAABB.lowerBound.x),a=this.m_quantizationFactor.y*(t.p1.y-this.m_worldAABB.lowerBound.y),f=[],l=[];f[0]=parseInt(u)&b2Settings.USHRT_MAX-1,f[1]=parseInt(a)&b2Settings.USHRT_MAX-1,l[0]=f[0]+1,l[1]=f[1]+1;var c=0,h=0;h=[],h.push(0);var p=[];p.push(0),this.QueryAxis(h,p,f[0],l[0],this.m_bounds[0],2*this.m_proxyCount,0),c=s>=0?p[0]-1:h[0],this.QueryAxis(h,p,f[1],l[1],this.m_bounds[1],2*this.m_proxyCount,1),h=o>=0?p[0]-1:h[0];for(f=0;f<this.m_queryResultCount;f++)n.maxFraction=e(this.m_queryResults[f],n);for(;;){p=l=0,c+=s>=0?1:-1;if(c<0||c>=this.m_proxyCount*2)break;s!=0&&(l=(this.m_bounds[0][c].value-u)/r),h+=o>=0?1:-1;if(h<0||h>=this.m_proxyCount*2)break;o!=0&&(p=(this.m_bounds[1][h].value-a)/i);for(;;)if(o==0||s!=0&&l<p){if(l>n.maxFraction)break;if(s>0?this.m_bounds[0][c].IsLower():this.m_bounds[0][c].IsUpper())f=this.m_bounds[0][c].proxy,o>=0?f.lowerBounds[1]<=h-1&&f.upperBounds[1]>=h&&(n.maxFraction=e(f,n)):f.lowerBounds[1]<=h&&f.upperBounds[1]>=h+1&&(n.maxFraction=e(f,n));if(n.maxFraction==0)break;if(s>0){c++;if(c==this.m_proxyCount*2)break}else{c--;if(c<0)break}l=(this.m_bounds[0][c].value-u)/r}else{if(p>n.maxFraction)break;if(o>0?this.m_bounds[1][h].IsLower():this.m_bounds[1][h].IsUpper())f=this.m_bounds[1][h].proxy,s>=0?f.lowerBounds[0]<=c-1&&f.upperBounds[0]>=c&&(n.maxFraction=e(f,n)):f.lowerBounds[0]<=c&&f.upperBounds[0]>=c+1&&(n.maxFraction=e(f,n));if(n.maxFraction==0)break;if(o>0){h++;if(h==this.m_proxyCount*2)break}else{h--;if(h<0)break}p=(this.m_bounds[1][h].value-a)/i}break}this.m_queryResultCount=0,this.IncrementTimeStamp()},b2BroadPhase.prototype.TestOverlapBound=function(e,t){for(var n=0;n<2;++n){var r=this.m_bounds[n],i=r[t.upperBounds[n]];if(e.lowerValues[n]>i.value)return!1;i=r[t.lowerBounds[n]];if(e.upperValues[n]<i.value)return!1}return!0},b2BroadPhase.prototype.m_pairManager=new b2PairManager,b2BroadPhase.prototype.m_proxyPool=[],b2BroadPhase.prototype.m_freeProxy=null,b2BroadPhase.prototype.m_bounds=null,b2BroadPhase.prototype.m_querySortKeys=[],b2BroadPhase.prototype.m_queryResults=[],b2BroadPhase.prototype.m_queryResultCount=0,b2BroadPhase.prototype.m_worldAABB=null,b2BroadPhase.prototype.m_quantizationFactor=new b2Vec2,b2BroadPhase.prototype.m_proxyCount=0,b2BroadPhase.prototype.m_timeStamp=0;var b2Manifold=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Manifold.prototype.__constructor=function(){this.m_points=Array(b2Settings.b2_maxManifoldPoints);for(var e=0;e<b2Settings.b2_maxManifoldPoints;e++)this.m_points[e]=new b2ManifoldPoint;this.m_localPlaneNormal=new b2Vec2,this.m_localPoint=new b2Vec2},b2Manifold.prototype.__varz=function(){},b2Manifold.e_circles=1,b2Manifold.e_faceA=2,b2Manifold.e_faceB=4,b2Manifold.prototype.Reset=function(){for(var e=0;e<b2Settings.b2_maxManifoldPoints;e++)this.m_points[e].Reset();this.m_localPlaneNormal.SetZero(),this.m_localPoint.SetZero(),this.m_pointCount=this.m_type=0},b2Manifold.prototype.Set=function(e){this.m_pointCount=e.m_pointCount;for(var t=0;t<b2Settings.b2_maxManifoldPoints;t++)this.m_points[t].Set(e.m_points[t]);this.m_localPlaneNormal.SetV(e.m_localPlaneNormal),this.m_localPoint.SetV(e.m_localPoint),this.m_type=e.m_type},b2Manifold.prototype.Copy=function(){var e=new b2Manifold;return e.Set(this),e},b2Manifold.prototype.m_points=null,b2Manifold.prototype.m_localPlaneNormal=null,b2Manifold.prototype.m_localPoint=null,b2Manifold.prototype.m_type=0,b2Manifold.prototype.m_pointCount=0;var b2CircleShape=function(){b2Shape.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2CircleShape.prototype,b2Shape.prototype),b2CircleShape.prototype._super=b2Shape.prototype,b2CircleShape.prototype.__constructor=function(e){this._super.__constructor.apply(this,[]),this.m_type=b2Shape.e_circleShape,this.m_radius=e},b2CircleShape.prototype.__varz=function(){this.m_p=new b2Vec2},b2CircleShape.prototype.Copy=function(){var e=new b2CircleShape;return e.Set(this),e},b2CircleShape.prototype.Set=function(e){this._super.Set.apply(this,[e]),isInstanceOf(e,b2CircleShape)&&this.m_p.SetV(e.m_p)},b2CircleShape.prototype.TestPoint=function(e,t){var n=e.R,r=e.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);return n=e.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),r=t.x-r,n=t.y-n,r*r+n*n<=this.m_radius*this.m_radius},b2CircleShape.prototype.RayCast=function(e,t,n){var r=n.R,i=t.p1.x-(n.position.x+(r.col1.x*this.m_p.x+r.col2.x*this.m_p.y));n=t.p1.y-(n.position.y+(r.col1.y*this.m_p.x+r.col2.y*this.m_p.y)),r=t.p2.x-t.p1.x;var s=t.p2.y-t.p1.y,o=i*r+n*s,u=r*r+s*s,a=o*o-u*(i*i+n*n-this.m_radius*this.m_radius);return a<0||u<Number.MIN_VALUE?!1:(o=-(o+Math.sqrt(a)),0<=o&&o<=t.maxFraction*u?(o/=u,e.fraction=o,e.normal.x=i+o*r,e.normal.y=n+o*s,e.normal.Normalize(),!0):!1)},b2CircleShape.prototype.ComputeAABB=function(e,t){var n=t.R,r=t.position.x+(n.col1.x*this.m_p.x+n.col2.x*this.m_p.y);n=t.position.y+(n.col1.y*this.m_p.x+n.col2.y*this.m_p.y),e.lowerBound.Set(r-this.m_radius,n-this.m_radius),e.upperBound.Set(r+this.m_radius,n+this.m_radius)},b2CircleShape.prototype.ComputeMass=function(e,t){e.mass=t*b2Settings.b2_pi*this.m_radius*this.m_radius,e.center.SetV(this.m_p),e.I=e.mass*(.5*this.m_radius*this.m_radius+(this.m_p.x*this.m_p.x+this.m_p.y*this.m_p.y))},b2CircleShape.prototype.ComputeSubmergedArea=function(e,t,n,r){n=b2Math.MulX(n,this.m_p);var i=-(b2Math.Dot(e,n)-t);if(i<-this.m_radius+Number.MIN_VALUE)return 0;if(i>this.m_radius)return r.SetV(n),Math.PI*this.m_radius*this.m_radius;t=this.m_radius*this.m_radius;var s=i*i;return i=t*(Math.asin(i/this.m_radius)+Math.PI/2)+i*Math.sqrt(t-s),t=-2/3*Math.pow(t-s,1.5)/i,r.x=n.x+e.x*t,r.y=n.y+e.y*t,i},b2CircleShape.prototype.GetLocalPosition=function(){return this.m_p},b2CircleShape.prototype.SetLocalPosition=function(e){this.m_p.SetV(e)},b2CircleShape.prototype.GetRadius=function(){return this.m_radius},b2CircleShape.prototype.SetRadius=function(e){this.m_radius=e},b2CircleShape.prototype.m_p=new b2Vec2;var b2Joint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Joint.prototype.__constructor=function(e){b2Settings.b2Assert(e.bodyA!=e.bodyB),this.m_type=e.type,this.m_next=this.m_prev=null,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=e.collideConnected,this.m_islandFlag=!1,this.m_userData=e.userData},b2Joint.prototype.__varz=function(){this.m_edgeA=new b2JointEdge,this.m_edgeB=new b2JointEdge,this.m_localCenterA=new b2Vec2,this.m_localCenterB=new b2Vec2},b2Joint.Create=function(e){var t=null;switch(e.type){case b2Joint.e_distanceJoint:t=new b2DistanceJoint(e);break;case b2Joint.e_mouseJoint:t=new b2MouseJoint(e);break;case b2Joint.e_prismaticJoint:t=new b2PrismaticJoint(e);break;case b2Joint.e_revoluteJoint:t=new b2RevoluteJoint(e);break;case b2Joint.e_pulleyJoint:t=new b2PulleyJoint(e);break;case b2Joint.e_gearJoint:t=new b2GearJoint(e);break;case b2Joint.e_lineJoint:t=new b2LineJoint(e);break;case b2Joint.e_weldJoint:t=new b2WeldJoint(e);break;case b2Joint.e_frictionJoint:t=new b2FrictionJoint(e)}return t},b2Joint.Destroy=function(){},b2Joint.e_unknownJoint=0,b2Joint.e_revoluteJoint=1,b2Joint.e_prismaticJoint=2,b2Joint.e_distanceJoint=3,b2Joint.e_pulleyJoint=4,b2Joint.e_mouseJoint=5,b2Joint.e_gearJoint=6,b2Joint.e_lineJoint=7,b2Joint.e_weldJoint=8,b2Joint.e_frictionJoint=9,b2Joint.e_inactiveLimit=0,b2Joint.e_atLowerLimit=1,b2Joint.e_atUpperLimit=2,b2Joint.e_equalLimits=3,b2Joint.prototype.InitVelocityConstraints=function(){},b2Joint.prototype.SolveVelocityConstraints=function(){},b2Joint.prototype.FinalizeVelocityConstraints=function(){},b2Joint.prototype.SolvePositionConstraints=function(){return!1},b2Joint.prototype.GetType=function(){return this.m_type},b2Joint.prototype.GetAnchorA=function(){return null},b2Joint.prototype.GetAnchorB=function(){return null},b2Joint.prototype.GetReactionForce=function(){return null},b2Joint.prototype.GetReactionTorque=function(){return 0},b2Joint.prototype.GetBodyA=function(){return this.m_bodyA},b2Joint.prototype.GetBodyB=function(){return this.m_bodyB},b2Joint.prototype.GetNext=function(){return this.m_next},b2Joint.prototype.GetUserData=function(){return this.m_userData},b2Joint.prototype.SetUserData=function(e){this.m_userData=e},b2Joint.prototype.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},b2Joint.prototype.m_type=0,b2Joint.prototype.m_prev=null,b2Joint.prototype.m_next=null,b2Joint.prototype.m_edgeA=new b2JointEdge,b2Joint.prototype.m_edgeB=new b2JointEdge,b2Joint.prototype.m_bodyA=null,b2Joint.prototype.m_bodyB=null,b2Joint.prototype.m_islandFlag=null,b2Joint.prototype.m_collideConnected=null,b2Joint.prototype.m_userData=null,b2Joint.prototype.m_localCenterA=new b2Vec2,b2Joint.prototype.m_localCenterB=new b2Vec2,b2Joint.prototype.m_invMassA=null,b2Joint.prototype.m_invMassB=null,b2Joint.prototype.m_invIA=null,b2Joint.prototype.m_invIB=null;var b2LineJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2LineJoint.prototype,b2Joint.prototype),b2LineJoint.prototype._super=b2Joint.prototype,b2LineJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2LineJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat22,this.m_impulse=new b2Vec2},b2LineJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(n.GetLocalCenter());var s=t.GetTransform();n.GetTransform(),r=t.m_xf.R;var o=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;i=r.col1.x*o+r.col2.x*u,u=r.col1.y*o+r.col2.y*u,o=i,r=n.m_xf.R;var a=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y;i=r.col1.x*a+r.col2.x*f,f=r.col1.y*a+r.col2.y*f,a=i,r=n.m_sweep.c.x+a-t.m_sweep.c.x-o,i=n.m_sweep.c.y+f-t.m_sweep.c.y-u,this.m_invMassA=t.m_invMass,this.m_invMassB=n.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=n.m_invI,this.m_axis.SetV(b2Math.MulMV(s.R,this.m_localXAxis1)),this.m_a1=(r+o)*this.m_axis.y-(i+u)*this.m_axis.x,this.m_a2=a*this.m_axis.y-f*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass=this.m_motorMass>Number.MIN_VALUE?1/this.m_motorMass:0,this.m_perp.SetV(b2Math.MulMV(s.R,this.m_localYAxis1)),this.m_s1=(r+o)*this.m_perp.y-(i+u)*this.m_perp.x,this.m_s2=a*this.m_perp.y-f*this.m_perp.x,s=this.m_invMassA,o=this.m_invMassB,u=this.m_invIA,a=this.m_invIB,this.m_K.col1.x=s+o+u*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,this.m_K.col1.y=u*this.m_s1*this.m_a1+a*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=s+o+u*this.m_a1*this.m_a1+a*this.m_a2*this.m_a2,this.m_enableLimit?(r=this.m_axis.x*r+this.m_axis.y*i,b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:r<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.y=0):r>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.y=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.y=0)):this.m_limitState=b2Joint.e_inactiveLimit,this.m_enableMotor==0&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x,r=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y,i=this.m_impulse.x*this.m_s1+(this.m_motorImpulse+this.m_impulse.y)*this.m_a1,s=this.m_impulse.x*this.m_s2+(this.m_motorImpulse+this.m_impulse.y)*this.m_a2,t.m_linearVelocity.x-=this.m_invMassA*e,t.m_linearVelocity.y-=this.m_invMassA*r,t.m_angularVelocity-=this.m_invIA*i,n.m_linearVelocity.x+=this.m_invMassB*e,n.m_linearVelocity.y+=this.m_invMassB*r,n.m_angularVelocity+=this.m_invIB*s):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b2LineJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,i=t.m_angularVelocity,s=n.m_linearVelocity,o=n.m_angularVelocity,u,a,f;this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(f=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i)),u=this.m_motorImpulse,e=e.dt*this.m_maxMotorForce,this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+f,-e,e),f=this.m_motorImpulse-u,u=f*this.m_axis.x,e=f*this.m_axis.y,a=f*this.m_a1,f*=this.m_a2,r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*e,i-=this.m_invIA*a,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*e,o+=this.m_invIB*f),e=this.m_perp.x*(s.x-r.x)+this.m_perp.y*(s.y-r.y)+this.m_s2*o-this.m_s1*i,this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit?(a=this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i,u=this.m_impulse.Copy(),f=this.m_K.Solve(new b2Vec2,-e,-a),this.m_impulse.Add(f),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.y=b2Math.Max(this.m_impulse.y,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.y=b2Math.Min(this.m_impulse.y,0)),e=-e-(this.m_impulse.y-u.y)*this.m_K.col2.x,this.m_impulse.x=this.m_K.col1.x!=0?e/this.m_K.col1.x+u.x:u.x,f.x=this.m_impulse.x-u.x,f.y=this.m_impulse.y-u.y,u=f.x*this.m_perp.x+f.y*this.m_axis.x,e=f.x*this.m_perp.y+f.y*this.m_axis.y,a=f.x*this.m_s1+f.y*this.m_a1,f=f.x*this.m_s2+f.y*this.m_a2):(f=this.m_K.col1.x!=0?-e/this.m_K.col1.x:0,this.m_impulse.x+=f,u=f*this.m_perp.x,e=f*this.m_perp.y,a=f*this.m_s1,f*=this.m_s2),r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*e,i-=this.m_invIA*a,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*e,o+=this.m_invIB*f,t.m_linearVelocity.SetV(r),t.m_angularVelocity=i,n.m_linearVelocity.SetV(s),n.m_angularVelocity=o},b2LineJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.m_sweep.c,r=e.m_sweep.a,i=t.m_sweep.c,s=t.m_sweep.a,o,u,a,f,l,c=0,h=0;a=!1;var p=0,d=b2Mat22.FromAngle(r);f=b2Mat22.FromAngle(s),o=d,h=this.m_localAnchor1.x-this.m_localCenterA.x;var v=this.m_localAnchor1.y-this.m_localCenterA.y;u=o.col1.x*h+o.col2.x*v,v=o.col1.y*h+o.col2.y*v,h=u,o=f,f=this.m_localAnchor2.x-this.m_localCenterB.x,l=this.m_localAnchor2.y-this.m_localCenterB.y,u=o.col1.x*f+o.col2.x*l,l=o.col1.y*f+o.col2.y*l,f=u,o=i.x+f-n.x-h,u=i.y+l-n.y-v;if(this.m_enableLimit){this.m_axis=b2Math.MulMV(d,this.m_localXAxis1),this.m_a1=(o+h)*this.m_axis.y-(u+v)*this.m_axis.x,this.m_a2=f*this.m_axis.y-l*this.m_axis.x;var m=this.m_axis.x*o+this.m_axis.y*u;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(p=b2Math.Clamp(m,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),c=b2Math.Abs(m),a=!0):m<=this.m_lowerTranslation?(p=b2Math.Clamp(m-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),c=this.m_lowerTranslation-m,a=!0):m>=this.m_upperTranslation&&(p=b2Math.Clamp(m-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),c=m-this.m_upperTranslation,a=!0)}return this.m_perp=b2Math.MulMV(d,this.m_localYAxis1),this.m_s1=(o+h)*this.m_perp.y-(u+v)*this.m_perp.x,this.m_s2=f*this.m_perp.y-l*this.m_perp.x,d=new b2Vec2,v=this.m_perp.x*o+this.m_perp.y*u,c=b2Math.Max(c,b2Math.Abs(v)),h=0,a?(a=this.m_invMassA,f=this.m_invMassB,l=this.m_invIA,o=this.m_invIB,this.m_K.col1.x=a+f+l*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2,this.m_K.col1.y=l*this.m_s1*this.m_a1+o*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=a+f+l*this.m_a1*this.m_a1+o*this.m_a2*this.m_a2,this.m_K.Solve(d,-v,-p)):(a=this.m_invMassA,f=this.m_invMassB,l=this.m_invIA,o=this.m_invIB,p=a+f+l*this.m_s1*this.m_s1+o*this.m_s2*this.m_s2,d.x=p!=0?-v/p:0,d.y=0),p=d.x*this.m_perp.x+d.y*this.m_axis.x,a=d.x*this.m_perp.y+d.y*this.m_axis.y,v=d.x*this.m_s1+d.y*this.m_a1,d=d.x*this.m_s2+d.y*this.m_a2,n.x-=this.m_invMassA*p,n.y-=this.m_invMassA*a,r-=this.m_invIA*v,i.x+=this.m_invMassB*p,i.y+=this.m_invMassB*a,s+=this.m_invIB*d,e.m_sweep.a=r,t.m_sweep.a=s,e.SynchronizeTransform(),t.SynchronizeTransform(),c<=b2Settings.b2_linearSlop&&h<=b2Settings.b2_angularSlop},b2LineJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2LineJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2LineJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.y)*this.m_axis.y))},b2LineJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.y},b2LineJoint.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},b2LineJoint.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},b2LineJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2LineJoint.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},b2LineJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2LineJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2LineJoint.prototype.SetLimits=function(e,t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},b2LineJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2LineJoint.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},b2LineJoint.prototype.SetMotorSpeed=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},b2LineJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2LineJoint.prototype.SetMaxMotorForce=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},b2LineJoint.prototype.GetMaxMotorForce=function(){return this.m_maxMotorForce},b2LineJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2LineJoint.prototype.m_localAnchor1=new b2Vec2,b2LineJoint.prototype.m_localAnchor2=new b2Vec2,b2LineJoint.prototype.m_localXAxis1=new b2Vec2,b2LineJoint.prototype.m_localYAxis1=new b2Vec2,b2LineJoint.prototype.m_axis=new b2Vec2,b2LineJoint.prototype.m_perp=new b2Vec2,b2LineJoint.prototype.m_s1=null,b2LineJoint.prototype.m_s2=null,b2LineJoint.prototype.m_a1=null,b2LineJoint.prototype.m_a2=null,b2LineJoint.prototype.m_K=new b2Mat22,b2LineJoint.prototype.m_impulse=new b2Vec2,b2LineJoint.prototype.m_motorMass=null,b2LineJoint.prototype.m_motorImpulse=null,b2LineJoint.prototype.m_lowerTranslation=null,b2LineJoint.prototype.m_upperTranslation=null,b2LineJoint.prototype.m_maxMotorForce=null,b2LineJoint.prototype.m_motorSpeed=null,b2LineJoint.prototype.m_enableLimit=null,b2LineJoint.prototype.m_enableMotor=null,b2LineJoint.prototype.m_limitState=0;var b2ContactSolver=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactSolver.prototype.__constructor=function(){},b2ContactSolver.prototype.__varz=function(){this.m_step=new b2TimeStep,this.m_constraints=[]},b2ContactSolver.s_worldManifold=new b2WorldManifold,b2ContactSolver.s_psm=new b2PositionSolverManifold,b2ContactSolver.prototype.Initialize=function(e,t,n,r){var i;this.m_step.Set(e),this.m_allocator=r,e=0;for(this.m_constraintCount=n;this.m_constraints.length<this.m_constraintCount;)this.m_constraints[this.m_constraints.length]=new b2ContactConstraint;for(e=0;e<n;++e){i=t[e],r=i.m_fixtureA;var s=i.m_fixtureB,o=r.m_shape.m_radius,u=s.m_shape.m_radius,a=r.m_body,f=s.m_body,l=i.GetManifold(),c=b2Settings.b2MixFriction(r.GetFriction(),s.GetFriction()),h=b2Settings.b2MixRestitution(r.GetRestitution(),s.GetRestitution()),p=a.m_linearVelocity.x,d=a.m_linearVelocity.y,v=f.m_linearVelocity.x,m=f.m_linearVelocity.y,g=a.m_angularVelocity,y=f.m_angularVelocity;b2Settings.b2Assert(l.m_pointCount>0),b2ContactSolver.s_worldManifold.Initialize(l,a.m_xf,o,f.m_xf,u),s=b2ContactSolver.s_worldManifold.m_normal.x,i=b2ContactSolver.s_worldManifold.m_normal.y,r=this.m_constraints[e],r.bodyA=a,r.bodyB=f,r.manifold=l,r.normal.x=s,r.normal.y=i,r.pointCount=l.m_pointCount,r.friction=c,r.restitution=h,r.localPlaneNormal.x=l.m_localPlaneNormal.x,r.localPlaneNormal.y=l.m_localPlaneNormal.y,r.localPoint.x=l.m_localPoint.x,r.localPoint.y=l.m_localPoint.y,r.radius=o+u,r.type=l.m_type;for(o=0;o<r.pointCount;++o){c=l.m_points[o],u=r.points[o],u.normalImpulse=c.m_normalImpulse,u.tangentImpulse=c.m_tangentImpulse,u.localPoint.SetV(c.m_localPoint),c=u.rA.x=b2ContactSolver.s_worldManifold.m_points[o].x-a.m_sweep.c.x,h=u.rA.y=b2ContactSolver.s_worldManifold.m_points[o].y-a.m_sweep.c.y;var b=u.rB.x=b2ContactSolver.s_worldManifold.m_points[o].x-f.m_sweep.c.x,w=u.rB.y=b2ContactSolver.s_worldManifold.m_points[o].y-f.m_sweep.c.y,E=c*i-h*s,S=b*i-w*s;E*=E,S*=S,u.normalMass=1/(a.m_invMass+f.m_invMass+a.m_invI*E+f.m_invI*S);var x=a.m_mass*a.m_invMass+f.m_mass*f.m_invMass;x+=a.m_mass*a.m_invI*E+f.m_mass*f.m_invI*S,u.equalizedMass=1/x,S=i,x=-s,E=c*x-h*S,S=b*x-w*S,E*=E,S*=S,u.tangentMass=1/(a.m_invMass+f.m_invMass+a.m_invI*E+f.m_invI*S),u.velocityBias=0,c=r.normal.x*(v+ -y*w-p- -g*h)+r.normal.y*(m+y*b-d-g*c),c<-b2Settings.b2_velocityThreshold&&(u.velocityBias+=-r.restitution*c)}r.pointCount==2&&(m=r.points[0],v=r.points[1],l=a.m_invMass,a=a.m_invI,p=f.m_invMass,f=f.m_invI,d=m.rA.x*i-m.rA.y*s,m=m.rB.x*i-m.rB.y*s,g=v.rA.x*i-v.rA.y*s,v=v.rB.x*i-v.rB.y*s,s=l+p+a*d*d+f*m*m,i=l+p+a*g*g+f*v*v,f=l+p+a*d*g+f*m*v,s*s<100*(s*i-f*f)?(r.K.col1.Set(s,f),r.K.col2.Set(f,i),r.K.GetInverse(r.normalMass)):r.pointCount=1)}},b2ContactSolver.prototype.InitVelocityConstraints=function(e){for(var t=0;t<this.m_constraintCount;++t){var n=this.m_constraints[t],r=n.bodyA,i=n.bodyB,s=r.m_invMass,o=r.m_invI,u=i.m_invMass,a=i.m_invI,f=n.normal.x,l=n.normal.y,c=l,h=-f,p=0,d=0;if(e.warmStarting){d=n.pointCount;for(p=0;p<d;++p){var v=n.points[p];v.normalImpulse*=e.dtRatio,v.tangentImpulse*=e.dtRatio;var m=v.normalImpulse*f+v.tangentImpulse*c,g=v.normalImpulse*l+v.tangentImpulse*h;r.m_angularVelocity-=o*(v.rA.x*g-v.rA.y*m),r.m_linearVelocity.x-=s*m,r.m_linearVelocity.y-=s*g,i.m_angularVelocity+=a*(v.rB.x*g-v.rB.y*m),i.m_linearVelocity.x+=u*m,i.m_linearVelocity.y+=u*g}}else{d=n.pointCount;for(p=0;p<d;++p)r=n.points[p],r.normalImpulse=0,r.tangentImpulse=0}}},b2ContactSolver.prototype.SolveVelocityConstraints=function(){for(var e=0,t,n,r,i,s,o,u,a,f,l=0;l<this.m_constraintCount;++l){i=this.m_constraints[l];var c=i.bodyA,h=i.bodyB,p=c.m_angularVelocity,d=h.m_angularVelocity,v=c.m_linearVelocity,m=h.m_linearVelocity,g=c.m_invMass,y=c.m_invI,b=h.m_invMass,w=h.m_invI;u=i.normal.x;var E=a=i.normal.y;f=-u,o=i.friction;for(e=0;e<i.pointCount;e++)t=i.points[e],n=m.x-d*t.rB.y-v.x+p*t.rA.y,r=m.y+d*t.rB.x-v.y-p*t.rA.x,n=n*E+r*f,n=t.tangentMass*-n,r=o*t.normalImpulse,r=b2Math.Clamp(t.tangentImpulse+n,-r,r),n=r-t.tangentImpulse,s=n*E,n*=f,v.x-=g*s,v.y-=g*n,p-=y*(t.rA.x*n-t.rA.y*s),m.x+=b*s,m.y+=b*n,d+=w*(t.rB.x*n-t.rB.y*s),t.tangentImpulse=r;if(i.pointCount==1)t=i.points[0],n=m.x+ -d*t.rB.y-v.x- -p*t.rA.y,r=m.y+d*t.rB.x-v.y-p*t.rA.x,i=n*u+r*a,n=-t.normalMass*(i-t.velocityBias),r=t.normalImpulse+n,r=r>0?r:0,n=r-t.normalImpulse,s=n*u,n*=a,v.x-=g*s,v.y-=g*n,p-=y*(t.rA.x*n-t.rA.y*s),m.x+=b*s,m.y+=b*n,d+=w*(t.rB.x*n-t.rB.y*s),t.normalImpulse=r;else{t=i.points[0],e=i.points[1],n=t.normalImpulse,o=e.normalImpulse;var S=(m.x-d*t.rB.y-v.x+p*t.rA.y)*u+(m.y+d*t.rB.x-v.y-p*t.rA.x)*a,x=(m.x-d*e.rB.y-v.x+p*e.rA.y)*u+(m.y+d*e.rB.x-v.y-p*e.rA.x)*a;r=S-t.velocityBias,s=x-e.velocityBias,f=i.K,r-=f.col1.x*n+f.col2.x*o;for(s-=f.col1.y*n+f.col2.y*o;;){f=i.normalMass,E=-(f.col1.x*r+f.col2.x*s),f=-(f.col1.y*r+f.col2.y*s);if(E>=0&&f>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}E=-t.normalMass*r,f=0,x=i.K.col1.y*E+s;if(E>=0&&x>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}E=0,f=-e.normalMass*s,S=i.K.col2.x*f+r;if(f>=0&&S>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}f=E=0,S=r,x=s;if(S>=0&&x>=0){n=E-n,o=f-o,i=n*u,n*=a,u=o*u,a=o*a,v.x-=g*(i+u),v.y-=g*(n+a),p-=y*(t.rA.x*n-t.rA.y*i+e.rA.x*a-e.rA.y*u),m.x+=b*(i+u),m.y+=b*(n+a),d+=w*(t.rB.x*n-t.rB.y*i+e.rB.x*a-e.rB.y*u),t.normalImpulse=E,e.normalImpulse=f;break}break}}c.m_angularVelocity=p,h.m_angularVelocity=d}},b2ContactSolver.prototype.FinalizeVelocityConstraints=function(){for(var e=0;e<this.m_constraintCount;++e)for(var t=this.m_constraints[e],n=t.manifold,r=0;r<t.pointCount;++r){var i=n.m_points[r],s=t.points[r];i.m_normalImpulse=s.normalImpulse,i.m_tangentImpulse=s.tangentImpulse}},b2ContactSolver.prototype.SolvePositionConstraints=function(e){for(var t=0,n=0;n<this.m_constraintCount;n++){var r=this.m_constraints[n],i=r.bodyA,s=r.bodyB,o=i.m_mass*i.m_invMass,u=i.m_mass*i.m_invI,a=s.m_mass*s.m_invMass,f=s.m_mass*s.m_invI;b2ContactSolver.s_psm.Initialize(r);for(var l=b2ContactSolver.s_psm.m_normal,c=0;c<r.pointCount;c++){var h=r.points[c],p=b2ContactSolver.s_psm.m_points[c],d=b2ContactSolver.s_psm.m_separations[c],v=p.x-i.m_sweep.c.x,m=p.y-i.m_sweep.c.y,g=p.x-s.m_sweep.c.x;p=p.y-s.m_sweep.c.y,t=t<d?t:d,d=b2Math.Clamp(e*(d+b2Settings.b2_linearSlop),-b2Settings.b2_maxLinearCorrection,0),d=-h.equalizedMass*d,h=d*l.x,d*=l.y,i.m_sweep.c.x-=o*h,i.m_sweep.c.y-=o*d,i.m_sweep.a-=u*(v*d-m*h),i.SynchronizeTransform(),s.m_sweep.c.x+=a*h,s.m_sweep.c.y+=a*d,s.m_sweep.a+=f*(g*d-p*h),s.SynchronizeTransform()}}return t>-1.5*b2Settings.b2_linearSlop},b2ContactSolver.prototype.m_step=new b2TimeStep,b2ContactSolver.prototype.m_allocator=null,b2ContactSolver.prototype.m_constraints=[],b2ContactSolver.prototype.m_constraintCount=0;var b2Simplex=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Simplex.prototype.__constructor=function(){this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3},b2Simplex.prototype.__varz=function(){this.m_v1=new b2SimplexVertex,this.m_v2=new b2SimplexVertex,this.m_v3=new b2SimplexVertex,this.m_vertices=Array(3)},b2Simplex.prototype.ReadCache=function(e,t,n,r,i){b2Settings.b2Assert(0<=e.count&&e.count<=3);var s,o;this.m_count=e.count;for(var u=this.m_vertices,a=0;a<this.m_count;a++){var f=u[a];f.indexA=e.indexA[a],f.indexB=e.indexB[a],s=t.GetVertex(f.indexA),o=r.GetVertex(f.indexB),f.wA=b2Math.MulX(n,s),f.wB=b2Math.MulX(i,o),f.w=b2Math.SubtractVV(f.wB,f.wA),f.a=0}if(this.m_count>1){e=e.metric,s=this.GetMetric();if(s<.5*e||2*e<s||s<Number.MIN_VALUE)this.m_count=0}this.m_count==0&&(f=u[0],f.indexA=0,f.indexB=0,s=t.GetVertex(0),o=r.GetVertex(0),f.wA=b2Math.MulX(n,s),f.wB=b2Math.MulX(i,o),f.w=b2Math.SubtractVV(f.wB,f.wA),this.m_count=1)},b2Simplex.prototype.WriteCache=function(e){e.metric=this.GetMetric(),e.count=parseInt(this.m_count);for(var t=this.m_vertices,n=0;n<this.m_count;n++)e.indexA[n]=parseInt(t[n].indexA),e.indexB[n]=parseInt(t[n].indexB)},b2Simplex.prototype.GetSearchDirection=function(){switch(this.m_count){case 1:return this.m_v1.w.GetNegative();case 2:var e=b2Math.SubtractVV(this.m_v2.w,this.m_v1.w);return b2Math.CrossVV(e,this.m_v1.w.GetNegative())>0?b2Math.CrossFV(1,e):b2Math.CrossVF(e,1);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetClosestPoint=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),new b2Vec2;case 1:return this.m_v1.w;case 2:return new b2Vec2(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);default:return b2Settings.b2Assert(!1),new b2Vec2}},b2Simplex.prototype.GetWitnessPoints=function(e,t){switch(this.m_count){case 0:b2Settings.b2Assert(!1);break;case 1:e.SetV(this.m_v1.wA),t.SetV(this.m_v1.wB);break;case 2:e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,t.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,t.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:t.x=e.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,t.y=e.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y;break;default:b2Settings.b2Assert(!1)}},b2Simplex.prototype.GetMetric=function(){switch(this.m_count){case 0:return b2Settings.b2Assert(!1),0;case 1:return 0;case 2:return b2Math.SubtractVV(this.m_v1.w,this.m_v2.w).Length();case 3:return b2Math.CrossVV(b2Math.SubtractVV(this.m_v2.w,this.m_v1.w),b2Math.SubtractVV(this.m_v3.w,this.m_v1.w));default:return b2Settings.b2Assert(!1),0}},b2Simplex.prototype.Solve2=function(){var e=this.m_v1.w,t=this.m_v2.w,n=b2Math.SubtractVV(t,e);e=-(e.x*n.x+e.y*n.y),e<=0?this.m_count=this.m_v1.a=1:(t=t.x*n.x+t.y*n.y,t<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):(n=1/(t+e),this.m_v1.a=t*n,this.m_v2.a=e*n,this.m_count=2))},b2Simplex.prototype.Solve3=function(){var e=this.m_v1.w,t=this.m_v2.w,n=this.m_v3.w,r=b2Math.SubtractVV(t,e),i=b2Math.Dot(e,r),s=b2Math.Dot(t,r);i=-i;var o=b2Math.SubtractVV(n,e),u=b2Math.Dot(e,o),a=b2Math.Dot(n,o);u=-u;var f=b2Math.SubtractVV(n,t),l=b2Math.Dot(t,f);f=b2Math.Dot(n,f),l=-l,o=b2Math.CrossVV(r,o),r=o*b2Math.CrossVV(t,n),n=o*b2Math.CrossVV(n,e),e=o*b2Math.CrossVV(e,t),i<=0&&u<=0?this.m_count=this.m_v1.a=1:s>0&&i>0&&e<=0?(a=1/(s+i),this.m_v1.a=s*a,this.m_v2.a=i*a,this.m_count=2):a>0&&u>0&&n<=0?(s=1/(a+u),this.m_v1.a=a*s,this.m_v3.a=u*s,this.m_count=2,this.m_v2.Set(this.m_v3)):s<=0&&l<=0?(this.m_count=this.m_v2.a=1,this.m_v1.Set(this.m_v2)):a<=0&&f<=0?(this.m_count=this.m_v3.a=1,this.m_v1.Set(this.m_v3)):f>0&&l>0&&r<=0?(s=1/(f+l),this.m_v2.a=f*s,this.m_v3.a=l*s,this.m_count=2,this.m_v1.Set(this.m_v3)):(s=1/(r+n+e),this.m_v1.a=r*s,this.m_v2.a=n*s,this.m_v3.a=e*s,this.m_count=3)},b2Simplex.prototype.m_v1=new b2SimplexVertex,b2Simplex.prototype.m_v2=new b2SimplexVertex,b2Simplex.prototype.m_v3=new b2SimplexVertex,b2Simplex.prototype.m_vertices=Array(3),b2Simplex.prototype.m_count=0;var b2WeldJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2WeldJoint.prototype,b2Joint.prototype),b2WeldJoint.prototype._super=b2Joint.prototype,b2WeldJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_mass=new b2Mat33},b2WeldJoint.prototype.__varz=function(){this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2WeldJoint.prototype.InitVelocityConstraints=function(e){var t,n,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=r.m_invMass,n=i.m_invMass;var f=r.m_invI,l=i.m_invI;this.m_mass.col1.x=t+n+o*o*f+a*a*l,this.m_mass.col2.x=-o*s*f-a*u*l,this.m_mass.col3.x=-o*f-a*l,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=t+n+s*s*f+u*u*l,this.m_mass.col3.y=s*f+u*l,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=f+l,e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_impulse.z*=e.dtRatio,r.m_linearVelocity.x-=t*this.m_impulse.x,r.m_linearVelocity.y-=t*this.m_impulse.y,r.m_angularVelocity-=f*(s*this.m_impulse.y-o*this.m_impulse.x+this.m_impulse.z),i.m_linearVelocity.x+=n*this.m_impulse.x,i.m_linearVelocity.y+=n*this.m_impulse.y,i.m_angularVelocity+=l*(u*this.m_impulse.y-a*this.m_impulse.x+this.m_impulse.z)):this.m_impulse.SetZero()},b2WeldJoint.prototype.SolveVelocityConstraints=function(){var e,t,n=this.m_bodyA,r=this.m_bodyB,i=n.m_linearVelocity,s=n.m_angularVelocity,o=r.m_linearVelocity,u=r.m_angularVelocity,a=n.m_invMass,f=r.m_invMass,l=n.m_invI,c=r.m_invI;e=n.m_xf.R;var h=this.m_localAnchorA.x-n.m_sweep.localCenter.x,p=this.m_localAnchorA.y-n.m_sweep.localCenter.y;t=e.col1.x*h+e.col2.x*p,p=e.col1.y*h+e.col2.y*p,h=t,e=r.m_xf.R;var d=this.m_localAnchorB.x-r.m_sweep.localCenter.x,v=this.m_localAnchorB.y-r.m_sweep.localCenter.y;t=e.col1.x*d+e.col2.x*v,v=e.col1.y*d+e.col2.y*v,d=t,e=o.x-u*v-i.x+s*p,t=o.y+u*d-i.y-s*h;var m=u-s,g=new b2Vec3;this.m_mass.Solve33(g,-e,-t,-m),this.m_impulse.Add(g),i.x-=a*g.x,i.y-=a*g.y,s-=l*(h*g.y-p*g.x+g.z),o.x+=f*g.x,o.y+=f*g.y,u+=c*(d*g.y-v*g.x+g.z),n.m_angularVelocity=s,r.m_angularVelocity=u},b2WeldJoint.prototype.SolvePositionConstraints=function(){var e,t,n=this.m_bodyA,r=this.m_bodyB;e=n.m_xf.R;var i=this.m_localAnchorA.x-n.m_sweep.localCenter.x,s=this.m_localAnchorA.y-n.m_sweep.localCenter.y;t=e.col1.x*i+e.col2.x*s,s=e.col1.y*i+e.col2.y*s,i=t,e=r.m_xf.R;var o=this.m_localAnchorB.x-r.m_sweep.localCenter.x,u=this.m_localAnchorB.y-r.m_sweep.localCenter.y;t=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=t,e=n.m_invMass,t=r.m_invMass;var a=n.m_invI,f=r.m_invI,l=r.m_sweep.c.x+o-n.m_sweep.c.x-i,c=r.m_sweep.c.y+u-n.m_sweep.c.y-s,h=r.m_sweep.a-n.m_sweep.a-this.m_referenceAngle,p=10*b2Settings.b2_linearSlop,d=Math.sqrt(l*l+c*c),v=b2Math.Abs(h);return d>p&&(a*=1,f*=1),this.m_mass.col1.x=e+t+s*s*a+u*u*f,this.m_mass.col2.x=-s*i*a-u*o*f,this.m_mass.col3.x=-s*a-u*f,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=e+t+i*i*a+o*o*f,this.m_mass.col3.y=i*a+o*f,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=a+f,p=new b2Vec3,this.m_mass.Solve33(p,-l,-c,-h),n.m_sweep.c.x-=e*p.x,n.m_sweep.c.y-=e*p.y,n.m_sweep.a-=a*(i*p.y-s*p.x+p.z),r.m_sweep.c.x+=t*p.x,r.m_sweep.c.y+=t*p.y,r.m_sweep.a+=f*(o*p.y-u*p.x+p.z),n.SynchronizeTransform(),r.SynchronizeTransform(),d<=b2Settings.b2_linearSlop&&v<=b2Settings.b2_angularSlop},b2WeldJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2WeldJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2WeldJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse.x,e*this.m_impulse.y)},b2WeldJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.z},b2WeldJoint.prototype.m_localAnchorA=new b2Vec2,b2WeldJoint.prototype.m_localAnchorB=new b2Vec2,b2WeldJoint.prototype.m_referenceAngle=null,b2WeldJoint.prototype.m_impulse=new b2Vec3,b2WeldJoint.prototype.m_mass=new b2Mat33;var b2Math=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Math.prototype.__constructor=function(){},b2Math.prototype.__varz=function(){},b2Math.IsValid=function(e){return isFinite(e)},b2Math.Dot=function(e,t){return e.x*t.x+e.y*t.y},b2Math.CrossVV=function(e,t){return e.x*t.y-e.y*t.x},b2Math.CrossVF=function(e,t){return new b2Vec2(t*e.y,-t*e.x)},b2Math.CrossFV=function(e,t){return new b2Vec2(-e*t.y,e*t.x)},b2Math.MulMV=function(e,t){return new b2Vec2(e.col1.x*t.x+e.col2.x*t.y,e.col1.y*t.x+e.col2.y*t.y)},b2Math.MulTMV=function(e,t){return new b2Vec2(b2Math.Dot(t,e.col1),b2Math.Dot(t,e.col2))},b2Math.MulX=function(e,t){var n=b2Math.MulMV(e.R,t);return n.x+=e.position.x,n.y+=e.position.y,n},b2Math.MulXT=function(e,t){var n=b2Math.SubtractVV(t,e.position),r=n.x*e.R.col1.x+n.y*e.R.col1.y;return n.y=n.x*e.R.col2.x+n.y*e.R.col2.y,n.x=r,n},b2Math.AddVV=function(e,t){return new b2Vec2(e.x+t.x,e.y+t.y)},b2Math.SubtractVV=function(e,t){return new b2Vec2(e.x-t.x,e.y-t.y)},b2Math.Distance=function(e,t){var n=e.x-t.x,r=e.y-t.y;return Math.sqrt(n*n+r*r)},b2Math.DistanceSquared=function(e,t){var n=e.x-t.x,r=e.y-t.y;return n*n+r*r},b2Math.MulFV=function(e,t){return new b2Vec2(e*t.x,e*t.y)},b2Math.AddMM=function(e,t){return b2Mat22.FromVV(b2Math.AddVV(e.col1,t.col1),b2Math.AddVV(e.col2,t.col2))},b2Math.MulMM=function(e,t){return b2Mat22.FromVV(b2Math.MulMV(e,t.col1),b2Math.MulMV(e,t.col2))},b2Math.MulTMM=function(e,t){var n=new b2Vec2(b2Math.Dot(e.col1,t.col1),b2Math.Dot(e.col2,t.col1)),r=new b2Vec2(b2Math.Dot(e.col1,t.col2),b2Math.Dot(e.col2,t.col2));return b2Mat22.FromVV(n,r)},b2Math.Abs=function(e){return e>0?e:-e},b2Math.AbsV=function(e){return new b2Vec2(b2Math.Abs(e.x),b2Math.Abs(e.y))},b2Math.AbsM=function(e){return b2Mat22.FromVV(b2Math.AbsV(e.col1),b2Math.AbsV(e.col2))},b2Math.Min=function(e,t){return e<t?e:t},b2Math.MinV=function(e,t){return new b2Vec2(b2Math.Min(e.x,t.x),b2Math.Min(e.y,t.y))},b2Math.Max=function(e,t){return e>t?e:t},b2Math.MaxV=function(e,t){return new b2Vec2(b2Math.Max(e.x,t.x),b2Math.Max(e.y,t.y))},b2Math.Clamp=function(e,t,n){return e<t?t:e>n?n:e},b2Math.ClampV=function(e,t,n){return b2Math.MaxV(t,b2Math.MinV(e,n))},b2Math.Swap=function(e,t){var n=e[0];e[0]=t[0],t[0]=n},b2Math.Random=function(){return Math.random()*2-1},b2Math.RandomRange=function(e,t){var n=Math.random();return n=(t-e)*n+e},b2Math.NextPowerOfTwo=function(e){return e|=e>>1&2147483647,e|=e>>2&1073741823,e|=e>>4&268435455,e|=e>>8&16777215,e|=e>>16&65535,e+1},b2Math.IsPowerOfTwo=function(e){return e>0&&(e&e-1)==0},b2Math.b2Vec2_zero=new b2Vec2(0,0),b2Math.b2Mat22_identity=b2Mat22.FromVV(new b2Vec2(1,0),new b2Vec2(0,1)),b2Math.b2Transform_identity=new b2Transform(b2Math.b2Vec2_zero,b2Math.b2Mat22_identity);var b2PulleyJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PulleyJoint.prototype,b2Joint.prototype),b2PulleyJoint.prototype._super=b2Joint.prototype,b2PulleyJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_ground=this.m_bodyA.m_world.m_groundBody,this.m_groundAnchor1.x=e.groundAnchorA.x-this.m_ground.m_xf.position.x,this.m_groundAnchor1.y=e.groundAnchorA.y-this.m_ground.m_xf.position.y,this.m_groundAnchor2.x=e.groundAnchorB.x-this.m_ground.m_xf.position.x,this.m_groundAnchor2.y=e.groundAnchorB.y-this.m_ground.m_xf.position.y,this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_ratio=e.ratio,this.m_constant=e.lengthA+this.m_ratio*e.lengthB,this.m_maxLength1=b2Math.Min(e.maxLengthA,this.m_constant-this.m_ratio*b2PulleyJoint.b2_minPulleyLength),this.m_maxLength2=b2Math.Min(e.maxLengthB,(this.m_constant-b2PulleyJoint.b2_minPulleyLength)/this.m_ratio),this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},b2PulleyJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u1=new b2Vec2,this.m_u2=new b2Vec2},b2PulleyJoint.b2_minPulleyLength=2,b2PulleyJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r;r=t.m_xf.R;var i=this.m_localAnchor1.x-t.m_sweep.localCenter.x,s=this.m_localAnchor1.y-t.m_sweep.localCenter.y,o=r.col1.x*i+r.col2.x*s;s=r.col1.y*i+r.col2.y*s,i=o,r=n.m_xf.R;var u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y;o=r.col1.x*u+r.col2.x*a,a=r.col1.y*u+r.col2.y*a,u=o,r=n.m_sweep.c.x+u,o=n.m_sweep.c.y+a;var f=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,l=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y;this.m_u1.Set(t.m_sweep.c.x+i-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x),t.m_sweep.c.y+s-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y)),this.m_u2.Set(r-f,o-l),r=this.m_u1.Length(),o=this.m_u2.Length(),r>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/r):this.m_u1.SetZero(),o>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/o):this.m_u2.SetZero(),this.m_constant-r-this.m_ratio*o>0?(this.m_state=b2Joint.e_inactiveLimit,this.m_impulse=0):this.m_state=b2Joint.e_atUpperLimit,r<this.m_maxLength1?(this.m_limitState1=b2Joint.e_inactiveLimit,this.m_limitImpulse1=0):this.m_limitState1=b2Joint.e_atUpperLimit,o<this.m_maxLength2?(this.m_limitState2=b2Joint.e_inactiveLimit,this.m_limitImpulse2=0):this.m_limitState2=b2Joint.e_atUpperLimit,r=i*this.m_u1.y-s*this.m_u1.x,o=u*this.m_u2.y-a*this.m_u2.x,this.m_limitMass1=t.m_invMass+t.m_invI*r*r,this.m_limitMass2=n.m_invMass+n.m_invI*o*o,this.m_pulleyMass=this.m_limitMass1+this.m_ratio*this.m_ratio*this.m_limitMass2,this.m_limitMass1=1/this.m_limitMass1,this.m_limitMass2=1/this.m_limitMass2,this.m_pulleyMass=1/this.m_pulleyMass,e.warmStarting?(this.m_impulse*=e.dtRatio,this.m_limitImpulse1*=e.dtRatio,this.m_limitImpulse2*=e.dtRatio,e=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.x,r=(-this.m_impulse-this.m_limitImpulse1)*this.m_u1.y,o=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.x,f=(-this.m_ratio*this.m_impulse-this.m_limitImpulse2)*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*e,t.m_linearVelocity.y+=t.m_invMass*r,t.m_angularVelocity+=t.m_invI*(i*r-s*e),n.m_linearVelocity.x+=n.m_invMass*o,n.m_linearVelocity.y+=n.m_invMass*f,n.m_angularVelocity+=n.m_invI*(u*f-a*o)):this.m_limitImpulse2=this.m_limitImpulse1=this.m_impulse=0},b2PulleyJoint.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s;var a,f;this.m_state==b2Joint.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*i,s=e.m_linearVelocity.y+e.m_angularVelocity*r,a=t.m_linearVelocity.x+ -t.m_angularVelocity*u,f=t.m_linearVelocity.y+t.m_angularVelocity*o,n=-(this.m_u1.x*n+this.m_u1.y*s)-this.m_ratio*(this.m_u2.x*a+this.m_u2.y*f),f=this.m_pulleyMass*-n,n=this.m_impulse,this.m_impulse=b2Math.Max(0,this.m_impulse+f),f=this.m_impulse-n,n=-f*this.m_u1.x,s=-f*this.m_u1.y,a=-this.m_ratio*f*this.m_u2.x,f=-this.m_ratio*f*this.m_u2.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(r*s-i*n),t.m_linearVelocity.x+=t.m_invMass*a,t.m_linearVelocity.y+=t.m_invMass*f,t.m_angularVelocity+=t.m_invI*(o*f-u*a)),this.m_limitState1==b2Joint.e_atUpperLimit&&(n=e.m_linearVelocity.x+ -e.m_angularVelocity*i,s=e.m_linearVelocity.y+e.m_angularVelocity*r,n=-(this.m_u1.x*n+this.m_u1.y*s),f=-this.m_limitMass1*n,n=this.m_limitImpulse1,this.m_limitImpulse1=b2Math.Max(0,this.m_limitImpulse1+f),f=this.m_limitImpulse1-n,n=-f*this.m_u1.x,s=-f*this.m_u1.y,e.m_linearVelocity.x+=e.m_invMass*n,e.m_linearVelocity.y+=e.m_invMass*s,e.m_angularVelocity+=e.m_invI*(r*s-i*n)),this.m_limitState2==b2Joint.e_atUpperLimit&&(a=t.m_linearVelocity.x+ -t.m_angularVelocity*u,f=t.m_linearVelocity.y+t.m_angularVelocity*o,n=-(this.m_u2.x*a+this.m_u2.y*f),f=-this.m_limitMass2*n,n=this.m_limitImpulse2,this.m_limitImpulse2=b2Math.Max(0,this.m_limitImpulse2+f),f=this.m_limitImpulse2-n,a=-f*this.m_u2.x,f=-f*this.m_u2.y,t.m_linearVelocity.x+=t.m_invMass*a,t.m_linearVelocity.y+=t.m_invMass*f,t.m_angularVelocity+=t.m_invI*(o*f-u*a))},b2PulleyJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n,r=this.m_ground.m_xf.position.x+this.m_groundAnchor1.x,i=this.m_ground.m_xf.position.y+this.m_groundAnchor1.y,s=this.m_ground.m_xf.position.x+this.m_groundAnchor2.x,o=this.m_ground.m_xf.position.y+this.m_groundAnchor2.y,u,a,f,l,c,h,p,d=0;return this.m_state==b2Joint.e_atUpperLimit&&(n=e.m_xf.R,u=this.m_localAnchor1.x-e.m_sweep.localCenter.x,a=this.m_localAnchor1.y-e.m_sweep.localCenter.y,c=n.col1.x*u+n.col2.x*a,a=n.col1.y*u+n.col2.y*a,u=c,n=t.m_xf.R,f=this.m_localAnchor2.x-t.m_sweep.localCenter.x,l=this.m_localAnchor2.y-t.m_sweep.localCenter.y,c=n.col1.x*f+n.col2.x*l,l=n.col1.y*f+n.col2.y*l,f=c,n=e.m_sweep.c.x+u,c=e.m_sweep.c.y+a,h=t.m_sweep.c.x+f,p=t.m_sweep.c.y+l,this.m_u1.Set(n-r,c-i),this.m_u2.Set(h-s,p-o),n=this.m_u1.Length(),c=this.m_u2.Length(),n>b2Settings.b2_linearSlop?this.m_u1.Multiply(1/n):this.m_u1.SetZero(),c>b2Settings.b2_linearSlop?this.m_u2.Multiply(1/c):this.m_u2.SetZero(),n=this.m_constant-n-this.m_ratio*c,d=b2Math.Max(d,-n),n=b2Math.Clamp(n+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),p=-this.m_pulleyMass*n,n=-p*this.m_u1.x,c=-p*this.m_u1.y,h=-this.m_ratio*p*this.m_u2.x,p=-this.m_ratio*p*this.m_u2.y,e.m_sweep.c.x+=e.m_invMass*n,e.m_sweep.c.y+=e.m_invMass*c,e.m_sweep.a+=e.m_invI*(u*c-a*n),t.m_sweep.c.x+=t.m_invMass*h,t.m_sweep.c.y+=t.m_invMass*p,t.m_sweep.a+=t.m_invI*(f*p-l*h),e.SynchronizeTransform(),t.SynchronizeTransform()),this.m_limitState1==b2Joint.e_atUpperLimit&&(n=e.m_xf.R,u=this.m_localAnchor1.x-e.m_sweep.localCenter.x,a=this.m_localAnchor1.y-e.m_sweep.localCenter.y,c=n.col1.x*u+n.col2.x*a,a=n.col1.y*u+n.col2.y*a,u=c,n=e.m_sweep.c.x+u,c=e.m_sweep.c.y+a,this.m_u1.Set(n-r,c-i),n=this.m_u1.Length(),n>b2Settings.b2_linearSlop?(this.m_u1.x*=1/n,this.m_u1.y*=1/n):this.m_u1.SetZero(),n=this.m_maxLength1-n,d=b2Math.Max(d,-n),n=b2Math.Clamp(n+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),p=-this.m_limitMass1*n,n=-p*this.m_u1.x,c=-p*this.m_u1.y,e.m_sweep.c.x+=e.m_invMass*n,e.m_sweep.c.y+=e.m_invMass*c,e.m_sweep.a+=e.m_invI*(u*c-a*n),e.SynchronizeTransform()),this.m_limitState2==b2Joint.e_atUpperLimit&&(n=t.m_xf.R,f=this.m_localAnchor2.x-t.m_sweep.localCenter.x,l=this.m_localAnchor2.y-t.m_sweep.localCenter.y,c=n.col1.x*f+n.col2.x*l,l=n.col1.y*f+n.col2.y*l,f=c,h=t.m_sweep.c.x+f,p=t.m_sweep.c.y+l,this.m_u2.Set(h-s,p-o),c=this.m_u2.Length(),c>b2Settings.b2_linearSlop?(this.m_u2.x*=1/c,this.m_u2.y*=1/c):this.m_u2.SetZero(),n=this.m_maxLength2-c,d=b2Math.Max(d,-n),n=b2Math.Clamp(n+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),p=-this.m_limitMass2*n,h=-p*this.m_u2.x,p=-p*this.m_u2.y,t.m_sweep.c.x+=t.m_invMass*h,t.m_sweep.c.y+=t.m_invMass*p,t.m_sweep.a+=t.m_invI*(f*p-l*h),t.SynchronizeTransform()),d<b2Settings.b2_linearSlop},b2PulleyJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PulleyJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PulleyJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse*this.m_u2.x,e*this.m_impulse*this.m_u2.y)},b2PulleyJoint.prototype.GetReactionTorque=function(){return 0},b2PulleyJoint.prototype.GetGroundAnchorA=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor1),e},b2PulleyJoint.prototype.GetGroundAnchorB=function(){var e=this.m_ground.m_xf.position.Copy();return e.Add(this.m_groundAnchor2),e},b2PulleyJoint.prototype.GetLength1=function(){var e=this.m_bodyA.GetWorldPoint(this.m_localAnchor1),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor1.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor1.y),Math.sqrt(t*t+e*e)},b2PulleyJoint.prototype.GetLength2=function(){var e=this.m_bodyB.GetWorldPoint(this.m_localAnchor2),t=e.x-(this.m_ground.m_xf.position.x+this.m_groundAnchor2.x);return e=e.y-(this.m_ground.m_xf.position.y+this.m_groundAnchor2.y),Math.sqrt(t*t+e*e)},b2PulleyJoint.prototype.GetRatio=function(){return this.m_ratio},b2PulleyJoint.prototype.m_ground=null,b2PulleyJoint.prototype.m_groundAnchor1=new b2Vec2,b2PulleyJoint.prototype.m_groundAnchor2=new b2Vec2,b2PulleyJoint.prototype.m_localAnchor1=new b2Vec2,b2PulleyJoint.prototype.m_localAnchor2=new b2Vec2,b2PulleyJoint.prototype.m_u1=new b2Vec2,b2PulleyJoint.prototype.m_u2=new b2Vec2,b2PulleyJoint.prototype.m_constant=null,b2PulleyJoint.prototype.m_ratio=null,b2PulleyJoint.prototype.m_maxLength1=null,b2PulleyJoint.prototype.m_maxLength2=null,b2PulleyJoint.prototype.m_pulleyMass=null,b2PulleyJoint.prototype.m_limitMass1=null,b2PulleyJoint.prototype.m_limitMass2=null,b2PulleyJoint.prototype.m_impulse=null,b2PulleyJoint.prototype.m_limitImpulse1=null,b2PulleyJoint.prototype.m_limitImpulse2=null,b2PulleyJoint.prototype.m_state=0,b2PulleyJoint.prototype.m_limitState1=0,b2PulleyJoint.prototype.m_limitState2=0;var b2PrismaticJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PrismaticJoint.prototype,b2Joint.prototype),b2PrismaticJoint.prototype._super=b2Joint.prototype,b2PrismaticJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_localXAxis1.SetV(e.localAxisA),this.m_localYAxis1.x=-this.m_localXAxis1.y,this.m_localYAxis1.y=this.m_localXAxis1.x,this.m_refAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=this.m_motorMass=0,this.m_lowerTranslation=e.lowerTranslation,this.m_upperTranslation=e.upperTranslation,this.m_maxMotorForce=e.maxMotorForce,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit,this.m_axis.SetZero(),this.m_perp.SetZero()},b2PrismaticJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_localXAxis1=new b2Vec2,this.m_localYAxis1=new b2Vec2,this.m_axis=new b2Vec2,this.m_perp=new b2Vec2,this.m_K=new b2Mat33,this.m_impulse=new b2Vec3},b2PrismaticJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i;this.m_localCenterA.SetV(t.GetLocalCenter()),this.m_localCenterB.SetV(n.GetLocalCenter());var s=t.GetTransform();n.GetTransform(),r=t.m_xf.R;var o=this.m_localAnchor1.x-this.m_localCenterA.x,u=this.m_localAnchor1.y-this.m_localCenterA.y;i=r.col1.x*o+r.col2.x*u,u=r.col1.y*o+r.col2.y*u,o=i,r=n.m_xf.R;var a=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y;i=r.col1.x*a+r.col2.x*f,f=r.col1.y*a+r.col2.y*f,a=i,r=n.m_sweep.c.x+a-t.m_sweep.c.x-o,i=n.m_sweep.c.y+f-t.m_sweep.c.y-u,this.m_invMassA=t.m_invMass,this.m_invMassB=n.m_invMass,this.m_invIA=t.m_invI,this.m_invIB=n.m_invI,this.m_axis.SetV(b2Math.MulMV(s.R,this.m_localXAxis1)),this.m_a1=(r+o)*this.m_axis.y-(i+u)*this.m_axis.x,this.m_a2=a*this.m_axis.y-f*this.m_axis.x,this.m_motorMass=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_a1*this.m_a1+this.m_invIB*this.m_a2*this.m_a2,this.m_motorMass>Number.MIN_VALUE&&(this.m_motorMass=1/this.m_motorMass),this.m_perp.SetV(b2Math.MulMV(s.R,this.m_localYAxis1)),this.m_s1=(r+o)*this.m_perp.y-(i+u)*this.m_perp.x,this.m_s2=a*this.m_perp.y-f*this.m_perp.x,s=this.m_invMassA,o=this.m_invMassB,u=this.m_invIA,a=this.m_invIB,this.m_K.col1.x=s+o+u*this.m_s1*this.m_s1+a*this.m_s2*this.m_s2,this.m_K.col1.y=u*this.m_s1+a*this.m_s2,this.m_K.col1.z=u*this.m_s1*this.m_a1+a*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=u+a,this.m_K.col2.z=u*this.m_a1+a*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=s+o+u*this.m_a1*this.m_a1+a*this.m_a2*this.m_a2,this.m_enableLimit?(r=this.m_axis.x*r+this.m_axis.y*i,b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?this.m_limitState=b2Joint.e_equalLimits:r<=this.m_lowerTranslation?this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_limitState=b2Joint.e_atLowerLimit,this.m_impulse.z=0):r>=this.m_upperTranslation?this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_limitState=b2Joint.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)):this.m_limitState=b2Joint.e_inactiveLimit,this.m_enableMotor==0&&(this.m_motorImpulse=0),e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x,r=this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y,i=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,s=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2,t.m_linearVelocity.x-=this.m_invMassA*e,t.m_linearVelocity.y-=this.m_invMassA*r,t.m_angularVelocity-=this.m_invIA*i,n.m_linearVelocity.x+=this.m_invMassB*e,n.m_linearVelocity.y+=this.m_invMassB*r,n.m_angularVelocity+=this.m_invIB*s):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b2PrismaticJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r=t.m_linearVelocity,i=t.m_angularVelocity,s=n.m_linearVelocity,o=n.m_angularVelocity,u,a,f;this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(f=this.m_motorMass*(this.m_motorSpeed-(this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i)),u=this.m_motorImpulse,e=e.dt*this.m_maxMotorForce,this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+f,-e,e),f=this.m_motorImpulse-u,u=f*this.m_axis.x,e=f*this.m_axis.y,a=f*this.m_a1,f*=this.m_a2,r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*e,i-=this.m_invIA*a,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*e,o+=this.m_invIB*f),a=this.m_perp.x*(s.x-r.x)+this.m_perp.y*(s.y-r.y)+this.m_s2*o-this.m_s1*i,e=o-i,this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit?(f=this.m_axis.x*(s.x-r.x)+this.m_axis.y*(s.y-r.y)+this.m_a2*o-this.m_a1*i,u=this.m_impulse.Copy(),f=this.m_K.Solve33(new b2Vec3,-a,-e,-f),this.m_impulse.Add(f),this.m_limitState==b2Joint.e_atLowerLimit?this.m_impulse.z=b2Math.Max(this.m_impulse.z,0):this.m_limitState==b2Joint.e_atUpperLimit&&(this.m_impulse.z=b2Math.Min(this.m_impulse.z,0)),a=-a-(this.m_impulse.z-u.z)*this.m_K.col3.x,e=-e-(this.m_impulse.z-u.z)*this.m_K.col3.y,e=this.m_K.Solve22(new b2Vec2,a,e),e.x+=u.x,e.y+=u.y,this.m_impulse.x=e.x,this.m_impulse.y=e.y,f.x=this.m_impulse.x-u.x,f.y=this.m_impulse.y-u.y,f.z=this.m_impulse.z-u.z,u=f.x*this.m_perp.x+f.z*this.m_axis.x,e=f.x*this.m_perp.y+f.z*this.m_axis.y,a=f.x*this.m_s1+f.y+f.z*this.m_a1,f=f.x*this.m_s2+f.y+f.z*this.m_a2):(f=this.m_K.Solve22(new b2Vec2,-a,-e),this.m_impulse.x+=f.x,this.m_impulse.y+=f.y,u=f.x*this.m_perp.x,e=f.x*this.m_perp.y,a=f.x*this.m_s1+f.y,f=f.x*this.m_s2+f.y),r.x-=this.m_invMassA*u,r.y-=this.m_invMassA*e,i-=this.m_invIA*a,s.x+=this.m_invMassB*u,s.y+=this.m_invMassB*e,o+=this.m_invIB*f,t.m_linearVelocity.SetV(r),t.m_angularVelocity=i,n.m_linearVelocity.SetV(s),n.m_angularVelocity=o},b2PrismaticJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.m_sweep.c,r=e.m_sweep.a,i=t.m_sweep.c,s=t.m_sweep.a,o,u,a,f,l=0,c=0;a=!1;var h=0,p=b2Mat22.FromAngle(r),d=b2Mat22.FromAngle(s);o=p,c=this.m_localAnchor1.x-this.m_localCenterA.x;var v=this.m_localAnchor1.y-this.m_localCenterA.y;u=o.col1.x*c+o.col2.x*v,v=o.col1.y*c+o.col2.y*v,c=u,o=d,d=this.m_localAnchor2.x-this.m_localCenterB.x,f=this.m_localAnchor2.y-this.m_localCenterB.y,u=o.col1.x*d+o.col2.x*f,f=o.col1.y*d+o.col2.y*f,d=u,o=i.x+d-n.x-c,u=i.y+f-n.y-v;if(this.m_enableLimit){this.m_axis=b2Math.MulMV(p,this.m_localXAxis1),this.m_a1=(o+c)*this.m_axis.y-(u+v)*this.m_axis.x,this.m_a2=d*this.m_axis.y-f*this.m_axis.x;var m=this.m_axis.x*o+this.m_axis.y*u;b2Math.Abs(this.m_upperTranslation-this.m_lowerTranslation)<2*b2Settings.b2_linearSlop?(h=b2Math.Clamp(m,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection),l=b2Math.Abs(m),a=!0):m<=this.m_lowerTranslation?(h=b2Math.Clamp(m-this.m_lowerTranslation+b2Settings.b2_linearSlop,-b2Settings.b2_maxLinearCorrection,0),l=this.m_lowerTranslation-m,a=!0):m>=this.m_upperTranslation&&(h=b2Math.Clamp(m-this.m_upperTranslation+b2Settings.b2_linearSlop,0,b2Settings.b2_maxLinearCorrection),l=m-this.m_upperTranslation,a=!0)}return this.m_perp=b2Math.MulMV(p,this.m_localYAxis1),this.m_s1=(o+c)*this.m_perp.y-(u+v)*this.m_perp.x,this.m_s2=d*this.m_perp.y-f*this.m_perp.x,p=new b2Vec3,v=this.m_perp.x*o+this.m_perp.y*u,d=s-r-this.m_refAngle,l=b2Math.Max(l,b2Math.Abs(v)),c=b2Math.Abs(d),a?(a=this.m_invMassA,f=this.m_invMassB,o=this.m_invIA,u=this.m_invIB,this.m_K.col1.x=a+f+o*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,this.m_K.col1.y=o*this.m_s1+u*this.m_s2,this.m_K.col1.z=o*this.m_s1*this.m_a1+u*this.m_s2*this.m_a2,this.m_K.col2.x=this.m_K.col1.y,this.m_K.col2.y=o+u,this.m_K.col2.z=o*this.m_a1+u*this.m_a2,this.m_K.col3.x=this.m_K.col1.z,this.m_K.col3.y=this.m_K.col2.z,this.m_K.col3.z=a+f+o*this.m_a1*this.m_a1+u*this.m_a2*this.m_a2,this.m_K.Solve33(p,-v,-d,-h)):(a=this.m_invMassA,f=this.m_invMassB,o=this.m_invIA,u=this.m_invIB,h=o*this.m_s1+u*this.m_s2,m=o+u,this.m_K.col1.Set(a+f+o*this.m_s1*this.m_s1+u*this.m_s2*this.m_s2,h,0),this.m_K.col2.Set(h,m,0),h=this.m_K.Solve22(new b2Vec2,-v,-d),p.x=h.x,p.y=h.y,p.z=0),h=p.x*this.m_perp.x+p.z*this.m_axis.x,a=p.x*this.m_perp.y+p.z*this.m_axis.y,v=p.x*this.m_s1+p.y+p.z*this.m_a1,p=p.x*this.m_s2+p.y+p.z*this.m_a2,n.x-=this.m_invMassA*h,n.y-=this.m_invMassA*a,r-=this.m_invIA*v,i.x+=this.m_invMassB*h,i.y+=this.m_invMassB*a,s+=this.m_invIB*p,e.m_sweep.a=r,t.m_sweep.a=s,e.SynchronizeTransform(),t.SynchronizeTransform(),l<=b2Settings.b2_linearSlop&&c<=b2Settings.b2_angularSlop},b2PrismaticJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2PrismaticJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2PrismaticJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y))},b2PrismaticJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.y},b2PrismaticJoint.prototype.GetJointTranslation=function(){var e=this.m_bodyA,t=this.m_bodyB,n=e.GetWorldPoint(this.m_localAnchor1),r=t.GetWorldPoint(this.m_localAnchor2);return t=r.x-n.x,n=r.y-n.y,e=e.GetWorldVector(this.m_localXAxis1),e.x*t+e.y*n},b2PrismaticJoint.prototype.GetJointSpeed=function(){var e=this.m_bodyA,t=this.m_bodyB,n;n=e.m_xf.R;var r=this.m_localAnchor1.x-e.m_sweep.localCenter.x,i=this.m_localAnchor1.y-e.m_sweep.localCenter.y,s=n.col1.x*r+n.col2.x*i;i=n.col1.y*r+n.col2.y*i,r=s,n=t.m_xf.R;var o=this.m_localAnchor2.x-t.m_sweep.localCenter.x,u=this.m_localAnchor2.y-t.m_sweep.localCenter.y;s=n.col1.x*o+n.col2.x*u,u=n.col1.y*o+n.col2.y*u,o=s,n=t.m_sweep.c.x+o-(e.m_sweep.c.x+r),s=t.m_sweep.c.y+u-(e.m_sweep.c.y+i);var a=e.GetWorldVector(this.m_localXAxis1),f=e.m_linearVelocity,l=t.m_linearVelocity;return e=e.m_angularVelocity,t=t.m_angularVelocity,n*-e*a.y+s*e*a.x+(a.x*(l.x+ -t*u-f.x- -e*i)+a.y*(l.y+t*o-f.y-e*r))},b2PrismaticJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2PrismaticJoint.prototype.EnableLimit=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=e},b2PrismaticJoint.prototype.GetLowerLimit=function(){return this.m_lowerTranslation},b2PrismaticJoint.prototype.GetUpperLimit=function(){return this.m_upperTranslation},b2PrismaticJoint.prototype.SetLimits=function(e,t){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=e,this.m_upperTranslation=t},b2PrismaticJoint.prototype.IsMotorEnabled=function(){return this.m_enableMotor},b2PrismaticJoint.prototype.EnableMotor=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=e},b2PrismaticJoint.prototype.SetMotorSpeed=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},b2PrismaticJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2PrismaticJoint.prototype.SetMaxMotorForce=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=e},b2PrismaticJoint.prototype.GetMotorForce=function(){return this.m_motorImpulse},b2PrismaticJoint.prototype.m_localAnchor1=new b2Vec2,b2PrismaticJoint.prototype.m_localAnchor2=new b2Vec2,b2PrismaticJoint.prototype.m_localXAxis1=new b2Vec2,b2PrismaticJoint.prototype.m_localYAxis1=new b2Vec2,b2PrismaticJoint.prototype.m_refAngle=null,b2PrismaticJoint.prototype.m_axis=new b2Vec2,b2PrismaticJoint.prototype.m_perp=new b2Vec2,b2PrismaticJoint.prototype.m_s1=null,b2PrismaticJoint.prototype.m_s2=null,b2PrismaticJoint.prototype.m_a1=null,b2PrismaticJoint.prototype.m_a2=null,b2PrismaticJoint.prototype.m_K=new b2Mat33,b2PrismaticJoint.prototype.m_impulse=new b2Vec3,b2PrismaticJoint.prototype.m_motorMass=null,b2PrismaticJoint.prototype.m_motorImpulse=null,b2PrismaticJoint.prototype.m_lowerTranslation=null,b2PrismaticJoint.prototype.m_upperTranslation=null,b2PrismaticJoint.prototype.m_maxMotorForce=null,b2PrismaticJoint.prototype.m_motorSpeed=null,b2PrismaticJoint.prototype.m_enableLimit=null,b2PrismaticJoint.prototype.m_enableMotor=null,b2PrismaticJoint.prototype.m_limitState=0;var b2RevoluteJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2RevoluteJoint.prototype,b2Joint.prototype),b2RevoluteJoint.prototype._super=b2Joint.prototype,b2RevoluteJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_referenceAngle=e.referenceAngle,this.m_impulse.SetZero(),this.m_motorImpulse=0,this.m_lowerAngle=e.lowerAngle,this.m_upperAngle=e.upperAngle,this.m_maxMotorTorque=e.maxMotorTorque,this.m_motorSpeed=e.motorSpeed,this.m_enableLimit=e.enableLimit,this.m_enableMotor=e.enableMotor,this.m_limitState=b2Joint.e_inactiveLimit},b2RevoluteJoint.prototype.__varz=function(){this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.K3=new b2Mat22,this.impulse3=new b2Vec3,this.impulse2=new b2Vec2,this.reduced=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_impulse=new b2Vec3,this.m_mass=new b2Mat33},b2RevoluteJoint.tImpulse=new b2Vec2,b2RevoluteJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i;r=t.m_xf.R;var s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y;i=r.col1.x*s+r.col2.x*o,o=r.col1.y*s+r.col2.y*o,s=i,r=n.m_xf.R;var u=this.m_localAnchor2.x-n.m_sweep.localCenter.x,a=this.m_localAnchor2.y-n.m_sweep.localCenter.y;i=r.col1.x*u+r.col2.x*a,a=r.col1.y*u+r.col2.y*a,u=i,r=t.m_invMass,i=n.m_invMass;var f=t.m_invI,l=n.m_invI;this.m_mass.col1.x=r+i+o*o*f+a*a*l,this.m_mass.col2.x=-o*s*f-a*u*l,this.m_mass.col3.x=-o*f-a*l,this.m_mass.col1.y=this.m_mass.col2.x,this.m_mass.col2.y=r+i+s*s*f+u*u*l,this.m_mass.col3.y=s*f+u*l,this.m_mass.col1.z=this.m_mass.col3.x,this.m_mass.col2.z=this.m_mass.col3.y,this.m_mass.col3.z=f+l,this.m_motorMass=1/(f+l),this.m_enableMotor==0&&(this.m_motorImpulse=0);if(this.m_enableLimit){var c=n.m_sweep.a-t.m_sweep.a-this.m_referenceAngle;b2Math.Abs(this.m_upperAngle-this.m_lowerAngle)<2*b2Settings.b2_angularSlop?this.m_limitState=b2Joint.e_equalLimits:c<=this.m_lowerAngle?(this.m_limitState!=b2Joint.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atLowerLimit):c>=this.m_upperAngle?(this.m_limitState!=b2Joint.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=b2Joint.e_atUpperLimit):(this.m_limitState=b2Joint.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=b2Joint.e_inactiveLimit;e.warmStarting?(this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,this.m_motorImpulse*=e.dtRatio,e=this.m_impulse.x,c=this.m_impulse.y,t.m_linearVelocity.x-=r*e,t.m_linearVelocity.y-=r*c,t.m_angularVelocity-=f*(s*c-o*e+this.m_motorImpulse+this.m_impulse.z),n.m_linearVelocity.x+=i*e,n.m_linearVelocity.y+=i*c,n.m_angularVelocity+=l*(u*c-a*e+this.m_motorImpulse+this.m_impulse.z)):(this.m_impulse.SetZero(),this.m_motorImpulse=0)},b2RevoluteJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyA,n=this.m_bodyB,r,i,s,o,u,a=t.m_linearVelocity,f=t.m_angularVelocity,l=n.m_linearVelocity,c=n.m_angularVelocity,h=t.m_invMass,p=n.m_invMass,d=t.m_invI,v=n.m_invI;this.m_enableMotor&&this.m_limitState!=b2Joint.e_equalLimits&&(s=this.m_motorMass*-(c-f-this.m_motorSpeed),o=this.m_motorImpulse,e=e.dt*this.m_maxMotorTorque,this.m_motorImpulse=b2Math.Clamp(this.m_motorImpulse+s,-e,e),s=this.m_motorImpulse-o,f-=d*s,c+=v*s);if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){r=t.m_xf.R,s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=r.col1.x*s+r.col2.x*o,o=r.col1.y*s+r.col2.y*o,s=i,r=n.m_xf.R,e=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=r.col1.x*e+r.col2.x*u,u=r.col1.y*e+r.col2.y*u,e=i,i=l.x+ -c*u-a.x- -f*o;var m=l.y+c*e-a.y-f*s;this.m_mass.Solve33(this.impulse3,-i,-m,-(c-f)),this.m_limitState==b2Joint.e_equalLimits?this.m_impulse.Add(this.impulse3):this.m_limitState==b2Joint.e_atLowerLimit?(r=this.m_impulse.z+this.impulse3.z,r<0&&(this.m_mass.Solve22(this.reduced,-i,-m),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)):this.m_limitState==b2Joint.e_atUpperLimit&&(r=this.m_impulse.z+this.impulse3.z,r>0&&(this.m_mass.Solve22(this.reduced,-i,-m),this.impulse3.x=this.reduced.x,this.impulse3.y=this.reduced.y,this.impulse3.z=-this.m_impulse.z,this.m_impulse.x+=this.reduced.x,this.m_impulse.y+=this.reduced.y,this.m_impulse.z=0)),a.x-=h*this.impulse3.x,a.y-=h*this.impulse3.y,f-=d*(s*this.impulse3.y-o*this.impulse3.x+this.impulse3.z),l.x+=p*this.impulse3.x,l.y+=p*this.impulse3.y,c+=v*(e*this.impulse3.y-u*this.impulse3.x+this.impulse3.z)}else r=t.m_xf.R,s=this.m_localAnchor1.x-t.m_sweep.localCenter.x,o=this.m_localAnchor1.y-t.m_sweep.localCenter.y,i=r.col1.x*s+r.col2.x*o,o=r.col1.y*s+r.col2.y*o,s=i,r=n.m_xf.R,e=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y,i=r.col1.x*e+r.col2.x*u,u=r.col1.y*e+r.col2.y*u,e=i,this.m_mass.Solve22(this.impulse2,-(l.x+ -c*u-a.x- -f*o),-(l.y+c*e-a.y-f*s)),this.m_impulse.x+=this.impulse2.x,this.m_impulse.y+=this.impulse2.y,a.x-=h*this.impulse2.x,a.y-=h*this.impulse2.y,f-=d*(s*this.impulse2.y-o*this.impulse2.x),l.x+=p*this.impulse2.x,l.y+=p*this.impulse2.y,c+=v*(e*this.impulse2.y-u*this.impulse2.x);t.m_linearVelocity.SetV(a),t.m_angularVelocity=f,n.m_linearVelocity.SetV(l),n.m_angularVelocity=c},b2RevoluteJoint.prototype.SolvePositionConstraints=function(){var e,t,n=this.m_bodyA,r=this.m_bodyB,i=0;t=0;var s,o,u;if(this.m_enableLimit&&this.m_limitState!=b2Joint.e_inactiveLimit){e=r.m_sweep.a-n.m_sweep.a-this.m_referenceAngle;var a=0;this.m_limitState==b2Joint.e_equalLimits?(e=b2Math.Clamp(e-this.m_lowerAngle,-b2Settings.b2_maxAngularCorrection,b2Settings.b2_maxAngularCorrection),a=-this.m_motorMass*e,i=b2Math.Abs(e)):this.m_limitState==b2Joint.e_atLowerLimit?(e-=this.m_lowerAngle,i=-e,e=b2Math.Clamp(e+b2Settings.b2_angularSlop,-b2Settings.b2_maxAngularCorrection,0),a=-this.m_motorMass*e):this.m_limitState==b2Joint.e_atUpperLimit&&(i=e-=this.m_upperAngle,e=b2Math.Clamp(e-b2Settings.b2_angularSlop,0,b2Settings.b2_maxAngularCorrection),a=-this.m_motorMass*e),n.m_sweep.a-=n.m_invI*a,r.m_sweep.a+=r.m_invI*a,n.SynchronizeTransform(),r.SynchronizeTransform()}t=n.m_xf.R,a=this.m_localAnchor1.x-n.m_sweep.localCenter.x,e=this.m_localAnchor1.y-n.m_sweep.localCenter.y,s=t.col1.x*a+t.col2.x*e,e=t.col1.y*a+t.col2.y*e,a=s,t=r.m_xf.R;var f=this.m_localAnchor2.x-r.m_sweep.localCenter.x,l=this.m_localAnchor2.y-r.m_sweep.localCenter.y;s=t.col1.x*f+t.col2.x*l,l=t.col1.y*f+t.col2.y*l,f=s,o=r.m_sweep.c.x+f-n.m_sweep.c.x-a,u=r.m_sweep.c.y+l-n.m_sweep.c.y-e;var c=o*o+u*u;t=Math.sqrt(c),s=n.m_invMass;var h=r.m_invMass,p=n.m_invI,d=r.m_invI,v=10*b2Settings.b2_linearSlop;return c>v*v&&(c=1/(s+h),o=c*-o,u=c*-u,n.m_sweep.c.x-=.5*s*o,n.m_sweep.c.y-=.5*s*u,r.m_sweep.c.x+=.5*h*o,r.m_sweep.c.y+=.5*h*u,o=r.m_sweep.c.x+f-n.m_sweep.c.x-a,u=r.m_sweep.c.y+l-n.m_sweep.c.y-e),this.K1.col1.x=s+h,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=s+h,this.K2.col1.x=p*e*e,this.K2.col2.x=-p*a*e,this.K2.col1.y=-p*a*e,this.K2.col2.y=p*a*a,this.K3.col1.x=d*l*l,this.K3.col2.x=-d*f*l,this.K3.col1.y=-d*f*l,this.K3.col2.y=d*f*f,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.AddM(this.K3),this.K.Solve(b2RevoluteJoint.tImpulse,-o,-u),o=b2RevoluteJoint.tImpulse.x,u=b2RevoluteJoint.tImpulse.y,n.m_sweep.c.x-=n.m_invMass*o,n.m_sweep.c.y-=n.m_invMass*u,n.m_sweep.a-=n.m_invI*(a*u-e*o),r.m_sweep.c.x+=r.m_invMass*o,r.m_sweep.c.y+=r.m_invMass*u,r.m_sweep.a+=r.m_invI*(f*u-l*o),n.SynchronizeTransform(),r.SynchronizeTransform(),t<=b2Settings.b2_linearSlop&&i<=b2Settings.b2_angularSlop},b2RevoluteJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2RevoluteJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2RevoluteJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse.x,e*this.m_impulse.y)},b2RevoluteJoint.prototype.GetReactionTorque=function(e){return e*this.m_impulse.z},b2RevoluteJoint.prototype.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},b2RevoluteJoint.prototype.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},b2RevoluteJoint.prototype.IsLimitEnabled=function(){return this.m_enableLimit},b2RevoluteJoint.prototype.EnableLimit=function(e){this.m_enableLimit=e},b2RevoluteJoint.prototype.GetLowerLimit=function(){return this.m_lowerAngle},b2RevoluteJoint.prototype.GetUpperLimit=function(){return this.m_upperAngle},b2RevoluteJoint.prototype.SetLimits=function(e,t){this.m_lowerAngle=e,this.m_upperAngle=t},b2RevoluteJoint.prototype.IsMotorEnabled=function(){return this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor},b2RevoluteJoint.prototype.EnableMotor=function(e){this.m_enableMotor=e},b2RevoluteJoint.prototype.SetMotorSpeed=function(e){this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=e},b2RevoluteJoint.prototype.GetMotorSpeed=function(){return this.m_motorSpeed},b2RevoluteJoint.prototype.SetMaxMotorTorque=function(e){this.m_maxMotorTorque=e},b2RevoluteJoint.prototype.GetMotorTorque=function(){return this.m_maxMotorTorque},b2RevoluteJoint.prototype.K=new b2Mat22,b2RevoluteJoint.prototype.K1=new b2Mat22,b2RevoluteJoint.prototype.K2=new b2Mat22,b2RevoluteJoint.prototype.K3=new b2Mat22,b2RevoluteJoint.prototype.impulse3=new b2Vec3,b2RevoluteJoint.prototype.impulse2=new b2Vec2,b2RevoluteJoint.prototype.reduced=new b2Vec2,b2RevoluteJoint.prototype.m_localAnchor1=new b2Vec2,b2RevoluteJoint.prototype.m_localAnchor2=new b2Vec2,b2RevoluteJoint.prototype.m_impulse=new b2Vec3,b2RevoluteJoint.prototype.m_motorImpulse=null,b2RevoluteJoint.prototype.m_mass=new b2Mat33,b2RevoluteJoint.prototype.m_motorMass=null,b2RevoluteJoint.prototype.m_enableMotor=null,b2RevoluteJoint.prototype.m_maxMotorTorque=null,b2RevoluteJoint.prototype.m_motorSpeed=null,b2RevoluteJoint.prototype.m_enableLimit=null,b2RevoluteJoint.prototype.m_referenceAngle=null,b2RevoluteJoint.prototype.m_lowerAngle=null,b2RevoluteJoint.prototype.m_upperAngle=null,b2RevoluteJoint.prototype.m_limitState=0;var b2JointDef=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2JointDef.prototype.__constructor=function(){this.type=b2Joint.e_unknownJoint,this.bodyB=this.bodyA=this.userData=null,this.collideConnected=!1},b2JointDef.prototype.__varz=function(){},b2JointDef.prototype.type=0,b2JointDef.prototype.userData=null,b2JointDef.prototype.bodyA=null,b2JointDef.prototype.bodyB=null,b2JointDef.prototype.collideConnected=null;var b2LineJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2LineJointDef.prototype,b2JointDef.prototype),b2LineJointDef.prototype._super=b2JointDef.prototype,b2LineJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_lineJoint,this.localAxisA.Set(1,0),this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},b2LineJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2LineJointDef.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r)},b2LineJointDef.prototype.localAnchorA=new b2Vec2,b2LineJointDef.prototype.localAnchorB=new b2Vec2,b2LineJointDef.prototype.localAxisA=new b2Vec2,b2LineJointDef.prototype.enableLimit=null,b2LineJointDef.prototype.lowerTranslation=null,b2LineJointDef.prototype.upperTranslation=null,b2LineJointDef.prototype.enableMotor=null,b2LineJointDef.prototype.maxMotorForce=null,b2LineJointDef.prototype.motorSpeed=null;var b2DistanceJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2DistanceJoint.prototype,b2Joint.prototype),b2DistanceJoint.prototype._super=b2Joint.prototype,b2DistanceJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchor1.SetV(e.localAnchorA),this.m_localAnchor2.SetV(e.localAnchorB),this.m_length=e.length,this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_bias=this.m_gamma=this.m_impulse=0},b2DistanceJoint.prototype.__varz=function(){this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_u=new b2Vec2},b2DistanceJoint.prototype.InitVelocityConstraints=function(e){var t,n,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchor1.x-r.m_sweep.localCenter.x,o=this.m_localAnchor1.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchor2.x-i.m_sweep.localCenter.x,a=this.m_localAnchor2.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,this.m_u.x=i.m_sweep.c.x+u-r.m_sweep.c.x-s,this.m_u.y=i.m_sweep.c.y+a-r.m_sweep.c.y-o,n=Math.sqrt(this.m_u.x*this.m_u.x+this.m_u.y*this.m_u.y),n>b2Settings.b2_linearSlop?this.m_u.Multiply(1/n):this.m_u.SetZero(),t=s*this.m_u.y-o*this.m_u.x;var f=u*this.m_u.y-a*this.m_u.x;t=r.m_invMass+r.m_invI*t*t+i.m_invMass+i.m_invI*f*f,this.m_mass=t!=0?1/t:0;if(this.m_frequencyHz>0){n-=this.m_length,f=2*Math.PI*this.m_frequencyHz;var l=this.m_mass*f*f;this.m_gamma=e.dt*(2*this.m_mass*this.m_dampingRatio*f+e.dt*l),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_bias=n*e.dt*l*this.m_gamma,this.m_mass=t+this.m_gamma,this.m_mass=this.m_mass!=0?1/this.m_mass:0}e.warmStarting?(this.m_impulse*=e.dtRatio,e=this.m_impulse*this.m_u.x,t=this.m_impulse*this.m_u.y,r.m_linearVelocity.x-=r.m_invMass*e,r.m_linearVelocity.y-=r.m_invMass*t,r.m_angularVelocity-=r.m_invI*(s*t-o*e),i.m_linearVelocity.x+=i.m_invMass*e,i.m_linearVelocity.y+=i.m_invMass*t,i.m_angularVelocity+=i.m_invI*(u*t-a*e)):this.m_impulse=0},b2DistanceJoint.prototype.SolveVelocityConstraints=function(){var e,t=this.m_bodyA,n=this.m_bodyB;e=t.m_xf.R;var r=this.m_localAnchor1.x-t.m_sweep.localCenter.x,i=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=e.col1.x*r+e.col2.x*i;i=e.col1.y*r+e.col2.y*i,r=s,e=n.m_xf.R;var o=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=s,s=-this.m_mass*(this.m_u.x*(n.m_linearVelocity.x+ -n.m_angularVelocity*u-(t.m_linearVelocity.x+ -t.m_angularVelocity*i))+this.m_u.y*(n.m_linearVelocity.y+n.m_angularVelocity*o-(t.m_linearVelocity.y+t.m_angularVelocity*r))+this.m_bias+this.m_gamma*this.m_impulse),this.m_impulse+=s,e=s*this.m_u.x,s*=this.m_u.y,t.m_linearVelocity.x-=t.m_invMass*e,t.m_linearVelocity.y-=t.m_invMass*s,t.m_angularVelocity-=t.m_invI*(r*s-i*e),n.m_linearVelocity.x+=n.m_invMass*e,n.m_linearVelocity.y+=n.m_invMass*s,n.m_angularVelocity+=n.m_invI*(o*s-u*e)},b2DistanceJoint.prototype.SolvePositionConstraints=function(){var e;if(this.m_frequencyHz>0)return!0;var t=this.m_bodyA,n=this.m_bodyB;e=t.m_xf.R;var r=this.m_localAnchor1.x-t.m_sweep.localCenter.x,i=this.m_localAnchor1.y-t.m_sweep.localCenter.y,s=e.col1.x*r+e.col2.x*i;i=e.col1.y*r+e.col2.y*i,r=s,e=n.m_xf.R;var o=this.m_localAnchor2.x-n.m_sweep.localCenter.x,u=this.m_localAnchor2.y-n.m_sweep.localCenter.y;s=e.col1.x*o+e.col2.x*u,u=e.col1.y*o+e.col2.y*u,o=s,s=n.m_sweep.c.x+o-t.m_sweep.c.x-r;var a=n.m_sweep.c.y+u-t.m_sweep.c.y-i;e=Math.sqrt(s*s+a*a),s/=e,a/=e,e-=this.m_length,e=b2Math.Clamp(e,-b2Settings.b2_maxLinearCorrection,b2Settings.b2_maxLinearCorrection);var f=-this.m_mass*e;return this.m_u.Set(s,a),s=f*this.m_u.x,a=f*this.m_u.y,t.m_sweep.c.x-=t.m_invMass*s,t.m_sweep.c.y-=t.m_invMass*a,t.m_sweep.a-=t.m_invI*(r*a-i*s),n.m_sweep.c.x+=n.m_invMass*s,n.m_sweep.c.y+=n.m_invMass*a,n.m_sweep.a+=n.m_invI*(o*a-u*s),t.SynchronizeTransform(),n.SynchronizeTransform(),b2Math.Abs(e)<b2Settings.b2_linearSlop},b2DistanceJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2DistanceJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2DistanceJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse*this.m_u.x,e*this.m_impulse*this.m_u.y)},b2DistanceJoint.prototype.GetReactionTorque=function(){return 0},b2DistanceJoint.prototype.GetLength=function(){return this.m_length},b2DistanceJoint.prototype.SetLength=function(e){this.m_length=e},b2DistanceJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2DistanceJoint.prototype.SetFrequency=function(e){this.m_frequencyHz=e},b2DistanceJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2DistanceJoint.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},b2DistanceJoint.prototype.m_localAnchor1=new b2Vec2,b2DistanceJoint.prototype.m_localAnchor2=new b2Vec2,b2DistanceJoint.prototype.m_u=new b2Vec2,b2DistanceJoint.prototype.m_frequencyHz=null,b2DistanceJoint.prototype.m_dampingRatio=null,b2DistanceJoint.prototype.m_gamma=null,b2DistanceJoint.prototype.m_bias=null,b2DistanceJoint.prototype.m_impulse=null,b2DistanceJoint.prototype.m_mass=null,b2DistanceJoint.prototype.m_length=null;var b2PulleyJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PulleyJointDef.prototype,b2JointDef.prototype),b2PulleyJointDef.prototype._super=b2JointDef.prototype,b2PulleyJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_pulleyJoint,this.groundAnchorA.Set(-1,1),this.groundAnchorB.Set(1,1),this.localAnchorA.Set(-1,0),this.localAnchorB.Set(1,0),this.maxLengthB=this.lengthB=this.maxLengthA=this.lengthA=0,this.ratio=1,this.collideConnected=!0},b2PulleyJointDef.prototype.__varz=function(){this.groundAnchorA=new b2Vec2,this.groundAnchorB=new b2Vec2,this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2PulleyJointDef.prototype.Initialize=function(e,t,n,r,i,s,o){this.bodyA=e,this.bodyB=t,this.groundAnchorA.SetV(n),this.groundAnchorB.SetV(r),this.localAnchorA=this.bodyA.GetLocalPoint(i),this.localAnchorB=this.bodyB.GetLocalPoint(s),e=i.x-n.x,n=i.y-n.y,this.lengthA=Math.sqrt(e*e+n*n),n=s.x-r.x,r=s.y-r.y,this.lengthB=Math.sqrt(n*n+r*r),this.ratio=o,o=this.lengthA+this.ratio*this.lengthB,this.maxLengthA=o-this.ratio*b2PulleyJoint.b2_minPulleyLength,this.maxLengthB=(o-b2PulleyJoint.b2_minPulleyLength)/this.ratio},b2PulleyJointDef.prototype.groundAnchorA=new b2Vec2,b2PulleyJointDef.prototype.groundAnchorB=new b2Vec2,b2PulleyJointDef.prototype.localAnchorA=new b2Vec2,b2PulleyJointDef.prototype.localAnchorB=new b2Vec2,b2PulleyJointDef.prototype.lengthA=null,b2PulleyJointDef.prototype.maxLengthA=null,b2PulleyJointDef.prototype.lengthB=null,b2PulleyJointDef.prototype.maxLengthB=null,b2PulleyJointDef.prototype.ratio=null;var b2DistanceJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2DistanceJointDef.prototype,b2JointDef.prototype),b2DistanceJointDef.prototype._super=b2JointDef.prototype,b2DistanceJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_distanceJoint,this.length=1,this.dampingRatio=this.frequencyHz=0},b2DistanceJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2DistanceJointDef.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(r)),e=r.x-n.x,n=r.y-n.y,this.length=Math.sqrt(e*e+n*n),this.dampingRatio=this.frequencyHz=0},b2DistanceJointDef.prototype.localAnchorA=new b2Vec2,b2DistanceJointDef.prototype.localAnchorB=new b2Vec2,b2DistanceJointDef.prototype.length=null,b2DistanceJointDef.prototype.frequencyHz=null,b2DistanceJointDef.prototype.dampingRatio=null;var b2FrictionJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2FrictionJointDef.prototype,b2JointDef.prototype),b2FrictionJointDef.prototype._super=b2JointDef.prototype,b2FrictionJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_frictionJoint,this.maxTorque=this.maxForce=0},b2FrictionJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2FrictionJointDef.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n))},b2FrictionJointDef.prototype.localAnchorA=new b2Vec2,b2FrictionJointDef.prototype.localAnchorB=new b2Vec2,b2FrictionJointDef.prototype.maxForce=null,b2FrictionJointDef.prototype.maxTorque=null;var b2WeldJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2WeldJointDef.prototype,b2JointDef.prototype),b2WeldJointDef.prototype._super=b2JointDef.prototype,b2WeldJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_weldJoint,this.referenceAngle=0},b2WeldJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2WeldJointDef.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA.SetV(this.bodyA.GetLocalPoint(n)),this.localAnchorB.SetV(this.bodyB.GetLocalPoint(n)),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2WeldJointDef.prototype.localAnchorA=new b2Vec2,b2WeldJointDef.prototype.localAnchorB=new b2Vec2,b2WeldJointDef.prototype.referenceAngle=null;var b2GearJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GearJointDef.prototype,b2JointDef.prototype),b2GearJointDef.prototype._super=b2JointDef.prototype,b2GearJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_gearJoint,this.joint2=this.joint1=null,this.ratio=1},b2GearJointDef.prototype.__varz=function(){},b2GearJointDef.prototype.joint1=null,b2GearJointDef.prototype.joint2=null,b2GearJointDef.prototype.ratio=null;var b2Color=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Color.prototype.__constructor=function(e,t,n){this._r=parseInt(255*b2Math.Clamp(e,0,1)),this._g=parseInt(255*b2Math.Clamp(t,0,1)),this._b=parseInt(255*b2Math.Clamp(n,0,1))},b2Color.prototype.__varz=function(){},b2Color.prototype.Set=function(e,t,n){this._r=parseInt(255*b2Math.Clamp(e,0,1)),this._g=parseInt(255*b2Math.Clamp(t,0,1)),this._b=parseInt(255*b2Math.Clamp(n,0,1))},b2Color.prototype.__defineGetter__("r",function(){return this._r}),b2Color.prototype.__defineSetter__("r",function(e){this._r=parseInt(255*b2Math.Clamp(e,0,1))}),b2Color.prototype.__defineGetter__("g",function(){return this._g}),b2Color.prototype.__defineSetter__("g",function(e){this._g=parseInt(255*b2Math.Clamp(e,0,1))}),b2Color.prototype.__defineGetter__("b",function(){return this._b}),b2Color.prototype.__defineSetter__("b",function(e){this._b=parseInt(255*b2Math.Clamp(e,0,1))}),b2Color.prototype.__defineGetter__("color",function(){return this._r<<16|this._g<<8|this._b}),b2Color.prototype._r=0,b2Color.prototype._g=0,b2Color.prototype._b=0;var b2FrictionJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2FrictionJoint.prototype,b2Joint.prototype),b2FrictionJoint.prototype._super=b2Joint.prototype,b2FrictionJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_localAnchorA.SetV(e.localAnchorA),this.m_localAnchorB.SetV(e.localAnchorB),this.m_linearMass.SetZero(),this.m_angularMass=0,this.m_linearImpulse.SetZero(),this.m_angularImpulse=0,this.m_maxForce=e.maxForce,this.m_maxTorque=e.maxTorque},b2FrictionJoint.prototype.__varz=function(){this.m_localAnchorA=new b2Vec2,this.m_localAnchorB=new b2Vec2,this.m_linearImpulse=new b2Vec2,this.m_linearMass=new b2Mat22},b2FrictionJoint.prototype.InitVelocityConstraints=function(e){var t,n,r=this.m_bodyA,i=this.m_bodyB;t=r.m_xf.R;var s=this.m_localAnchorA.x-r.m_sweep.localCenter.x,o=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*s+t.col2.x*o,o=t.col1.y*s+t.col2.y*o,s=n,t=i.m_xf.R;var u=this.m_localAnchorB.x-i.m_sweep.localCenter.x,a=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*u+t.col2.x*a,a=t.col1.y*u+t.col2.y*a,u=n,t=r.m_invMass,n=i.m_invMass;var f=r.m_invI,l=i.m_invI,c=new b2Mat22;c.col1.x=t+n,c.col2.x=0,c.col1.y=0,c.col2.y=t+n,c.col1.x+=f*o*o,c.col2.x+=-f*s*o,c.col1.y+=-f*s*o,c.col2.y+=f*s*s,c.col1.x+=l*a*a,c.col2.x+=-l*u*a,c.col1.y+=-l*u*a,c.col2.y+=l*u*u,c.GetInverse(this.m_linearMass),this.m_angularMass=f+l,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),e.warmStarting?(this.m_linearImpulse.x*=e.dtRatio,this.m_linearImpulse.y*=e.dtRatio,this.m_angularImpulse*=e.dtRatio,e=this.m_linearImpulse,r.m_linearVelocity.x-=t*e.x,r.m_linearVelocity.y-=t*e.y,r.m_angularVelocity-=f*(s*e.y-o*e.x+this.m_angularImpulse),i.m_linearVelocity.x+=n*e.x,i.m_linearVelocity.y+=n*e.y,i.m_angularVelocity+=l*(u*e.y-a*e.x+this.m_angularImpulse)):(this.m_linearImpulse.SetZero(),this.m_angularImpulse=0)},b2FrictionJoint.prototype.SolveVelocityConstraints=function(e){var t,n,r=this.m_bodyA,i=this.m_bodyB,s=r.m_linearVelocity,o=r.m_angularVelocity,u=i.m_linearVelocity,a=i.m_angularVelocity,f=r.m_invMass,l=i.m_invMass,c=r.m_invI,h=i.m_invI;t=r.m_xf.R;var p=this.m_localAnchorA.x-r.m_sweep.localCenter.x,d=this.m_localAnchorA.y-r.m_sweep.localCenter.y;n=t.col1.x*p+t.col2.x*d,d=t.col1.y*p+t.col2.y*d,p=n,t=i.m_xf.R;var v=this.m_localAnchorB.x-i.m_sweep.localCenter.x,m=this.m_localAnchorB.y-i.m_sweep.localCenter.y;n=t.col1.x*v+t.col2.x*m,m=t.col1.y*v+t.col2.y*m,v=n,n=-this.m_angularMass*(a-o);var g=this.m_angularImpulse;t=e.dt*this.m_maxTorque,this.m_angularImpulse=b2Math.Clamp(this.m_angularImpulse+n,-t,t),n=this.m_angularImpulse-g,o-=c*n,a+=h*n,t=b2Math.MulMV(this.m_linearMass,new b2Vec2(-(u.x-a*m-s.x+o*d),-(u.y+a*v-s.y-o*p))),n=this.m_linearImpulse.Copy(),this.m_linearImpulse.Add(t),t=e.dt*this.m_maxForce,this.m_linearImpulse.LengthSquared()>t*t&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.Multiply(t)),t=b2Math.SubtractVV(this.m_linearImpulse,n),s.x-=f*t.x,s.y-=f*t.y,o-=c*(p*t.y-d*t.x),u.x+=l*t.x,u.y+=l*t.y,a+=h*(v*t.y-m*t.x),r.m_angularVelocity=o,i.m_angularVelocity=a},b2FrictionJoint.prototype.SolvePositionConstraints=function(){return!0},b2FrictionJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA)},b2FrictionJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB)},b2FrictionJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_linearImpulse.x,e*this.m_linearImpulse.y)},b2FrictionJoint.prototype.GetReactionTorque=function(e){return e*this.m_angularImpulse},b2FrictionJoint.prototype.SetMaxForce=function(e){this.m_maxForce=e},b2FrictionJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2FrictionJoint.prototype.SetMaxTorque=function(e){this.m_maxTorque=e},b2FrictionJoint.prototype.GetMaxTorque=function(){return this.m_maxTorque},b2FrictionJoint.prototype.m_localAnchorA=new b2Vec2,b2FrictionJoint.prototype.m_localAnchorB=new b2Vec2,b2FrictionJoint.prototype.m_linearImpulse=new b2Vec2,b2FrictionJoint.prototype.m_angularImpulse=null,b2FrictionJoint.prototype.m_maxForce=null,b2FrictionJoint.prototype.m_maxTorque=null,b2FrictionJoint.prototype.m_linearMass=new b2Mat22,b2FrictionJoint.prototype.m_angularMass=null;var b2Distance=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Distance.prototype.__constructor=function(){},b2Distance.prototype.__varz=function(){},b2Distance.Distance=function(e,t,n){++b2Distance.b2_gjkCalls;var r=n.proxyA,i=n.proxyB,s=n.transformA,o=n.transformB,u=b2Distance.s_simplex;u.ReadCache(t,r,s,i,o);var a=u.m_vertices,f=b2Distance.s_saveA,l=b2Distance.s_saveB,c=0;u.GetClosestPoint().LengthSquared();for(var h=0,p,d=0;d<20;){c=u.m_count;for(h=0;h<c;h++)f[h]=a[h].indexA,l[h]=a[h].indexB;switch(u.m_count){case 1:break;case 2:u.Solve2();break;case 3:u.Solve3();break;default:b2Settings.b2Assert(!1)}if(u.m_count==3)break;p=u.GetClosestPoint(),p.LengthSquared(),h=u.GetSearchDirection();if(h.LengthSquared()<Number.MIN_VALUE*Number.MIN_VALUE)break;p=a[u.m_count],p.indexA=r.GetSupport(b2Math.MulTMV(s.R,h.GetNegative())),p.wA=b2Math.MulX(s,r.GetVertex(p.indexA)),p.indexB=i.GetSupport(b2Math.MulTMV(o.R,h)),p.wB=b2Math.MulX(o,i.GetVertex(p.indexB)),p.w=b2Math.SubtractVV(p.wB,p.wA),++d,++b2Distance.b2_gjkIters;var v=!1;for(h=0;h<c;h++)if(p.indexA==f[h]&&p.indexB==l[h]){v=!0;break}if(v)break;++u.m_count}b2Distance.b2_gjkMaxIters=b2Math.Max(b2Distance.b2_gjkMaxIters,d),u.GetWitnessPoints(e.pointA,e.pointB),e.distance=b2Math.SubtractVV(e.pointA,e.pointB).Length(),e.iterations=d,u.WriteCache(t),n.useRadii&&(t=r.m_radius,i=i.m_radius,e.distance>t+i&&e.distance>Number.MIN_VALUE?(e.distance-=t+i,n=b2Math.SubtractVV(e.pointB,e.pointA),n.Normalize(),e.pointA.x+=t*n.x,e.pointA.y+=t*n.y,e.pointB.x-=i*n.x,e.pointB.y-=i*n.y):(p=new b2Vec2,p.x=.5*(e.pointA.x+e.pointB.x),p.y=.5*(e.pointA.y+e.pointB.y),e.pointA.x=e.pointB.x=p.x,e.pointA.y=e.pointB.y=p.y,e.distance=0))},b2Distance.b2_gjkCalls=0,b2Distance.b2_gjkIters=0,b2Distance.b2_gjkMaxIters=0,b2Distance.s_simplex=new b2Simplex,b2Distance.s_saveA=Array(3),b2Distance.s_saveB=Array(3);var b2MouseJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2MouseJoint.prototype,b2Joint.prototype),b2MouseJoint.prototype._super=b2Joint.prototype,b2MouseJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]),this.m_target.SetV(e.target);var t=this.m_target.x-this.m_bodyB.m_xf.position.x,n=this.m_target.y-this.m_bodyB.m_xf.position.y,r=this.m_bodyB.m_xf.R;this.m_localAnchor.x=t*r.col1.x+n*r.col1.y,this.m_localAnchor.y=t*r.col2.x+n*r.col2.y,this.m_maxForce=e.maxForce,this.m_impulse.SetZero(),this.m_frequencyHz=e.frequencyHz,this.m_dampingRatio=e.dampingRatio,this.m_gamma=this.m_beta=0},b2MouseJoint.prototype.__varz=function(){this.K=new b2Mat22,this.K1=new b2Mat22,this.K2=new b2Mat22,this.m_localAnchor=new b2Vec2,this.m_target=new b2Vec2,this.m_impulse=new b2Vec2,this.m_mass=new b2Mat22,this.m_C=new b2Vec2},b2MouseJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_bodyB,n=t.GetMass(),r=2*Math.PI*this.m_frequencyHz,i=n*r*r;this.m_gamma=e.dt*(2*n*this.m_dampingRatio*r+e.dt*i),this.m_gamma=this.m_gamma!=0?1/this.m_gamma:0,this.m_beta=e.dt*i*this.m_gamma,i=t.m_xf.R,n=this.m_localAnchor.x-t.m_sweep.localCenter.x,r=this.m_localAnchor.y-t.m_sweep.localCenter.y;var s=i.col1.x*n+i.col2.x*r;r=i.col1.y*n+i.col2.y*r,n=s,i=t.m_invMass,s=t.m_invI,this.K1.col1.x=i,this.K1.col2.x=0,this.K1.col1.y=0,this.K1.col2.y=i,this.K2.col1.x=s*r*r,this.K2.col2.x=-s*n*r,this.K2.col1.y=-s*n*r,this.K2.col2.y=s*n*n,this.K.SetM(this.K1),this.K.AddM(this.K2),this.K.col1.x+=this.m_gamma,this.K.col2.y+=this.m_gamma,this.K.GetInverse(this.m_mass),this.m_C.x=t.m_sweep.c.x+n-this.m_target.x,this.m_C.y=t.m_sweep.c.y+r-this.m_target.y,t.m_angularVelocity*=.98,this.m_impulse.x*=e.dtRatio,this.m_impulse.y*=e.dtRatio,t.m_linearVelocity.x+=i*this.m_impulse.x,t.m_linearVelocity.y+=i*this.m_impulse.y,t.m_angularVelocity+=s*(n*this.m_impulse.y-r*this.m_impulse.x)},b2MouseJoint.prototype.SolveVelocityConstraints=function(e){var t=this.m_bodyB,n,r,i;n=t.m_xf.R;var s=this.m_localAnchor.x-t.m_sweep.localCenter.x,o=this.m_localAnchor.y-t.m_sweep.localCenter.y;r=n.col1.x*s+n.col2.x*o,o=n.col1.y*s+n.col2.y*o,s=r,r=t.m_linearVelocity.x+ -t.m_angularVelocity*o;var u=t.m_linearVelocity.y+t.m_angularVelocity*s;n=this.m_mass,r=r+this.m_beta*this.m_C.x+this.m_gamma*this.m_impulse.x,i=u+this.m_beta*this.m_C.y+this.m_gamma*this.m_impulse.y,u=-(n.col1.x*r+n.col2.x*i),i=-(n.col1.y*r+n.col2.y*i),n=this.m_impulse.x,r=this.m_impulse.y,this.m_impulse.x+=u,this.m_impulse.y+=i,e=e.dt*this.m_maxForce,this.m_impulse.LengthSquared()>e*e&&this.m_impulse.Multiply(e/this.m_impulse.Length()),u=this.m_impulse.x-n,i=this.m_impulse.y-r,t.m_linearVelocity.x+=t.m_invMass*u,t.m_linearVelocity.y+=t.m_invMass*i,t.m_angularVelocity+=t.m_invI*(s*i-o*u)},b2MouseJoint.prototype.SolvePositionConstraints=function(){return!0},b2MouseJoint.prototype.GetAnchorA=function(){return this.m_target},b2MouseJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor)},b2MouseJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse.x,e*this.m_impulse.y)},b2MouseJoint.prototype.GetReactionTorque=function(){return 0},b2MouseJoint.prototype.GetTarget=function(){return this.m_target},b2MouseJoint.prototype.SetTarget=function(e){this.m_bodyB.IsAwake()==0&&this.m_bodyB.SetAwake(!0),this.m_target=e},b2MouseJoint.prototype.GetMaxForce=function(){return this.m_maxForce},b2MouseJoint.prototype.SetMaxForce=function(e){this.m_maxForce=e},b2MouseJoint.prototype.GetFrequency=function(){return this.m_frequencyHz},b2MouseJoint.prototype.SetFrequency=function(e){this.m_frequencyHz=e},b2MouseJoint.prototype.GetDampingRatio=function(){return this.m_dampingRatio},b2MouseJoint.prototype.SetDampingRatio=function(e){this.m_dampingRatio=e},b2MouseJoint.prototype.K=new b2Mat22,b2MouseJoint.prototype.K1=new b2Mat22,b2MouseJoint.prototype.K2=new b2Mat22,b2MouseJoint.prototype.m_localAnchor=new b2Vec2,b2MouseJoint.prototype.m_target=new b2Vec2,b2MouseJoint.prototype.m_impulse=new b2Vec2,b2MouseJoint.prototype.m_mass=new b2Mat22,b2MouseJoint.prototype.m_C=new b2Vec2,b2MouseJoint.prototype.m_maxForce=null,b2MouseJoint.prototype.m_frequencyHz=null,b2MouseJoint.prototype.m_dampingRatio=null,b2MouseJoint.prototype.m_beta=null,b2MouseJoint.prototype.m_gamma=null;var b2PrismaticJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PrismaticJointDef.prototype,b2JointDef.prototype),b2PrismaticJointDef.prototype._super=b2JointDef.prototype,b2PrismaticJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_prismaticJoint,this.localAxisA.Set(1,0),this.referenceAngle=0,this.enableLimit=!1,this.upperTranslation=this.lowerTranslation=0,this.enableMotor=!1,this.motorSpeed=this.maxMotorForce=0},b2PrismaticJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2,this.localAxisA=new b2Vec2},b2PrismaticJointDef.prototype.Initialize=function(e,t,n,r){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.localAxisA=this.bodyA.GetLocalVector(r),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2PrismaticJointDef.prototype.localAnchorA=new b2Vec2,b2PrismaticJointDef.prototype.localAnchorB=new b2Vec2,b2PrismaticJointDef.prototype.localAxisA=new b2Vec2,b2PrismaticJointDef.prototype.referenceAngle=null,b2PrismaticJointDef.prototype.enableLimit=null,b2PrismaticJointDef.prototype.lowerTranslation=null,b2PrismaticJointDef.prototype.upperTranslation=null,b2PrismaticJointDef.prototype.enableMotor=null,b2PrismaticJointDef.prototype.maxMotorForce=null,b2PrismaticJointDef.prototype.motorSpeed=null;var b2TimeOfImpact=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TimeOfImpact.prototype.__constructor=function(){},b2TimeOfImpact.prototype.__varz=function(){},b2TimeOfImpact.TimeOfImpact=function(e){++b2TimeOfImpact.b2_toiCalls;var t=e.proxyA,n=e.proxyB,r=e.sweepA,i=e.sweepB;b2Settings.b2Assert(r.t0==i.t0),b2Settings.b2Assert(1-r.t0>Number.MIN_VALUE);var s=t.m_radius+n.m_radius;e=e.tolerance;var o=0,u=0,a=0;b2TimeOfImpact.s_cache.count=0;for(b2TimeOfImpact.s_distanceInput.useRadii=!1;;){r.GetTransform(b2TimeOfImpact.s_xfA,o),i.GetTransform(b2TimeOfImpact.s_xfB,o),b2TimeOfImpact.s_distanceInput.proxyA=t,b2TimeOfImpact.s_distanceInput.proxyB=n,b2TimeOfImpact.s_distanceInput.transformA=b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_distanceInput.transformB=b2TimeOfImpact.s_xfB,b2Distance.Distance(b2TimeOfImpact.s_distanceOutput,b2TimeOfImpact.s_cache,b2TimeOfImpact.s_distanceInput);if(b2TimeOfImpact.s_distanceOutput.distance<=0){o=1;break}b2TimeOfImpact.s_fcn.Initialize(b2TimeOfImpact.s_cache,t,b2TimeOfImpact.s_xfA,n,b2TimeOfImpact.s_xfB);var f=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(f<=0){o=1;break}u==0&&(a=f>s?b2Math.Max(s-e,.75*s):b2Math.Max(f-e,.02*s));if(f-a<.5*e){if(u==0){o=1;break}break}var l=o,c=o,h=1;f=f,r.GetTransform(b2TimeOfImpact.s_xfA,h),i.GetTransform(b2TimeOfImpact.s_xfB,h);var p=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(p>=a){o=1;break}for(var d=0;;){var v;v=d&1?c+(a-f)*(h-c)/(p-f):.5*(c+h),r.GetTransform(b2TimeOfImpact.s_xfA,v),i.GetTransform(b2TimeOfImpact.s_xfB,v);var m=b2TimeOfImpact.s_fcn.Evaluate(b2TimeOfImpact.s_xfA,b2TimeOfImpact.s_xfB);if(b2Math.Abs(m-a)<.025*e){l=v;break}m>a?(c=v,f=m):(h=v,p=m),++d,++b2TimeOfImpact.b2_toiRootIters;if(d==50)break}b2TimeOfImpact.b2_toiMaxRootIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxRootIters,d);if(l<(1+100*Number.MIN_VALUE)*o)break;o=l,u++,++b2TimeOfImpact.b2_toiIters;if(u==1e3)break}return b2TimeOfImpact.b2_toiMaxIters=b2Math.Max(b2TimeOfImpact.b2_toiMaxIters,u),o},b2TimeOfImpact.b2_toiCalls=0,b2TimeOfImpact.b2_toiIters=0,b2TimeOfImpact.b2_toiMaxIters=0,b2TimeOfImpact.b2_toiRootIters=0,b2TimeOfImpact.b2_toiMaxRootIters=0,b2TimeOfImpact.s_cache=new b2SimplexCache,b2TimeOfImpact.s_distanceInput=new b2DistanceInput,b2TimeOfImpact.s_xfA=new b2Transform,b2TimeOfImpact.s_xfB=new b2Transform,b2TimeOfImpact.s_fcn=new b2SeparationFunction,b2TimeOfImpact.s_distanceOutput=new b2DistanceOutput;var b2GearJoint=function(){b2Joint.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2GearJoint.prototype,b2Joint.prototype),b2GearJoint.prototype._super=b2Joint.prototype,b2GearJoint.prototype.__constructor=function(e){this._super.__constructor.apply(this,[e]);var t=e.joint1.m_type,n=e.joint2.m_type;this.m_prismatic2=this.m_revolute2=this.m_prismatic1=this.m_revolute1=null,this.m_ground1=e.joint1.GetBodyA(),this.m_bodyA=e.joint1.GetBodyB(),t==b2Joint.e_revoluteJoint?(this.m_revolute1=e.joint1,this.m_groundAnchor1.SetV(this.m_revolute1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_revolute1.m_localAnchor2),t=this.m_revolute1.GetJointAngle()):(this.m_prismatic1=e.joint1,this.m_groundAnchor1.SetV(this.m_prismatic1.m_localAnchor1),this.m_localAnchor1.SetV(this.m_prismatic1.m_localAnchor2),t=this.m_prismatic1.GetJointTranslation()),this.m_ground2=e.joint2.GetBodyA(),this.m_bodyB=e.joint2.GetBodyB(),n==b2Joint.e_revoluteJoint?(this.m_revolute2=e.joint2,this.m_groundAnchor2.SetV(this.m_revolute2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_revolute2.m_localAnchor2),n=this.m_revolute2.GetJointAngle()):(this.m_prismatic2=e.joint2,this.m_groundAnchor2.SetV(this.m_prismatic2.m_localAnchor1),this.m_localAnchor2.SetV(this.m_prismatic2.m_localAnchor2),n=this.m_prismatic2.GetJointTranslation()),this.m_ratio=e.ratio,this.m_constant=t+this.m_ratio*n,this.m_impulse=0},b2GearJoint.prototype.__varz=function(){this.m_groundAnchor1=new b2Vec2,this.m_groundAnchor2=new b2Vec2,this.m_localAnchor1=new b2Vec2,this.m_localAnchor2=new b2Vec2,this.m_J=new b2Jacobian},b2GearJoint.prototype.InitVelocityConstraints=function(e){var t=this.m_ground1,n=this.m_ground2,r=this.m_bodyA,i=this.m_bodyB,s,o,u,a,f,l=0;this.m_J.SetZero(),this.m_revolute1?(this.m_J.angularA=-1,l+=r.m_invI):(a=t.m_xf.R,s=this.m_prismatic1.m_localXAxis1,t=a.col1.x*s.x+a.col2.x*s.y,s=a.col1.y*s.x+a.col2.y*s.y,a=r.m_xf.R,o=this.m_localAnchor1.x-r.m_sweep.localCenter.x,u=this.m_localAnchor1.y-r.m_sweep.localCenter.y,f=a.col1.x*o+a.col2.x*u,u=a.col1.y*o+a.col2.y*u,o=f,a=o*s-u*t,this.m_J.linearA.Set(-t,-s),this.m_J.angularA=-a,l+=r.m_invMass+r.m_invI*a*a),this.m_revolute2?(this.m_J.angularB=-this.m_ratio,l+=this.m_ratio*this.m_ratio*i.m_invI):(a=n.m_xf.R,s=this.m_prismatic2.m_localXAxis1,t=a.col1.x*s.x+a.col2.x*s.y,s=a.col1.y*s.x+a.col2.y*s.y,a=i.m_xf.R,o=this.m_localAnchor2.x-i.m_sweep.localCenter.x,u=this.m_localAnchor2.y-i.m_sweep.localCenter.y,f=a.col1.x*o+a.col2.x*u,u=a.col1.y*o+a.col2.y*u,o=f,a=o*s-u*t,this.m_J.linearB.Set(-this.m_ratio*t,-this.m_ratio*s),this.m_J.angularB=-this.m_ratio*a,l+=this.m_ratio*this.m_ratio*(i.m_invMass+i.m_invI*a*a)),this.m_mass=l>0?1/l:0,e.warmStarting?(r.m_linearVelocity.x+=r.m_invMass*this.m_impulse*this.m_J.linearA.x,r.m_linearVelocity.y+=r.m_invMass*this.m_impulse*this.m_J.linearA.y,r.m_angularVelocity+=r.m_invI*this.m_impulse*this.m_J.angularA,i.m_linearVelocity.x+=i.m_invMass*this.m_impulse*this.m_J.linearB.x,i.m_linearVelocity.y+=i.m_invMass*this.m_impulse*this.m_J.linearB.y,i.m_angularVelocity+=i.m_invI*this.m_impulse*this.m_J.angularB):this.m_impulse=0},b2GearJoint.prototype.SolveVelocityConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n=-this.m_mass*this.m_J.Compute(e.m_linearVelocity,e.m_angularVelocity,t.m_linearVelocity,t.m_angularVelocity);this.m_impulse+=n,e.m_linearVelocity.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_linearVelocity.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_angularVelocity+=e.m_invI*n*this.m_J.angularA,t.m_linearVelocity.x+=t.m_invMass*n*this.m_J.linearB.x,t.m_linearVelocity.y+=t.m_invMass*n*this.m_J.linearB.y,t.m_angularVelocity+=t.m_invI*n*this.m_J.angularB},b2GearJoint.prototype.SolvePositionConstraints=function(){var e=this.m_bodyA,t=this.m_bodyB,n,r;return n=this.m_revolute1?this.m_revolute1.GetJointAngle():this.m_prismatic1.GetJointTranslation(),r=this.m_revolute2?this.m_revolute2.GetJointAngle():this.m_prismatic2.GetJointTranslation(),n=-this.m_mass*(this.m_constant-(n+this.m_ratio*r)),e.m_sweep.c.x+=e.m_invMass*n*this.m_J.linearA.x,e.m_sweep.c.y+=e.m_invMass*n*this.m_J.linearA.y,e.m_sweep.a+=e.m_invI*n*this.m_J.angularA,t.m_sweep.c.x+=t.m_invMass*n*this.m_J.linearB.x,t.m_sweep.c.y+=t.m_invMass*n*this.m_J.linearB.y,t.m_sweep.a+=t.m_invI*n*this.m_J.angularB,e.SynchronizeTransform(),t.SynchronizeTransform(),0<b2Settings.b2_linearSlop},b2GearJoint.prototype.GetAnchorA=function(){return this.m_bodyA.GetWorldPoint(this.m_localAnchor1)},b2GearJoint.prototype.GetAnchorB=function(){return this.m_bodyB.GetWorldPoint(this.m_localAnchor2)},b2GearJoint.prototype.GetReactionForce=function(e){return new b2Vec2(e*this.m_impulse*this.m_J.linearB.x,e*this.m_impulse*this.m_J.linearB.y)},b2GearJoint.prototype.GetReactionTorque=function(e){var t=this.m_bodyB.m_xf.R,n=this.m_localAnchor1.x-this.m_bodyB.m_sweep.localCenter.x,r=this.m_localAnchor1.y-this.m_bodyB.m_sweep.localCenter.y,i=t.col1.x*n+t.col2.x*r;return r=t.col1.y*n+t.col2.y*r,n=i,e*(this.m_impulse*this.m_J.angularB-n*this.m_impulse*this.m_J.linearB.y+r*this.m_impulse*this.m_J.linearB.x)},b2GearJoint.prototype.GetRatio=function(){return this.m_ratio},b2GearJoint.prototype.SetRatio=function(e){this.m_ratio=e},b2GearJoint.prototype.m_ground1=null,b2GearJoint.prototype.m_ground2=null,b2GearJoint.prototype.m_revolute1=null,b2GearJoint.prototype.m_prismatic1=null,b2GearJoint.prototype.m_revolute2=null,b2GearJoint.prototype.m_prismatic2=null,b2GearJoint.prototype.m_groundAnchor1=new b2Vec2,b2GearJoint.prototype.m_groundAnchor2=new b2Vec2,b2GearJoint.prototype.m_localAnchor1=new b2Vec2,b2GearJoint.prototype.m_localAnchor2=new b2Vec2,b2GearJoint.prototype.m_J=new b2Jacobian,b2GearJoint.prototype.m_constant=null,b2GearJoint.prototype.m_ratio=null,b2GearJoint.prototype.m_mass=null,b2GearJoint.prototype.m_impulse=null;var b2TOIInput=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2TOIInput.prototype.__constructor=function(){},b2TOIInput.prototype.__varz=function(){this.proxyA=new b2DistanceProxy,this.proxyB=new b2DistanceProxy,this.sweepA=new b2Sweep,this.sweepB=new b2Sweep},b2TOIInput.prototype.proxyA=new b2DistanceProxy,b2TOIInput.prototype.proxyB=new b2DistanceProxy,b2TOIInput.prototype.sweepA=new b2Sweep,b2TOIInput.prototype.sweepB=new b2Sweep,b2TOIInput.prototype.tolerance=null;var b2RevoluteJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2RevoluteJointDef.prototype,b2JointDef.prototype),b2RevoluteJointDef.prototype._super=b2JointDef.prototype,b2RevoluteJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_revoluteJoint,this.localAnchorA.Set(0,0),this.localAnchorB.Set(0,0),this.motorSpeed=this.maxMotorTorque=this.upperAngle=this.lowerAngle=this.referenceAngle=0,this.enableMotor=this.enableLimit=!1},b2RevoluteJointDef.prototype.__varz=function(){this.localAnchorA=new b2Vec2,this.localAnchorB=new b2Vec2},b2RevoluteJointDef.prototype.Initialize=function(e,t,n){this.bodyA=e,this.bodyB=t,this.localAnchorA=this.bodyA.GetLocalPoint(n),this.localAnchorB=this.bodyB.GetLocalPoint(n),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},b2RevoluteJointDef.prototype.localAnchorA=new b2Vec2,b2RevoluteJointDef.prototype.localAnchorB=new b2Vec2,b2RevoluteJointDef.prototype.referenceAngle=null,b2RevoluteJointDef.prototype.enableLimit=null,b2RevoluteJointDef.prototype.lowerAngle=null,b2RevoluteJointDef.prototype.upperAngle=null,b2RevoluteJointDef.prototype.enableMotor=null,b2RevoluteJointDef.prototype.motorSpeed=null,b2RevoluteJointDef.prototype.maxMotorTorque=null;var b2MouseJointDef=function(){b2JointDef.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2MouseJointDef.prototype,b2JointDef.prototype),b2MouseJointDef.prototype._super=b2JointDef.prototype,b2MouseJointDef.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments),this.type=b2Joint.e_mouseJoint,this.maxForce=0,this.frequencyHz=5,this.dampingRatio=.7},b2MouseJointDef.prototype.__varz=function(){this.target=new b2Vec2},b2MouseJointDef.prototype.target=new b2Vec2,b2MouseJointDef.prototype.maxForce=null,b2MouseJointDef.prototype.frequencyHz=null,b2MouseJointDef.prototype.dampingRatio=null;var b2Contact=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Contact.prototype.__constructor=function(){},b2Contact.prototype.__varz=function(){this.m_nodeA=new b2ContactEdge,this.m_nodeB=new b2ContactEdge,this.m_manifold=new b2Manifold,this.m_oldManifold=new b2Manifold},b2Contact.s_input=new b2TOIInput,b2Contact.e_sensorFlag=1,b2Contact.e_continuousFlag=2,b2Contact.e_islandFlag=4,b2Contact.e_toiFlag=8,b2Contact.e_touchingFlag=16,b2Contact.e_enabledFlag=32,b2Contact.e_filterFlag=64,b2Contact.prototype.Reset=function(e,t){this.m_flags=b2Contact.e_enabledFlag;if(!e||!t)this.m_fixtureB=this.m_fixtureA=null;else{if(e.IsSensor()||t.IsSensor())this.m_flags|=b2Contact.e_sensorFlag;var n=e.GetBody(),r=t.GetBody();if(n.GetType()!=b2Body.b2_dynamicBody||n.IsBullet()||r.GetType()!=b2Body.b2_dynamicBody||r.IsBullet())this.m_flags|=b2Contact.e_continuousFlag;this.m_fixtureA=e,this.m_fixtureB=t,this.m_manifold.m_pointCount=0,this.m_next=this.m_prev=null,this.m_nodeA.contact=null,this.m_nodeA.prev=null,this.m_nodeA.next=null,this.m_nodeA.other=null,this.m_nodeB.contact=null,this.m_nodeB.prev=null,this.m_nodeB.next=null,this.m_nodeB.other=null}},b2Contact.prototype.Update=function(e){var t=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=t,this.m_flags|=b2Contact.e_enabledFlag;var n=!1;t=(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag;var r=this.m_fixtureA.m_body,i=this.m_fixtureB.m_body,s=this.m_fixtureA.m_aabb.TestOverlap(this.m_fixtureB.m_aabb);if(this.m_flags&b2Contact.e_sensorFlag)s&&(n=this.m_fixtureA.GetShape(),s=this.m_fixtureB.GetShape(),r=r.GetTransform(),i=i.GetTransform(),n=b2Shape.TestOverlap(n,r,s,i)),this.m_manifold.m_pointCount=0;else{r.GetType()!=b2Body.b2_dynamicBody||r.IsBullet()||i.GetType()!=b2Body.b2_dynamicBody||i.IsBullet()?this.m_flags|=b2Contact.e_continuousFlag:this.m_flags&=~b2Contact.e_continuousFlag;if(s){this.Evaluate(),n=this.m_manifold.m_pointCount>0;for(s=0;s<this.m_manifold.m_pointCount;++s){var o=this.m_manifold.m_points[s];o.m_normalImpulse=0,o.m_tangentImpulse=0;for(var u=o.m_id,a=0;a<this.m_oldManifold.m_pointCount;++a){var f=this.m_oldManifold.m_points[a];if(f.m_id.key==u.key){o.m_normalImpulse=f.m_normalImpulse,o.m_tangentImpulse=f.m_tangentImpulse;break}}}}else this.m_manifold.m_pointCount=0;n!=t&&(r.SetAwake(!0),i.SetAwake(!0))}n?this.m_flags|=b2Contact.e_touchingFlag:this.m_flags&=~b2Contact.e_touchingFlag,t==0&&n==1&&e.BeginContact(this),t==1&&n==0&&e.EndContact(this),(this.m_flags&b2Contact.e_sensorFlag)==0&&e.PreSolve(this,this.m_oldManifold)},b2Contact.prototype.Evaluate=function(){},b2Contact.prototype.ComputeTOI=function(e,t){return b2Contact.s_input.proxyA.Set(this.m_fixtureA.GetShape()),b2Contact.s_input.proxyB.Set(this.m_fixtureB.GetShape()),b2Contact.s_input.sweepA=e,b2Contact.s_input.sweepB=t,b2Contact.s_input.tolerance=b2Settings.b2_linearSlop,b2TimeOfImpact.TimeOfImpact(b2Contact.s_input)},b2Contact.prototype.GetManifold=function(){return this.m_manifold},b2Contact.prototype.GetWorldManifold=function(e){var t=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),r=this.m_fixtureA.GetShape(),i=this.m_fixtureB.GetShape();e.Initialize(this.m_manifold,t.GetTransform(),r.m_radius,n.GetTransform(),i.m_radius)},b2Contact.prototype.IsTouching=function(){return(this.m_flags&b2Contact.e_touchingFlag)==b2Contact.e_touchingFlag},b2Contact.prototype.IsContinuous=function(){return(this.m_flags&b2Contact.e_continuousFlag)==b2Contact.e_continuousFlag},b2Contact.prototype.SetSensor=function(e){e?this.m_flags|=b2Contact.e_sensorFlag:this.m_flags&=~b2Contact.e_sensorFlag},b2Contact.prototype.IsSensor=function(){return(this.m_flags&b2Contact.e_sensorFlag)==b2Contact.e_sensorFlag},b2Contact.prototype.SetEnabled=function(e){e?this.m_flags|=b2Contact.e_enabledFlag:this.m_flags&=~b2Contact.e_enabledFlag},b2Contact.prototype.IsEnabled=function(){return(this.m_flags&b2Contact.e_enabledFlag)==b2Contact.e_enabledFlag},b2Contact.prototype.GetNext=function(){return this.m_next},b2Contact.prototype.GetFixtureA=function(){return this.m_fixtureA},b2Contact.prototype.GetFixtureB=function(){return this.m_fixtureB},b2Contact.prototype.FlagForFiltering=function(){this.m_flags|=b2Contact.e_filterFlag},b2Contact.prototype.m_flags=0,b2Contact.prototype.m_prev=null,b2Contact.prototype.m_next=null,b2Contact.prototype.m_nodeA=new b2ContactEdge,b2Contact.prototype.m_nodeB=new b2ContactEdge,b2Contact.prototype.m_fixtureA=null,b2Contact.prototype.m_fixtureB=null,b2Contact.prototype.m_manifold=new b2Manifold,b2Contact.prototype.m_oldManifold=new b2Manifold,b2Contact.prototype.m_toi=null;var b2ContactConstraint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactConstraint.prototype.__constructor=function(){this.points=Array(b2Settings.b2_maxManifoldPoints);for(var e=0;e<b2Settings.b2_maxManifoldPoints;e++)this.points[e]=new b2ContactConstraintPoint},b2ContactConstraint.prototype.__varz=function(){this.localPlaneNormal=new b2Vec2,this.localPoint=new b2Vec2,this.normal=new b2Vec2,this.normalMass=new b2Mat22,this.K=new b2Mat22},b2ContactConstraint.prototype.points=null,b2ContactConstraint.prototype.localPlaneNormal=new b2Vec2,b2ContactConstraint.prototype.localPoint=new b2Vec2,b2ContactConstraint.prototype.normal=new b2Vec2,b2ContactConstraint.prototype.normalMass=new b2Mat22,b2ContactConstraint.prototype.K=new b2Mat22,b2ContactConstraint.prototype.bodyA=null,b2ContactConstraint.prototype.bodyB=null,b2ContactConstraint.prototype.type=0,b2ContactConstraint.prototype.radius=null,b2ContactConstraint.prototype.friction=null,b2ContactConstraint.prototype.restitution=null,b2ContactConstraint.prototype.pointCount=0,b2ContactConstraint.prototype.manifold=null;var b2ContactResult=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactResult.prototype.__constructor=function(){},b2ContactResult.prototype.__varz=function(){this.position=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactResult.prototype.shape1=null,b2ContactResult.prototype.shape2=null,b2ContactResult.prototype.position=new b2Vec2,b2ContactResult.prototype.normal=new b2Vec2,b2ContactResult.prototype.normalImpulse=null,b2ContactResult.prototype.tangentImpulse=null,b2ContactResult.prototype.id=new b2ContactID;var b2PolygonContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolygonContact.prototype,b2Contact.prototype),b2PolygonContact.prototype._super=b2Contact.prototype,b2PolygonContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolygonContact.prototype.__varz=function(){},b2PolygonContact.Create=function(){return new b2PolygonContact},b2PolygonContact.Destroy=function(){},b2PolygonContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();b2Collision.CollidePolygons(this.m_manifold,this.m_fixtureA.GetShape(),e.m_xf,this.m_fixtureB.GetShape(),t.m_xf)},b2PolygonContact.prototype.Reset=function(e,t){this._super.Reset.apply(this,[e,t])};var ClipVertex=function(){this.__varz(),this.__constructor.apply(this,arguments)};ClipVertex.prototype.__constructor=function(){},ClipVertex.prototype.__varz=function(){this.v=new b2Vec2,this.id=new b2ContactID},ClipVertex.prototype.Set=function(e){this.v.SetV(e.v),this.id.Set(e.id)},ClipVertex.prototype.v=new b2Vec2,ClipVertex.prototype.id=new b2ContactID;var b2ContactFilter=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactFilter.prototype.__constructor=function(){},b2ContactFilter.prototype.__varz=function(){},b2ContactFilter.b2_defaultFilter=new b2ContactFilter,b2ContactFilter.prototype.ShouldCollide=function(e,t){var n=e.GetFilterData(),r=t.GetFilterData();return n.groupIndex==r.groupIndex&&n.groupIndex!=0?n.groupIndex>0:(n.maskBits&r.categoryBits)!=0&&(n.categoryBits&r.maskBits)!=0},b2ContactFilter.prototype.RayCollide=function(e,t){return e?this.ShouldCollide(e,t):!0};var b2NullContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2NullContact.prototype,b2Contact.prototype),b2NullContact.prototype._super=b2Contact.prototype,b2NullContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2NullContact.prototype.__varz=function(){},b2NullContact.prototype.Evaluate=function(){};var b2ContactListener=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactListener.prototype.__constructor=function(){},b2ContactListener.prototype.__varz=function(){},b2ContactListener.b2_defaultListener=new b2ContactListener,b2ContactListener.prototype.BeginContact=function(){},b2ContactListener.prototype.EndContact=function(){},b2ContactListener.prototype.PreSolve=function(){},b2ContactListener.prototype.PostSolve=function(){};var b2Island=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Island.prototype.__constructor=function(){this.m_bodies=[],this.m_contacts=[],this.m_joints=[]},b2Island.prototype.__varz=function(){},b2Island.s_impulse=new b2ContactImpulse,b2Island.prototype.Initialize=function(e,t,n,r,i,s){var o=0;this.m_bodyCapacity=e,this.m_contactCapacity=t,this.m_jointCapacity=n,this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,this.m_allocator=r,this.m_listener=i,this.m_contactSolver=s;for(o=this.m_bodies.length;o<e;o++)this.m_bodies[o]=null;for(o=this.m_contacts.length;o<t;o++)this.m_contacts[o]=null;for(o=this.m_joints.length;o<n;o++)this.m_joints[o]=null},b2Island.prototype.Clear=function(){this.m_jointCount=this.m_contactCount=this.m_bodyCount=0},b2Island.prototype.Solve=function(e,t,n){var r=0,i=0,s;for(r=0;r<this.m_bodyCount;++r)i=this.m_bodies[r],i.GetType()==b2Body.b2_dynamicBody&&(i.m_linearVelocity.x+=e.dt*(t.x+i.m_invMass*i.m_force.x),i.m_linearVelocity.y+=e.dt*(t.y+i.m_invMass*i.m_force.y),i.m_angularVelocity+=e.dt*i.m_invI*i.m_torque,i.m_linearVelocity.Multiply(b2Math.Clamp(1-e.dt*i.m_linearDamping,0,1)),i.m_angularVelocity*=b2Math.Clamp(1-e.dt*i.m_angularDamping,0,1));this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator),t=this.m_contactSolver,t.InitVelocityConstraints(e);for(r=0;r<this.m_jointCount;++r)s=this.m_joints[r],s.InitVelocityConstraints(e);for(r=0;r<e.velocityIterations;++r){for(i=0;i<this.m_jointCount;++i)s=this.m_joints[i],s.SolveVelocityConstraints(e);t.SolveVelocityConstraints()}for(r=0;r<this.m_jointCount;++r)s=this.m_joints[r],s.FinalizeVelocityConstraints();t.FinalizeVelocityConstraints();for(r=0;r<this.m_bodyCount;++r){i=this.m_bodies[r];if(i.GetType()!=b2Body.b2_staticBody){var o=e.dt*i.m_linearVelocity.x,u=e.dt*i.m_linearVelocity.y;o*o+u*u>b2Settings.b2_maxTranslationSquared&&(i.m_linearVelocity.Normalize(),i.m_linearVelocity.x*=b2Settings.b2_maxTranslation*e.inv_dt,i.m_linearVelocity.y*=b2Settings.b2_maxTranslation*e.inv_dt),o=e.dt*i.m_angularVelocity,o*o>b2Settings.b2_maxRotationSquared&&(i.m_angularVelocity=i.m_angularVelocity<0?-b2Settings.b2_maxRotation*e.inv_dt:b2Settings.b2_maxRotation*e.inv_dt),i.m_sweep.c0.SetV(i.m_sweep.c),i.m_sweep.a0=i.m_sweep.a,i.m_sweep.c.x+=e.dt*i.m_linearVelocity.x,i.m_sweep.c.y+=e.dt*i.m_linearVelocity.y,i.m_sweep.a+=e.dt*i.m_angularVelocity,i.SynchronizeTransform()}}for(r=0;r<e.positionIterations;++r){o=t.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),u=!0;for(i=0;i<this.m_jointCount;++i)s=this.m_joints[i],s=s.SolvePositionConstraints(b2Settings.b2_contactBaumgarte),u=u&&s;if(o&&u)break}this.Report(t.m_constraints);if(n){n=Number.MAX_VALUE,t=b2Settings.b2_linearSleepTolerance*b2Settings.b2_linearSleepTolerance,o=b2Settings.b2_angularSleepTolerance*b2Settings.b2_angularSleepTolerance;for(r=0;r<this.m_bodyCount;++r)i=this.m_bodies[r],i.GetType()!=b2Body.b2_staticBody&&((i.m_flags&b2Body.e_allowSleepFlag)==0&&(n=i.m_sleepTime=0),(i.m_flags&b2Body.e_allowSleepFlag)==0||i.m_angularVelocity*i.m_angularVelocity>o||b2Math.Dot(i.m_linearVelocity,i.m_linearVelocity)>t?n=i.m_sleepTime=0:(i.m_sleepTime+=e.dt,n=b2Math.Min(n,i.m_sleepTime)));if(n>=b2Settings.b2_timeToSleep)for(r=0;r<this.m_bodyCount;++r)i=this.m_bodies[r],i.SetAwake(!1)}},b2Island.prototype.SolveTOI=function(e){var t=0,n=0;this.m_contactSolver.Initialize(e,this.m_contacts,this.m_contactCount,this.m_allocator);var r=this.m_contactSolver;for(t=0;t<this.m_jointCount;++t)this.m_joints[t].InitVelocityConstraints(e);for(t=0;t<e.velocityIterations;++t){r.SolveVelocityConstraints();for(n=0;n<this.m_jointCount;++n)this.m_joints[n].SolveVelocityConstraints(e)}for(t=0;t<this.m_bodyCount;++t){n=this.m_bodies[t];if(n.GetType()!=b2Body.b2_staticBody){var i=e.dt*n.m_linearVelocity.x,s=e.dt*n.m_linearVelocity.y;i*i+s*s>b2Settings.b2_maxTranslationSquared&&(n.m_linearVelocity.Normalize(),n.m_linearVelocity.x*=b2Settings.b2_maxTranslation*e.inv_dt,n.m_linearVelocity.y*=b2Settings.b2_maxTranslation*e.inv_dt),i=e.dt*n.m_angularVelocity,i*i>b2Settings.b2_maxRotationSquared&&(n.m_angularVelocity=n.m_angularVelocity<0?-b2Settings.b2_maxRotation*e.inv_dt:b2Settings.b2_maxRotation*e.inv_dt),n.m_sweep.c0.SetV(n.m_sweep.c),n.m_sweep.a0=n.m_sweep.a,n.m_sweep.c.x+=e.dt*n.m_linearVelocity.x,n.m_sweep.c.y+=e.dt*n.m_linearVelocity.y,n.m_sweep.a+=e.dt*n.m_angularVelocity,n.SynchronizeTransform()}}for(t=0;t<e.positionIterations;++t){i=r.SolvePositionConstraints(.75),s=!0;for(n=0;n<this.m_jointCount;++n){var o=this.m_joints[n].SolvePositionConstraints(b2Settings.b2_contactBaumgarte);s=s&&o}if(i&&s)break}this.Report(r.m_constraints)},b2Island.prototype.Report=function(e){if(this.m_listener!=null)for(var t=0;t<this.m_contactCount;++t){for(var n=this.m_contacts[t],r=e[t],i=0;i<r.pointCount;++i)b2Island.s_impulse.normalImpulses[i]=r.points[i].normalImpulse,b2Island.s_impulse.tangentImpulses[i]=r.points[i].tangentImpulse;this.m_listener.PostSolve(n,b2Island.s_impulse)}},b2Island.prototype.AddBody=function(e){e.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=e},b2Island.prototype.AddContact=function(e){this.m_contacts[this.m_contactCount++]=e},b2Island.prototype.AddJoint=function(e){this.m_joints[this.m_jointCount++]=e},b2Island.prototype.m_allocator=null,b2Island.prototype.m_listener=null,b2Island.prototype.m_contactSolver=null,b2Island.prototype.m_bodies=null,b2Island.prototype.m_contacts=null,b2Island.prototype.m_joints=null,b2Island.prototype.m_bodyCount=0,b2Island.prototype.m_jointCount=0,b2Island.prototype.m_contactCount=0,b2Island.prototype.m_bodyCapacity=0,b2Island.prototype.m_contactCapacity=0,b2Island.prototype.m_jointCapacity=0;var b2PolyAndEdgeContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolyAndEdgeContact.prototype,b2Contact.prototype),b2PolyAndEdgeContact.prototype._super=b2Contact.prototype,b2PolyAndEdgeContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolyAndEdgeContact.prototype.__varz=function(){},b2PolyAndEdgeContact.Create=function(){return new b2PolyAndEdgeContact},b2PolyAndEdgeContact.Destroy=function(){},b2PolyAndEdgeContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollidePolyAndEdge(this.m_manifold,this.m_fixtureA.GetShape(),e.m_xf,this.m_fixtureB.GetShape(),t.m_xf)},b2PolyAndEdgeContact.prototype.b2CollidePolyAndEdge=function(){},b2PolyAndEdgeContact.prototype.Reset=function(e,t){this._super.Reset.apply(this,[e,t]),b2Settings.b2Assert(e.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(t.GetType()==b2Shape.e_edgeShape)};var b2Collision=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2Collision.prototype.__constructor=function(){},b2Collision.prototype.__varz=function(){},b2Collision.MakeClipPointVector=function(){var e=Array(2);return e[0]=new ClipVertex,e[1]=new ClipVertex,e},b2Collision.ClipSegmentToLine=function(e,t,n,r){var i,s=0;i=t[0];var o=i.v;i=t[1];var u=i.v,a=n.x*o.x+n.y*o.y-r;return i=n.x*u.x+n.y*u.y-r,a<=0&&e[s++].Set(t[0]),i<=0&&e[s++].Set(t[1]),a*i<0&&(n=a/(a-i),i=e[s],i=i.v,i.x=o.x+n*(u.x-o.x),i.y=o.y+n*(u.y-o.y),i=e[s],i.id=(a>0?t[0]:t[1]).id,++s),s},b2Collision.EdgeSeparation=function(e,t,n,r,i){var s=e.m_vertices;e=e.m_normals;var o=r.m_vertexCount,u=r.m_vertices,a,f;a=t.R,f=e[n],e=a.col1.x*f.x+a.col2.x*f.y,r=a.col1.y*f.x+a.col2.y*f.y,a=i.R;var l=a.col1.x*e+a.col1.y*r;a=a.col2.x*e+a.col2.y*r;for(var c=0,h=Number.MAX_VALUE,p=0;p<o;++p)f=u[p],f=f.x*l+f.y*a,f<h&&(h=f,c=p);return f=s[n],a=t.R,n=t.position.x+(a.col1.x*f.x+a.col2.x*f.y),t=t.position.y+(a.col1.y*f.x+a.col2.y*f.y),f=u[c],a=i.R,s=i.position.x+(a.col1.x*f.x+a.col2.x*f.y),i=i.position.y+(a.col1.y*f.x+a.col2.y*f.y),s-=n,i-=t,s*e+i*r},b2Collision.FindMaxSeparation=function(e,t,n,r,i){var s=t.m_vertexCount,o=t.m_normals,u,a;a=i.R,u=r.m_centroid;var f=i.position.x+(a.col1.x*u.x+a.col2.x*u.y),l=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);a=n.R,u=t.m_centroid,f-=n.position.x+(a.col1.x*u.x+a.col2.x*u.y),l-=n.position.y+(a.col1.y*u.x+a.col2.y*u.y),a=f*n.R.col1.x+l*n.R.col1.y,l=f*n.R.col2.x+l*n.R.col2.y,f=0;for(var c=-Number.MAX_VALUE,h=0;h<s;++h)u=o[h],u=u.x*a+u.y*l,u>c&&(c=u,f=h);o=b2Collision.EdgeSeparation(t,n,f,r,i),l=f-1>=0?f-1:s-1,c=b2Collision.EdgeSeparation(t,n,l,r,i),h=f+1<s?f+1:0;var p=b2Collision.EdgeSeparation(t,n,h,r,i);a=u=0;if(c>o&&c>p)a=-1,u=l,l=c;else{if(!(p>o))return e[0]=f,o;a=1,u=h,l=p}for(;;){f=a==-1?u-1>=0?u-1:s-1:u+1<s?u+1:0,o=b2Collision.EdgeSeparation(t,n,f,r,i);if(!(o>l))break;u=f,l=o}return e[0]=u,l},b2Collision.FindIncidentEdge=function(e,t,n,r,i,s){var o=t.m_normals,u=i.m_vertexCount;t=i.m_vertices,i=i.m_normals;var a;a=n.R,n=o[r],o=a.col1.x*n.x+a.col2.x*n.y;var f=a.col1.y*n.x+a.col2.y*n.y;a=s.R,n=a.col1.x*o+a.col1.y*f,f=a.col2.x*o+a.col2.y*f,o=n,a=0;for(var l=Number.MAX_VALUE,c=0;c<u;++c)n=i[c],n=o*n.x+f*n.y,n<l&&(l=n,a=c);i=a,o=i+1<u?i+1:0,u=e[0],n=t[i],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=i,u.id.features.incidentVertex=0,u=e[1],n=t[o],a=s.R,u.v.x=s.position.x+(a.col1.x*n.x+a.col2.x*n.y),u.v.y=s.position.y+(a.col1.y*n.x+a.col2.y*n.y),u.id.features.referenceEdge=r,u.id.features.incidentEdge=o,u.id.features.incidentVertex=1},b2Collision.CollidePolygons=function(e,t,n,r,i){var s;e.m_pointCount=0;var o=t.m_radius+r.m_radius;s=0,b2Collision.s_edgeAO[0]=s;var u=b2Collision.FindMaxSeparation(b2Collision.s_edgeAO,t,n,r,i);s=b2Collision.s_edgeAO[0];if(!(u>o)){var a=0;b2Collision.s_edgeBO[0]=a;var f=b2Collision.FindMaxSeparation(b2Collision.s_edgeBO,r,i,t,n);a=b2Collision.s_edgeBO[0];if(!(f>o)){var l=0,c=0;f>.98*u+.001?(u=r,r=t,t=i,n=n,l=a,e.m_type=b2Manifold.e_faceB,c=1):(u=t,r=r,t=n,n=i,l=s,e.m_type=b2Manifold.e_faceA,c=0),s=b2Collision.s_incidentEdge,b2Collision.FindIncidentEdge(s,u,t,l,r,n),i=u.m_vertices,a=i[l];var h;h=l+1<u.m_vertexCount?i[parseInt(l+1)]:i[0],l=b2Collision.s_localTangent,l.Set(h.x-a.x,h.y-a.y),l.Normalize(),i=b2Collision.s_localNormal,i.x=l.y,i.y=-l.x,r=b2Collision.s_planePoint,r.Set(.5*(a.x+h.x),.5*(a.y+h.y)),f=b2Collision.s_tangent,u=t.R,f.x=u.col1.x*l.x+u.col2.x*l.y,f.y=u.col1.y*l.x+u.col2.y*l.y;var p=b2Collision.s_tangent2;p.x=-f.x,p.y=-f.y,l=b2Collision.s_normal,l.x=f.y,l.y=-f.x;var d=b2Collision.s_v11,v=b2Collision.s_v12;d.x=t.position.x+(u.col1.x*a.x+u.col2.x*a.y),d.y=t.position.y+(u.col1.y*a.x+u.col2.y*a.y),v.x=t.position.x+(u.col1.x*h.x+u.col2.x*h.y),v.y=t.position.y+(u.col1.y*h.x+u.col2.y*h.y),t=l.x*d.x+l.y*d.y,u=f.x*v.x+f.y*v.y+o,h=b2Collision.s_clipPoints1,a=b2Collision.s_clipPoints2,v=0,v=b2Collision.ClipSegmentToLine(h,s,p,-f.x*d.x-f.y*d.y+o);if(!(v<2)){v=b2Collision.ClipSegmentToLine(a,h,f,u);if(!(v<2)){e.m_localPlaneNormal.SetV(i),e.m_localPoint.SetV(r);for(r=i=0;r<b2Settings.b2_maxManifoldPoints;++r)s=a[r],l.x*s.v.x+l.y*s.v.y-t<=o&&(f=e.m_points[i],u=n.R,p=s.v.x-n.position.x,d=s.v.y-n.position.y,f.m_localPoint.x=p*u.col1.x+d*u.col1.y,f.m_localPoint.y=p*u.col2.x+d*u.col2.y,f.m_id.Set(s.id),f.m_id.features.flip=c,++i);e.m_pointCount=i}}}}},b2Collision.CollideCircles=function(e,t,n,r,i){e.m_pointCount=0;var s,o;s=n.R,o=t.m_p;var u=n.position.x+(s.col1.x*o.x+s.col2.x*o.y);n=n.position.y+(s.col1.y*o.x+s.col2.y*o.y),s=i.R,o=r.m_p,u=i.position.x+(s.col1.x*o.x+s.col2.x*o.y)-u,i=i.position.y+(s.col1.y*o.x+s.col2.y*o.y)-n,s=t.m_radius+r.m_radius,u*u+i*i>s*s||(e.m_type=b2Manifold.e_circles,e.m_localPoint.SetV(t.m_p),e.m_localPlaneNormal.SetZero(),e.m_pointCount=1,e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0)},b2Collision.CollidePolygonAndCircle=function(e,t,n,r,i){e.m_pointCount=0;var s,o,u,a;a=i.R,u=r.m_p;var f=i.position.y+(a.col1.y*u.x+a.col2.y*u.y);s=i.position.x+(a.col1.x*u.x+a.col2.x*u.y)-n.position.x,o=f-n.position.y,a=n.R,n=s*a.col1.x+o*a.col1.y,a=s*a.col2.x+o*a.col2.y;var l=0;i=-Number.MAX_VALUE,f=t.m_radius+r.m_radius;var c=t.m_vertexCount,h=t.m_vertices;t=t.m_normals;for(var p=0;p<c;++p){u=h[p],s=n-u.x,o=a-u.y,u=t[p],u=u.x*s+u.y*o;if(u>f)return;u>i&&(i=u,l=p)}u=l,s=h[u],c=h[u+1<c?u+1:0];if(i<Number.MIN_VALUE)e.m_pointCount=1,e.m_type=b2Manifold.e_faceA,e.m_localPlaneNormal.SetV(t[l]),e.m_localPoint.x=.5*(s.x+c.x),e.m_localPoint.y=.5*(s.y+c.y);else{i=(n-c.x)*(s.x-c.x)+(a-c.y)*(s.y-c.y);if((n-s.x)*(c.x-s.x)+(a-s.y)*(c.y-s.y)<=0){if((n-s.x)*(n-s.x)+(a-s.y)*(a-s.y)>f*f)return;e.m_pointCount=1,e.m_type=b2Manifold.e_faceA,e.m_localPlaneNormal.x=n-s.x,e.m_localPlaneNormal.y=a-s.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(s)}else if(i<=0){if((n-c.x)*(n-c.x)+(a-c.y)*(a-c.y)>f*f)return;e.m_pointCount=1,e.m_type=b2Manifold.e_faceA,e.m_localPlaneNormal.x=n-c.x,e.m_localPlaneNormal.y=a-c.y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.SetV(c)}else{l=.5*(s.x+c.x),s=.5*(s.y+c.y),i=(n-l)*t[u].x+(a-s)*t[u].y;if(i>f)return;e.m_pointCount=1,e.m_type=b2Manifold.e_faceA,e.m_localPlaneNormal.x=t[u].x,e.m_localPlaneNormal.y=t[u].y,e.m_localPlaneNormal.Normalize(),e.m_localPoint.Set(l,s)}}e.m_points[0].m_localPoint.SetV(r.m_p),e.m_points[0].m_id.key=0},b2Collision.TestOverlap=function(e,t){var n=t.lowerBound,r=e.upperBound,i=n.x-r.x,s=n.y-r.y;n=e.lowerBound,r=t.upperBound;var o=n.y-r.y;return i>0||s>0?!1:n.x-r.x>0||o>0?!1:!0},b2Collision.b2_nullFeature=255,b2Collision.s_incidentEdge=b2Collision.MakeClipPointVector(),b2Collision.s_clipPoints1=b2Collision.MakeClipPointVector(),b2Collision.s_clipPoints2=b2Collision.MakeClipPointVector(),b2Collision.s_edgeAO=Array(1),b2Collision.s_edgeBO=Array(1),b2Collision.s_localTangent=new b2Vec2,b2Collision.s_localNormal=new b2Vec2,b2Collision.s_planePoint=new b2Vec2,b2Collision.s_normal=new b2Vec2,b2Collision.s_tangent=new b2Vec2,b2Collision.s_tangent2=new b2Vec2,b2Collision.s_v11=new b2Vec2,b2Collision.s_v12=new b2Vec2,b2Collision.b2CollidePolyTempVec=new b2Vec2;var b2PolyAndCircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2PolyAndCircleContact.prototype,b2Contact.prototype),b2PolyAndCircleContact.prototype._super=b2Contact.prototype,b2PolyAndCircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2PolyAndCircleContact.prototype.__varz=function(){},b2PolyAndCircleContact.Create=function(){return new b2PolyAndCircleContact},b2PolyAndCircleContact.Destroy=function(){},b2PolyAndCircleContact.prototype.Evaluate=function(){var e=this.m_fixtureA.m_body,t=this.m_fixtureB.m_body;b2Collision.CollidePolygonAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),e.m_xf,this.m_fixtureB.GetShape(),t.m_xf)},b2PolyAndCircleContact.prototype.Reset=function(e,t){this._super.Reset.apply(this,[e,t]),b2Settings.b2Assert(e.GetType()==b2Shape.e_polygonShape),b2Settings.b2Assert(t.GetType()==b2Shape.e_circleShape)};var b2ContactPoint=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactPoint.prototype.__constructor=function(){},b2ContactPoint.prototype.__varz=function(){this.position=new b2Vec2,this.velocity=new b2Vec2,this.normal=new b2Vec2,this.id=new b2ContactID},b2ContactPoint.prototype.shape1=null,b2ContactPoint.prototype.shape2=null,b2ContactPoint.prototype.position=new b2Vec2,b2ContactPoint.prototype.velocity=new b2Vec2,b2ContactPoint.prototype.normal=new b2Vec2,b2ContactPoint.prototype.separation=null,b2ContactPoint.prototype.friction=null,b2ContactPoint.prototype.restitution=null,b2ContactPoint.prototype.id=new b2ContactID;var b2CircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2CircleContact.prototype,b2Contact.prototype),b2CircleContact.prototype._super=b2Contact.prototype,b2CircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2CircleContact.prototype.__varz=function(){},b2CircleContact.Create=function(){return new b2CircleContact},b2CircleContact.Destroy=function(){},b2CircleContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();b2Collision.CollideCircles(this.m_manifold,this.m_fixtureA.GetShape(),e.m_xf,this.m_fixtureB.GetShape(),t.m_xf)},b2CircleContact.prototype.Reset=function(e,t){this._super.Reset.apply(this,[e,t])};var b2EdgeAndCircleContact=function(){b2Contact.prototype.__varz.call(this),this.__varz(),this.__constructor.apply(this,arguments)};extend(b2EdgeAndCircleContact.prototype,b2Contact.prototype),b2EdgeAndCircleContact.prototype._super=b2Contact.prototype,b2EdgeAndCircleContact.prototype.__constructor=function(){this._super.__constructor.apply(this,arguments)},b2EdgeAndCircleContact.prototype.__varz=function(){},b2EdgeAndCircleContact.Create=function(){return new b2EdgeAndCircleContact},b2EdgeAndCircleContact.Destroy=function(){},b2EdgeAndCircleContact.prototype.Evaluate=function(){var e=this.m_fixtureA.GetBody(),t=this.m_fixtureB.GetBody();this.b2CollideEdgeAndCircle(this.m_manifold,this.m_fixtureA.GetShape(),e.m_xf,this.m_fixtureB.GetShape(),t.m_xf)},b2EdgeAndCircleContact.prototype.b2CollideEdgeAndCircle=function(){},b2EdgeAndCircleContact.prototype.Reset=function(e,t){this._super.Reset.apply(this,[e,t])};var b2ContactManager=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2ContactManager.prototype.__constructor=function(){this.m_world=null,this.m_contactCount=0,this.m_contactFilter=b2ContactFilter.b2_defaultFilter,this.m_contactListener=b2ContactListener.b2_defaultListener,this.m_contactFactory=new b2ContactFactory(this.m_allocator),this.m_broadPhase=new b2DynamicTreeBroadPhase},b2ContactManager.prototype.__varz=function(){},b2ContactManager.s_evalCP=new b2ContactPoint,b2ContactManager.prototype.AddPair=function(e,t){var n=e,r=t,i=n.GetBody(),s=r.GetBody();if(i!=s){for(var o=s.GetContactList();o;){if(o.other==i){var u=o.contact.GetFixtureA(),a=o.contact.GetFixtureB();if(u==n&&a==r)return;if(u==r&&a==n)return}o=o.next}s.ShouldCollide(i)!=0&&this.m_contactFilter.ShouldCollide(n,r)!=0&&(o=this.m_contactFactory.Create(n,r),n=o.GetFixtureA(),r=o.GetFixtureB(),i=n.m_body,s=r.m_body,o.m_prev=null,o.m_next=this.m_world.m_contactList,this.m_world.m_contactList!=null&&(this.m_world.m_contactList.m_prev=o),this.m_world.m_contactList=o,o.m_nodeA.contact=o,o.m_nodeA.other=s,o.m_nodeA.prev=null,o.m_nodeA.next=i.m_contactList,i.m_contactList!=null&&(i.m_contactList.prev=o.m_nodeA),i.m_contactList=o.m_nodeA,o.m_nodeB.contact=o,o.m_nodeB.other=i,o.m_nodeB.prev=null,o.m_nodeB.next=s.m_contactList,s.m_contactList!=null&&(s.m_contactList.prev=o.m_nodeB),s.m_contactList=o.m_nodeB,++this.m_world.m_contactCount)}},b2ContactManager.prototype.FindNewContacts=function(){var e=this;this.m_broadPhase.UpdatePairs(function(t,n){return e.AddPair(t,n)})},b2ContactManager.prototype.Destroy=function(e){var t=e.GetFixtureA(),n=e.GetFixtureB();t=t.GetBody(),n=n.GetBody(),e.IsTouching()&&this.m_contactListener.EndContact(e),e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_world.m_contactList&&(this.m_world.m_contactList=e.m_next),e.m_nodeA.prev&&(e.m_nodeA.prev.next=e.m_nodeA.next),e.m_nodeA.next&&(e.m_nodeA.next.prev=e.m_nodeA.prev),e.m_nodeA==t.m_contactList&&(t.m_contactList=e.m_nodeA.next),e.m_nodeB.prev&&(e.m_nodeB.prev.next=e.m_nodeB.next),e.m_nodeB.next&&(e.m_nodeB.next.prev=e.m_nodeB.prev),e.m_nodeB==n.m_contactList&&(n.m_contactList=e.m_nodeB.next),this.m_contactFactory.Destroy(e),--this.m_contactCount},b2ContactManager.prototype.Collide=function(){for(var e=this.m_world.m_contactList;e;){var t=e.GetFixtureA(),n=e.GetFixtureB(),r=t.GetBody(),i=n.GetBody();if(r.IsAwake()==0&&i.IsAwake()==0)e=e.GetNext();else{if(e.m_flags&b2Contact.e_filterFlag){if(i.ShouldCollide(r)==0){t=e,e=t.GetNext(),this.Destroy(t);continue}if(this.m_contactFilter.ShouldCollide(t,n)==0){t=e,e=t.GetNext(),this.Destroy(t);continue}e.m_flags&=~b2Contact.e_filterFlag}this.m_broadPhase.TestOverlap(t.m_proxy,n.m_proxy)==0?(t=e,e=t.GetNext(),this.Destroy(t)):(e.Update(this.m_contactListener),e=e.GetNext())}}},b2ContactManager.prototype.m_world=null,b2ContactManager.prototype.m_broadPhase=null,b2ContactManager.prototype.m_contactList=null,b2ContactManager.prototype.m_contactCount=0,b2ContactManager.prototype.m_contactFilter=null,b2ContactManager.prototype.m_contactListener=null,b2ContactManager.prototype.m_contactFactory=null,b2ContactManager.prototype.m_allocator=null;var b2World=function(){this.__varz(),this.__constructor.apply(this,arguments)};b2World.prototype.__constructor=function(e,t){this.m_controllerList=this.m_jointList=this.m_contactList=this.m_bodyList=this.m_debugDraw=this.m_destructionListener=null,this.m_controllerCount=this.m_jointCount=this.m_contactCount=this.m_bodyCount=0,b2World.m_warmStarting=!0,b2World.m_continuousPhysics=!0,this.m_allowSleep=t,this.m_gravity=e,this.m_inv_dt0=0,this.m_contactManager.m_world=this,this.m_groundBody=this.CreateBody(new b2BodyDef)},b2World.prototype.__varz=function(){this.s_stack=[],this.m_contactManager=new b2ContactManager,this.m_contactSolver=new b2ContactSolver,this.m_island=new b2Island},b2World.s_timestep2=new b2TimeStep,b2World.s_backupA=new b2Sweep,b2World.s_backupB=new b2Sweep,b2World.s_timestep=new b2TimeStep,b2World.s_queue=[],b2World.e_newFixture=1,b2World.e_locked=2,b2World.s_xf=new b2Transform,b2World.s_jointColor=new b2Color(.5,.8,.8),b2World.m_warmStarting=null,b2World.m_continuousPhysics=null,b2World.prototype.Solve=function(e){for(var t,n=this.m_controllerList;n;n=n.m_next)n.Step(e);n=this.m_island,n.Initialize(this.m_bodyCount,this.m_contactCount,this.m_jointCount,null,this.m_contactManager.m_contactListener,this.m_contactSolver);for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~b2Body.e_islandFlag;for(var r=this.m_contactList;r;r=r.m_next)r.m_flags&=~b2Contact.e_islandFlag;for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;r=this.s_stack;for(var i=this.m_bodyList;i;i=i.m_next)if(!(i.m_flags&b2Body.e_islandFlag)&&i.IsAwake()!=0&&i.IsActive()!=0&&i.GetType()!=b2Body.b2_staticBody){n.Clear();var s=0;r[s++]=i;for(i.m_flags|=b2Body.e_islandFlag;s>0;){t=r[--s],n.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()!=b2Body.b2_staticBody){for(var o,u=t.m_contactList;u;u=u.next)u.contact.m_flags&b2Contact.e_islandFlag||u.contact.IsSensor()!=1&&u.contact.IsEnabled()!=0&&u.contact.IsTouching()!=0&&(n.AddContact(u.contact),u.contact.m_flags|=b2Contact.e_islandFlag,o=u.other,o.m_flags&b2Body.e_islandFlag||(r[s++]=o,o.m_flags|=b2Body.e_islandFlag));for(t=t.m_jointList;t;t=t.next)t.joint.m_islandFlag!=1&&(o=t.other,o.IsActive()!=0&&(n.AddJoint(t.joint),t.joint.m_islandFlag=!0,o.m_flags&b2Body.e_islandFlag||(r[s++]=o,o.m_flags|=b2Body.e_islandFlag)))}}n.Solve(e,this.m_gravity,this.m_allowSleep);for(s=0;s<n.m_bodyCount;++s)t=n.m_bodies[s],t.GetType()==b2Body.b2_staticBody&&(t.m_flags&=~b2Body.e_islandFlag)}for(s=0;s<r.length;++s){if(!r[s])break;r[s]=null}for(t=this.m_bodyList;t;t=t.m_next)t.IsAwake()==0||t.IsActive()==0||t.GetType()!=b2Body.b2_staticBody&&t.SynchronizeFixtures();this.m_contactManager.FindNewContacts()},b2World.prototype.SolveTOI=function(e){var t,n,r,i=this.m_island;i.Initialize(this.m_bodyCount,b2Settings.b2_maxTOIContactsPerIsland,b2Settings.b2_maxTOIJointsPerIsland,null,this.m_contactManager.m_contactListener,this.m_contactSolver);var s=b2World.s_queue;for(t=this.m_bodyList;t;t=t.m_next)t.m_flags&=~b2Body.e_islandFlag,t.m_sweep.t0=0;for(r=this.m_contactList;r;r=r.m_next)r.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(r=this.m_jointList;r;r=r.m_next)r.m_islandFlag=!1;for(;;){var o=null,u=1;for(r=this.m_contactList;r;r=r.m_next)if(r.IsSensor()!=1&&r.IsEnabled()!=0&&r.IsContinuous()!=0){t=1;if(r.m_flags&b2Contact.e_toiFlag)t=r.m_toi;else{t=r.m_fixtureA,n=r.m_fixtureB,t=t.m_body,n=n.m_body;if(!(t.GetType()==b2Body.b2_dynamicBody&&t.IsAwake()!=0||n.GetType()==b2Body.b2_dynamicBody&&n.IsAwake()!=0))continue;var a=t.m_sweep.t0;t.m_sweep.t0<n.m_sweep.t0?(a=n.m_sweep.t0,t.m_sweep.Advance(a)):n.m_sweep.t0<t.m_sweep.t0&&(a=t.m_sweep.t0,n.m_sweep.Advance(a)),t=r.ComputeTOI(t.m_sweep,n.m_sweep),b2Settings.b2Assert(0<=t&&t<=1),t>0&&t<1&&(t=(1-t)*a+t,t>1&&(t=1)),r.m_toi=t,r.m_flags|=b2Contact.e_toiFlag}Number.MIN_VALUE<t&&t<u&&(o=r,u=t)}if(o==null||1-100*Number.MIN_VALUE<u)break;t=o.m_fixtureA,n=o.m_fixtureB,t=t.m_body,n=n.m_body,b2World.s_backupA.Set(t.m_sweep),b2World.s_backupB.Set(n.m_sweep),t.Advance(u),n.Advance(u),o.Update(this.m_contactManager.m_contactListener),o.m_flags&=~b2Contact.e_toiFlag;if(o.IsSensor()==1||o.IsEnabled()==0)t.m_sweep.Set(b2World.s_backupA),n.m_sweep.Set(b2World.s_backupB),t.SynchronizeTransform(),n.SynchronizeTransform();else if(o.IsTouching()!=0){t=t,t.GetType()!=b2Body.b2_dynamicBody&&(t=n),i.Clear(),o=r=0,s[r+o++]=t;for(t.m_flags|=b2Body.e_islandFlag;o>0;){t=s[r++],--o,i.AddBody(t),t.IsAwake()==0&&t.SetAwake(!0);if(t.GetType()==b2Body.b2_dynamicBody){for(n=t.m_contactList;n;n=n.next){if(i.m_contactCount==i.m_contactCapacity)break;n.contact.m_flags&b2Contact.e_islandFlag||n.contact.IsSensor()!=1&&n.contact.IsEnabled()!=0&&n.contact.IsTouching()!=0&&(i.AddContact(n.contact),n.contact.m_flags|=b2Contact.e_islandFlag,a=n.other,a.m_flags&b2Body.e_islandFlag||(a.GetType()!=b2Body.b2_staticBody&&(a.Advance(u),a.SetAwake(!0)),s[r+o]=a,++o,a.m_flags|=b2Body.e_islandFlag))}for(t=t.m_jointList;t;t=t.next)i.m_jointCount!=i.m_jointCapacity&&t.joint.m_islandFlag!=1&&(a=t.other,a.IsActive()!=0&&(i.AddJoint(t.joint),t.joint.m_islandFlag=!0,a.m_flags&b2Body.e_islandFlag||(a.GetType()!=b2Body.b2_staticBody&&(a.Advance(u),a.SetAwake(!0)),s[r+o]=a,++o,a.m_flags|=b2Body.e_islandFlag)))}}r=b2World.s_timestep,r.warmStarting=!1,r.dt=(1-u)*e.dt,r.inv_dt=1/r.dt,r.dtRatio=0,r.velocityIterations=e.velocityIterations,r.positionIterations=e.positionIterations,i.SolveTOI(r);for(u=u=0;u<i.m_bodyCount;++u){t=i.m_bodies[u],t.m_flags&=~b2Body.e_islandFlag;if(t.IsAwake()!=0&&t.GetType()==b2Body.b2_dynamicBody){t.SynchronizeFixtures();for(n=t.m_contactList;n;n=n.next)n.contact.m_flags&=~b2Contact.e_toiFlag}}for(u=0;u<i.m_contactCount;++u)r=i.m_contacts[u],r.m_flags&=~(b2Contact.e_toiFlag|b2Contact.e_islandFlag);for(u=0;u<i.m_jointCount;++u)r=i.m_joints[u],r.m_islandFlag=!1;this.m_contactManager.FindNewContacts()}}},b2World.prototype.DrawJoint=function(e){var t=e.GetBodyA(),n=e.GetBodyB(),r=t.m_xf.position,i=n.m_xf.position,s=e.GetAnchorA(),o=e.GetAnchorB(),u=b2World.s_jointColor;switch(e.m_type){case b2Joint.e_distanceJoint:this.m_debugDraw.DrawSegment(s,o,u);break;case b2Joint.e_pulleyJoint:t=e.GetGroundAnchorA(),e=e.GetGroundAnchorB(),this.m_debugDraw.DrawSegment(t,s,u),this.m_debugDraw.DrawSegment(e,o,u),this.m_debugDraw.DrawSegment(t,e,u);break;case b2Joint.e_mouseJoint:this.m_debugDraw.DrawSegment(s,o,u);break;default:t!=this.m_groundBody&&this.m_debugDraw.DrawSegment(r,s,u),this.m_debugDraw.DrawSegment(s,o,u),n!=this.m_groundBody&&this.m_debugDraw.DrawSegment(i,o,u)}},b2World.prototype.DrawShape=function(e,t,n){switch(e.m_type){case b2Shape.e_circleShape:this.m_debugDraw.DrawSolidCircle(b2Math.MulX(t,e.m_p),e.m_radius,t.R.col1,n);break;case b2Shape.e_polygonShape:var r=0,i=e.GetVertexCount();e=e.GetVertices();var s=Array(i);for(r=0;r<i;++r)s[r]=b2Math.MulX(t,e[r]);this.m_debugDraw.DrawSolidPolygon(s,i,n);break;case b2Shape.e_edgeShape:this.m_debugDraw.DrawSegment(b2Math.MulX(t,e.GetVertex1()),b2Math.MulX(t,e.GetVertex2()),n)}},b2World.prototype.SetDestructionListener=function(e){this.m_destructionListener=e},b2World.prototype.SetContactFilter=function(e){this.m_contactManager.m_contactFilter=e},b2World.prototype.SetContactListener=function(e){this.m_contactManager.m_contactListener=e},b2World.prototype.SetDebugDraw=function(e){this.m_debugDraw=e},b2World.prototype.SetBroadPhase=function(e){var t=this.m_contactManager.m_broadPhase;this.m_contactManager.m_broadPhase=e;for(var n=this.m_bodyList;n;n=n.m_next)for(var r=n.m_fixtureList;r;r=r.m_next)r.m_proxy=e.CreateProxy(t.GetFatAABB(r.m_proxy),r)},b2World.prototype.Validate=function(){this.m_contactManager.m_broadPhase.Validate()},b2World.prototype.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},b2World.prototype.CreateBody=function(e){if(this.IsLocked()==1)return null;e=new b2Body(e,this),e.m_prev=null;if(e.m_next=this.m_bodyList)this.m_bodyList.m_prev=e;return this.m_bodyList=e,++this.m_bodyCount,e},b2World.prototype.DestroyBody=function(e){if(this.IsLocked()!=1){for(var t=e.m_jointList;t;){var n=t;t=t.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint)}for(t=e.m_controllerList;t;)n=t,t=t.nextController,n.controller.RemoveBody(e);for(t=e.m_contactList;t;)n=t,t=t.next,this.m_contactManager.Destroy(n.contact);e.m_contactList=null;for(t=e.m_fixtureList;t;)n=t,t=t.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(n),n.DestroyProxy(this.m_contactManager.m_broadPhase),n.Destroy();e.m_fixtureList=null,e.m_fixtureCount=0,e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_bodyList&&(this.m_bodyList=e.m_next),--this.m_bodyCount}},b2World.prototype.CreateJoint=function(e){var t=b2Joint.Create(e,null);t.m_prev=null;if(t.m_next=this.m_jointList)this.m_jointList.m_prev=t;this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null;if(t.m_edgeA.next=t.m_bodyA.m_jointList)t.m_bodyA.m_jointList.prev=t.m_edgeA;t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null;if(t.m_edgeB.next=t.m_bodyB.m_jointList)t.m_bodyB.m_jointList.prev=t.m_edgeB;t.m_bodyB.m_jointList=t.m_edgeB;var n=e.bodyA,r=e.bodyB;if(e.collideConnected==0)for(e=r.GetContactList();e;)e.other==n&&e.contact.FlagForFiltering(),e=e.next;return t},b2World.prototype.DestroyJoint=function(e){var t=e.m_collideConnected;e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),e==this.m_jointList&&(this.m_jointList=e.m_next);var n=e.m_bodyA,r=e.m_bodyB;n.SetAwake(!0),r.SetAwake(!0),e.m_edgeA.prev&&(e.m_edgeA.prev.next=e.m_edgeA.next),e.m_edgeA.next&&(e.m_edgeA.next.prev=e.m_edgeA.prev),e.m_edgeA==n.m_jointList&&(n.m_jointList=e.m_edgeA.next),e.m_edgeA.prev=null,e.m_edgeA.next=null,e.m_edgeB.prev&&(e.m_edgeB.prev.next=e.m_edgeB.next),e.m_edgeB.next&&(e.m_edgeB.next.prev=e.m_edgeB.prev),e.m_edgeB==r.m_jointList&&(r.m_jointList=e.m_edgeB.next),e.m_edgeB.prev=null,e.m_edgeB.next=null,b2Joint.Destroy(e,null),--this.m_jointCount;if(t==0)for(e=r.GetContactList();e;)e.other==n&&e.contact.FlagForFiltering(),e=e.next},b2World.prototype.AddController=function(e){return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList=e,e.m_world=this,this.m_controllerCount++,e},b2World.prototype.RemoveController=function(e){e.m_prev&&(e.m_prev.m_next=e.m_next),e.m_next&&(e.m_next.m_prev=e.m_prev),this.m_controllerList==e&&(this.m_controllerList=e.m_next),this.m_controllerCount--},b2World.prototype.CreateController=function(e){if(e.m_world!=this)throw Error("Controller can only be a member of one world");return e.m_next=this.m_controllerList,e.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=e),this.m_controllerList=e,++this.m_controllerCount,e.m_world=this,e},b2World.prototype.DestroyController=function(e){e.Clear(),e.m_next&&(e.m_next.m_prev=e.m_prev),e.m_prev&&(e.m_prev.m_next=e.m_next),e==this.m_controllerList&&(this.m_controllerList=e.m_next),--this.m_controllerCount},b2World.prototype.SetWarmStarting=function(e){b2World.m_warmStarting=e},b2World.prototype.SetContinuousPhysics=function(e){b2World.m_continuousPhysics=e},b2World.prototype.GetBodyCount=function(){return this.m_bodyCount},b2World.prototype.GetJointCount=function(){return this.m_jointCount},b2World.prototype.GetContactCount=function(){return this.m_contactCount},b2World.prototype.SetGravity=function(e){this.m_gravity=e},b2World.prototype.GetGravity=function(){return this.m_gravity},b2World.prototype.GetGroundBody=function(){return this.m_groundBody},b2World.prototype.Step=function(e,t,n){this.m_flags&b2World.e_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_flags&=~b2World.e_newFixture),this.m_flags|=b2World.e_locked;var r=b2World.s_timestep2;r.dt=e,r.velocityIterations=t,r.positionIterations=n,r.inv_dt=e>0?1/e:0,r.dtRatio=this.m_inv_dt0*e,r.warmStarting=b2World.m_warmStarting,this.m_contactManager.Collide(),r.dt>0&&this.Solve(r),b2World.m_continuousPhysics&&r.dt>0&&this.SolveTOI(r),r.dt>0&&(this.m_inv_dt0=r.inv_dt),this.m_flags&=~b2World.e_locked},b2World.prototype.ClearForces=function(){for(var e=this.m_bodyList;e;e=e.m_next)e.m_force.SetZero(),e.m_torque=0},b2World.prototype.DrawDebugData=function(){if(this.m_debugDraw!=null){this.m_debugDraw.Clear();var e=this.m_debugDraw.GetFlags(),t,n,r;new b2Vec2,new b2Vec2,new b2Vec2;var i;new b2AABB,new b2AABB,i=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2];var s=new b2Color(0,0,0);if(e&b2DebugDraw.e_shapeBit)for(t=this.m_bodyList;t;t=t.m_next){i=t.m_xf;for(n=t.GetFixtureList();n;n=n.m_next)r=n.GetShape(),t.IsActive()==0?s.Set(.5,.5,.3):t.GetType()==b2Body.b2_staticBody?s.Set(.5,.9,.5):t.GetType()==b2Body.b2_kinematicBody?s.Set(.5,.5,.9):t.IsAwake()==0?s.Set(.6,.6,.6):s.Set(.9,.7,.7),this.DrawShape(r,i,s)}if(e&b2DebugDraw.e_jointBit)for(t=this.m_jointList;t;t=t.m_next)this.DrawJoint(t);if(e&b2DebugDraw.e_controllerBit)for(t=this.m_controllerList;t;t=t.m_next)t.Draw(this.m_debugDraw);if(e&b2DebugDraw.e_pairBit){s.Set(.3,.9,.9);for(t=this.m_contactManager.m_contactList;t;t=t.GetNext())r=t.GetFixtureA(),n=t.GetFixtureB(),r=r.GetAABB().GetCenter(),n=n.GetAABB().GetCenter(),this.m_debugDraw.DrawSegment(r,n,s)}if(e&b2DebugDraw.e_aabbBit){r=this.m_contactManager.m_broadPhase,i=[new b2Vec2,new b2Vec2,new b2Vec2,new b2Vec2];for(t=this.m_bodyList;t;t=t.GetNext())if(t.IsActive()!=0)for(n=t.GetFixtureList();n;n=n.GetNext()){var o=r.GetFatAABB(n.m_proxy);i[0].Set(o.lowerBound.x,o.lowerBound.y),i[1].Set(o.upperBound.x,o.lowerBound.y),i[2].Set(o.upperBound.x,o.upperBound.y),i[3].Set(o.lowerBound.x,o.upperBound.y),this.m_debugDraw.DrawPolygon(i,4,s)}}if(e&b2DebugDraw.e_centerOfMassBit)for(t=this.m_bodyList;t;t=t.m_next)i=b2World.s_xf,i.R=t.m_xf.R,i.position=t.GetWorldCenter(),this.m_debugDraw.DrawTransform(i)}},b2World.prototype.QueryAABB=function(e,t){var n=this.m_contactManager.m_broadPhase;n.Query(function(t){return e(n.GetUserData(t))},t)},b2World.prototype.QueryShape=function(e,t,n){n==null&&(n=new b2Transform,n.SetIdentity());var r=this.m_contactManager.m_broadPhase,i=new b2AABB;t.ComputeAABB(i,n),r.Query(function(i){return i=r.GetUserData(i),b2Shape.TestOverlap(t,n,i.GetShape(),i.GetBody().GetTransform())?e(i):!0},i)},b2World.prototype.QueryPoint=function(e,t){var n=this.m_contactManager.m_broadPhase,r=new b2AABB;r.lowerBound.Set(t.x-b2Settings.b2_linearSlop,t.y-b2Settings.b2_linearSlop),r.upperBound.Set(t.x+b2Settings.b2_linearSlop,t.y+b2Settings.b2_linearSlop),n.Query(function(r){return r=n.GetUserData(r),r.TestPoint(t)?e(r):!0},r)},b2World.prototype.RayCast=function(e,t,n){var r=this.m_contactManager.m_broadPhase,i=new b2RayCastOutput,s=new b2RayCastInput(t,n);r.RayCast(function(s,o){var u=r.GetUserData(o);if(u.RayCast(i,s)){var f=i.fraction,l=new b2Vec2((1-f)*t.x+f*n.x,(1-f)*t.y+f*n.y);return e(u,l,i.normal,f)}return s.maxFraction},s)},b2World.prototype.RayCastOne=function(e,t){var n;return this.RayCast(function(e,t,r,i){return n=e,i},e,t),n},b2World.prototype.RayCastAll=function(e,t){var n=[];return this.RayCast(function(e){return n[n.length]=e,1},e,t),n},b2World.prototype.GetBodyList=function(){return this.m_bodyList},b2World.prototype.GetJointList=function(){return this.m_jointList},b2World.prototype.GetContactList=function(){return this.m_contactList},b2World.prototype.IsLocked=function(){return(this.m_flags&b2World.e_locked)>0},b2World.prototype.s_stack=[],b2World.prototype.m_flags=0,b2World.prototype.m_contactManager=new b2ContactManager,b2World.prototype.m_contactSolver=new b2ContactSolver,b2World.prototype.m_island=new b2Island,b2World.prototype.m_bodyList=null,b2World.prototype.m_jointList=null,b2World.prototype.m_contactList=null,b2World.prototype.m_bodyCount=0,b2World.prototype.m_contactCount=0,b2World.prototype.m_jointCount=0,b2World.prototype.m_controllerList=null,b2World.prototype.m_controllerCount=0,b2World.prototype.m_gravity=null,b2World.prototype.m_allowSleep=null,b2World.prototype.m_groundBody=null,b2World.prototype.m_destructionListener=null,b2World.prototype.m_debugDraw=null,b2World.prototype.m_inv_dt0=null,typeof exports!="undefined"&&(exports.b2BoundValues=b2BoundValues,exports.b2Math=b2Math,exports.b2DistanceOutput=b2DistanceOutput,exports.b2Mat33=b2Mat33,exports.b2ContactPoint=b2ContactPoint,exports.b2PairManager=b2PairManager,exports.b2PositionSolverManifold=b2PositionSolverManifold,exports.b2OBB=b2OBB,exports.b2CircleContact=b2CircleContact,exports.b2PulleyJoint=b2PulleyJoint,exports.b2Pair=b2Pair,exports.b2TimeStep=b2TimeStep,exports.b2FixtureDef=b2FixtureDef,exports.b2World=b2World,exports.b2PrismaticJoint=b2PrismaticJoint,exports.b2Controller=b2Controller,exports.b2ContactID=b2ContactID,exports.b2RevoluteJoint=b2RevoluteJoint,exports.b2JointDef=b2JointDef,exports.b2Transform=b2Transform,exports.b2GravityController=b2GravityController,exports.b2EdgeAndCircleContact=b2EdgeAndCircleContact,exports.b2EdgeShape=b2EdgeShape,exports.b2BuoyancyController=b2BuoyancyController,exports.b2LineJointDef=b2LineJointDef,exports.b2Contact=b2Contact,exports.b2DistanceJoint=b2DistanceJoint,exports.b2Body=b2Body,exports.b2DestructionListener=b2DestructionListener,exports.b2PulleyJointDef=b2PulleyJointDef,exports.b2ContactEdge=b2ContactEdge,exports.b2ContactConstraint=b2ContactConstraint,exports.b2ContactImpulse=b2ContactImpulse,exports.b2DistanceJointDef=b2DistanceJointDef,exports.b2ContactResult=b2ContactResult,exports.b2EdgeChainDef=b2EdgeChainDef,exports.b2Vec2=b2Vec2,exports.b2Vec3=b2Vec3,exports.b2DistanceProxy=b2DistanceProxy,exports.b2FrictionJointDef=b2FrictionJointDef,exports.b2PolygonContact=b2PolygonContact,exports.b2TensorDampingController=b2TensorDampingController,exports.b2ContactFactory=b2ContactFactory,exports.b2WeldJointDef=b2WeldJointDef,exports.b2ConstantAccelController=b2ConstantAccelController,exports.b2GearJointDef=b2GearJointDef,exports.ClipVertex=ClipVertex,exports.b2SeparationFunction=b2SeparationFunction,exports.b2ManifoldPoint=b2ManifoldPoint,exports.b2Color=b2Color,exports.b2PolygonShape=b2PolygonShape,exports.b2DynamicTreePair=b2DynamicTreePair,exports.b2ContactConstraintPoint=b2ContactConstraintPoint,exports.b2FrictionJoint=b2FrictionJoint,exports.b2ContactFilter=b2ContactFilter,exports.b2ControllerEdge=b2ControllerEdge,exports.b2Distance=b2Distance,exports.b2Fixture=b2Fixture,exports.b2DynamicTreeNode=b2DynamicTreeNode,exports.b2MouseJoint=b2MouseJoint,exports.b2DistanceInput=b2DistanceInput,exports.b2BodyDef=b2BodyDef,exports.b2DynamicTreeBroadPhase=b2DynamicTreeBroadPhase,exports.b2Settings=b2Settings,exports.b2Proxy=b2Proxy,exports.b2Point=b2Point,exports.b2BroadPhase=b2BroadPhase,exports.b2Manifold=b2Manifold,exports.b2WorldManifold=b2WorldManifold,exports.b2PrismaticJointDef=b2PrismaticJointDef,exports.b2RayCastOutput=b2RayCastOutput,exports.b2ConstantForceController=b2ConstantForceController,exports.b2TimeOfImpact=b2TimeOfImpact,exports.b2CircleShape=b2CircleShape,exports.b2MassData=b2MassData,exports.b2Joint=b2Joint,exports.b2GearJoint=b2GearJoint,exports.b2DynamicTree=b2DynamicTree,exports.b2JointEdge=b2JointEdge,exports.b2LineJoint=b2LineJoint,exports.b2NullContact=b2NullContact,exports.b2ContactListener=b2ContactListener,exports.b2RayCastInput=b2RayCastInput,exports.b2TOIInput=b2TOIInput,exports.Features=Features,exports.b2FilterData=b2FilterData,exports.b2Island=b2Island,exports.b2ContactManager=b2ContactManager,exports.b2ContactSolver=b2ContactSolver,exports.b2Simplex=b2Simplex,exports.b2AABB=b2AABB,exports.b2Jacobian=b2Jacobian,exports.b2Bound=b2Bound,exports.b2RevoluteJointDef=b2RevoluteJointDef,exports.b2PolyAndEdgeContact=b2PolyAndEdgeContact,exports.b2SimplexVertex=b2SimplexVertex,exports.b2WeldJoint=b2WeldJoint,exports.b2Collision=b2Collision,exports.b2Mat22=b2Mat22,exports.b2SimplexCache=b2SimplexCache,exports.b2PolyAndCircleContact=b2PolyAndCircleContact,exports.b2MouseJointDef=b2MouseJointDef,exports.b2Shape=b2Shape,exports.b2Segment=b2Segment,exports.b2ContactRegister=b2ContactRegister,exports.b2DebugDraw=b2DebugDraw,exports.b2Sweep=b2Sweep),define("lib/Box2d",function(){}),define("engine/PhysicsManager",["core/Monogatari","core/Constants","core/Timer","core/collection/Map","lib/Three","lib/Box2d","engine/EventManager"],function(){function e(){this.world=null,this.velocityIterations=10,this.positionIterations=10,this.clearForcesOnUpdate=!1}Monogatari.PhysicsManager=new e,e.prototype.createWorld=function(e,t){this.world=new b2World(new b2Vec2(e.x,e.y),t),this.createListener()},e.prototype.createBody=function(e){return this.world.CreateBody(e)},e.prototype.createListener=function(){var e=new b2ContactListener;e.BeginContact=function(e){Monogatari.EventManager.notify("PhysicsManager.beginContact",e)},e.EndContact=function(e){Monogatari.EventManager.notify("PhysicsManager.endContact",e)},this.world.SetContactListener(e)},e.prototype.update=function(){if(this.world){var e=Monogatari.Frames.getFps();this.world.Step(e?1/e:Monogatari.Constants.FRAME_RATE_60FPS,this.velocityIterations,this.positionIterations),this.clearForcesOnUpdate&&this.world.ClearForces()}}}),define("engine/GameManager",["core/Monogatari","core/Timer","core/String","engine/EventManager","engine/AudioManager","engine/FontManager","engine/SceneManager","engine/ObjectManager","engine/PhysicsManager"],function(){function e(){}Monogatari.GameManager=new e,e.prototype.init=function(e,t,n,r){Monogatari.SceneManager.init(e,t,n,r)},e.prototype.update=function(){Monogatari.Time.tick(),Monogatari.PhysicsManager.update(),Monogatari.ObjectManager.update()},e.prototype.render=function(){Monogatari.SceneManager.render()},e.prototype.run=function(){requestAnimationFrame(Monogatari.GameManager.run),Monogatari.GameManager.update(),Monogatari.GameManager.render()}});